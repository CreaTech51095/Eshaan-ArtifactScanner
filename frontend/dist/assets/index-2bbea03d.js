var sP=Object.defineProperty;var iP=(t,e,n)=>e in t?sP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Qo=(t,e,n)=>(iP(t,typeof e!="symbol"?e+"":e,n),n);function xI(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var jh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wI(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var _I={exports:{}},Xg={},vI={exports:{}},mt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tf=Symbol.for("react.element"),oP=Symbol.for("react.portal"),aP=Symbol.for("react.fragment"),lP=Symbol.for("react.strict_mode"),cP=Symbol.for("react.profiler"),uP=Symbol.for("react.provider"),hP=Symbol.for("react.context"),dP=Symbol.for("react.forward_ref"),fP=Symbol.for("react.suspense"),mP=Symbol.for("react.memo"),gP=Symbol.for("react.lazy"),m2=Symbol.iterator;function pP(t){return t===null||typeof t!="object"?null:(t=m2&&t[m2]||t["@@iterator"],typeof t=="function"?t:null)}var EI={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},AI=Object.assign,bI={};function rh(t,e,n){this.props=t,this.context=e,this.refs=bI,this.updater=n||EI}rh.prototype.isReactComponent={};rh.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};rh.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function II(){}II.prototype=rh.prototype;function xw(t,e,n){this.props=t,this.context=e,this.refs=bI,this.updater=n||EI}var ww=xw.prototype=new II;ww.constructor=xw;AI(ww,rh.prototype);ww.isPureReactComponent=!0;var g2=Array.isArray,CI=Object.prototype.hasOwnProperty,_w={current:null},TI={key:!0,ref:!0,__self:!0,__source:!0};function SI(t,e,n){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)CI.call(e,r)&&!TI.hasOwnProperty(r)&&(s[r]=e[r]);var u=arguments.length-2;if(u===1)s.children=n;else if(1<u){for(var d=Array(u),m=0;m<u;m++)d[m]=arguments[m+2];s.children=d}if(t&&t.defaultProps)for(r in u=t.defaultProps,u)s[r]===void 0&&(s[r]=u[r]);return{$$typeof:Tf,type:t,key:i,ref:a,props:s,_owner:_w.current}}function yP(t,e){return{$$typeof:Tf,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function vw(t){return typeof t=="object"&&t!==null&&t.$$typeof===Tf}function xP(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var p2=/\/+/g;function r1(t,e){return typeof t=="object"&&t!==null&&t.key!=null?xP(""+t.key):e.toString(36)}function im(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Tf:case oP:a=!0}}if(a)return a=t,s=s(a),t=r===""?"."+r1(a,0):r,g2(s)?(n="",t!=null&&(n=t.replace(p2,"$&/")+"/"),im(s,e,n,"",function(m){return m})):s!=null&&(vw(s)&&(s=yP(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(p2,"$&/")+"/")+t)),e.push(s)),1;if(a=0,r=r===""?".":r+":",g2(t))for(var u=0;u<t.length;u++){i=t[u];var d=r+r1(i,u);a+=im(i,e,n,d,s)}else if(d=pP(t),typeof d=="function")for(t=d.call(t),u=0;!(i=t.next()).done;)i=i.value,d=r+r1(i,u++),a+=im(i,e,n,d,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function v0(t,e,n){if(t==null)return t;var r=[],s=0;return im(t,r,"","",function(i){return e.call(n,i,s++)}),r}function wP(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ts={current:null},om={transition:null},_P={ReactCurrentDispatcher:ts,ReactCurrentBatchConfig:om,ReactCurrentOwner:_w};function NI(){throw Error("act(...) is not supported in production builds of React.")}mt.Children={map:v0,forEach:function(t,e,n){v0(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return v0(t,function(){e++}),e},toArray:function(t){return v0(t,function(e){return e})||[]},only:function(t){if(!vw(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};mt.Component=rh;mt.Fragment=aP;mt.Profiler=cP;mt.PureComponent=xw;mt.StrictMode=lP;mt.Suspense=fP;mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_P;mt.act=NI;mt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=AI({},t.props),s=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=_w.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var u=t.type.defaultProps;for(d in e)CI.call(e,d)&&!TI.hasOwnProperty(d)&&(r[d]=e[d]===void 0&&u!==void 0?u[d]:e[d])}var d=arguments.length-2;if(d===1)r.children=n;else if(1<d){u=Array(d);for(var m=0;m<d;m++)u[m]=arguments[m+2];r.children=u}return{$$typeof:Tf,type:t.type,key:s,ref:i,props:r,_owner:a}};mt.createContext=function(t){return t={$$typeof:hP,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:uP,_context:t},t.Consumer=t};mt.createElement=SI;mt.createFactory=function(t){var e=SI.bind(null,t);return e.type=t,e};mt.createRef=function(){return{current:null}};mt.forwardRef=function(t){return{$$typeof:dP,render:t}};mt.isValidElement=vw;mt.lazy=function(t){return{$$typeof:gP,_payload:{_status:-1,_result:t},_init:wP}};mt.memo=function(t,e){return{$$typeof:mP,type:t,compare:e===void 0?null:e}};mt.startTransition=function(t){var e=om.transition;om.transition={};try{t()}finally{om.transition=e}};mt.unstable_act=NI;mt.useCallback=function(t,e){return ts.current.useCallback(t,e)};mt.useContext=function(t){return ts.current.useContext(t)};mt.useDebugValue=function(){};mt.useDeferredValue=function(t){return ts.current.useDeferredValue(t)};mt.useEffect=function(t,e){return ts.current.useEffect(t,e)};mt.useId=function(){return ts.current.useId()};mt.useImperativeHandle=function(t,e,n){return ts.current.useImperativeHandle(t,e,n)};mt.useInsertionEffect=function(t,e){return ts.current.useInsertionEffect(t,e)};mt.useLayoutEffect=function(t,e){return ts.current.useLayoutEffect(t,e)};mt.useMemo=function(t,e){return ts.current.useMemo(t,e)};mt.useReducer=function(t,e,n){return ts.current.useReducer(t,e,n)};mt.useRef=function(t){return ts.current.useRef(t)};mt.useState=function(t){return ts.current.useState(t)};mt.useSyncExternalStore=function(t,e,n){return ts.current.useSyncExternalStore(t,e,n)};mt.useTransition=function(){return ts.current.useTransition()};mt.version="18.3.1";vI.exports=mt;var H=vI.exports;const jr=wI(H),vP=xI({__proto__:null,default:jr},[H]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EP=H,AP=Symbol.for("react.element"),bP=Symbol.for("react.fragment"),IP=Object.prototype.hasOwnProperty,CP=EP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,TP={key:!0,ref:!0,__self:!0,__source:!0};function RI(t,e,n){var r,s={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)IP.call(e,r)&&!TP.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:AP,type:t,key:i,ref:a,props:s,_owner:CP.current}}Xg.Fragment=bP;Xg.jsx=RI;Xg.jsxs=RI;_I.exports=Xg;var p=_I.exports,oy={},PI={exports:{}},Os={},kI={exports:{}},DI={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(he,Ce){var Me=he.length;he.push(Ce);e:for(;0<Me;){var ht=Me-1>>>1,Ge=he[ht];if(0<s(Ge,Ce))he[ht]=Ce,he[Me]=Ge,Me=ht;else break e}}function n(he){return he.length===0?null:he[0]}function r(he){if(he.length===0)return null;var Ce=he[0],Me=he.pop();if(Me!==Ce){he[0]=Me;e:for(var ht=0,Ge=he.length,_t=Ge>>>1;ht<_t;){var zt=2*(ht+1)-1,Pr=he[zt],Fe=zt+1,fr=he[Fe];if(0>s(Pr,Me))Fe<Ge&&0>s(fr,Pr)?(he[ht]=fr,he[Fe]=Me,ht=Fe):(he[ht]=Pr,he[zt]=Me,ht=zt);else if(Fe<Ge&&0>s(fr,Me))he[ht]=fr,he[Fe]=Me,ht=Fe;else break e}}return Ce}function s(he,Ce){var Me=he.sortIndex-Ce.sortIndex;return Me!==0?Me:he.id-Ce.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,u=a.now();t.unstable_now=function(){return a.now()-u}}var d=[],m=[],y=1,_=null,E=3,b=!1,k=!1,S=!1,O=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R(he){for(var Ce=n(m);Ce!==null;){if(Ce.callback===null)r(m);else if(Ce.startTime<=he)r(m),Ce.sortIndex=Ce.expirationTime,e(d,Ce);else break;Ce=n(m)}}function j(he){if(S=!1,R(he),!k)if(n(d)!==null)k=!0,Xe(K);else{var Ce=n(m);Ce!==null&&de(j,Ce.startTime-he)}}function K(he,Ce){k=!1,S&&(S=!1,T(B),B=-1),b=!0;var Me=E;try{for(R(Ce),_=n(d);_!==null&&(!(_.expirationTime>Ce)||he&&!X());){var ht=_.callback;if(typeof ht=="function"){_.callback=null,E=_.priorityLevel;var Ge=ht(_.expirationTime<=Ce);Ce=t.unstable_now(),typeof Ge=="function"?_.callback=Ge:_===n(d)&&r(d),R(Ce)}else r(d);_=n(d)}if(_!==null)var _t=!0;else{var zt=n(m);zt!==null&&de(j,zt.startTime-Ce),_t=!1}return _t}finally{_=null,E=Me,b=!1}}var Q=!1,D=null,B=-1,F=5,W=-1;function X(){return!(t.unstable_now()-W<F)}function $(){if(D!==null){var he=t.unstable_now();W=he;var Ce=!0;try{Ce=D(!0,he)}finally{Ce?z():(Q=!1,D=null)}}else Q=!1}var z;if(typeof C=="function")z=function(){C($)};else if(typeof MessageChannel<"u"){var Te=new MessageChannel,ie=Te.port2;Te.port1.onmessage=$,z=function(){ie.postMessage(null)}}else z=function(){O($,0)};function Xe(he){D=he,Q||(Q=!0,z())}function de(he,Ce){B=O(function(){he(t.unstable_now())},Ce)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(he){he.callback=null},t.unstable_continueExecution=function(){k||b||(k=!0,Xe(K))},t.unstable_forceFrameRate=function(he){0>he||125<he?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<he?Math.floor(1e3/he):5},t.unstable_getCurrentPriorityLevel=function(){return E},t.unstable_getFirstCallbackNode=function(){return n(d)},t.unstable_next=function(he){switch(E){case 1:case 2:case 3:var Ce=3;break;default:Ce=E}var Me=E;E=Ce;try{return he()}finally{E=Me}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(he,Ce){switch(he){case 1:case 2:case 3:case 4:case 5:break;default:he=3}var Me=E;E=he;try{return Ce()}finally{E=Me}},t.unstable_scheduleCallback=function(he,Ce,Me){var ht=t.unstable_now();switch(typeof Me=="object"&&Me!==null?(Me=Me.delay,Me=typeof Me=="number"&&0<Me?ht+Me:ht):Me=ht,he){case 1:var Ge=-1;break;case 2:Ge=250;break;case 5:Ge=1073741823;break;case 4:Ge=1e4;break;default:Ge=5e3}return Ge=Me+Ge,he={id:y++,callback:Ce,priorityLevel:he,startTime:Me,expirationTime:Ge,sortIndex:-1},Me>ht?(he.sortIndex=Me,e(m,he),n(d)===null&&he===n(m)&&(S?(T(B),B=-1):S=!0,de(j,Me-ht))):(he.sortIndex=Ge,e(d,he),k||b||(k=!0,Xe(K))),he},t.unstable_shouldYield=X,t.unstable_wrapCallback=function(he){var Ce=E;return function(){var Me=E;E=Ce;try{return he.apply(this,arguments)}finally{E=Me}}}})(DI);kI.exports=DI;var SP=kI.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NP=H,Ps=SP;function we(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var OI=new Set,Fd={};function mc(t,e){Iu(t,e),Iu(t+"Capture",e)}function Iu(t,e){for(Fd[t]=e,t=0;t<e.length;t++)OI.add(e[t])}var Io=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ay=Object.prototype.hasOwnProperty,RP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,y2={},x2={};function PP(t){return ay.call(x2,t)?!0:ay.call(y2,t)?!1:RP.test(t)?x2[t]=!0:(y2[t]=!0,!1)}function kP(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function DP(t,e,n,r){if(e===null||typeof e>"u"||kP(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ns(t,e,n,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var Sr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Sr[t]=new ns(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Sr[e]=new ns(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Sr[t]=new ns(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Sr[t]=new ns(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Sr[t]=new ns(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Sr[t]=new ns(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Sr[t]=new ns(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Sr[t]=new ns(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Sr[t]=new ns(t,5,!1,t.toLowerCase(),null,!1,!1)});var Ew=/[\-:]([a-z])/g;function Aw(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Ew,Aw);Sr[e]=new ns(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Ew,Aw);Sr[e]=new ns(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Ew,Aw);Sr[e]=new ns(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Sr[t]=new ns(t,1,!1,t.toLowerCase(),null,!1,!1)});Sr.xlinkHref=new ns("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Sr[t]=new ns(t,1,!1,t.toLowerCase(),null,!0,!0)});function bw(t,e,n,r){var s=Sr.hasOwnProperty(e)?Sr[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(DP(e,n,s,r)&&(n=null),r||s===null?PP(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var jo=NP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,E0=Symbol.for("react.element"),Yc=Symbol.for("react.portal"),Zc=Symbol.for("react.fragment"),Iw=Symbol.for("react.strict_mode"),ly=Symbol.for("react.profiler"),MI=Symbol.for("react.provider"),LI=Symbol.for("react.context"),Cw=Symbol.for("react.forward_ref"),cy=Symbol.for("react.suspense"),uy=Symbol.for("react.suspense_list"),Tw=Symbol.for("react.memo"),ta=Symbol.for("react.lazy"),jI=Symbol.for("react.offscreen"),w2=Symbol.iterator;function Fh(t){return t===null||typeof t!="object"?null:(t=w2&&t[w2]||t["@@iterator"],typeof t=="function"?t:null)}var En=Object.assign,s1;function td(t){if(s1===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);s1=e&&e[1]||""}return`
`+s1+t}var i1=!1;function o1(t,e){if(!t||i1)return"";i1=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(m){var r=m}Reflect.construct(t,[],e)}else{try{e.call()}catch(m){r=m}t.call(e.prototype)}else{try{throw Error()}catch(m){r=m}t()}}catch(m){if(m&&r&&typeof m.stack=="string"){for(var s=m.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,u=i.length-1;1<=a&&0<=u&&s[a]!==i[u];)u--;for(;1<=a&&0<=u;a--,u--)if(s[a]!==i[u]){if(a!==1||u!==1)do if(a--,u--,0>u||s[a]!==i[u]){var d=`
`+s[a].replace(" at new "," at ");return t.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",t.displayName)),d}while(1<=a&&0<=u);break}}}finally{i1=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?td(t):""}function OP(t){switch(t.tag){case 5:return td(t.type);case 16:return td("Lazy");case 13:return td("Suspense");case 19:return td("SuspenseList");case 0:case 2:case 15:return t=o1(t.type,!1),t;case 11:return t=o1(t.type.render,!1),t;case 1:return t=o1(t.type,!0),t;default:return""}}function hy(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Zc:return"Fragment";case Yc:return"Portal";case ly:return"Profiler";case Iw:return"StrictMode";case cy:return"Suspense";case uy:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case LI:return(t.displayName||"Context")+".Consumer";case MI:return(t._context.displayName||"Context")+".Provider";case Cw:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Tw:return e=t.displayName||null,e!==null?e:hy(t.type)||"Memo";case ta:e=t._payload,t=t._init;try{return hy(t(e))}catch{}}return null}function MP(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hy(e);case 8:return e===Iw?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function La(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function FI(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function LP(t){var e=FI(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function A0(t){t._valueTracker||(t._valueTracker=LP(t))}function BI(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=FI(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Fm(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function dy(t,e){var n=e.checked;return En({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function _2(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=La(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function VI(t,e){e=e.checked,e!=null&&bw(t,"checked",e,!1)}function fy(t,e){VI(t,e);var n=La(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?my(t,e.type,n):e.hasOwnProperty("defaultValue")&&my(t,e.type,La(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function v2(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function my(t,e,n){(e!=="number"||Fm(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var nd=Array.isArray;function hu(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+La(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function gy(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(we(91));return En({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function E2(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(we(92));if(nd(n)){if(1<n.length)throw Error(we(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:La(n)}}function UI(t,e){var n=La(e.value),r=La(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function A2(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function zI(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function py(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?zI(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var b0,GI=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(b0=b0||document.createElement("div"),b0.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=b0.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Bd(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var fd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},jP=["Webkit","ms","Moz","O"];Object.keys(fd).forEach(function(t){jP.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),fd[e]=fd[t]})});function qI(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||fd.hasOwnProperty(t)&&fd[t]?(""+e).trim():e+"px"}function WI(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=qI(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var FP=En({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yy(t,e){if(e){if(FP[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(we(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(we(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(we(61))}if(e.style!=null&&typeof e.style!="object")throw Error(we(62))}}function xy(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wy=null;function Sw(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var _y=null,du=null,fu=null;function b2(t){if(t=Rf(t)){if(typeof _y!="function")throw Error(we(280));var e=t.stateNode;e&&(e=tp(e),_y(t.stateNode,t.type,e))}}function $I(t){du?fu?fu.push(t):fu=[t]:du=t}function HI(){if(du){var t=du,e=fu;if(fu=du=null,b2(t),e)for(t=0;t<e.length;t++)b2(e[t])}}function KI(t,e){return t(e)}function QI(){}var a1=!1;function XI(t,e,n){if(a1)return t(e,n);a1=!0;try{return KI(t,e,n)}finally{a1=!1,(du!==null||fu!==null)&&(QI(),HI())}}function Vd(t,e){var n=t.stateNode;if(n===null)return null;var r=tp(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(we(231,e,typeof n));return n}var vy=!1;if(Io)try{var Bh={};Object.defineProperty(Bh,"passive",{get:function(){vy=!0}}),window.addEventListener("test",Bh,Bh),window.removeEventListener("test",Bh,Bh)}catch{vy=!1}function BP(t,e,n,r,s,i,a,u,d){var m=Array.prototype.slice.call(arguments,3);try{e.apply(n,m)}catch(y){this.onError(y)}}var md=!1,Bm=null,Vm=!1,Ey=null,VP={onError:function(t){md=!0,Bm=t}};function UP(t,e,n,r,s,i,a,u,d){md=!1,Bm=null,BP.apply(VP,arguments)}function zP(t,e,n,r,s,i,a,u,d){if(UP.apply(this,arguments),md){if(md){var m=Bm;md=!1,Bm=null}else throw Error(we(198));Vm||(Vm=!0,Ey=m)}}function gc(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function YI(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function I2(t){if(gc(t)!==t)throw Error(we(188))}function GP(t){var e=t.alternate;if(!e){if(e=gc(t),e===null)throw Error(we(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return I2(s),t;if(i===r)return I2(s),e;i=i.sibling}throw Error(we(188))}if(n.return!==r.return)n=s,r=i;else{for(var a=!1,u=s.child;u;){if(u===n){a=!0,n=s,r=i;break}if(u===r){a=!0,r=s,n=i;break}u=u.sibling}if(!a){for(u=i.child;u;){if(u===n){a=!0,n=i,r=s;break}if(u===r){a=!0,r=i,n=s;break}u=u.sibling}if(!a)throw Error(we(189))}}if(n.alternate!==r)throw Error(we(190))}if(n.tag!==3)throw Error(we(188));return n.stateNode.current===n?t:e}function ZI(t){return t=GP(t),t!==null?JI(t):null}function JI(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=JI(t);if(e!==null)return e;t=t.sibling}return null}var eC=Ps.unstable_scheduleCallback,C2=Ps.unstable_cancelCallback,qP=Ps.unstable_shouldYield,WP=Ps.unstable_requestPaint,Bn=Ps.unstable_now,$P=Ps.unstable_getCurrentPriorityLevel,Nw=Ps.unstable_ImmediatePriority,tC=Ps.unstable_UserBlockingPriority,Um=Ps.unstable_NormalPriority,HP=Ps.unstable_LowPriority,nC=Ps.unstable_IdlePriority,Yg=null,Fi=null;function KP(t){if(Fi&&typeof Fi.onCommitFiberRoot=="function")try{Fi.onCommitFiberRoot(Yg,t,void 0,(t.current.flags&128)===128)}catch{}}var di=Math.clz32?Math.clz32:YP,QP=Math.log,XP=Math.LN2;function YP(t){return t>>>=0,t===0?32:31-(QP(t)/XP|0)|0}var I0=64,C0=4194304;function rd(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function zm(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var u=a&~s;u!==0?r=rd(u):(i&=a,i!==0&&(r=rd(i)))}else a=n&~s,a!==0?r=rd(a):i!==0&&(r=rd(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-di(e),s=1<<n,r|=t[n],e&=~s;return r}function ZP(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function JP(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-di(i),u=1<<a,d=s[a];d===-1?(!(u&n)||u&r)&&(s[a]=ZP(u,e)):d<=e&&(t.expiredLanes|=u),i&=~u}}function Ay(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function rC(){var t=I0;return I0<<=1,!(I0&4194240)&&(I0=64),t}function l1(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Sf(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-di(e),t[e]=n}function ek(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-di(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Rw(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-di(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Lt=0;function sC(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var iC,Pw,oC,aC,lC,by=!1,T0=[],Aa=null,ba=null,Ia=null,Ud=new Map,zd=new Map,sa=[],tk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function T2(t,e){switch(t){case"focusin":case"focusout":Aa=null;break;case"dragenter":case"dragleave":ba=null;break;case"mouseover":case"mouseout":Ia=null;break;case"pointerover":case"pointerout":Ud.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":zd.delete(e.pointerId)}}function Vh(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Rf(e),e!==null&&Pw(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function nk(t,e,n,r,s){switch(e){case"focusin":return Aa=Vh(Aa,t,e,n,r,s),!0;case"dragenter":return ba=Vh(ba,t,e,n,r,s),!0;case"mouseover":return Ia=Vh(Ia,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Ud.set(i,Vh(Ud.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,zd.set(i,Vh(zd.get(i)||null,t,e,n,r,s)),!0}return!1}function cC(t){var e=Pl(t.target);if(e!==null){var n=gc(e);if(n!==null){if(e=n.tag,e===13){if(e=YI(n),e!==null){t.blockedOn=e,lC(t.priority,function(){oC(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function am(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Iy(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);wy=r,n.target.dispatchEvent(r),wy=null}else return e=Rf(n),e!==null&&Pw(e),t.blockedOn=n,!1;e.shift()}return!0}function S2(t,e,n){am(t)&&n.delete(e)}function rk(){by=!1,Aa!==null&&am(Aa)&&(Aa=null),ba!==null&&am(ba)&&(ba=null),Ia!==null&&am(Ia)&&(Ia=null),Ud.forEach(S2),zd.forEach(S2)}function Uh(t,e){t.blockedOn===e&&(t.blockedOn=null,by||(by=!0,Ps.unstable_scheduleCallback(Ps.unstable_NormalPriority,rk)))}function Gd(t){function e(s){return Uh(s,t)}if(0<T0.length){Uh(T0[0],t);for(var n=1;n<T0.length;n++){var r=T0[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Aa!==null&&Uh(Aa,t),ba!==null&&Uh(ba,t),Ia!==null&&Uh(Ia,t),Ud.forEach(e),zd.forEach(e),n=0;n<sa.length;n++)r=sa[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<sa.length&&(n=sa[0],n.blockedOn===null);)cC(n),n.blockedOn===null&&sa.shift()}var mu=jo.ReactCurrentBatchConfig,Gm=!0;function sk(t,e,n,r){var s=Lt,i=mu.transition;mu.transition=null;try{Lt=1,kw(t,e,n,r)}finally{Lt=s,mu.transition=i}}function ik(t,e,n,r){var s=Lt,i=mu.transition;mu.transition=null;try{Lt=4,kw(t,e,n,r)}finally{Lt=s,mu.transition=i}}function kw(t,e,n,r){if(Gm){var s=Iy(t,e,n,r);if(s===null)x1(t,e,r,qm,n),T2(t,r);else if(nk(s,t,e,n,r))r.stopPropagation();else if(T2(t,r),e&4&&-1<tk.indexOf(t)){for(;s!==null;){var i=Rf(s);if(i!==null&&iC(i),i=Iy(t,e,n,r),i===null&&x1(t,e,r,qm,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else x1(t,e,r,null,n)}}var qm=null;function Iy(t,e,n,r){if(qm=null,t=Sw(r),t=Pl(t),t!==null)if(e=gc(t),e===null)t=null;else if(n=e.tag,n===13){if(t=YI(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return qm=t,null}function uC(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($P()){case Nw:return 1;case tC:return 4;case Um:case HP:return 16;case nC:return 536870912;default:return 16}default:return 16}}var ya=null,Dw=null,lm=null;function hC(){if(lm)return lm;var t,e=Dw,n=e.length,r,s="value"in ya?ya.value:ya.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===s[i-r];r++);return lm=s.slice(t,1<r?1-r:void 0)}function cm(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function S0(){return!0}function N2(){return!1}function Ms(t){function e(n,r,s,i,a){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var u in t)t.hasOwnProperty(u)&&(n=t[u],this[u]=n?n(i):i[u]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?S0:N2,this.isPropagationStopped=N2,this}return En(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=S0)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=S0)},persist:function(){},isPersistent:S0}),e}var sh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ow=Ms(sh),Nf=En({},sh,{view:0,detail:0}),ok=Ms(Nf),c1,u1,zh,Zg=En({},Nf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mw,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==zh&&(zh&&t.type==="mousemove"?(c1=t.screenX-zh.screenX,u1=t.screenY-zh.screenY):u1=c1=0,zh=t),c1)},movementY:function(t){return"movementY"in t?t.movementY:u1}}),R2=Ms(Zg),ak=En({},Zg,{dataTransfer:0}),lk=Ms(ak),ck=En({},Nf,{relatedTarget:0}),h1=Ms(ck),uk=En({},sh,{animationName:0,elapsedTime:0,pseudoElement:0}),hk=Ms(uk),dk=En({},sh,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),fk=Ms(dk),mk=En({},sh,{data:0}),P2=Ms(mk),gk={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yk={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xk(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=yk[t])?!!e[t]:!1}function Mw(){return xk}var wk=En({},Nf,{key:function(t){if(t.key){var e=gk[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=cm(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?pk[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mw,charCode:function(t){return t.type==="keypress"?cm(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?cm(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),_k=Ms(wk),vk=En({},Zg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),k2=Ms(vk),Ek=En({},Nf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mw}),Ak=Ms(Ek),bk=En({},sh,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ik=Ms(bk),Ck=En({},Zg,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Tk=Ms(Ck),Sk=[9,13,27,32],Lw=Io&&"CompositionEvent"in window,gd=null;Io&&"documentMode"in document&&(gd=document.documentMode);var Nk=Io&&"TextEvent"in window&&!gd,dC=Io&&(!Lw||gd&&8<gd&&11>=gd),D2=String.fromCharCode(32),O2=!1;function fC(t,e){switch(t){case"keyup":return Sk.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mC(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Jc=!1;function Rk(t,e){switch(t){case"compositionend":return mC(e);case"keypress":return e.which!==32?null:(O2=!0,D2);case"textInput":return t=e.data,t===D2&&O2?null:t;default:return null}}function Pk(t,e){if(Jc)return t==="compositionend"||!Lw&&fC(t,e)?(t=hC(),lm=Dw=ya=null,Jc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return dC&&e.locale!=="ko"?null:e.data;default:return null}}var kk={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function M2(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!kk[t.type]:e==="textarea"}function gC(t,e,n,r){$I(r),e=Wm(e,"onChange"),0<e.length&&(n=new Ow("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var pd=null,qd=null;function Dk(t){CC(t,0)}function Jg(t){var e=nu(t);if(BI(e))return t}function Ok(t,e){if(t==="change")return e}var pC=!1;if(Io){var d1;if(Io){var f1="oninput"in document;if(!f1){var L2=document.createElement("div");L2.setAttribute("oninput","return;"),f1=typeof L2.oninput=="function"}d1=f1}else d1=!1;pC=d1&&(!document.documentMode||9<document.documentMode)}function j2(){pd&&(pd.detachEvent("onpropertychange",yC),qd=pd=null)}function yC(t){if(t.propertyName==="value"&&Jg(qd)){var e=[];gC(e,qd,t,Sw(t)),XI(Dk,e)}}function Mk(t,e,n){t==="focusin"?(j2(),pd=e,qd=n,pd.attachEvent("onpropertychange",yC)):t==="focusout"&&j2()}function Lk(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Jg(qd)}function jk(t,e){if(t==="click")return Jg(e)}function Fk(t,e){if(t==="input"||t==="change")return Jg(e)}function Bk(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var pi=typeof Object.is=="function"?Object.is:Bk;function Wd(t,e){if(pi(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!ay.call(e,s)||!pi(t[s],e[s]))return!1}return!0}function F2(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function B2(t,e){var n=F2(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=F2(n)}}function xC(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?xC(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function wC(){for(var t=window,e=Fm();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Fm(t.document)}return e}function jw(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Vk(t){var e=wC(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&xC(n.ownerDocument.documentElement,n)){if(r!==null&&jw(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=B2(n,i);var a=B2(n,r);s&&a&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Uk=Io&&"documentMode"in document&&11>=document.documentMode,eu=null,Cy=null,yd=null,Ty=!1;function V2(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ty||eu==null||eu!==Fm(r)||(r=eu,"selectionStart"in r&&jw(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),yd&&Wd(yd,r)||(yd=r,r=Wm(Cy,"onSelect"),0<r.length&&(e=new Ow("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=eu)))}function N0(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var tu={animationend:N0("Animation","AnimationEnd"),animationiteration:N0("Animation","AnimationIteration"),animationstart:N0("Animation","AnimationStart"),transitionend:N0("Transition","TransitionEnd")},m1={},_C={};Io&&(_C=document.createElement("div").style,"AnimationEvent"in window||(delete tu.animationend.animation,delete tu.animationiteration.animation,delete tu.animationstart.animation),"TransitionEvent"in window||delete tu.transitionend.transition);function ep(t){if(m1[t])return m1[t];if(!tu[t])return t;var e=tu[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in _C)return m1[t]=e[n];return t}var vC=ep("animationend"),EC=ep("animationiteration"),AC=ep("animationstart"),bC=ep("transitionend"),IC=new Map,U2="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ya(t,e){IC.set(t,e),mc(e,[t])}for(var g1=0;g1<U2.length;g1++){var p1=U2[g1],zk=p1.toLowerCase(),Gk=p1[0].toUpperCase()+p1.slice(1);Ya(zk,"on"+Gk)}Ya(vC,"onAnimationEnd");Ya(EC,"onAnimationIteration");Ya(AC,"onAnimationStart");Ya("dblclick","onDoubleClick");Ya("focusin","onFocus");Ya("focusout","onBlur");Ya(bC,"onTransitionEnd");Iu("onMouseEnter",["mouseout","mouseover"]);Iu("onMouseLeave",["mouseout","mouseover"]);Iu("onPointerEnter",["pointerout","pointerover"]);Iu("onPointerLeave",["pointerout","pointerover"]);mc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));mc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));mc("onBeforeInput",["compositionend","keypress","textInput","paste"]);mc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));mc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));mc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var sd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qk=new Set("cancel close invalid load scroll toggle".split(" ").concat(sd));function z2(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,zP(r,e,void 0,t),t.currentTarget=null}function CC(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var u=r[a],d=u.instance,m=u.currentTarget;if(u=u.listener,d!==i&&s.isPropagationStopped())break e;z2(s,u,m),i=d}else for(a=0;a<r.length;a++){if(u=r[a],d=u.instance,m=u.currentTarget,u=u.listener,d!==i&&s.isPropagationStopped())break e;z2(s,u,m),i=d}}}if(Vm)throw t=Ey,Vm=!1,Ey=null,t}function tn(t,e){var n=e[ky];n===void 0&&(n=e[ky]=new Set);var r=t+"__bubble";n.has(r)||(TC(e,t,2,!1),n.add(r))}function y1(t,e,n){var r=0;e&&(r|=4),TC(n,t,r,e)}var R0="_reactListening"+Math.random().toString(36).slice(2);function $d(t){if(!t[R0]){t[R0]=!0,OI.forEach(function(n){n!=="selectionchange"&&(qk.has(n)||y1(n,!1,t),y1(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[R0]||(e[R0]=!0,y1("selectionchange",!1,e))}}function TC(t,e,n,r){switch(uC(e)){case 1:var s=sk;break;case 4:s=ik;break;default:s=kw}n=s.bind(null,e,n,t),s=void 0,!vy||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function x1(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var u=r.stateNode.containerInfo;if(u===s||u.nodeType===8&&u.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var d=a.tag;if((d===3||d===4)&&(d=a.stateNode.containerInfo,d===s||d.nodeType===8&&d.parentNode===s))return;a=a.return}for(;u!==null;){if(a=Pl(u),a===null)return;if(d=a.tag,d===5||d===6){r=i=a;continue e}u=u.parentNode}}r=r.return}XI(function(){var m=i,y=Sw(n),_=[];e:{var E=IC.get(t);if(E!==void 0){var b=Ow,k=t;switch(t){case"keypress":if(cm(n)===0)break e;case"keydown":case"keyup":b=_k;break;case"focusin":k="focus",b=h1;break;case"focusout":k="blur",b=h1;break;case"beforeblur":case"afterblur":b=h1;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":b=R2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":b=lk;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":b=Ak;break;case vC:case EC:case AC:b=hk;break;case bC:b=Ik;break;case"scroll":b=ok;break;case"wheel":b=Tk;break;case"copy":case"cut":case"paste":b=fk;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":b=k2}var S=(e&4)!==0,O=!S&&t==="scroll",T=S?E!==null?E+"Capture":null:E;S=[];for(var C=m,R;C!==null;){R=C;var j=R.stateNode;if(R.tag===5&&j!==null&&(R=j,T!==null&&(j=Vd(C,T),j!=null&&S.push(Hd(C,j,R)))),O)break;C=C.return}0<S.length&&(E=new b(E,k,null,n,y),_.push({event:E,listeners:S}))}}if(!(e&7)){e:{if(E=t==="mouseover"||t==="pointerover",b=t==="mouseout"||t==="pointerout",E&&n!==wy&&(k=n.relatedTarget||n.fromElement)&&(Pl(k)||k[Co]))break e;if((b||E)&&(E=y.window===y?y:(E=y.ownerDocument)?E.defaultView||E.parentWindow:window,b?(k=n.relatedTarget||n.toElement,b=m,k=k?Pl(k):null,k!==null&&(O=gc(k),k!==O||k.tag!==5&&k.tag!==6)&&(k=null)):(b=null,k=m),b!==k)){if(S=R2,j="onMouseLeave",T="onMouseEnter",C="mouse",(t==="pointerout"||t==="pointerover")&&(S=k2,j="onPointerLeave",T="onPointerEnter",C="pointer"),O=b==null?E:nu(b),R=k==null?E:nu(k),E=new S(j,C+"leave",b,n,y),E.target=O,E.relatedTarget=R,j=null,Pl(y)===m&&(S=new S(T,C+"enter",k,n,y),S.target=R,S.relatedTarget=O,j=S),O=j,b&&k)t:{for(S=b,T=k,C=0,R=S;R;R=jc(R))C++;for(R=0,j=T;j;j=jc(j))R++;for(;0<C-R;)S=jc(S),C--;for(;0<R-C;)T=jc(T),R--;for(;C--;){if(S===T||T!==null&&S===T.alternate)break t;S=jc(S),T=jc(T)}S=null}else S=null;b!==null&&G2(_,E,b,S,!1),k!==null&&O!==null&&G2(_,O,k,S,!0)}}e:{if(E=m?nu(m):window,b=E.nodeName&&E.nodeName.toLowerCase(),b==="select"||b==="input"&&E.type==="file")var K=Ok;else if(M2(E))if(pC)K=Fk;else{K=Lk;var Q=Mk}else(b=E.nodeName)&&b.toLowerCase()==="input"&&(E.type==="checkbox"||E.type==="radio")&&(K=jk);if(K&&(K=K(t,m))){gC(_,K,n,y);break e}Q&&Q(t,E,m),t==="focusout"&&(Q=E._wrapperState)&&Q.controlled&&E.type==="number"&&my(E,"number",E.value)}switch(Q=m?nu(m):window,t){case"focusin":(M2(Q)||Q.contentEditable==="true")&&(eu=Q,Cy=m,yd=null);break;case"focusout":yd=Cy=eu=null;break;case"mousedown":Ty=!0;break;case"contextmenu":case"mouseup":case"dragend":Ty=!1,V2(_,n,y);break;case"selectionchange":if(Uk)break;case"keydown":case"keyup":V2(_,n,y)}var D;if(Lw)e:{switch(t){case"compositionstart":var B="onCompositionStart";break e;case"compositionend":B="onCompositionEnd";break e;case"compositionupdate":B="onCompositionUpdate";break e}B=void 0}else Jc?fC(t,n)&&(B="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(B="onCompositionStart");B&&(dC&&n.locale!=="ko"&&(Jc||B!=="onCompositionStart"?B==="onCompositionEnd"&&Jc&&(D=hC()):(ya=y,Dw="value"in ya?ya.value:ya.textContent,Jc=!0)),Q=Wm(m,B),0<Q.length&&(B=new P2(B,t,null,n,y),_.push({event:B,listeners:Q}),D?B.data=D:(D=mC(n),D!==null&&(B.data=D)))),(D=Nk?Rk(t,n):Pk(t,n))&&(m=Wm(m,"onBeforeInput"),0<m.length&&(y=new P2("onBeforeInput","beforeinput",null,n,y),_.push({event:y,listeners:m}),y.data=D))}CC(_,e)})}function Hd(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Wm(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Vd(t,n),i!=null&&r.unshift(Hd(t,i,s)),i=Vd(t,e),i!=null&&r.push(Hd(t,i,s))),t=t.return}return r}function jc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function G2(t,e,n,r,s){for(var i=e._reactName,a=[];n!==null&&n!==r;){var u=n,d=u.alternate,m=u.stateNode;if(d!==null&&d===r)break;u.tag===5&&m!==null&&(u=m,s?(d=Vd(n,i),d!=null&&a.unshift(Hd(n,d,u))):s||(d=Vd(n,i),d!=null&&a.push(Hd(n,d,u)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var Wk=/\r\n?/g,$k=/\u0000|\uFFFD/g;function q2(t){return(typeof t=="string"?t:""+t).replace(Wk,`
`).replace($k,"")}function P0(t,e,n){if(e=q2(e),q2(t)!==e&&n)throw Error(we(425))}function $m(){}var Sy=null,Ny=null;function Ry(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Py=typeof setTimeout=="function"?setTimeout:void 0,Hk=typeof clearTimeout=="function"?clearTimeout:void 0,W2=typeof Promise=="function"?Promise:void 0,Kk=typeof queueMicrotask=="function"?queueMicrotask:typeof W2<"u"?function(t){return W2.resolve(null).then(t).catch(Qk)}:Py;function Qk(t){setTimeout(function(){throw t})}function w1(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Gd(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Gd(e)}function Ca(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function $2(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ih=Math.random().toString(36).slice(2),Di="__reactFiber$"+ih,Kd="__reactProps$"+ih,Co="__reactContainer$"+ih,ky="__reactEvents$"+ih,Xk="__reactListeners$"+ih,Yk="__reactHandles$"+ih;function Pl(t){var e=t[Di];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Co]||n[Di]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=$2(t);t!==null;){if(n=t[Di])return n;t=$2(t)}return e}t=n,n=t.parentNode}return null}function Rf(t){return t=t[Di]||t[Co],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function nu(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(we(33))}function tp(t){return t[Kd]||null}var Dy=[],ru=-1;function Za(t){return{current:t}}function on(t){0>ru||(t.current=Dy[ru],Dy[ru]=null,ru--)}function Yt(t,e){ru++,Dy[ru]=t.current,t.current=e}var ja={},qr=Za(ja),ps=Za(!1),Wl=ja;function Cu(t,e){var n=t.type.contextTypes;if(!n)return ja;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function ys(t){return t=t.childContextTypes,t!=null}function Hm(){on(ps),on(qr)}function H2(t,e,n){if(qr.current!==ja)throw Error(we(168));Yt(qr,e),Yt(ps,n)}function SC(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(we(108,MP(t)||"Unknown",s));return En({},n,r)}function Km(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ja,Wl=qr.current,Yt(qr,t),Yt(ps,ps.current),!0}function K2(t,e,n){var r=t.stateNode;if(!r)throw Error(we(169));n?(t=SC(t,e,Wl),r.__reactInternalMemoizedMergedChildContext=t,on(ps),on(qr),Yt(qr,t)):on(ps),Yt(ps,n)}var ho=null,np=!1,_1=!1;function NC(t){ho===null?ho=[t]:ho.push(t)}function Zk(t){np=!0,NC(t)}function Ja(){if(!_1&&ho!==null){_1=!0;var t=0,e=Lt;try{var n=ho;for(Lt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}ho=null,np=!1}catch(s){throw ho!==null&&(ho=ho.slice(t+1)),eC(Nw,Ja),s}finally{Lt=e,_1=!1}}return null}var su=[],iu=0,Qm=null,Xm=0,Vs=[],Us=0,$l=null,go=1,po="";function Al(t,e){su[iu++]=Xm,su[iu++]=Qm,Qm=t,Xm=e}function RC(t,e,n){Vs[Us++]=go,Vs[Us++]=po,Vs[Us++]=$l,$l=t;var r=go;t=po;var s=32-di(r)-1;r&=~(1<<s),n+=1;var i=32-di(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,go=1<<32-di(e)+s|n<<s|r,po=i+t}else go=1<<i|n<<s|r,po=t}function Fw(t){t.return!==null&&(Al(t,1),RC(t,1,0))}function Bw(t){for(;t===Qm;)Qm=su[--iu],su[iu]=null,Xm=su[--iu],su[iu]=null;for(;t===$l;)$l=Vs[--Us],Vs[Us]=null,po=Vs[--Us],Vs[Us]=null,go=Vs[--Us],Vs[Us]=null}var Rs=null,Ss=null,dn=!1,ci=null;function PC(t,e){var n=zs(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Q2(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Rs=t,Ss=Ca(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Rs=t,Ss=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=$l!==null?{id:go,overflow:po}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=zs(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Rs=t,Ss=null,!0):!1;default:return!1}}function Oy(t){return(t.mode&1)!==0&&(t.flags&128)===0}function My(t){if(dn){var e=Ss;if(e){var n=e;if(!Q2(t,e)){if(Oy(t))throw Error(we(418));e=Ca(n.nextSibling);var r=Rs;e&&Q2(t,e)?PC(r,n):(t.flags=t.flags&-4097|2,dn=!1,Rs=t)}}else{if(Oy(t))throw Error(we(418));t.flags=t.flags&-4097|2,dn=!1,Rs=t}}}function X2(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Rs=t}function k0(t){if(t!==Rs)return!1;if(!dn)return X2(t),dn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Ry(t.type,t.memoizedProps)),e&&(e=Ss)){if(Oy(t))throw kC(),Error(we(418));for(;e;)PC(t,e),e=Ca(e.nextSibling)}if(X2(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(we(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Ss=Ca(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Ss=null}}else Ss=Rs?Ca(t.stateNode.nextSibling):null;return!0}function kC(){for(var t=Ss;t;)t=Ca(t.nextSibling)}function Tu(){Ss=Rs=null,dn=!1}function Vw(t){ci===null?ci=[t]:ci.push(t)}var Jk=jo.ReactCurrentBatchConfig;function Gh(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(we(309));var r=n.stateNode}if(!r)throw Error(we(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var u=s.refs;a===null?delete u[i]:u[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(we(284));if(!n._owner)throw Error(we(290,t))}return t}function D0(t,e){throw t=Object.prototype.toString.call(e),Error(we(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Y2(t){var e=t._init;return e(t._payload)}function DC(t){function e(T,C){if(t){var R=T.deletions;R===null?(T.deletions=[C],T.flags|=16):R.push(C)}}function n(T,C){if(!t)return null;for(;C!==null;)e(T,C),C=C.sibling;return null}function r(T,C){for(T=new Map;C!==null;)C.key!==null?T.set(C.key,C):T.set(C.index,C),C=C.sibling;return T}function s(T,C){return T=Ra(T,C),T.index=0,T.sibling=null,T}function i(T,C,R){return T.index=R,t?(R=T.alternate,R!==null?(R=R.index,R<C?(T.flags|=2,C):R):(T.flags|=2,C)):(T.flags|=1048576,C)}function a(T){return t&&T.alternate===null&&(T.flags|=2),T}function u(T,C,R,j){return C===null||C.tag!==6?(C=T1(R,T.mode,j),C.return=T,C):(C=s(C,R),C.return=T,C)}function d(T,C,R,j){var K=R.type;return K===Zc?y(T,C,R.props.children,j,R.key):C!==null&&(C.elementType===K||typeof K=="object"&&K!==null&&K.$$typeof===ta&&Y2(K)===C.type)?(j=s(C,R.props),j.ref=Gh(T,C,R),j.return=T,j):(j=pm(R.type,R.key,R.props,null,T.mode,j),j.ref=Gh(T,C,R),j.return=T,j)}function m(T,C,R,j){return C===null||C.tag!==4||C.stateNode.containerInfo!==R.containerInfo||C.stateNode.implementation!==R.implementation?(C=S1(R,T.mode,j),C.return=T,C):(C=s(C,R.children||[]),C.return=T,C)}function y(T,C,R,j,K){return C===null||C.tag!==7?(C=Fl(R,T.mode,j,K),C.return=T,C):(C=s(C,R),C.return=T,C)}function _(T,C,R){if(typeof C=="string"&&C!==""||typeof C=="number")return C=T1(""+C,T.mode,R),C.return=T,C;if(typeof C=="object"&&C!==null){switch(C.$$typeof){case E0:return R=pm(C.type,C.key,C.props,null,T.mode,R),R.ref=Gh(T,null,C),R.return=T,R;case Yc:return C=S1(C,T.mode,R),C.return=T,C;case ta:var j=C._init;return _(T,j(C._payload),R)}if(nd(C)||Fh(C))return C=Fl(C,T.mode,R,null),C.return=T,C;D0(T,C)}return null}function E(T,C,R,j){var K=C!==null?C.key:null;if(typeof R=="string"&&R!==""||typeof R=="number")return K!==null?null:u(T,C,""+R,j);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case E0:return R.key===K?d(T,C,R,j):null;case Yc:return R.key===K?m(T,C,R,j):null;case ta:return K=R._init,E(T,C,K(R._payload),j)}if(nd(R)||Fh(R))return K!==null?null:y(T,C,R,j,null);D0(T,R)}return null}function b(T,C,R,j,K){if(typeof j=="string"&&j!==""||typeof j=="number")return T=T.get(R)||null,u(C,T,""+j,K);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case E0:return T=T.get(j.key===null?R:j.key)||null,d(C,T,j,K);case Yc:return T=T.get(j.key===null?R:j.key)||null,m(C,T,j,K);case ta:var Q=j._init;return b(T,C,R,Q(j._payload),K)}if(nd(j)||Fh(j))return T=T.get(R)||null,y(C,T,j,K,null);D0(C,j)}return null}function k(T,C,R,j){for(var K=null,Q=null,D=C,B=C=0,F=null;D!==null&&B<R.length;B++){D.index>B?(F=D,D=null):F=D.sibling;var W=E(T,D,R[B],j);if(W===null){D===null&&(D=F);break}t&&D&&W.alternate===null&&e(T,D),C=i(W,C,B),Q===null?K=W:Q.sibling=W,Q=W,D=F}if(B===R.length)return n(T,D),dn&&Al(T,B),K;if(D===null){for(;B<R.length;B++)D=_(T,R[B],j),D!==null&&(C=i(D,C,B),Q===null?K=D:Q.sibling=D,Q=D);return dn&&Al(T,B),K}for(D=r(T,D);B<R.length;B++)F=b(D,T,B,R[B],j),F!==null&&(t&&F.alternate!==null&&D.delete(F.key===null?B:F.key),C=i(F,C,B),Q===null?K=F:Q.sibling=F,Q=F);return t&&D.forEach(function(X){return e(T,X)}),dn&&Al(T,B),K}function S(T,C,R,j){var K=Fh(R);if(typeof K!="function")throw Error(we(150));if(R=K.call(R),R==null)throw Error(we(151));for(var Q=K=null,D=C,B=C=0,F=null,W=R.next();D!==null&&!W.done;B++,W=R.next()){D.index>B?(F=D,D=null):F=D.sibling;var X=E(T,D,W.value,j);if(X===null){D===null&&(D=F);break}t&&D&&X.alternate===null&&e(T,D),C=i(X,C,B),Q===null?K=X:Q.sibling=X,Q=X,D=F}if(W.done)return n(T,D),dn&&Al(T,B),K;if(D===null){for(;!W.done;B++,W=R.next())W=_(T,W.value,j),W!==null&&(C=i(W,C,B),Q===null?K=W:Q.sibling=W,Q=W);return dn&&Al(T,B),K}for(D=r(T,D);!W.done;B++,W=R.next())W=b(D,T,B,W.value,j),W!==null&&(t&&W.alternate!==null&&D.delete(W.key===null?B:W.key),C=i(W,C,B),Q===null?K=W:Q.sibling=W,Q=W);return t&&D.forEach(function($){return e(T,$)}),dn&&Al(T,B),K}function O(T,C,R,j){if(typeof R=="object"&&R!==null&&R.type===Zc&&R.key===null&&(R=R.props.children),typeof R=="object"&&R!==null){switch(R.$$typeof){case E0:e:{for(var K=R.key,Q=C;Q!==null;){if(Q.key===K){if(K=R.type,K===Zc){if(Q.tag===7){n(T,Q.sibling),C=s(Q,R.props.children),C.return=T,T=C;break e}}else if(Q.elementType===K||typeof K=="object"&&K!==null&&K.$$typeof===ta&&Y2(K)===Q.type){n(T,Q.sibling),C=s(Q,R.props),C.ref=Gh(T,Q,R),C.return=T,T=C;break e}n(T,Q);break}else e(T,Q);Q=Q.sibling}R.type===Zc?(C=Fl(R.props.children,T.mode,j,R.key),C.return=T,T=C):(j=pm(R.type,R.key,R.props,null,T.mode,j),j.ref=Gh(T,C,R),j.return=T,T=j)}return a(T);case Yc:e:{for(Q=R.key;C!==null;){if(C.key===Q)if(C.tag===4&&C.stateNode.containerInfo===R.containerInfo&&C.stateNode.implementation===R.implementation){n(T,C.sibling),C=s(C,R.children||[]),C.return=T,T=C;break e}else{n(T,C);break}else e(T,C);C=C.sibling}C=S1(R,T.mode,j),C.return=T,T=C}return a(T);case ta:return Q=R._init,O(T,C,Q(R._payload),j)}if(nd(R))return k(T,C,R,j);if(Fh(R))return S(T,C,R,j);D0(T,R)}return typeof R=="string"&&R!==""||typeof R=="number"?(R=""+R,C!==null&&C.tag===6?(n(T,C.sibling),C=s(C,R),C.return=T,T=C):(n(T,C),C=T1(R,T.mode,j),C.return=T,T=C),a(T)):n(T,C)}return O}var Su=DC(!0),OC=DC(!1),Ym=Za(null),Zm=null,ou=null,Uw=null;function zw(){Uw=ou=Zm=null}function Gw(t){var e=Ym.current;on(Ym),t._currentValue=e}function Ly(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function gu(t,e){Zm=t,Uw=ou=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(ds=!0),t.firstContext=null)}function $s(t){var e=t._currentValue;if(Uw!==t)if(t={context:t,memoizedValue:e,next:null},ou===null){if(Zm===null)throw Error(we(308));ou=t,Zm.dependencies={lanes:0,firstContext:t}}else ou=ou.next=t;return e}var kl=null;function qw(t){kl===null?kl=[t]:kl.push(t)}function MC(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,qw(e)):(n.next=s.next,s.next=n),e.interleaved=n,To(t,r)}function To(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var na=!1;function Ww(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function LC(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Eo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ta(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Nt&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,To(t,n)}return s=r.interleaved,s===null?(e.next=e,qw(r)):(e.next=s.next,s.next=e),r.interleaved=e,To(t,n)}function um(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Rw(t,n)}}function Z2(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Jm(t,e,n,r){var s=t.updateQueue;na=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,u=s.shared.pending;if(u!==null){s.shared.pending=null;var d=u,m=d.next;d.next=null,a===null?i=m:a.next=m,a=d;var y=t.alternate;y!==null&&(y=y.updateQueue,u=y.lastBaseUpdate,u!==a&&(u===null?y.firstBaseUpdate=m:u.next=m,y.lastBaseUpdate=d))}if(i!==null){var _=s.baseState;a=0,y=m=d=null,u=i;do{var E=u.lane,b=u.eventTime;if((r&E)===E){y!==null&&(y=y.next={eventTime:b,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var k=t,S=u;switch(E=e,b=n,S.tag){case 1:if(k=S.payload,typeof k=="function"){_=k.call(b,_,E);break e}_=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=S.payload,E=typeof k=="function"?k.call(b,_,E):k,E==null)break e;_=En({},_,E);break e;case 2:na=!0}}u.callback!==null&&u.lane!==0&&(t.flags|=64,E=s.effects,E===null?s.effects=[u]:E.push(u))}else b={eventTime:b,lane:E,tag:u.tag,payload:u.payload,callback:u.callback,next:null},y===null?(m=y=b,d=_):y=y.next=b,a|=E;if(u=u.next,u===null){if(u=s.shared.pending,u===null)break;E=u,u=E.next,E.next=null,s.lastBaseUpdate=E,s.shared.pending=null}}while(1);if(y===null&&(d=_),s.baseState=d,s.firstBaseUpdate=m,s.lastBaseUpdate=y,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Kl|=a,t.lanes=a,t.memoizedState=_}}function J2(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(we(191,s));s.call(r)}}}var Pf={},Bi=Za(Pf),Qd=Za(Pf),Xd=Za(Pf);function Dl(t){if(t===Pf)throw Error(we(174));return t}function $w(t,e){switch(Yt(Xd,e),Yt(Qd,t),Yt(Bi,Pf),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:py(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=py(e,t)}on(Bi),Yt(Bi,e)}function Nu(){on(Bi),on(Qd),on(Xd)}function jC(t){Dl(Xd.current);var e=Dl(Bi.current),n=py(e,t.type);e!==n&&(Yt(Qd,t),Yt(Bi,n))}function Hw(t){Qd.current===t&&(on(Bi),on(Qd))}var wn=Za(0);function eg(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var v1=[];function Kw(){for(var t=0;t<v1.length;t++)v1[t]._workInProgressVersionPrimary=null;v1.length=0}var hm=jo.ReactCurrentDispatcher,E1=jo.ReactCurrentBatchConfig,Hl=0,_n=null,ir=null,pr=null,tg=!1,xd=!1,Yd=0,eD=0;function Or(){throw Error(we(321))}function Qw(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!pi(t[n],e[n]))return!1;return!0}function Xw(t,e,n,r,s,i){if(Hl=i,_n=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,hm.current=t===null||t.memoizedState===null?sD:iD,t=n(r,s),xd){i=0;do{if(xd=!1,Yd=0,25<=i)throw Error(we(301));i+=1,pr=ir=null,e.updateQueue=null,hm.current=oD,t=n(r,s)}while(xd)}if(hm.current=ng,e=ir!==null&&ir.next!==null,Hl=0,pr=ir=_n=null,tg=!1,e)throw Error(we(300));return t}function Yw(){var t=Yd!==0;return Yd=0,t}function Ri(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pr===null?_n.memoizedState=pr=t:pr=pr.next=t,pr}function Hs(){if(ir===null){var t=_n.alternate;t=t!==null?t.memoizedState:null}else t=ir.next;var e=pr===null?_n.memoizedState:pr.next;if(e!==null)pr=e,ir=t;else{if(t===null)throw Error(we(310));ir=t,t={memoizedState:ir.memoizedState,baseState:ir.baseState,baseQueue:ir.baseQueue,queue:ir.queue,next:null},pr===null?_n.memoizedState=pr=t:pr=pr.next=t}return pr}function Zd(t,e){return typeof e=="function"?e(t):e}function A1(t){var e=Hs(),n=e.queue;if(n===null)throw Error(we(311));n.lastRenderedReducer=t;var r=ir,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var u=a=null,d=null,m=i;do{var y=m.lane;if((Hl&y)===y)d!==null&&(d=d.next={lane:0,action:m.action,hasEagerState:m.hasEagerState,eagerState:m.eagerState,next:null}),r=m.hasEagerState?m.eagerState:t(r,m.action);else{var _={lane:y,action:m.action,hasEagerState:m.hasEagerState,eagerState:m.eagerState,next:null};d===null?(u=d=_,a=r):d=d.next=_,_n.lanes|=y,Kl|=y}m=m.next}while(m!==null&&m!==i);d===null?a=r:d.next=u,pi(r,e.memoizedState)||(ds=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=d,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,_n.lanes|=i,Kl|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function b1(t){var e=Hs(),n=e.queue;if(n===null)throw Error(we(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do i=t(i,a.action),a=a.next;while(a!==s);pi(i,e.memoizedState)||(ds=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function FC(){}function BC(t,e){var n=_n,r=Hs(),s=e(),i=!pi(r.memoizedState,s);if(i&&(r.memoizedState=s,ds=!0),r=r.queue,Zw(zC.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||pr!==null&&pr.memoizedState.tag&1){if(n.flags|=2048,Jd(9,UC.bind(null,n,r,s,e),void 0,null),xr===null)throw Error(we(349));Hl&30||VC(n,e,s)}return s}function VC(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=_n.updateQueue,e===null?(e={lastEffect:null,stores:null},_n.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function UC(t,e,n,r){e.value=n,e.getSnapshot=r,GC(e)&&qC(t)}function zC(t,e,n){return n(function(){GC(e)&&qC(t)})}function GC(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!pi(t,n)}catch{return!0}}function qC(t){var e=To(t,1);e!==null&&fi(e,t,1,-1)}function eE(t){var e=Ri();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zd,lastRenderedState:t},e.queue=t,t=t.dispatch=rD.bind(null,_n,t),[e.memoizedState,t]}function Jd(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=_n.updateQueue,e===null?(e={lastEffect:null,stores:null},_n.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function WC(){return Hs().memoizedState}function dm(t,e,n,r){var s=Ri();_n.flags|=t,s.memoizedState=Jd(1|e,n,void 0,r===void 0?null:r)}function rp(t,e,n,r){var s=Hs();r=r===void 0?null:r;var i=void 0;if(ir!==null){var a=ir.memoizedState;if(i=a.destroy,r!==null&&Qw(r,a.deps)){s.memoizedState=Jd(e,n,i,r);return}}_n.flags|=t,s.memoizedState=Jd(1|e,n,i,r)}function tE(t,e){return dm(8390656,8,t,e)}function Zw(t,e){return rp(2048,8,t,e)}function $C(t,e){return rp(4,2,t,e)}function HC(t,e){return rp(4,4,t,e)}function KC(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function QC(t,e,n){return n=n!=null?n.concat([t]):null,rp(4,4,KC.bind(null,e,t),n)}function Jw(){}function XC(t,e){var n=Hs();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Qw(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function YC(t,e){var n=Hs();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Qw(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function ZC(t,e,n){return Hl&21?(pi(n,e)||(n=rC(),_n.lanes|=n,Kl|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,ds=!0),t.memoizedState=n)}function tD(t,e){var n=Lt;Lt=n!==0&&4>n?n:4,t(!0);var r=E1.transition;E1.transition={};try{t(!1),e()}finally{Lt=n,E1.transition=r}}function JC(){return Hs().memoizedState}function nD(t,e,n){var r=Na(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},eT(t))tT(e,n);else if(n=MC(t,e,n,r),n!==null){var s=Zr();fi(n,t,r,s),nT(n,e,r)}}function rD(t,e,n){var r=Na(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(eT(t))tT(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,u=i(a,n);if(s.hasEagerState=!0,s.eagerState=u,pi(u,a)){var d=e.interleaved;d===null?(s.next=s,qw(e)):(s.next=d.next,d.next=s),e.interleaved=s;return}}catch{}finally{}n=MC(t,e,s,r),n!==null&&(s=Zr(),fi(n,t,r,s),nT(n,e,r))}}function eT(t){var e=t.alternate;return t===_n||e!==null&&e===_n}function tT(t,e){xd=tg=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function nT(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Rw(t,n)}}var ng={readContext:$s,useCallback:Or,useContext:Or,useEffect:Or,useImperativeHandle:Or,useInsertionEffect:Or,useLayoutEffect:Or,useMemo:Or,useReducer:Or,useRef:Or,useState:Or,useDebugValue:Or,useDeferredValue:Or,useTransition:Or,useMutableSource:Or,useSyncExternalStore:Or,useId:Or,unstable_isNewReconciler:!1},sD={readContext:$s,useCallback:function(t,e){return Ri().memoizedState=[t,e===void 0?null:e],t},useContext:$s,useEffect:tE,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,dm(4194308,4,KC.bind(null,e,t),n)},useLayoutEffect:function(t,e){return dm(4194308,4,t,e)},useInsertionEffect:function(t,e){return dm(4,2,t,e)},useMemo:function(t,e){var n=Ri();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Ri();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=nD.bind(null,_n,t),[r.memoizedState,t]},useRef:function(t){var e=Ri();return t={current:t},e.memoizedState=t},useState:eE,useDebugValue:Jw,useDeferredValue:function(t){return Ri().memoizedState=t},useTransition:function(){var t=eE(!1),e=t[0];return t=tD.bind(null,t[1]),Ri().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=_n,s=Ri();if(dn){if(n===void 0)throw Error(we(407));n=n()}else{if(n=e(),xr===null)throw Error(we(349));Hl&30||VC(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,tE(zC.bind(null,r,i,t),[t]),r.flags|=2048,Jd(9,UC.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Ri(),e=xr.identifierPrefix;if(dn){var n=po,r=go;n=(r&~(1<<32-di(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Yd++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=eD++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},iD={readContext:$s,useCallback:XC,useContext:$s,useEffect:Zw,useImperativeHandle:QC,useInsertionEffect:$C,useLayoutEffect:HC,useMemo:YC,useReducer:A1,useRef:WC,useState:function(){return A1(Zd)},useDebugValue:Jw,useDeferredValue:function(t){var e=Hs();return ZC(e,ir.memoizedState,t)},useTransition:function(){var t=A1(Zd)[0],e=Hs().memoizedState;return[t,e]},useMutableSource:FC,useSyncExternalStore:BC,useId:JC,unstable_isNewReconciler:!1},oD={readContext:$s,useCallback:XC,useContext:$s,useEffect:Zw,useImperativeHandle:QC,useInsertionEffect:$C,useLayoutEffect:HC,useMemo:YC,useReducer:b1,useRef:WC,useState:function(){return b1(Zd)},useDebugValue:Jw,useDeferredValue:function(t){var e=Hs();return ir===null?e.memoizedState=t:ZC(e,ir.memoizedState,t)},useTransition:function(){var t=b1(Zd)[0],e=Hs().memoizedState;return[t,e]},useMutableSource:FC,useSyncExternalStore:BC,useId:JC,unstable_isNewReconciler:!1};function ai(t,e){if(t&&t.defaultProps){e=En({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function jy(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:En({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var sp={isMounted:function(t){return(t=t._reactInternals)?gc(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Zr(),s=Na(t),i=Eo(r,s);i.payload=e,n!=null&&(i.callback=n),e=Ta(t,i,s),e!==null&&(fi(e,t,s,r),um(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Zr(),s=Na(t),i=Eo(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Ta(t,i,s),e!==null&&(fi(e,t,s,r),um(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Zr(),r=Na(t),s=Eo(n,r);s.tag=2,e!=null&&(s.callback=e),e=Ta(t,s,r),e!==null&&(fi(e,t,r,n),um(e,t,r))}};function nE(t,e,n,r,s,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!Wd(n,r)||!Wd(s,i):!0}function rT(t,e,n){var r=!1,s=ja,i=e.contextType;return typeof i=="object"&&i!==null?i=$s(i):(s=ys(e)?Wl:qr.current,r=e.contextTypes,i=(r=r!=null)?Cu(t,s):ja),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=sp,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function rE(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&sp.enqueueReplaceState(e,e.state,null)}function Fy(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Ww(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=$s(i):(i=ys(e)?Wl:qr.current,s.context=Cu(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(jy(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&sp.enqueueReplaceState(s,s.state,null),Jm(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Ru(t,e){try{var n="",r=e;do n+=OP(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function I1(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function By(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var aD=typeof WeakMap=="function"?WeakMap:Map;function sT(t,e,n){n=Eo(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){sg||(sg=!0,Qy=r),By(t,e)},n}function iT(t,e,n){n=Eo(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){By(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){By(t,e),typeof r!="function"&&(Sa===null?Sa=new Set([this]):Sa.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function sE(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new aD;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=vD.bind(null,t,e,n),e.then(t,t))}function iE(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function oE(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Eo(-1,1),e.tag=2,Ta(n,e,1))),n.lanes|=1),t)}var lD=jo.ReactCurrentOwner,ds=!1;function Qr(t,e,n,r){e.child=t===null?OC(e,null,n,r):Su(e,t.child,n,r)}function aE(t,e,n,r,s){n=n.render;var i=e.ref;return gu(e,s),r=Xw(t,e,n,r,i,s),n=Yw(),t!==null&&!ds?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,So(t,e,s)):(dn&&n&&Fw(e),e.flags|=1,Qr(t,e,r,s),e.child)}function lE(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!a_(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,oT(t,e,i,r,s)):(t=pm(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:Wd,n(a,r)&&t.ref===e.ref)return So(t,e,s)}return e.flags|=1,t=Ra(i,r),t.ref=e.ref,t.return=e,e.child=t}function oT(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Wd(i,r)&&t.ref===e.ref)if(ds=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(ds=!0);else return e.lanes=t.lanes,So(t,e,s)}return Vy(t,e,n,r,s)}function aT(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Yt(lu,Cs),Cs|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Yt(lu,Cs),Cs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Yt(lu,Cs),Cs|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Yt(lu,Cs),Cs|=r;return Qr(t,e,s,n),e.child}function lT(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Vy(t,e,n,r,s){var i=ys(n)?Wl:qr.current;return i=Cu(e,i),gu(e,s),n=Xw(t,e,n,r,i,s),r=Yw(),t!==null&&!ds?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,So(t,e,s)):(dn&&r&&Fw(e),e.flags|=1,Qr(t,e,n,s),e.child)}function cE(t,e,n,r,s){if(ys(n)){var i=!0;Km(e)}else i=!1;if(gu(e,s),e.stateNode===null)fm(t,e),rT(e,n,r),Fy(e,n,r,s),r=!0;else if(t===null){var a=e.stateNode,u=e.memoizedProps;a.props=u;var d=a.context,m=n.contextType;typeof m=="object"&&m!==null?m=$s(m):(m=ys(n)?Wl:qr.current,m=Cu(e,m));var y=n.getDerivedStateFromProps,_=typeof y=="function"||typeof a.getSnapshotBeforeUpdate=="function";_||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(u!==r||d!==m)&&rE(e,a,r,m),na=!1;var E=e.memoizedState;a.state=E,Jm(e,r,a,s),d=e.memoizedState,u!==r||E!==d||ps.current||na?(typeof y=="function"&&(jy(e,n,y,r),d=e.memoizedState),(u=na||nE(e,n,u,r,E,d,m))?(_||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=d),a.props=r,a.state=d,a.context=m,r=u):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,LC(t,e),u=e.memoizedProps,m=e.type===e.elementType?u:ai(e.type,u),a.props=m,_=e.pendingProps,E=a.context,d=n.contextType,typeof d=="object"&&d!==null?d=$s(d):(d=ys(n)?Wl:qr.current,d=Cu(e,d));var b=n.getDerivedStateFromProps;(y=typeof b=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(u!==_||E!==d)&&rE(e,a,r,d),na=!1,E=e.memoizedState,a.state=E,Jm(e,r,a,s);var k=e.memoizedState;u!==_||E!==k||ps.current||na?(typeof b=="function"&&(jy(e,n,b,r),k=e.memoizedState),(m=na||nE(e,n,m,r,E,k,d)||!1)?(y||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,k,d),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,k,d)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||u===t.memoizedProps&&E===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||u===t.memoizedProps&&E===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=k),a.props=r,a.state=k,a.context=d,r=m):(typeof a.componentDidUpdate!="function"||u===t.memoizedProps&&E===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||u===t.memoizedProps&&E===t.memoizedState||(e.flags|=1024),r=!1)}return Uy(t,e,n,r,i,s)}function Uy(t,e,n,r,s,i){lT(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&K2(e,n,!1),So(t,e,i);r=e.stateNode,lD.current=e;var u=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=Su(e,t.child,null,i),e.child=Su(e,null,u,i)):Qr(t,e,u,i),e.memoizedState=r.state,s&&K2(e,n,!0),e.child}function cT(t){var e=t.stateNode;e.pendingContext?H2(t,e.pendingContext,e.pendingContext!==e.context):e.context&&H2(t,e.context,!1),$w(t,e.containerInfo)}function uE(t,e,n,r,s){return Tu(),Vw(s),e.flags|=256,Qr(t,e,n,r),e.child}var zy={dehydrated:null,treeContext:null,retryLane:0};function Gy(t){return{baseLanes:t,cachePool:null,transitions:null}}function uT(t,e,n){var r=e.pendingProps,s=wn.current,i=!1,a=(e.flags&128)!==0,u;if((u=a)||(u=t!==null&&t.memoizedState===null?!1:(s&2)!==0),u?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Yt(wn,s&1),t===null)return My(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=ap(a,r,0,null),t=Fl(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Gy(n),e.memoizedState=zy,t):e_(e,a));if(s=t.memoizedState,s!==null&&(u=s.dehydrated,u!==null))return cD(t,e,a,r,u,s,n);if(i){i=r.fallback,a=e.mode,s=t.child,u=s.sibling;var d={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=d,e.deletions=null):(r=Ra(s,d),r.subtreeFlags=s.subtreeFlags&14680064),u!==null?i=Ra(u,i):(i=Fl(i,a,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=t.child.memoizedState,a=a===null?Gy(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=zy,r}return i=t.child,t=i.sibling,r=Ra(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function e_(t,e){return e=ap({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function O0(t,e,n,r){return r!==null&&Vw(r),Su(e,t.child,null,n),t=e_(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function cD(t,e,n,r,s,i,a){if(n)return e.flags&256?(e.flags&=-257,r=I1(Error(we(422))),O0(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=ap({mode:"visible",children:r.children},s,0,null),i=Fl(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Su(e,t.child,null,a),e.child.memoizedState=Gy(a),e.memoizedState=zy,i);if(!(e.mode&1))return O0(t,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var u=r.dgst;return r=u,i=Error(we(419)),r=I1(i,r,void 0),O0(t,e,a,r)}if(u=(a&t.childLanes)!==0,ds||u){if(r=xr,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,To(t,s),fi(r,t,s,-1))}return o_(),r=I1(Error(we(421))),O0(t,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=ED.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Ss=Ca(s.nextSibling),Rs=e,dn=!0,ci=null,t!==null&&(Vs[Us++]=go,Vs[Us++]=po,Vs[Us++]=$l,go=t.id,po=t.overflow,$l=e),e=e_(e,r.children),e.flags|=4096,e)}function hE(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Ly(t.return,e,n)}function C1(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function hT(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Qr(t,e,r.children,n),r=wn.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&hE(t,n,e);else if(t.tag===19)hE(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Yt(wn,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&eg(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),C1(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&eg(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}C1(e,!0,n,null,i);break;case"together":C1(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function fm(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function So(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Kl|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(we(153));if(e.child!==null){for(t=e.child,n=Ra(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ra(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function uD(t,e,n){switch(e.tag){case 3:cT(e),Tu();break;case 5:jC(e);break;case 1:ys(e.type)&&Km(e);break;case 4:$w(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Yt(Ym,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Yt(wn,wn.current&1),e.flags|=128,null):n&e.child.childLanes?uT(t,e,n):(Yt(wn,wn.current&1),t=So(t,e,n),t!==null?t.sibling:null);Yt(wn,wn.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return hT(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Yt(wn,wn.current),r)break;return null;case 22:case 23:return e.lanes=0,aT(t,e,n)}return So(t,e,n)}var dT,qy,fT,mT;dT=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};qy=function(){};fT=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Dl(Bi.current);var i=null;switch(n){case"input":s=dy(t,s),r=dy(t,r),i=[];break;case"select":s=En({},s,{value:void 0}),r=En({},r,{value:void 0}),i=[];break;case"textarea":s=gy(t,s),r=gy(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=$m)}yy(n,r);var a;n=null;for(m in s)if(!r.hasOwnProperty(m)&&s.hasOwnProperty(m)&&s[m]!=null)if(m==="style"){var u=s[m];for(a in u)u.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else m!=="dangerouslySetInnerHTML"&&m!=="children"&&m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(Fd.hasOwnProperty(m)?i||(i=[]):(i=i||[]).push(m,null));for(m in r){var d=r[m];if(u=s!=null?s[m]:void 0,r.hasOwnProperty(m)&&d!==u&&(d!=null||u!=null))if(m==="style")if(u){for(a in u)!u.hasOwnProperty(a)||d&&d.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in d)d.hasOwnProperty(a)&&u[a]!==d[a]&&(n||(n={}),n[a]=d[a])}else n||(i||(i=[]),i.push(m,n)),n=d;else m==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,u=u?u.__html:void 0,d!=null&&u!==d&&(i=i||[]).push(m,d)):m==="children"?typeof d!="string"&&typeof d!="number"||(i=i||[]).push(m,""+d):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&(Fd.hasOwnProperty(m)?(d!=null&&m==="onScroll"&&tn("scroll",t),i||u===d||(i=[])):(i=i||[]).push(m,d))}n&&(i=i||[]).push("style",n);var m=i;(e.updateQueue=m)&&(e.flags|=4)}};mT=function(t,e,n,r){n!==r&&(e.flags|=4)};function qh(t,e){if(!dn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Mr(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function hD(t,e,n){var r=e.pendingProps;switch(Bw(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mr(e),null;case 1:return ys(e.type)&&Hm(),Mr(e),null;case 3:return r=e.stateNode,Nu(),on(ps),on(qr),Kw(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(k0(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ci!==null&&(Zy(ci),ci=null))),qy(t,e),Mr(e),null;case 5:Hw(e);var s=Dl(Xd.current);if(n=e.type,t!==null&&e.stateNode!=null)fT(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(we(166));return Mr(e),null}if(t=Dl(Bi.current),k0(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Di]=e,r[Kd]=i,t=(e.mode&1)!==0,n){case"dialog":tn("cancel",r),tn("close",r);break;case"iframe":case"object":case"embed":tn("load",r);break;case"video":case"audio":for(s=0;s<sd.length;s++)tn(sd[s],r);break;case"source":tn("error",r);break;case"img":case"image":case"link":tn("error",r),tn("load",r);break;case"details":tn("toggle",r);break;case"input":_2(r,i),tn("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},tn("invalid",r);break;case"textarea":E2(r,i),tn("invalid",r)}yy(n,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var u=i[a];a==="children"?typeof u=="string"?r.textContent!==u&&(i.suppressHydrationWarning!==!0&&P0(r.textContent,u,t),s=["children",u]):typeof u=="number"&&r.textContent!==""+u&&(i.suppressHydrationWarning!==!0&&P0(r.textContent,u,t),s=["children",""+u]):Fd.hasOwnProperty(a)&&u!=null&&a==="onScroll"&&tn("scroll",r)}switch(n){case"input":A0(r),v2(r,i,!0);break;case"textarea":A0(r),A2(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=$m)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=zI(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[Di]=e,t[Kd]=r,dT(t,e,!1,!1),e.stateNode=t;e:{switch(a=xy(n,r),n){case"dialog":tn("cancel",t),tn("close",t),s=r;break;case"iframe":case"object":case"embed":tn("load",t),s=r;break;case"video":case"audio":for(s=0;s<sd.length;s++)tn(sd[s],t);s=r;break;case"source":tn("error",t),s=r;break;case"img":case"image":case"link":tn("error",t),tn("load",t),s=r;break;case"details":tn("toggle",t),s=r;break;case"input":_2(t,r),s=dy(t,r),tn("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=En({},r,{value:void 0}),tn("invalid",t);break;case"textarea":E2(t,r),s=gy(t,r),tn("invalid",t);break;default:s=r}yy(n,s),u=s;for(i in u)if(u.hasOwnProperty(i)){var d=u[i];i==="style"?WI(t,d):i==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&GI(t,d)):i==="children"?typeof d=="string"?(n!=="textarea"||d!=="")&&Bd(t,d):typeof d=="number"&&Bd(t,""+d):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Fd.hasOwnProperty(i)?d!=null&&i==="onScroll"&&tn("scroll",t):d!=null&&bw(t,i,d,a))}switch(n){case"input":A0(t),v2(t,r,!1);break;case"textarea":A0(t),A2(t);break;case"option":r.value!=null&&t.setAttribute("value",""+La(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?hu(t,!!r.multiple,i,!1):r.defaultValue!=null&&hu(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=$m)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Mr(e),null;case 6:if(t&&e.stateNode!=null)mT(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(we(166));if(n=Dl(Xd.current),Dl(Bi.current),k0(e)){if(r=e.stateNode,n=e.memoizedProps,r[Di]=e,(i=r.nodeValue!==n)&&(t=Rs,t!==null))switch(t.tag){case 3:P0(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&P0(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Di]=e,e.stateNode=r}return Mr(e),null;case 13:if(on(wn),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(dn&&Ss!==null&&e.mode&1&&!(e.flags&128))kC(),Tu(),e.flags|=98560,i=!1;else if(i=k0(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(we(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(we(317));i[Di]=e}else Tu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Mr(e),i=!1}else ci!==null&&(Zy(ci),ci=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||wn.current&1?ar===0&&(ar=3):o_())),e.updateQueue!==null&&(e.flags|=4),Mr(e),null);case 4:return Nu(),qy(t,e),t===null&&$d(e.stateNode.containerInfo),Mr(e),null;case 10:return Gw(e.type._context),Mr(e),null;case 17:return ys(e.type)&&Hm(),Mr(e),null;case 19:if(on(wn),i=e.memoizedState,i===null)return Mr(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)qh(i,!1);else{if(ar!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=eg(t),a!==null){for(e.flags|=128,qh(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Yt(wn,wn.current&1|2),e.child}t=t.sibling}i.tail!==null&&Bn()>Pu&&(e.flags|=128,r=!0,qh(i,!1),e.lanes=4194304)}else{if(!r)if(t=eg(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),qh(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!dn)return Mr(e),null}else 2*Bn()-i.renderingStartTime>Pu&&n!==1073741824&&(e.flags|=128,r=!0,qh(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Bn(),e.sibling=null,n=wn.current,Yt(wn,r?n&1|2:n&1),e):(Mr(e),null);case 22:case 23:return i_(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Cs&1073741824&&(Mr(e),e.subtreeFlags&6&&(e.flags|=8192)):Mr(e),null;case 24:return null;case 25:return null}throw Error(we(156,e.tag))}function dD(t,e){switch(Bw(e),e.tag){case 1:return ys(e.type)&&Hm(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Nu(),on(ps),on(qr),Kw(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Hw(e),null;case 13:if(on(wn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(we(340));Tu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return on(wn),null;case 4:return Nu(),null;case 10:return Gw(e.type._context),null;case 22:case 23:return i_(),null;case 24:return null;default:return null}}var M0=!1,Br=!1,fD=typeof WeakSet=="function"?WeakSet:Set,Le=null;function au(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Rn(t,e,r)}else n.current=null}function Wy(t,e,n){try{n()}catch(r){Rn(t,e,r)}}var dE=!1;function mD(t,e){if(Sy=Gm,t=wC(),jw(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,u=-1,d=-1,m=0,y=0,_=t,E=null;t:for(;;){for(var b;_!==n||s!==0&&_.nodeType!==3||(u=a+s),_!==i||r!==0&&_.nodeType!==3||(d=a+r),_.nodeType===3&&(a+=_.nodeValue.length),(b=_.firstChild)!==null;)E=_,_=b;for(;;){if(_===t)break t;if(E===n&&++m===s&&(u=a),E===i&&++y===r&&(d=a),(b=_.nextSibling)!==null)break;_=E,E=_.parentNode}_=b}n=u===-1||d===-1?null:{start:u,end:d}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ny={focusedElem:t,selectionRange:n},Gm=!1,Le=e;Le!==null;)if(e=Le,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Le=t;else for(;Le!==null;){e=Le;try{var k=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var S=k.memoizedProps,O=k.memoizedState,T=e.stateNode,C=T.getSnapshotBeforeUpdate(e.elementType===e.type?S:ai(e.type,S),O);T.__reactInternalSnapshotBeforeUpdate=C}break;case 3:var R=e.stateNode.containerInfo;R.nodeType===1?R.textContent="":R.nodeType===9&&R.documentElement&&R.removeChild(R.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(we(163))}}catch(j){Rn(e,e.return,j)}if(t=e.sibling,t!==null){t.return=e.return,Le=t;break}Le=e.return}return k=dE,dE=!1,k}function wd(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Wy(e,n,i)}s=s.next}while(s!==r)}}function ip(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function $y(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function gT(t){var e=t.alternate;e!==null&&(t.alternate=null,gT(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Di],delete e[Kd],delete e[ky],delete e[Xk],delete e[Yk])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function pT(t){return t.tag===5||t.tag===3||t.tag===4}function fE(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||pT(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Hy(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=$m));else if(r!==4&&(t=t.child,t!==null))for(Hy(t,e,n),t=t.sibling;t!==null;)Hy(t,e,n),t=t.sibling}function Ky(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Ky(t,e,n),t=t.sibling;t!==null;)Ky(t,e,n),t=t.sibling}var br=null,li=!1;function Xo(t,e,n){for(n=n.child;n!==null;)yT(t,e,n),n=n.sibling}function yT(t,e,n){if(Fi&&typeof Fi.onCommitFiberUnmount=="function")try{Fi.onCommitFiberUnmount(Yg,n)}catch{}switch(n.tag){case 5:Br||au(n,e);case 6:var r=br,s=li;br=null,Xo(t,e,n),br=r,li=s,br!==null&&(li?(t=br,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):br.removeChild(n.stateNode));break;case 18:br!==null&&(li?(t=br,n=n.stateNode,t.nodeType===8?w1(t.parentNode,n):t.nodeType===1&&w1(t,n),Gd(t)):w1(br,n.stateNode));break;case 4:r=br,s=li,br=n.stateNode.containerInfo,li=!0,Xo(t,e,n),br=r,li=s;break;case 0:case 11:case 14:case 15:if(!Br&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&Wy(n,e,a),s=s.next}while(s!==r)}Xo(t,e,n);break;case 1:if(!Br&&(au(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(u){Rn(n,e,u)}Xo(t,e,n);break;case 21:Xo(t,e,n);break;case 22:n.mode&1?(Br=(r=Br)||n.memoizedState!==null,Xo(t,e,n),Br=r):Xo(t,e,n);break;default:Xo(t,e,n)}}function mE(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new fD),e.forEach(function(r){var s=AD.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function oi(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,a=e,u=a;e:for(;u!==null;){switch(u.tag){case 5:br=u.stateNode,li=!1;break e;case 3:br=u.stateNode.containerInfo,li=!0;break e;case 4:br=u.stateNode.containerInfo,li=!0;break e}u=u.return}if(br===null)throw Error(we(160));yT(i,a,s),br=null,li=!1;var d=s.alternate;d!==null&&(d.return=null),s.return=null}catch(m){Rn(s,e,m)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)xT(e,t),e=e.sibling}function xT(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(oi(e,t),Ni(t),r&4){try{wd(3,t,t.return),ip(3,t)}catch(S){Rn(t,t.return,S)}try{wd(5,t,t.return)}catch(S){Rn(t,t.return,S)}}break;case 1:oi(e,t),Ni(t),r&512&&n!==null&&au(n,n.return);break;case 5:if(oi(e,t),Ni(t),r&512&&n!==null&&au(n,n.return),t.flags&32){var s=t.stateNode;try{Bd(s,"")}catch(S){Rn(t,t.return,S)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,u=t.type,d=t.updateQueue;if(t.updateQueue=null,d!==null)try{u==="input"&&i.type==="radio"&&i.name!=null&&VI(s,i),xy(u,a);var m=xy(u,i);for(a=0;a<d.length;a+=2){var y=d[a],_=d[a+1];y==="style"?WI(s,_):y==="dangerouslySetInnerHTML"?GI(s,_):y==="children"?Bd(s,_):bw(s,y,_,m)}switch(u){case"input":fy(s,i);break;case"textarea":UI(s,i);break;case"select":var E=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var b=i.value;b!=null?hu(s,!!i.multiple,b,!1):E!==!!i.multiple&&(i.defaultValue!=null?hu(s,!!i.multiple,i.defaultValue,!0):hu(s,!!i.multiple,i.multiple?[]:"",!1))}s[Kd]=i}catch(S){Rn(t,t.return,S)}}break;case 6:if(oi(e,t),Ni(t),r&4){if(t.stateNode===null)throw Error(we(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(S){Rn(t,t.return,S)}}break;case 3:if(oi(e,t),Ni(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Gd(e.containerInfo)}catch(S){Rn(t,t.return,S)}break;case 4:oi(e,t),Ni(t);break;case 13:oi(e,t),Ni(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(r_=Bn())),r&4&&mE(t);break;case 22:if(y=n!==null&&n.memoizedState!==null,t.mode&1?(Br=(m=Br)||y,oi(e,t),Br=m):oi(e,t),Ni(t),r&8192){if(m=t.memoizedState!==null,(t.stateNode.isHidden=m)&&!y&&t.mode&1)for(Le=t,y=t.child;y!==null;){for(_=Le=y;Le!==null;){switch(E=Le,b=E.child,E.tag){case 0:case 11:case 14:case 15:wd(4,E,E.return);break;case 1:au(E,E.return);var k=E.stateNode;if(typeof k.componentWillUnmount=="function"){r=E,n=E.return;try{e=r,k.props=e.memoizedProps,k.state=e.memoizedState,k.componentWillUnmount()}catch(S){Rn(r,n,S)}}break;case 5:au(E,E.return);break;case 22:if(E.memoizedState!==null){pE(_);continue}}b!==null?(b.return=E,Le=b):pE(_)}y=y.sibling}e:for(y=null,_=t;;){if(_.tag===5){if(y===null){y=_;try{s=_.stateNode,m?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(u=_.stateNode,d=_.memoizedProps.style,a=d!=null&&d.hasOwnProperty("display")?d.display:null,u.style.display=qI("display",a))}catch(S){Rn(t,t.return,S)}}}else if(_.tag===6){if(y===null)try{_.stateNode.nodeValue=m?"":_.memoizedProps}catch(S){Rn(t,t.return,S)}}else if((_.tag!==22&&_.tag!==23||_.memoizedState===null||_===t)&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===t)break e;for(;_.sibling===null;){if(_.return===null||_.return===t)break e;y===_&&(y=null),_=_.return}y===_&&(y=null),_.sibling.return=_.return,_=_.sibling}}break;case 19:oi(e,t),Ni(t),r&4&&mE(t);break;case 21:break;default:oi(e,t),Ni(t)}}function Ni(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(pT(n)){var r=n;break e}n=n.return}throw Error(we(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Bd(s,""),r.flags&=-33);var i=fE(t);Ky(t,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,u=fE(t);Hy(t,u,a);break;default:throw Error(we(161))}}catch(d){Rn(t,t.return,d)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function gD(t,e,n){Le=t,wT(t)}function wT(t,e,n){for(var r=(t.mode&1)!==0;Le!==null;){var s=Le,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||M0;if(!a){var u=s.alternate,d=u!==null&&u.memoizedState!==null||Br;u=M0;var m=Br;if(M0=a,(Br=d)&&!m)for(Le=s;Le!==null;)a=Le,d=a.child,a.tag===22&&a.memoizedState!==null?yE(s):d!==null?(d.return=a,Le=d):yE(s);for(;i!==null;)Le=i,wT(i),i=i.sibling;Le=s,M0=u,Br=m}gE(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Le=i):gE(t)}}function gE(t){for(;Le!==null;){var e=Le;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Br||ip(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Br)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:ai(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&J2(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}J2(e,a,n)}break;case 5:var u=e.stateNode;if(n===null&&e.flags&4){n=u;var d=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&n.focus();break;case"img":d.src&&(n.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var m=e.alternate;if(m!==null){var y=m.memoizedState;if(y!==null){var _=y.dehydrated;_!==null&&Gd(_)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(we(163))}Br||e.flags&512&&$y(e)}catch(E){Rn(e,e.return,E)}}if(e===t){Le=null;break}if(n=e.sibling,n!==null){n.return=e.return,Le=n;break}Le=e.return}}function pE(t){for(;Le!==null;){var e=Le;if(e===t){Le=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Le=n;break}Le=e.return}}function yE(t){for(;Le!==null;){var e=Le;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ip(4,e)}catch(d){Rn(e,n,d)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(d){Rn(e,s,d)}}var i=e.return;try{$y(e)}catch(d){Rn(e,i,d)}break;case 5:var a=e.return;try{$y(e)}catch(d){Rn(e,a,d)}}}catch(d){Rn(e,e.return,d)}if(e===t){Le=null;break}var u=e.sibling;if(u!==null){u.return=e.return,Le=u;break}Le=e.return}}var pD=Math.ceil,rg=jo.ReactCurrentDispatcher,t_=jo.ReactCurrentOwner,qs=jo.ReactCurrentBatchConfig,Nt=0,xr=null,Xn=null,Tr=0,Cs=0,lu=Za(0),ar=0,ef=null,Kl=0,op=0,n_=0,_d=null,hs=null,r_=0,Pu=1/0,co=null,sg=!1,Qy=null,Sa=null,L0=!1,xa=null,ig=0,vd=0,Xy=null,mm=-1,gm=0;function Zr(){return Nt&6?Bn():mm!==-1?mm:mm=Bn()}function Na(t){return t.mode&1?Nt&2&&Tr!==0?Tr&-Tr:Jk.transition!==null?(gm===0&&(gm=rC()),gm):(t=Lt,t!==0||(t=window.event,t=t===void 0?16:uC(t.type)),t):1}function fi(t,e,n,r){if(50<vd)throw vd=0,Xy=null,Error(we(185));Sf(t,n,r),(!(Nt&2)||t!==xr)&&(t===xr&&(!(Nt&2)&&(op|=n),ar===4&&ia(t,Tr)),xs(t,r),n===1&&Nt===0&&!(e.mode&1)&&(Pu=Bn()+500,np&&Ja()))}function xs(t,e){var n=t.callbackNode;JP(t,e);var r=zm(t,t===xr?Tr:0);if(r===0)n!==null&&C2(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&C2(n),e===1)t.tag===0?Zk(xE.bind(null,t)):NC(xE.bind(null,t)),Kk(function(){!(Nt&6)&&Ja()}),n=null;else{switch(sC(r)){case 1:n=Nw;break;case 4:n=tC;break;case 16:n=Um;break;case 536870912:n=nC;break;default:n=Um}n=TT(n,_T.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function _T(t,e){if(mm=-1,gm=0,Nt&6)throw Error(we(327));var n=t.callbackNode;if(pu()&&t.callbackNode!==n)return null;var r=zm(t,t===xr?Tr:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=og(t,r);else{e=r;var s=Nt;Nt|=2;var i=ET();(xr!==t||Tr!==e)&&(co=null,Pu=Bn()+500,jl(t,e));do try{wD();break}catch(u){vT(t,u)}while(1);zw(),rg.current=i,Nt=s,Xn!==null?e=0:(xr=null,Tr=0,e=ar)}if(e!==0){if(e===2&&(s=Ay(t),s!==0&&(r=s,e=Yy(t,s))),e===1)throw n=ef,jl(t,0),ia(t,r),xs(t,Bn()),n;if(e===6)ia(t,r);else{if(s=t.current.alternate,!(r&30)&&!yD(s)&&(e=og(t,r),e===2&&(i=Ay(t),i!==0&&(r=i,e=Yy(t,i))),e===1))throw n=ef,jl(t,0),ia(t,r),xs(t,Bn()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(we(345));case 2:bl(t,hs,co);break;case 3:if(ia(t,r),(r&130023424)===r&&(e=r_+500-Bn(),10<e)){if(zm(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Zr(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Py(bl.bind(null,t,hs,co),e);break}bl(t,hs,co);break;case 4:if(ia(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var a=31-di(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=Bn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*pD(r/1960))-r,10<r){t.timeoutHandle=Py(bl.bind(null,t,hs,co),r);break}bl(t,hs,co);break;case 5:bl(t,hs,co);break;default:throw Error(we(329))}}}return xs(t,Bn()),t.callbackNode===n?_T.bind(null,t):null}function Yy(t,e){var n=_d;return t.current.memoizedState.isDehydrated&&(jl(t,e).flags|=256),t=og(t,e),t!==2&&(e=hs,hs=n,e!==null&&Zy(e)),t}function Zy(t){hs===null?hs=t:hs.push.apply(hs,t)}function yD(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!pi(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ia(t,e){for(e&=~n_,e&=~op,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-di(e),r=1<<n;t[n]=-1,e&=~r}}function xE(t){if(Nt&6)throw Error(we(327));pu();var e=zm(t,0);if(!(e&1))return xs(t,Bn()),null;var n=og(t,e);if(t.tag!==0&&n===2){var r=Ay(t);r!==0&&(e=r,n=Yy(t,r))}if(n===1)throw n=ef,jl(t,0),ia(t,e),xs(t,Bn()),n;if(n===6)throw Error(we(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,bl(t,hs,co),xs(t,Bn()),null}function s_(t,e){var n=Nt;Nt|=1;try{return t(e)}finally{Nt=n,Nt===0&&(Pu=Bn()+500,np&&Ja())}}function Ql(t){xa!==null&&xa.tag===0&&!(Nt&6)&&pu();var e=Nt;Nt|=1;var n=qs.transition,r=Lt;try{if(qs.transition=null,Lt=1,t)return t()}finally{Lt=r,qs.transition=n,Nt=e,!(Nt&6)&&Ja()}}function i_(){Cs=lu.current,on(lu)}function jl(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Hk(n)),Xn!==null)for(n=Xn.return;n!==null;){var r=n;switch(Bw(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Hm();break;case 3:Nu(),on(ps),on(qr),Kw();break;case 5:Hw(r);break;case 4:Nu();break;case 13:on(wn);break;case 19:on(wn);break;case 10:Gw(r.type._context);break;case 22:case 23:i_()}n=n.return}if(xr=t,Xn=t=Ra(t.current,null),Tr=Cs=e,ar=0,ef=null,n_=op=Kl=0,hs=_d=null,kl!==null){for(e=0;e<kl.length;e++)if(n=kl[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}n.pending=r}kl=null}return t}function vT(t,e){do{var n=Xn;try{if(zw(),hm.current=ng,tg){for(var r=_n.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}tg=!1}if(Hl=0,pr=ir=_n=null,xd=!1,Yd=0,t_.current=null,n===null||n.return===null){ar=1,ef=e,Xn=null;break}e:{var i=t,a=n.return,u=n,d=e;if(e=Tr,u.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var m=d,y=u,_=y.tag;if(!(y.mode&1)&&(_===0||_===11||_===15)){var E=y.alternate;E?(y.updateQueue=E.updateQueue,y.memoizedState=E.memoizedState,y.lanes=E.lanes):(y.updateQueue=null,y.memoizedState=null)}var b=iE(a);if(b!==null){b.flags&=-257,oE(b,a,u,i,e),b.mode&1&&sE(i,m,e),e=b,d=m;var k=e.updateQueue;if(k===null){var S=new Set;S.add(d),e.updateQueue=S}else k.add(d);break e}else{if(!(e&1)){sE(i,m,e),o_();break e}d=Error(we(426))}}else if(dn&&u.mode&1){var O=iE(a);if(O!==null){!(O.flags&65536)&&(O.flags|=256),oE(O,a,u,i,e),Vw(Ru(d,u));break e}}i=d=Ru(d,u),ar!==4&&(ar=2),_d===null?_d=[i]:_d.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var T=sT(i,d,e);Z2(i,T);break e;case 1:u=d;var C=i.type,R=i.stateNode;if(!(i.flags&128)&&(typeof C.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(Sa===null||!Sa.has(R)))){i.flags|=65536,e&=-e,i.lanes|=e;var j=iT(i,u,e);Z2(i,j);break e}}i=i.return}while(i!==null)}bT(n)}catch(K){e=K,Xn===n&&n!==null&&(Xn=n=n.return);continue}break}while(1)}function ET(){var t=rg.current;return rg.current=ng,t===null?ng:t}function o_(){(ar===0||ar===3||ar===2)&&(ar=4),xr===null||!(Kl&268435455)&&!(op&268435455)||ia(xr,Tr)}function og(t,e){var n=Nt;Nt|=2;var r=ET();(xr!==t||Tr!==e)&&(co=null,jl(t,e));do try{xD();break}catch(s){vT(t,s)}while(1);if(zw(),Nt=n,rg.current=r,Xn!==null)throw Error(we(261));return xr=null,Tr=0,ar}function xD(){for(;Xn!==null;)AT(Xn)}function wD(){for(;Xn!==null&&!qP();)AT(Xn)}function AT(t){var e=CT(t.alternate,t,Cs);t.memoizedProps=t.pendingProps,e===null?bT(t):Xn=e,t_.current=null}function bT(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=dD(n,e),n!==null){n.flags&=32767,Xn=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ar=6,Xn=null;return}}else if(n=hD(n,e,Cs),n!==null){Xn=n;return}if(e=e.sibling,e!==null){Xn=e;return}Xn=e=t}while(e!==null);ar===0&&(ar=5)}function bl(t,e,n){var r=Lt,s=qs.transition;try{qs.transition=null,Lt=1,_D(t,e,n,r)}finally{qs.transition=s,Lt=r}return null}function _D(t,e,n,r){do pu();while(xa!==null);if(Nt&6)throw Error(we(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(we(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(ek(t,i),t===xr&&(Xn=xr=null,Tr=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||L0||(L0=!0,TT(Um,function(){return pu(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=qs.transition,qs.transition=null;var a=Lt;Lt=1;var u=Nt;Nt|=4,t_.current=null,mD(t,n),xT(n,t),Vk(Ny),Gm=!!Sy,Ny=Sy=null,t.current=n,gD(n),WP(),Nt=u,Lt=a,qs.transition=i}else t.current=n;if(L0&&(L0=!1,xa=t,ig=s),i=t.pendingLanes,i===0&&(Sa=null),KP(n.stateNode),xs(t,Bn()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(sg)throw sg=!1,t=Qy,Qy=null,t;return ig&1&&t.tag!==0&&pu(),i=t.pendingLanes,i&1?t===Xy?vd++:(vd=0,Xy=t):vd=0,Ja(),null}function pu(){if(xa!==null){var t=sC(ig),e=qs.transition,n=Lt;try{if(qs.transition=null,Lt=16>t?16:t,xa===null)var r=!1;else{if(t=xa,xa=null,ig=0,Nt&6)throw Error(we(331));var s=Nt;for(Nt|=4,Le=t.current;Le!==null;){var i=Le,a=i.child;if(Le.flags&16){var u=i.deletions;if(u!==null){for(var d=0;d<u.length;d++){var m=u[d];for(Le=m;Le!==null;){var y=Le;switch(y.tag){case 0:case 11:case 15:wd(8,y,i)}var _=y.child;if(_!==null)_.return=y,Le=_;else for(;Le!==null;){y=Le;var E=y.sibling,b=y.return;if(gT(y),y===m){Le=null;break}if(E!==null){E.return=b,Le=E;break}Le=b}}}var k=i.alternate;if(k!==null){var S=k.child;if(S!==null){k.child=null;do{var O=S.sibling;S.sibling=null,S=O}while(S!==null)}}Le=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,Le=a;else e:for(;Le!==null;){if(i=Le,i.flags&2048)switch(i.tag){case 0:case 11:case 15:wd(9,i,i.return)}var T=i.sibling;if(T!==null){T.return=i.return,Le=T;break e}Le=i.return}}var C=t.current;for(Le=C;Le!==null;){a=Le;var R=a.child;if(a.subtreeFlags&2064&&R!==null)R.return=a,Le=R;else e:for(a=C;Le!==null;){if(u=Le,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:ip(9,u)}}catch(K){Rn(u,u.return,K)}if(u===a){Le=null;break e}var j=u.sibling;if(j!==null){j.return=u.return,Le=j;break e}Le=u.return}}if(Nt=s,Ja(),Fi&&typeof Fi.onPostCommitFiberRoot=="function")try{Fi.onPostCommitFiberRoot(Yg,t)}catch{}r=!0}return r}finally{Lt=n,qs.transition=e}}return!1}function wE(t,e,n){e=Ru(n,e),e=sT(t,e,1),t=Ta(t,e,1),e=Zr(),t!==null&&(Sf(t,1,e),xs(t,e))}function Rn(t,e,n){if(t.tag===3)wE(t,t,n);else for(;e!==null;){if(e.tag===3){wE(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Sa===null||!Sa.has(r))){t=Ru(n,t),t=iT(e,t,1),e=Ta(e,t,1),t=Zr(),e!==null&&(Sf(e,1,t),xs(e,t));break}}e=e.return}}function vD(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Zr(),t.pingedLanes|=t.suspendedLanes&n,xr===t&&(Tr&n)===n&&(ar===4||ar===3&&(Tr&130023424)===Tr&&500>Bn()-r_?jl(t,0):n_|=n),xs(t,e)}function IT(t,e){e===0&&(t.mode&1?(e=C0,C0<<=1,!(C0&130023424)&&(C0=4194304)):e=1);var n=Zr();t=To(t,e),t!==null&&(Sf(t,e,n),xs(t,n))}function ED(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),IT(t,n)}function AD(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(we(314))}r!==null&&r.delete(e),IT(t,n)}var CT;CT=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||ps.current)ds=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return ds=!1,uD(t,e,n);ds=!!(t.flags&131072)}else ds=!1,dn&&e.flags&1048576&&RC(e,Xm,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;fm(t,e),t=e.pendingProps;var s=Cu(e,qr.current);gu(e,n),s=Xw(null,e,r,t,s,n);var i=Yw();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ys(r)?(i=!0,Km(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Ww(e),s.updater=sp,e.stateNode=s,s._reactInternals=e,Fy(e,r,t,n),e=Uy(null,e,r,!0,i,n)):(e.tag=0,dn&&i&&Fw(e),Qr(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(fm(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=ID(r),t=ai(r,t),s){case 0:e=Vy(null,e,r,t,n);break e;case 1:e=cE(null,e,r,t,n);break e;case 11:e=aE(null,e,r,t,n);break e;case 14:e=lE(null,e,r,ai(r.type,t),n);break e}throw Error(we(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ai(r,s),Vy(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ai(r,s),cE(t,e,r,s,n);case 3:e:{if(cT(e),t===null)throw Error(we(387));r=e.pendingProps,i=e.memoizedState,s=i.element,LC(t,e),Jm(e,r,null,n);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Ru(Error(we(423)),e),e=uE(t,e,r,n,s);break e}else if(r!==s){s=Ru(Error(we(424)),e),e=uE(t,e,r,n,s);break e}else for(Ss=Ca(e.stateNode.containerInfo.firstChild),Rs=e,dn=!0,ci=null,n=OC(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Tu(),r===s){e=So(t,e,n);break e}Qr(t,e,r,n)}e=e.child}return e;case 5:return jC(e),t===null&&My(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,a=s.children,Ry(r,s)?a=null:i!==null&&Ry(r,i)&&(e.flags|=32),lT(t,e),Qr(t,e,a,n),e.child;case 6:return t===null&&My(e),null;case 13:return uT(t,e,n);case 4:return $w(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Su(e,null,r,n):Qr(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ai(r,s),aE(t,e,r,s,n);case 7:return Qr(t,e,e.pendingProps,n),e.child;case 8:return Qr(t,e,e.pendingProps.children,n),e.child;case 12:return Qr(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,Yt(Ym,r._currentValue),r._currentValue=a,i!==null)if(pi(i.value,a)){if(i.children===s.children&&!ps.current){e=So(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var u=i.dependencies;if(u!==null){a=i.child;for(var d=u.firstContext;d!==null;){if(d.context===r){if(i.tag===1){d=Eo(-1,n&-n),d.tag=2;var m=i.updateQueue;if(m!==null){m=m.shared;var y=m.pending;y===null?d.next=d:(d.next=y.next,y.next=d),m.pending=d}}i.lanes|=n,d=i.alternate,d!==null&&(d.lanes|=n),Ly(i.return,n,e),u.lanes|=n;break}d=d.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(we(341));a.lanes|=n,u=a.alternate,u!==null&&(u.lanes|=n),Ly(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Qr(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,gu(e,n),s=$s(s),r=r(s),e.flags|=1,Qr(t,e,r,n),e.child;case 14:return r=e.type,s=ai(r,e.pendingProps),s=ai(r.type,s),lE(t,e,r,s,n);case 15:return oT(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ai(r,s),fm(t,e),e.tag=1,ys(r)?(t=!0,Km(e)):t=!1,gu(e,n),rT(e,r,s),Fy(e,r,s,n),Uy(null,e,r,!0,t,n);case 19:return hT(t,e,n);case 22:return aT(t,e,n)}throw Error(we(156,e.tag))};function TT(t,e){return eC(t,e)}function bD(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zs(t,e,n,r){return new bD(t,e,n,r)}function a_(t){return t=t.prototype,!(!t||!t.isReactComponent)}function ID(t){if(typeof t=="function")return a_(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Cw)return 11;if(t===Tw)return 14}return 2}function Ra(t,e){var n=t.alternate;return n===null?(n=zs(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function pm(t,e,n,r,s,i){var a=2;if(r=t,typeof t=="function")a_(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case Zc:return Fl(n.children,s,i,e);case Iw:a=8,s|=8;break;case ly:return t=zs(12,n,e,s|2),t.elementType=ly,t.lanes=i,t;case cy:return t=zs(13,n,e,s),t.elementType=cy,t.lanes=i,t;case uy:return t=zs(19,n,e,s),t.elementType=uy,t.lanes=i,t;case jI:return ap(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case MI:a=10;break e;case LI:a=9;break e;case Cw:a=11;break e;case Tw:a=14;break e;case ta:a=16,r=null;break e}throw Error(we(130,t==null?t:typeof t,""))}return e=zs(a,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Fl(t,e,n,r){return t=zs(7,t,r,e),t.lanes=n,t}function ap(t,e,n,r){return t=zs(22,t,r,e),t.elementType=jI,t.lanes=n,t.stateNode={isHidden:!1},t}function T1(t,e,n){return t=zs(6,t,null,e),t.lanes=n,t}function S1(t,e,n){return e=zs(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function CD(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=l1(0),this.expirationTimes=l1(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=l1(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function l_(t,e,n,r,s,i,a,u,d){return t=new CD(t,e,n,u,d),e===1?(e=1,i===!0&&(e|=8)):e=0,i=zs(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ww(i),t}function TD(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Yc,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function ST(t){if(!t)return ja;t=t._reactInternals;e:{if(gc(t)!==t||t.tag!==1)throw Error(we(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ys(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(we(171))}if(t.tag===1){var n=t.type;if(ys(n))return SC(t,n,e)}return e}function NT(t,e,n,r,s,i,a,u,d){return t=l_(n,r,!0,t,s,i,a,u,d),t.context=ST(null),n=t.current,r=Zr(),s=Na(n),i=Eo(r,s),i.callback=e??null,Ta(n,i,s),t.current.lanes=s,Sf(t,s,r),xs(t,r),t}function lp(t,e,n,r){var s=e.current,i=Zr(),a=Na(s);return n=ST(n),e.context===null?e.context=n:e.pendingContext=n,e=Eo(i,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Ta(s,e,a),t!==null&&(fi(t,s,a,i),um(t,s,a)),a}function ag(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function _E(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function c_(t,e){_E(t,e),(t=t.alternate)&&_E(t,e)}function SD(){return null}var RT=typeof reportError=="function"?reportError:function(t){console.error(t)};function u_(t){this._internalRoot=t}cp.prototype.render=u_.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(we(409));lp(t,e,null,null)};cp.prototype.unmount=u_.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ql(function(){lp(null,t,null,null)}),e[Co]=null}};function cp(t){this._internalRoot=t}cp.prototype.unstable_scheduleHydration=function(t){if(t){var e=aC();t={blockedOn:null,target:t,priority:e};for(var n=0;n<sa.length&&e!==0&&e<sa[n].priority;n++);sa.splice(n,0,t),n===0&&cC(t)}};function h_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function up(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function vE(){}function ND(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var m=ag(a);i.call(m)}}var a=NT(e,r,t,0,null,!1,!1,"",vE);return t._reactRootContainer=a,t[Co]=a.current,$d(t.nodeType===8?t.parentNode:t),Ql(),a}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var u=r;r=function(){var m=ag(d);u.call(m)}}var d=l_(t,0,!1,null,null,!1,!1,"",vE);return t._reactRootContainer=d,t[Co]=d.current,$d(t.nodeType===8?t.parentNode:t),Ql(function(){lp(e,d,n,r)}),d}function hp(t,e,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var u=s;s=function(){var d=ag(a);u.call(d)}}lp(e,a,t,s)}else a=ND(n,e,t,s,r);return ag(a)}iC=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=rd(e.pendingLanes);n!==0&&(Rw(e,n|1),xs(e,Bn()),!(Nt&6)&&(Pu=Bn()+500,Ja()))}break;case 13:Ql(function(){var r=To(t,1);if(r!==null){var s=Zr();fi(r,t,1,s)}}),c_(t,1)}};Pw=function(t){if(t.tag===13){var e=To(t,134217728);if(e!==null){var n=Zr();fi(e,t,134217728,n)}c_(t,134217728)}};oC=function(t){if(t.tag===13){var e=Na(t),n=To(t,e);if(n!==null){var r=Zr();fi(n,t,e,r)}c_(t,e)}};aC=function(){return Lt};lC=function(t,e){var n=Lt;try{return Lt=t,e()}finally{Lt=n}};_y=function(t,e,n){switch(e){case"input":if(fy(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=tp(r);if(!s)throw Error(we(90));BI(r),fy(r,s)}}}break;case"textarea":UI(t,n);break;case"select":e=n.value,e!=null&&hu(t,!!n.multiple,e,!1)}};KI=s_;QI=Ql;var RD={usingClientEntryPoint:!1,Events:[Rf,nu,tp,$I,HI,s_]},Wh={findFiberByHostInstance:Pl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},PD={bundleType:Wh.bundleType,version:Wh.version,rendererPackageName:Wh.rendererPackageName,rendererConfig:Wh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:jo.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ZI(t),t===null?null:t.stateNode},findFiberByHostInstance:Wh.findFiberByHostInstance||SD,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var j0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!j0.isDisabled&&j0.supportsFiber)try{Yg=j0.inject(PD),Fi=j0}catch{}}Os.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RD;Os.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h_(e))throw Error(we(200));return TD(t,e,null,n)};Os.createRoot=function(t,e){if(!h_(t))throw Error(we(299));var n=!1,r="",s=RT;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=l_(t,1,!1,null,null,n,!1,r,s),t[Co]=e.current,$d(t.nodeType===8?t.parentNode:t),new u_(e)};Os.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(we(188)):(t=Object.keys(t).join(","),Error(we(268,t)));return t=ZI(e),t=t===null?null:t.stateNode,t};Os.flushSync=function(t){return Ql(t)};Os.hydrate=function(t,e,n){if(!up(e))throw Error(we(200));return hp(null,t,e,!0,n)};Os.hydrateRoot=function(t,e,n){if(!h_(t))throw Error(we(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",a=RT;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=NT(e,null,t,1,n??null,s,!1,i,a),t[Co]=e.current,$d(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new cp(e)};Os.render=function(t,e,n){if(!up(e))throw Error(we(200));return hp(null,t,e,!1,n)};Os.unmountComponentAtNode=function(t){if(!up(t))throw Error(we(40));return t._reactRootContainer?(Ql(function(){hp(null,null,t,!1,function(){t._reactRootContainer=null,t[Co]=null})}),!0):!1};Os.unstable_batchedUpdates=s_;Os.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!up(n))throw Error(we(200));if(t==null||t._reactInternals===void 0)throw Error(we(38));return hp(t,e,n,!1,r)};Os.version="18.3.1-next-f1338f8080-20240426";function PT(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(PT)}catch(t){console.error(t)}}PT(),PI.exports=Os;var kD=PI.exports,EE=kD;oy.createRoot=EE.createRoot,oy.hydrateRoot=EE.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tf(){return tf=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},tf.apply(this,arguments)}var wa;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(wa||(wa={}));const AE="popstate";function DD(t){t===void 0&&(t={});function e(r,s){let{pathname:i,search:a,hash:u}=r.location;return Jy("",{pathname:i,search:a,hash:u},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:lg(s)}return MD(e,n,null,t)}function Un(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function kT(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function OD(){return Math.random().toString(36).substr(2,8)}function bE(t,e){return{usr:t.state,key:t.key,idx:e}}function Jy(t,e,n,r){return n===void 0&&(n=null),tf({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?oh(e):e,{state:n,key:e&&e.key||r||OD()})}function lg(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function oh(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function MD(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,u=wa.Pop,d=null,m=y();m==null&&(m=0,a.replaceState(tf({},a.state,{idx:m}),""));function y(){return(a.state||{idx:null}).idx}function _(){u=wa.Pop;let O=y(),T=O==null?null:O-m;m=O,d&&d({action:u,location:S.location,delta:T})}function E(O,T){u=wa.Push;let C=Jy(S.location,O,T);n&&n(C,O),m=y()+1;let R=bE(C,m),j=S.createHref(C);try{a.pushState(R,"",j)}catch(K){if(K instanceof DOMException&&K.name==="DataCloneError")throw K;s.location.assign(j)}i&&d&&d({action:u,location:S.location,delta:1})}function b(O,T){u=wa.Replace;let C=Jy(S.location,O,T);n&&n(C,O),m=y();let R=bE(C,m),j=S.createHref(C);a.replaceState(R,"",j),i&&d&&d({action:u,location:S.location,delta:0})}function k(O){let T=s.location.origin!=="null"?s.location.origin:s.location.href,C=typeof O=="string"?O:lg(O);return C=C.replace(/ $/,"%20"),Un(T,"No window.location.(origin|href) available to create URL for href: "+C),new URL(C,T)}let S={get action(){return u},get location(){return t(s,a)},listen(O){if(d)throw new Error("A history only accepts one active listener");return s.addEventListener(AE,_),d=O,()=>{s.removeEventListener(AE,_),d=null}},createHref(O){return e(s,O)},createURL:k,encodeLocation(O){let T=k(O);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:E,replace:b,go(O){return a.go(O)}};return S}var IE;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(IE||(IE={}));function LD(t,e,n){return n===void 0&&(n="/"),jD(t,e,n,!1)}function jD(t,e,n,r){let s=typeof e=="string"?oh(e):e,i=d_(s.pathname||"/",n);if(i==null)return null;let a=DT(t);FD(a);let u=null;for(let d=0;u==null&&d<a.length;++d){let m=QD(i);u=HD(a[d],m,r)}return u}function DT(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(i,a,u)=>{let d={relativePath:u===void 0?i.path||"":u,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};d.relativePath.startsWith("/")&&(Un(d.relativePath.startsWith(r),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(r.length));let m=Pa([r,d.relativePath]),y=n.concat(d);i.children&&i.children.length>0&&(Un(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+m+'".')),DT(i.children,e,y,m)),!(i.path==null&&!i.index)&&e.push({path:m,score:WD(m,i.index),routesMeta:y})};return t.forEach((i,a)=>{var u;if(i.path===""||!((u=i.path)!=null&&u.includes("?")))s(i,a);else for(let d of OT(i.path))s(i,a,d)}),e}function OT(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let a=OT(r.join("/")),u=[];return u.push(...a.map(d=>d===""?i:[i,d].join("/"))),s&&u.push(...a),u.map(d=>t.startsWith("/")&&d===""?"/":d)}function FD(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:$D(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const BD=/^:[\w-]+$/,VD=3,UD=2,zD=1,GD=10,qD=-2,CE=t=>t==="*";function WD(t,e){let n=t.split("/"),r=n.length;return n.some(CE)&&(r+=qD),e&&(r+=UD),n.filter(s=>!CE(s)).reduce((s,i)=>s+(BD.test(i)?VD:i===""?zD:GD),r)}function $D(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function HD(t,e,n){n===void 0&&(n=!1);let{routesMeta:r}=t,s={},i="/",a=[];for(let u=0;u<r.length;++u){let d=r[u],m=u===r.length-1,y=i==="/"?e:e.slice(i.length)||"/",_=TE({path:d.relativePath,caseSensitive:d.caseSensitive,end:m},y),E=d.route;if(!_&&m&&n&&!r[r.length-1].route.index&&(_=TE({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},y)),!_)return null;Object.assign(s,_.params),a.push({params:s,pathname:Pa([i,_.pathname]),pathnameBase:JD(Pa([i,_.pathnameBase])),route:E}),_.pathnameBase!=="/"&&(i=Pa([i,_.pathnameBase]))}return a}function TE(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=KD(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),u=s.slice(1);return{params:r.reduce((m,y,_)=>{let{paramName:E,isOptional:b}=y;if(E==="*"){let S=u[_]||"";a=i.slice(0,i.length-S.length).replace(/(.)\/+$/,"$1")}const k=u[_];return b&&!k?m[E]=void 0:m[E]=(k||"").replace(/%2F/g,"/"),m},{}),pathname:i,pathnameBase:a,pattern:t}}function KD(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),kT(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,u,d)=>(r.push({paramName:u,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function QD(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return kT(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function d_(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function XD(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?oh(t):t;return{pathname:n?n.startsWith("/")?n:YD(n,e):e,search:e8(r),hash:t8(s)}}function YD(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function N1(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function ZD(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function f_(t,e){let n=ZD(t);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function m_(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=oh(t):(s=tf({},t),Un(!s.pathname||!s.pathname.includes("?"),N1("?","pathname","search",s)),Un(!s.pathname||!s.pathname.includes("#"),N1("#","pathname","hash",s)),Un(!s.search||!s.search.includes("#"),N1("#","search","hash",s)));let i=t===""||s.pathname==="",a=i?"/":s.pathname,u;if(a==null)u=n;else{let _=e.length-1;if(!r&&a.startsWith("..")){let E=a.split("/");for(;E[0]==="..";)E.shift(),_-=1;s.pathname=E.join("/")}u=_>=0?e[_]:"/"}let d=XD(s,u),m=a&&a!=="/"&&a.endsWith("/"),y=(i||a===".")&&n.endsWith("/");return!d.pathname.endsWith("/")&&(m||y)&&(d.pathname+="/"),d}const Pa=t=>t.join("/").replace(/\/\/+/g,"/"),JD=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),e8=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,t8=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function n8(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const MT=["post","put","patch","delete"];new Set(MT);const r8=["get",...MT];new Set(r8);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function nf(){return nf=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},nf.apply(this,arguments)}const g_=H.createContext(null),s8=H.createContext(null),el=H.createContext(null),dp=H.createContext(null),Fo=H.createContext({outlet:null,matches:[],isDataRoute:!1}),LT=H.createContext(null);function i8(t,e){let{relative:n}=e===void 0?{}:e;ah()||Un(!1);let{basename:r,navigator:s}=H.useContext(el),{hash:i,pathname:a,search:u}=FT(t,{relative:n}),d=a;return r!=="/"&&(d=a==="/"?r:Pa([r,a])),s.createHref({pathname:d,search:u,hash:i})}function ah(){return H.useContext(dp)!=null}function kf(){return ah()||Un(!1),H.useContext(dp).location}function jT(t){H.useContext(el).static||H.useLayoutEffect(t)}function gn(){let{isDataRoute:t}=H.useContext(Fo);return t?x8():o8()}function o8(){ah()||Un(!1);let t=H.useContext(g_),{basename:e,future:n,navigator:r}=H.useContext(el),{matches:s}=H.useContext(Fo),{pathname:i}=kf(),a=JSON.stringify(f_(s,n.v7_relativeSplatPath)),u=H.useRef(!1);return jT(()=>{u.current=!0}),H.useCallback(function(m,y){if(y===void 0&&(y={}),!u.current)return;if(typeof m=="number"){r.go(m);return}let _=m_(m,JSON.parse(a),i,y.relative==="path");t==null&&e!=="/"&&(_.pathname=_.pathname==="/"?e:Pa([e,_.pathname])),(y.replace?r.replace:r.push)(_,y.state,y)},[e,r,a,i,t])}function p_(){let{matches:t}=H.useContext(Fo),e=t[t.length-1];return e?e.params:{}}function FT(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=H.useContext(el),{matches:s}=H.useContext(Fo),{pathname:i}=kf(),a=JSON.stringify(f_(s,r.v7_relativeSplatPath));return H.useMemo(()=>m_(t,JSON.parse(a),i,n==="path"),[t,a,i,n])}function a8(t,e){return l8(t,e)}function l8(t,e,n,r){ah()||Un(!1);let{navigator:s}=H.useContext(el),{matches:i}=H.useContext(Fo),a=i[i.length-1],u=a?a.params:{};a&&a.pathname;let d=a?a.pathnameBase:"/";a&&a.route;let m=kf(),y;if(e){var _;let O=typeof e=="string"?oh(e):e;d==="/"||(_=O.pathname)!=null&&_.startsWith(d)||Un(!1),y=O}else y=m;let E=y.pathname||"/",b=E;if(d!=="/"){let O=d.replace(/^\//,"").split("/");b="/"+E.replace(/^\//,"").split("/").slice(O.length).join("/")}let k=LD(t,{pathname:b}),S=f8(k&&k.map(O=>Object.assign({},O,{params:Object.assign({},u,O.params),pathname:Pa([d,s.encodeLocation?s.encodeLocation(O.pathname).pathname:O.pathname]),pathnameBase:O.pathnameBase==="/"?d:Pa([d,s.encodeLocation?s.encodeLocation(O.pathnameBase).pathname:O.pathnameBase])})),i,n,r);return e&&S?H.createElement(dp.Provider,{value:{location:nf({pathname:"/",search:"",hash:"",state:null,key:"default"},y),navigationType:wa.Pop}},S):S}function c8(){let t=y8(),e=n8(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return H.createElement(H.Fragment,null,H.createElement("h2",null,"Unexpected Application Error!"),H.createElement("h3",{style:{fontStyle:"italic"}},e),n?H.createElement("pre",{style:s},n):null,i)}const u8=H.createElement(c8,null);class h8 extends H.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?H.createElement(Fo.Provider,{value:this.props.routeContext},H.createElement(LT.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function d8(t){let{routeContext:e,match:n,children:r}=t,s=H.useContext(g_);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),H.createElement(Fo.Provider,{value:e},r)}function f8(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var i;if(!n)return null;if(n.errors)t=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let a=t,u=(s=n)==null?void 0:s.errors;if(u!=null){let y=a.findIndex(_=>_.route.id&&(u==null?void 0:u[_.route.id])!==void 0);y>=0||Un(!1),a=a.slice(0,Math.min(a.length,y+1))}let d=!1,m=-1;if(n&&r&&r.v7_partialHydration)for(let y=0;y<a.length;y++){let _=a[y];if((_.route.HydrateFallback||_.route.hydrateFallbackElement)&&(m=y),_.route.id){let{loaderData:E,errors:b}=n,k=_.route.loader&&E[_.route.id]===void 0&&(!b||b[_.route.id]===void 0);if(_.route.lazy||k){d=!0,m>=0?a=a.slice(0,m+1):a=[a[0]];break}}}return a.reduceRight((y,_,E)=>{let b,k=!1,S=null,O=null;n&&(b=u&&_.route.id?u[_.route.id]:void 0,S=_.route.errorElement||u8,d&&(m<0&&E===0?(w8("route-fallback",!1),k=!0,O=null):m===E&&(k=!0,O=_.route.hydrateFallbackElement||null)));let T=e.concat(a.slice(0,E+1)),C=()=>{let R;return b?R=S:k?R=O:_.route.Component?R=H.createElement(_.route.Component,null):_.route.element?R=_.route.element:R=y,H.createElement(d8,{match:_,routeContext:{outlet:y,matches:T,isDataRoute:n!=null},children:R})};return n&&(_.route.ErrorBoundary||_.route.errorElement||E===0)?H.createElement(h8,{location:n.location,revalidation:n.revalidation,component:S,error:b,children:C(),routeContext:{outlet:null,matches:T,isDataRoute:!0}}):C()},null)}var BT=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(BT||{}),cg=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(cg||{});function m8(t){let e=H.useContext(g_);return e||Un(!1),e}function g8(t){let e=H.useContext(s8);return e||Un(!1),e}function p8(t){let e=H.useContext(Fo);return e||Un(!1),e}function VT(t){let e=p8(),n=e.matches[e.matches.length-1];return n.route.id||Un(!1),n.route.id}function y8(){var t;let e=H.useContext(LT),n=g8(cg.UseRouteError),r=VT(cg.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function x8(){let{router:t}=m8(BT.UseNavigateStable),e=VT(cg.UseNavigateStable),n=H.useRef(!1);return jT(()=>{n.current=!0}),H.useCallback(function(s,i){i===void 0&&(i={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,nf({fromRouteId:e},i)))},[t,e])}const SE={};function w8(t,e,n){!e&&!SE[t]&&(SE[t]=!0)}function _8(t,e){t==null||t.v7_startTransition,(t==null?void 0:t.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function Wn(t){let{to:e,replace:n,state:r,relative:s}=t;ah()||Un(!1);let{future:i,static:a}=H.useContext(el),{matches:u}=H.useContext(Fo),{pathname:d}=kf(),m=gn(),y=m_(e,f_(u,i.v7_relativeSplatPath),d,s==="path"),_=JSON.stringify(y);return H.useEffect(()=>m(JSON.parse(_),{replace:n,state:r,relative:s}),[m,_,s,n,r]),null}function $n(t){Un(!1)}function v8(t){let{basename:e="/",children:n=null,location:r,navigationType:s=wa.Pop,navigator:i,static:a=!1,future:u}=t;ah()&&Un(!1);let d=e.replace(/^\/*/,"/"),m=H.useMemo(()=>({basename:d,navigator:i,static:a,future:nf({v7_relativeSplatPath:!1},u)}),[d,u,i,a]);typeof r=="string"&&(r=oh(r));let{pathname:y="/",search:_="",hash:E="",state:b=null,key:k="default"}=r,S=H.useMemo(()=>{let O=d_(y,d);return O==null?null:{location:{pathname:O,search:_,hash:E,state:b,key:k},navigationType:s}},[d,y,_,E,b,k,s]);return S==null?null:H.createElement(el.Provider,{value:m},H.createElement(dp.Provider,{children:n,value:S}))}function E8(t){let{children:e,location:n}=t;return a8(ex(e),n)}new Promise(()=>{});function ex(t,e){e===void 0&&(e=[]);let n=[];return H.Children.forEach(t,(r,s)=>{if(!H.isValidElement(r))return;let i=[...e,s];if(r.type===H.Fragment){n.push.apply(n,ex(r.props.children,i));return}r.type!==$n&&Un(!1),!r.props.index||!r.props.children||Un(!1);let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=ex(r.props.children,i)),n.push(a)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tx(){return tx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},tx.apply(this,arguments)}function A8(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function b8(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function I8(t,e){return t.button===0&&(!e||e==="_self")&&!b8(t)}const C8=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],T8="6";try{window.__reactRouterVersion=T8}catch{}const S8="startTransition",NE=vP[S8];function N8(t){let{basename:e,children:n,future:r,window:s}=t,i=H.useRef();i.current==null&&(i.current=DD({window:s,v5Compat:!0}));let a=i.current,[u,d]=H.useState({action:a.action,location:a.location}),{v7_startTransition:m}=r||{},y=H.useCallback(_=>{m&&NE?NE(()=>d(_)):d(_)},[d,m]);return H.useLayoutEffect(()=>a.listen(y),[a,y]),H.useEffect(()=>_8(r),[r]),H.createElement(v8,{basename:e,children:n,location:u.location,navigationType:u.action,navigator:a,future:r})}const R8=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",P8=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$h=H.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:i,replace:a,state:u,target:d,to:m,preventScrollReset:y,viewTransition:_}=e,E=A8(e,C8),{basename:b}=H.useContext(el),k,S=!1;if(typeof m=="string"&&P8.test(m)&&(k=m,R8))try{let R=new URL(window.location.href),j=m.startsWith("//")?new URL(R.protocol+m):new URL(m),K=d_(j.pathname,b);j.origin===R.origin&&K!=null?m=K+j.search+j.hash:S=!0}catch{}let O=i8(m,{relative:s}),T=k8(m,{replace:a,state:u,target:d,preventScrollReset:y,relative:s,viewTransition:_});function C(R){r&&r(R),R.defaultPrevented||T(R)}return H.createElement("a",tx({},E,{href:k||O,onClick:S||i?r:C,ref:n,target:d}))});var RE;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(RE||(RE={}));var PE;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(PE||(PE={}));function k8(t,e){let{target:n,replace:r,state:s,preventScrollReset:i,relative:a,viewTransition:u}=e===void 0?{}:e,d=gn(),m=kf(),y=FT(t,{relative:a});return H.useCallback(_=>{if(I8(_,n)){_.preventDefault();let E=r!==void 0?r:lg(m)===lg(y);d(t,{replace:E,state:s,preventScrollReset:i,relative:a,viewTransition:u})}},[m,d,y,r,s,n,t,i,a,u])}let D8={data:""},O8=t=>typeof window=="object"?((t?t.querySelector("#_goober"):window._goober)||Object.assign((t||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:t||D8,M8=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,L8=/\/\*[^]*?\*\/|  +/g,kE=/\n+/g,oa=(t,e)=>{let n="",r="",s="";for(let i in t){let a=t[i];i[0]=="@"?i[1]=="i"?n=i+" "+a+";":r+=i[1]=="f"?oa(a,i):i+"{"+oa(a,i[1]=="k"?"":e)+"}":typeof a=="object"?r+=oa(a,e?e.replace(/([^,])+/g,u=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,d=>/&/.test(d)?d.replace(/&/g,u):u?u+" "+d:d)):i):a!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),s+=oa.p?oa.p(i,a):i+":"+a+";")}return n+(e&&s?e+"{"+s+"}":s)+r},io={},UT=t=>{if(typeof t=="object"){let e="";for(let n in t)e+=n+UT(t[n]);return e}return t},j8=(t,e,n,r,s)=>{let i=UT(t),a=io[i]||(io[i]=(d=>{let m=0,y=11;for(;m<d.length;)y=101*y+d.charCodeAt(m++)>>>0;return"go"+y})(i));if(!io[a]){let d=i!==t?t:(m=>{let y,_,E=[{}];for(;y=M8.exec(m.replace(L8,""));)y[4]?E.shift():y[3]?(_=y[3].replace(kE," ").trim(),E.unshift(E[0][_]=E[0][_]||{})):E[0][y[1]]=y[2].replace(kE," ").trim();return E[0]})(t);io[a]=oa(s?{["@keyframes "+a]:d}:d,n?"":"."+a)}let u=n&&io.g?io.g:null;return n&&(io.g=io[a]),((d,m,y,_)=>{_?m.data=m.data.replace(_,d):m.data.indexOf(d)===-1&&(m.data=y?d+m.data:m.data+d)})(io[a],e,r,u),a},F8=(t,e,n)=>t.reduce((r,s,i)=>{let a=e[i];if(a&&a.call){let u=a(n),d=u&&u.props&&u.props.className||/^go/.test(u)&&u;a=d?"."+d:u&&typeof u=="object"?u.props?"":oa(u,""):u===!1?"":u}return r+s+(a??"")},"");function fp(t){let e=this||{},n=t.call?t(e.p):t;return j8(n.unshift?n.raw?F8(n,[].slice.call(arguments,1),e.p):n.reduce((r,s)=>Object.assign(r,s&&s.call?s(e.p):s),{}):n,O8(e.target),e.g,e.o,e.k)}let zT,nx,rx;fp.bind({g:1});let No=fp.bind({k:1});function B8(t,e,n,r){oa.p=e,zT=t,nx=n,rx=r}function tl(t,e){let n=this||{};return function(){let r=arguments;function s(i,a){let u=Object.assign({},i),d=u.className||s.className;n.p=Object.assign({theme:nx&&nx()},u),n.o=/ *go\d+/.test(d),u.className=fp.apply(n,r)+(d?" "+d:""),e&&(u.ref=a);let m=t;return t[0]&&(m=u.as||t,delete u.as),rx&&m[0]&&rx(u),zT(m,u)}return e?e(s):s}}var V8=t=>typeof t=="function",ug=(t,e)=>V8(t)?t(e):t,U8=(()=>{let t=0;return()=>(++t).toString()})(),GT=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");t=!e||e.matches}return t}})(),z8=20,y_="default",qT=(t,e)=>{let{toastLimit:n}=t.settings;switch(e.type){case 0:return{...t,toasts:[e.toast,...t.toasts].slice(0,n)};case 1:return{...t,toasts:t.toasts.map(a=>a.id===e.toast.id?{...a,...e.toast}:a)};case 2:let{toast:r}=e;return qT(t,{type:t.toasts.find(a=>a.id===r.id)?1:0,toast:r});case 3:let{toastId:s}=e;return{...t,toasts:t.toasts.map(a=>a.id===s||s===void 0?{...a,dismissed:!0,visible:!1}:a)};case 4:return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(a=>a.id!==e.toastId)};case 5:return{...t,pausedAt:e.time};case 6:let i=e.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(a=>({...a,pauseDuration:a.pauseDuration+i}))}}},ym=[],WT={toasts:[],pausedAt:void 0,settings:{toastLimit:z8}},Oi={},$T=(t,e=y_)=>{Oi[e]=qT(Oi[e]||WT,t),ym.forEach(([n,r])=>{n===e&&r(Oi[e])})},HT=t=>Object.keys(Oi).forEach(e=>$T(t,e)),G8=t=>Object.keys(Oi).find(e=>Oi[e].toasts.some(n=>n.id===t)),mp=(t=y_)=>e=>{$T(e,t)},q8={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},W8=(t={},e=y_)=>{let[n,r]=H.useState(Oi[e]||WT),s=H.useRef(Oi[e]);H.useEffect(()=>(s.current!==Oi[e]&&r(Oi[e]),ym.push([e,r]),()=>{let a=ym.findIndex(([u])=>u===e);a>-1&&ym.splice(a,1)}),[e]);let i=n.toasts.map(a=>{var u,d,m;return{...t,...t[a.type],...a,removeDelay:a.removeDelay||((u=t[a.type])==null?void 0:u.removeDelay)||(t==null?void 0:t.removeDelay),duration:a.duration||((d=t[a.type])==null?void 0:d.duration)||(t==null?void 0:t.duration)||q8[a.type],style:{...t.style,...(m=t[a.type])==null?void 0:m.style,...a.style}}});return{...n,toasts:i}},$8=(t,e="blank",n)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...n,id:(n==null?void 0:n.id)||U8()}),Df=t=>(e,n)=>{let r=$8(e,t,n);return mp(r.toasterId||G8(r.id))({type:2,toast:r}),r.id},or=(t,e)=>Df("blank")(t,e);or.error=Df("error");or.success=Df("success");or.loading=Df("loading");or.custom=Df("custom");or.dismiss=(t,e)=>{let n={type:3,toastId:t};e?mp(e)(n):HT(n)};or.dismissAll=t=>or.dismiss(void 0,t);or.remove=(t,e)=>{let n={type:4,toastId:t};e?mp(e)(n):HT(n)};or.removeAll=t=>or.remove(void 0,t);or.promise=(t,e,n)=>{let r=or.loading(e.loading,{...n,...n==null?void 0:n.loading});return typeof t=="function"&&(t=t()),t.then(s=>{let i=e.success?ug(e.success,s):void 0;return i?or.success(i,{id:r,...n,...n==null?void 0:n.success}):or.dismiss(r),s}).catch(s=>{let i=e.error?ug(e.error,s):void 0;i?or.error(i,{id:r,...n,...n==null?void 0:n.error}):or.dismiss(r)}),t};var H8=1e3,K8=(t,e="default")=>{let{toasts:n,pausedAt:r}=W8(t,e),s=H.useRef(new Map).current,i=H.useCallback((_,E=H8)=>{if(s.has(_))return;let b=setTimeout(()=>{s.delete(_),a({type:4,toastId:_})},E);s.set(_,b)},[]);H.useEffect(()=>{if(r)return;let _=Date.now(),E=n.map(b=>{if(b.duration===1/0)return;let k=(b.duration||0)+b.pauseDuration-(_-b.createdAt);if(k<0){b.visible&&or.dismiss(b.id);return}return setTimeout(()=>or.dismiss(b.id,e),k)});return()=>{E.forEach(b=>b&&clearTimeout(b))}},[n,r,e]);let a=H.useCallback(mp(e),[e]),u=H.useCallback(()=>{a({type:5,time:Date.now()})},[a]),d=H.useCallback((_,E)=>{a({type:1,toast:{id:_,height:E}})},[a]),m=H.useCallback(()=>{r&&a({type:6,time:Date.now()})},[r,a]),y=H.useCallback((_,E)=>{let{reverseOrder:b=!1,gutter:k=8,defaultPosition:S}=E||{},O=n.filter(R=>(R.position||S)===(_.position||S)&&R.height),T=O.findIndex(R=>R.id===_.id),C=O.filter((R,j)=>j<T&&R.visible).length;return O.filter(R=>R.visible).slice(...b?[C+1]:[0,C]).reduce((R,j)=>R+(j.height||0)+k,0)},[n]);return H.useEffect(()=>{n.forEach(_=>{if(_.dismissed)i(_.id,_.removeDelay);else{let E=s.get(_.id);E&&(clearTimeout(E),s.delete(_.id))}})},[n,i]),{toasts:n,handlers:{updateHeight:d,startPause:u,endPause:m,calculateOffset:y}}},Q8=No`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,X8=No`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Y8=No`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Z8=tl("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Q8} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${X8} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Y8} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,J8=No`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,e6=tl("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${J8} 1s linear infinite;
`,t6=No`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,n6=No`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,r6=tl("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${t6} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${n6} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,s6=tl("div")`
  position: absolute;
`,i6=tl("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,o6=No`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,a6=tl("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${o6} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,l6=({toast:t})=>{let{icon:e,type:n,iconTheme:r}=t;return e!==void 0?typeof e=="string"?H.createElement(a6,null,e):e:n==="blank"?null:H.createElement(i6,null,H.createElement(e6,{...r}),n!=="loading"&&H.createElement(s6,null,n==="error"?H.createElement(Z8,{...r}):H.createElement(r6,{...r})))},c6=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,u6=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,h6="0%{opacity:0;} 100%{opacity:1;}",d6="0%{opacity:1;} 100%{opacity:0;}",f6=tl("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,m6=tl("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,g6=(t,e)=>{let n=t.includes("top")?1:-1,[r,s]=GT()?[h6,d6]:[c6(n),u6(n)];return{animation:e?`${No(r)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${No(s)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},p6=H.memo(({toast:t,position:e,style:n,children:r})=>{let s=t.height?g6(t.position||e||"top-center",t.visible):{opacity:0},i=H.createElement(l6,{toast:t}),a=H.createElement(m6,{...t.ariaProps},ug(t.message,t));return H.createElement(f6,{className:t.className,style:{...s,...n,...t.style}},typeof r=="function"?r({icon:i,message:a}):H.createElement(H.Fragment,null,i,a))});B8(H.createElement);var y6=({id:t,className:e,style:n,onHeightUpdate:r,children:s})=>{let i=H.useCallback(a=>{if(a){let u=()=>{let d=a.getBoundingClientRect().height;r(t,d)};u(),new MutationObserver(u).observe(a,{subtree:!0,childList:!0,characterData:!0})}},[t,r]);return H.createElement("div",{ref:i,className:e,style:n},s)},x6=(t,e)=>{let n=t.includes("top"),r=n?{top:0}:{bottom:0},s=t.includes("center")?{justifyContent:"center"}:t.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:GT()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(n?1:-1)}px)`,...r,...s}},w6=fp`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,F0=16,_6=({reverseOrder:t,position:e="top-center",toastOptions:n,gutter:r,children:s,toasterId:i,containerStyle:a,containerClassName:u})=>{let{toasts:d,handlers:m}=K8(n,i);return H.createElement("div",{"data-rht-toaster":i||"",style:{position:"fixed",zIndex:9999,top:F0,left:F0,right:F0,bottom:F0,pointerEvents:"none",...a},className:u,onMouseEnter:m.startPause,onMouseLeave:m.endPause},d.map(y=>{let _=y.position||e,E=m.calculateOffset(y,{reverseOrder:t,gutter:r,defaultPosition:e}),b=x6(_,E);return H.createElement(y6,{id:y.id,key:y.id,onHeightUpdate:m.updateHeight,className:y.visible?w6:"",style:b},y.type==="custom"?ug(y.message,y):s?s(y):H.createElement(p6,{toast:y,position:_}))}))},ye=or;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KT=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},v6=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],a=t[n++],u=t[n++],d=((s&7)<<18|(i&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(d>>10)),e[r++]=String.fromCharCode(56320+(d&1023))}else{const i=t[n++],a=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},QT={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],a=s+1<t.length,u=a?t[s+1]:0,d=s+2<t.length,m=d?t[s+2]:0,y=i>>2,_=(i&3)<<4|u>>4;let E=(u&15)<<2|m>>6,b=m&63;d||(b=64,a||(E=64)),r.push(n[y],n[_],n[E],n[b])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(KT(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):v6(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],u=s<t.length?n[t.charAt(s)]:0;++s;const m=s<t.length?n[t.charAt(s)]:64;++s;const _=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||u==null||m==null||_==null)throw new E6;const E=i<<2|u>>4;if(r.push(E),m!==64){const b=u<<4&240|m>>2;if(r.push(b),_!==64){const k=m<<6&192|_;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class E6 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const A6=function(t){const e=KT(t);return QT.encodeByteArray(e,!0)},hg=function(t){return A6(t).replace(/\./g,"")},XT=function(t){try{return QT.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b6(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I6=()=>b6().__FIREBASE_DEFAULTS__,C6=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},T6=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&XT(t[1]);return e&&JSON.parse(e)},gp=()=>{try{return I6()||C6()||T6()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},YT=t=>{var e,n;return(n=(e=gp())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},x_=t=>{const e=YT(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},ZT=()=>{var t;return(t=gp())===null||t===void 0?void 0:t.config},JT=t=>{var e;return(e=gp())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S6{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eS(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t),u="";return[hg(JSON.stringify(n)),hg(JSON.stringify(a)),u].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function N6(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(cr())}function R6(){var t;const e=(t=gp())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function P6(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function k6(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function D6(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function O6(){const t=cr();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function tS(){return!R6()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function nS(){try{return typeof indexedDB=="object"}catch{return!1}}function M6(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L6="FirebaseError";class Hi extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=L6,Object.setPrototypeOf(this,Hi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Of.prototype.create)}}class Of{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?j6(i,r):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new Hi(s,u,r)}}function j6(t,e){return t.replace(F6,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const F6=/\{\$([^}]+)}/g;function B6(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Fa(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],a=e[s];if(DE(i)&&DE(a)){if(!Fa(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function DE(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mf(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function id(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function od(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function V6(t,e){const n=new U6(t,e);return n.subscribe.bind(n)}class U6{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");z6(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=R1),s.error===void 0&&(s.error=R1),s.complete===void 0&&(s.complete=R1);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function z6(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function R1(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ut(t){return t&&t._delegate?t._delegate:t}class Ro{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Il="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G6{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new S6;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(W6(e))try{this.getOrInitializeService({instanceIdentifier:Il})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Il){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Il){return this.instances.has(e)}getOptions(e=Il){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(i);r===u&&a.resolve(s)}return s}onInit(e,n){var r;const s=this.normalizeInstanceIdentifier(n),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const a=this.instances.get(s);return a&&e(a,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:q6(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Il){return this.component?this.component.multipleInstances?e:Il:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function q6(t){return t===Il?void 0:t}function W6(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $6{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new G6(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(pt||(pt={}));const H6={debug:pt.DEBUG,verbose:pt.VERBOSE,info:pt.INFO,warn:pt.WARN,error:pt.ERROR,silent:pt.SILENT},K6=pt.INFO,Q6={[pt.DEBUG]:"log",[pt.VERBOSE]:"log",[pt.INFO]:"info",[pt.WARN]:"warn",[pt.ERROR]:"error"},X6=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=Q6[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class w_{constructor(e){this.name=e,this._logLevel=K6,this._logHandler=X6,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in pt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?H6[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,pt.DEBUG,...e),this._logHandler(this,pt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,pt.VERBOSE,...e),this._logHandler(this,pt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,pt.INFO,...e),this._logHandler(this,pt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,pt.WARN,...e),this._logHandler(this,pt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,pt.ERROR,...e),this._logHandler(this,pt.ERROR,...e)}}const Y6=(t,e)=>e.some(n=>t instanceof n);let OE,ME;function Z6(){return OE||(OE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function J6(){return ME||(ME=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const rS=new WeakMap,sx=new WeakMap,sS=new WeakMap,P1=new WeakMap,__=new WeakMap;function eO(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",a)},i=()=>{n(ka(t.result)),s()},a=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",a)});return e.then(n=>{n instanceof IDBCursor&&rS.set(n,t)}).catch(()=>{}),__.set(e,t),e}function tO(t){if(sx.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",a),t.removeEventListener("abort",a)},i=()=>{n(),s()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",a),t.addEventListener("abort",a)});sx.set(t,e)}let ix={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return sx.get(t);if(e==="objectStoreNames")return t.objectStoreNames||sS.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ka(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function nO(t){ix=t(ix)}function rO(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(k1(this),e,...n);return sS.set(r,e.sort?e.sort():[e]),ka(r)}:J6().includes(t)?function(...e){return t.apply(k1(this),e),ka(rS.get(this))}:function(...e){return ka(t.apply(k1(this),e))}}function sO(t){return typeof t=="function"?rO(t):(t instanceof IDBTransaction&&tO(t),Y6(t,Z6())?new Proxy(t,ix):t)}function ka(t){if(t instanceof IDBRequest)return eO(t);if(P1.has(t))return P1.get(t);const e=sO(t);return e!==t&&(P1.set(t,e),__.set(e,t)),e}const k1=t=>__.get(t);function iO(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(t,e),u=ka(a);return r&&a.addEventListener("upgradeneeded",d=>{r(ka(a.result),d.oldVersion,d.newVersion,ka(a.transaction),d)}),n&&a.addEventListener("blocked",d=>n(d.oldVersion,d.newVersion,d)),u.then(d=>{i&&d.addEventListener("close",()=>i()),s&&d.addEventListener("versionchange",m=>s(m.oldVersion,m.newVersion,m))}).catch(()=>{}),u}const oO=["get","getKey","getAll","getAllKeys","count"],aO=["put","add","delete","clear"],D1=new Map;function LE(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(D1.get(e))return D1.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=aO.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||oO.includes(n)))return;const i=async function(a,...u){const d=this.transaction(a,s?"readwrite":"readonly");let m=d.store;return r&&(m=m.index(u.shift())),(await Promise.all([m[n](...u),s&&d.done]))[0]};return D1.set(e,i),i}nO(t=>({...t,get:(e,n,r)=>LE(e,n)||t.get(e,n,r),has:(e,n)=>!!LE(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lO{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(cO(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function cO(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ox="@firebase/app",jE="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Po=new w_("@firebase/app"),uO="@firebase/app-compat",hO="@firebase/analytics-compat",dO="@firebase/analytics",fO="@firebase/app-check-compat",mO="@firebase/app-check",gO="@firebase/auth",pO="@firebase/auth-compat",yO="@firebase/database",xO="@firebase/data-connect",wO="@firebase/database-compat",_O="@firebase/functions",vO="@firebase/functions-compat",EO="@firebase/installations",AO="@firebase/installations-compat",bO="@firebase/messaging",IO="@firebase/messaging-compat",CO="@firebase/performance",TO="@firebase/performance-compat",SO="@firebase/remote-config",NO="@firebase/remote-config-compat",RO="@firebase/storage",PO="@firebase/storage-compat",kO="@firebase/firestore",DO="@firebase/vertexai-preview",OO="@firebase/firestore-compat",MO="firebase",LO="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dg="[DEFAULT]",jO={[ox]:"fire-core",[uO]:"fire-core-compat",[dO]:"fire-analytics",[hO]:"fire-analytics-compat",[mO]:"fire-app-check",[fO]:"fire-app-check-compat",[gO]:"fire-auth",[pO]:"fire-auth-compat",[yO]:"fire-rtdb",[xO]:"fire-data-connect",[wO]:"fire-rtdb-compat",[_O]:"fire-fn",[vO]:"fire-fn-compat",[EO]:"fire-iid",[AO]:"fire-iid-compat",[bO]:"fire-fcm",[IO]:"fire-fcm-compat",[CO]:"fire-perf",[TO]:"fire-perf-compat",[SO]:"fire-rc",[NO]:"fire-rc-compat",[RO]:"fire-gcs",[PO]:"fire-gcs-compat",[kO]:"fire-fst",[OO]:"fire-fst-compat",[DO]:"fire-vertex","fire-js":"fire-js",[MO]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fg=new Map,FO=new Map,ax=new Map;function FE(t,e){try{t.container.addComponent(e)}catch(n){Po.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Ba(t){const e=t.name;if(ax.has(e))return Po.debug(`There were multiple attempts to register component ${e}.`),!1;ax.set(e,t);for(const n of fg.values())FE(n,t);for(const n of FO.values())FE(n,t);return!0}function pc(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function BO(t,e,n=dg){pc(t,e).clearInstance(n)}function Gs(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VO={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Da=new Of("app","Firebase",VO);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UO{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ro("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Da.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yc=LO;function iS(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:dg,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Da.create("bad-app-name",{appName:String(s)});if(n||(n=ZT()),!n)throw Da.create("no-options");const i=fg.get(s);if(i){if(Fa(n,i.options)&&Fa(r,i.config))return i;throw Da.create("duplicate-app",{appName:s})}const a=new $6(s);for(const d of ax.values())a.addComponent(d);const u=new UO(n,r,a);return fg.set(s,u),u}function pp(t=dg){const e=fg.get(t);if(!e&&t===dg&&ZT())return iS();if(!e)throw Da.create("no-app",{appName:t});return e}function Ws(t,e,n){var r;let s=(r=jO[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const u=[`Unable to register library "${s}" with version "${e}":`];i&&u.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&a&&u.push("and"),a&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Po.warn(u.join(" "));return}Ba(new Ro(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zO="firebase-heartbeat-database",GO=1,rf="firebase-heartbeat-store";let O1=null;function oS(){return O1||(O1=iO(zO,GO,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(rf)}catch(n){console.warn(n)}}}}).catch(t=>{throw Da.create("idb-open",{originalErrorMessage:t.message})})),O1}async function qO(t){try{const n=(await oS()).transaction(rf),r=await n.objectStore(rf).get(aS(t));return await n.done,r}catch(e){if(e instanceof Hi)Po.warn(e.message);else{const n=Da.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Po.warn(n.message)}}}async function BE(t,e){try{const r=(await oS()).transaction(rf,"readwrite");await r.objectStore(rf).put(e,aS(t)),await r.done}catch(n){if(n instanceof Hi)Po.warn(n.message);else{const r=Da.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Po.warn(r.message)}}}function aS(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WO=1024,$O=30*24*60*60*1e3;class HO{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new QO(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=VE();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const u=new Date(a.date).valueOf();return Date.now()-u<=$O}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Po.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=VE(),{heartbeatsToSend:r,unsentEntries:s}=KO(this._heartbeatsCache.heartbeats),i=hg(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Po.warn(n),""}}}function VE(){return new Date().toISOString().substring(0,10)}function KO(t,e=WO){const n=[];let r=t.slice();for(const s of t){const i=n.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),UE(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),UE(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class QO{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return nS()?M6().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await qO(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return BE(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return BE(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function UE(t){return hg(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XO(t){Ba(new Ro("platform-logger",e=>new lO(e),"PRIVATE")),Ba(new Ro("heartbeat",e=>new HO(e),"PRIVATE")),Ws(ox,jE,t),Ws(ox,jE,"esm2017"),Ws("fire-js","")}XO("");function v_(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function lS(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const YO=lS,cS=new Of("auth","Firebase",lS());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mg=new w_("@firebase/auth");function ZO(t,...e){mg.logLevel<=pt.WARN&&mg.warn(`Auth (${yc}): ${t}`,...e)}function xm(t,...e){mg.logLevel<=pt.ERROR&&mg.error(`Auth (${yc}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yi(t,...e){throw E_(t,...e)}function Vi(t,...e){return E_(t,...e)}function uS(t,e,n){const r=Object.assign(Object.assign({},YO()),{[e]:n});return new Of("auth","Firebase",r).create(e,{appName:t.name})}function mi(t){return uS(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function E_(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return cS.create(t,...e)}function Ze(t,e,...n){if(!t)throw E_(e,...n)}function yo(t){const e="INTERNAL ASSERTION FAILED: "+t;throw xm(e),new Error(e)}function ko(t,e){t||yo(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lx(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function JO(){return zE()==="http:"||zE()==="https:"}function zE(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e5(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(JO()||k6()||"connection"in navigator)?navigator.onLine:!0}function t5(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf{constructor(e,n){this.shortDelay=e,this.longDelay=n,ko(n>e,"Short delay should be less than long delay!"),this.isMobile=N6()||D6()}get(){return e5()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A_(t,e){ko(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hS{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;yo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;yo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;yo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n5={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r5=new Lf(3e4,6e4);function nl(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Ki(t,e,n,r,s={}){return dS(t,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const u=Mf(Object.assign({key:t.config.apiKey},a)).slice(1),d=await t._getAdditionalHeaders();d["Content-Type"]="application/json",t.languageCode&&(d["X-Firebase-Locale"]=t.languageCode);const m=Object.assign({method:e,headers:d},i);return P6()||(m.referrerPolicy="no-referrer"),hS.fetch()(fS(t,t.config.apiHost,n,u),m)})}async function dS(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},n5),e);try{const s=new i5(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw B0(t,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const u=i.ok?a.errorMessage:a.error.message,[d,m]=u.split(" : ");if(d==="FEDERATED_USER_ID_ALREADY_LINKED")throw B0(t,"credential-already-in-use",a);if(d==="EMAIL_EXISTS")throw B0(t,"email-already-in-use",a);if(d==="USER_DISABLED")throw B0(t,"user-disabled",a);const y=r[d]||d.toLowerCase().replace(/[_\s]+/g,"-");if(m)throw uS(t,y,m);yi(t,y)}}catch(s){if(s instanceof Hi)throw s;yi(t,"network-request-failed",{message:String(s)})}}async function jf(t,e,n,r,s={}){const i=await Ki(t,e,n,r,s);return"mfaPendingCredential"in i&&yi(t,"multi-factor-auth-required",{_serverResponse:i}),i}function fS(t,e,n,r){const s=`${e}${n}?${r}`;return t.config.emulator?A_(t.config,s):`${t.config.apiScheme}://${s}`}function s5(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class i5{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Vi(this.auth,"network-request-failed")),r5.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function B0(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Vi(t,e,r);return s.customData._tokenResponse=n,s}function GE(t){return t!==void 0&&t.enterprise!==void 0}class o5{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return s5(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function a5(t,e){return Ki(t,"GET","/v2/recaptchaConfig",nl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l5(t,e){return Ki(t,"POST","/v1/accounts:delete",e)}async function mS(t,e){return Ki(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ed(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function c5(t,e=!1){const n=ut(t),r=await n.getIdToken(e),s=b_(r);Ze(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Ed(M1(s.auth_time)),issuedAtTime:Ed(M1(s.iat)),expirationTime:Ed(M1(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function M1(t){return Number(t)*1e3}function b_(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return xm("JWT malformed, contained fewer than 3 sections"),null;try{const s=XT(n);return s?JSON.parse(s):(xm("Failed to decode base64 JWT payload"),null)}catch(s){return xm("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function qE(t){const e=b_(t);return Ze(e,"internal-error"),Ze(typeof e.exp<"u","internal-error"),Ze(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xl(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Hi&&u5(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function u5({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h5{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cx{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ed(this.lastLoginAt),this.creationTime=Ed(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gg(t){var e;const n=t.auth,r=await t.getIdToken(),s=await Xl(t,mS(n,{idToken:r}));Ze(s==null?void 0:s.users.length,n,"internal-error");const i=s.users[0];t._notifyReloadListener(i);const a=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?gS(i.providerUserInfo):[],u=f5(t.providerData,a),d=t.isAnonymous,m=!(t.email&&i.passwordHash)&&!(u!=null&&u.length),y=d?m:!1,_={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:u,metadata:new cx(i.createdAt,i.lastLoginAt),isAnonymous:y};Object.assign(t,_)}async function d5(t){const e=ut(t);await gg(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function f5(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function gS(t){return t.map(e=>{var{providerId:n}=e,r=v_(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m5(t,e){const n=await dS(t,{},async()=>{const r=Mf({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,a=fS(t,s,"/v1/token",`key=${i}`),u=await t._getAdditionalHeaders();return u["Content-Type"]="application/x-www-form-urlencoded",hS.fetch()(a,{method:"POST",headers:u,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function g5(t,e){return Ki(t,"POST","/v2/accounts:revokeToken",nl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yu{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ze(e.idToken,"internal-error"),Ze(typeof e.idToken<"u","internal-error"),Ze(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):qE(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ze(e.length!==0,"internal-error");const n=qE(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ze(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await m5(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,a=new yu;return r&&(Ze(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(Ze(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(Ze(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new yu,this.toJSON())}_performRefresh(){return yo("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yo(t,e){Ze(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class xo{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,i=v_(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new h5(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new cx(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Xl(this,this.stsTokenManager.getToken(this.auth,e));return Ze(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return c5(this,e)}reload(){return d5(this)}_assign(e){this!==e&&(Ze(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new xo(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){Ze(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await gg(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Gs(this.auth.app))return Promise.reject(mi(this.auth));const e=await this.getIdToken();return await Xl(this,l5(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,i,a,u,d,m,y;const _=(r=n.displayName)!==null&&r!==void 0?r:void 0,E=(s=n.email)!==null&&s!==void 0?s:void 0,b=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,k=(a=n.photoURL)!==null&&a!==void 0?a:void 0,S=(u=n.tenantId)!==null&&u!==void 0?u:void 0,O=(d=n._redirectEventId)!==null&&d!==void 0?d:void 0,T=(m=n.createdAt)!==null&&m!==void 0?m:void 0,C=(y=n.lastLoginAt)!==null&&y!==void 0?y:void 0,{uid:R,emailVerified:j,isAnonymous:K,providerData:Q,stsTokenManager:D}=n;Ze(R&&D,e,"internal-error");const B=yu.fromJSON(this.name,D);Ze(typeof R=="string",e,"internal-error"),Yo(_,e.name),Yo(E,e.name),Ze(typeof j=="boolean",e,"internal-error"),Ze(typeof K=="boolean",e,"internal-error"),Yo(b,e.name),Yo(k,e.name),Yo(S,e.name),Yo(O,e.name),Yo(T,e.name),Yo(C,e.name);const F=new xo({uid:R,auth:e,email:E,emailVerified:j,displayName:_,isAnonymous:K,photoURL:k,phoneNumber:b,tenantId:S,stsTokenManager:B,createdAt:T,lastLoginAt:C});return Q&&Array.isArray(Q)&&(F.providerData=Q.map(W=>Object.assign({},W))),O&&(F._redirectEventId=O),F}static async _fromIdTokenResponse(e,n,r=!1){const s=new yu;s.updateFromServerResponse(n);const i=new xo({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await gg(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Ze(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?gS(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),u=new yu;u.updateFromIdToken(r);const d=new xo({uid:s.localId,auth:e,stsTokenManager:u,isAnonymous:a}),m={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new cx(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(d,m),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WE=new Map;function wo(t){ko(t instanceof Function,"Expected a class definition");let e=WE.get(t);return e?(ko(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,WE.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pS{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}pS.type="NONE";const $E=pS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wm(t,e,n){return`firebase:${t}:${e}:${n}`}class xu{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=wm(this.userKey,s.apiKey,i),this.fullPersistenceKey=wm("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?xo._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new xu(wo($E),e,r);const s=(await Promise.all(n.map(async m=>{if(await m._isAvailable())return m}))).filter(m=>m);let i=s[0]||wo($E);const a=wm(r,e.config.apiKey,e.name);let u=null;for(const m of n)try{const y=await m._get(a);if(y){const _=xo._fromJSON(e,y);m!==i&&(u=_),i=m;break}}catch{}const d=s.filter(m=>m._shouldAllowMigration);return!i._shouldAllowMigration||!d.length?new xu(i,e,r):(i=d[0],u&&await i._set(a,u.toJSON()),await Promise.all(n.map(async m=>{if(m!==i)try{await m._remove(a)}catch{}})),new xu(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HE(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(_S(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(yS(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(ES(e))return"Blackberry";if(AS(e))return"Webos";if(xS(e))return"Safari";if((e.includes("chrome/")||wS(e))&&!e.includes("edge/"))return"Chrome";if(vS(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function yS(t=cr()){return/firefox\//i.test(t)}function xS(t=cr()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function wS(t=cr()){return/crios\//i.test(t)}function _S(t=cr()){return/iemobile/i.test(t)}function vS(t=cr()){return/android/i.test(t)}function ES(t=cr()){return/blackberry/i.test(t)}function AS(t=cr()){return/webos/i.test(t)}function I_(t=cr()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function p5(t=cr()){var e;return I_(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function y5(){return O6()&&document.documentMode===10}function bS(t=cr()){return I_(t)||vS(t)||AS(t)||ES(t)||/windows phone/i.test(t)||_S(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IS(t,e=[]){let n;switch(t){case"Browser":n=HE(cr());break;case"Worker":n=`${HE(cr())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${yc}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x5{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((a,u)=>{try{const d=e(i);a(d)}catch(d){u(d)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w5(t,e={}){return Ki(t,"GET","/v2/passwordPolicy",nl(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _5=6;class v5{constructor(e){var n,r,s,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=a.minPasswordLength)!==null&&n!==void 0?n:_5,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,s,i,a,u;const d={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,d),this.validatePasswordCharacterOptions(e,d),d.isValid&&(d.isValid=(n=d.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),d.isValid&&(d.isValid=(r=d.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),d.isValid&&(d.isValid=(s=d.containsLowercaseLetter)!==null&&s!==void 0?s:!0),d.isValid&&(d.isValid=(i=d.containsUppercaseLetter)!==null&&i!==void 0?i:!0),d.isValid&&(d.isValid=(a=d.containsNumericCharacter)!==null&&a!==void 0?a:!0),d.isValid&&(d.isValid=(u=d.containsNonAlphanumericCharacter)!==null&&u!==void 0?u:!0),d}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E5{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new KE(this),this.idTokenSubscription=new KE(this),this.beforeStateQueue=new x5(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=cS,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=wo(n)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await xu.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await mS(this,{idToken:e}),r=await xo._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(Gs(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(u,u))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,u=s==null?void 0:s._redirectEventId,d=await this.tryRedirectSignIn(e);(!a||a===u)&&(d!=null&&d.user)&&(s=d.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ze(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await gg(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=t5()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Gs(this.app))return Promise.reject(mi(this));const n=e?ut(e):null;return n&&Ze(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ze(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Gs(this.app)?Promise.reject(mi(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Gs(this.app)?Promise.reject(mi(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(wo(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await w5(this),n=new v5(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Of("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await g5(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&wo(e)||this._popupRedirectResolver;Ze(n,this,"argument-error"),this.redirectPersistenceManager=await xu.create(this,[wo(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let a=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ze(u,this,"internal-error"),u.then(()=>{a||i(this.currentUser)}),typeof n=="function"){const d=e.addObserver(n,r,s);return()=>{a=!0,d()}}else{const d=e.addObserver(n);return()=>{a=!0,d()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ze(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=IS(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&ZO(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function rl(t){return ut(t)}class KE{constructor(e){this.auth=e,this.observer=null,this.addObserver=V6(n=>this.observer=n)}get next(){return Ze(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yp={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function A5(t){yp=t}function CS(t){return yp.loadJS(t)}function b5(){return yp.recaptchaEnterpriseScript}function I5(){return yp.gapiScript}function C5(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const T5="recaptcha-enterprise",S5="NO_RECAPTCHA";class N5{constructor(e){this.type=T5,this.auth=rl(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,u)=>{a5(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(d=>{if(d.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const m=new o5(d);return i.tenantId==null?i._agentRecaptchaConfig=m:i._tenantRecaptchaConfigs[i.tenantId]=m,a(m.siteKey)}}).catch(d=>{u(d)})})}function s(i,a,u){const d=window.grecaptcha;GE(d)?d.enterprise.ready(()=>{d.enterprise.execute(i,{action:e}).then(m=>{a(m)}).catch(()=>{a(S5)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,a)=>{r(this.auth).then(u=>{if(!n&&GE(window.grecaptcha))s(u,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let d=b5();d.length!==0&&(d+=u),CS(d).then(()=>{s(u,i,a)}).catch(m=>{a(m)})}}).catch(u=>{a(u)})})}}async function QE(t,e,n,r=!1){const s=new N5(t);let i;try{i=await s.verify(n)}catch{i=await s.verify(n,!0)}const a=Object.assign({},e);return r?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function ux(t,e,n,r){var s;if(!((s=t._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await QE(t,e,n,n==="getOobCode");return r(t,i)}else return r(t,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await QE(t,e,n,n==="getOobCode");return r(t,a)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R5(t,e){const n=pc(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Fa(i,e??{}))return s;yi(s,"already-initialized")}return n.initialize({options:e})}function P5(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(wo);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function k5(t,e,n){const r=rl(t);Ze(r._canInitEmulator,r,"emulator-config-failed"),Ze(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(n!=null&&n.disableWarnings),i=TS(e),{host:a,port:u}=D5(e),d=u===null?"":`:${u}`;r.config.emulator={url:`${i}//${a}${d}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:u,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||O5()}function TS(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function D5(t){const e=TS(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:XE(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:XE(a)}}}function XE(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function O5(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C_{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return yo("not implemented")}_getIdTokenResponse(e){return yo("not implemented")}_linkToIdToken(e,n){return yo("not implemented")}_getReauthenticationResolver(e){return yo("not implemented")}}async function M5(t,e){return Ki(t,"POST","/v1/accounts:update",e)}async function L5(t,e){return Ki(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j5(t,e){return jf(t,"POST","/v1/accounts:signInWithPassword",nl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F5(t,e){return jf(t,"POST","/v1/accounts:signInWithEmailLink",nl(t,e))}async function B5(t,e){return jf(t,"POST","/v1/accounts:signInWithEmailLink",nl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sf extends C_{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new sf(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new sf(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ux(e,n,"signInWithPassword",j5);case"emailLink":return F5(e,{email:this._email,oobCode:this._password});default:yi(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ux(e,r,"signUpPassword",L5);case"emailLink":return B5(e,{idToken:n,email:this._email,oobCode:this._password});default:yi(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wu(t,e){return jf(t,"POST","/v1/accounts:signInWithIdp",nl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V5="http://localhost";class Yl extends C_{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Yl(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):yi("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,i=v_(n,["providerId","signInMethod"]);if(!r||!s)return null;const a=new Yl(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const n=this.buildRequest();return wu(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,wu(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,wu(e,n)}buildRequest(){const e={requestUri:V5,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Mf(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U5(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function z5(t){const e=id(od(t)).link,n=e?id(od(e)).deep_link_id:null,r=id(od(t)).deep_link_id;return(r?id(od(r)).link:null)||r||n||e||t}class T_{constructor(e){var n,r,s,i,a,u;const d=id(od(e)),m=(n=d.apiKey)!==null&&n!==void 0?n:null,y=(r=d.oobCode)!==null&&r!==void 0?r:null,_=U5((s=d.mode)!==null&&s!==void 0?s:null);Ze(m&&y&&_,"argument-error"),this.apiKey=m,this.operation=_,this.code=y,this.continueUrl=(i=d.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(a=d.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(u=d.tenantId)!==null&&u!==void 0?u:null}static parseLink(e){const n=z5(e);try{return new T_(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{constructor(){this.providerId=xc.PROVIDER_ID}static credential(e,n){return sf._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=T_.parseLink(n);return Ze(r,"argument-error"),sf._fromEmailAndCode(e,r.code,r.tenantId)}}xc.PROVIDER_ID="password";xc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";xc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SS{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff extends SS{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa extends Ff{constructor(){super("facebook.com")}static credential(e){return Yl._fromParams({providerId:aa.PROVIDER_ID,signInMethod:aa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return aa.credentialFromTaggedObject(e)}static credentialFromError(e){return aa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return aa.credential(e.oauthAccessToken)}catch{return null}}}aa.FACEBOOK_SIGN_IN_METHOD="facebook.com";aa.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la extends Ff{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Yl._fromParams({providerId:la.PROVIDER_ID,signInMethod:la.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return la.credentialFromTaggedObject(e)}static credentialFromError(e){return la.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return la.credential(n,r)}catch{return null}}}la.GOOGLE_SIGN_IN_METHOD="google.com";la.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca extends Ff{constructor(){super("github.com")}static credential(e){return Yl._fromParams({providerId:ca.PROVIDER_ID,signInMethod:ca.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ca.credentialFromTaggedObject(e)}static credentialFromError(e){return ca.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ca.credential(e.oauthAccessToken)}catch{return null}}}ca.GITHUB_SIGN_IN_METHOD="github.com";ca.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua extends Ff{constructor(){super("twitter.com")}static credential(e,n){return Yl._fromParams({providerId:ua.PROVIDER_ID,signInMethod:ua.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return ua.credentialFromTaggedObject(e)}static credentialFromError(e){return ua.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return ua.credential(n,r)}catch{return null}}}ua.TWITTER_SIGN_IN_METHOD="twitter.com";ua.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NS(t,e){return jf(t,"POST","/v1/accounts:signUp",nl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await xo._fromIdTokenResponse(e,r,s),a=YE(r);return new Do({user:i,providerId:a,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=YE(r);return new Do({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function YE(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G5(t){var e;if(Gs(t.app))return Promise.reject(mi(t));const n=rl(t);if(await n._initializationPromise,!((e=n.currentUser)===null||e===void 0)&&e.isAnonymous)return new Do({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await NS(n,{returnSecureToken:!0}),s=await Do._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pg extends Hi{constructor(e,n,r,s){var i;super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,pg.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new pg(e,n,r,s)}}function RS(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?pg._fromErrorAndOperation(t,i,e,r):i})}async function q5(t,e,n=!1){const r=await Xl(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Do._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PS(t,e,n=!1){const{auth:r}=t;if(Gs(r.app))return Promise.reject(mi(r));const s="reauthenticate";try{const i=await Xl(t,RS(r,s,e,t),n);Ze(i.idToken,r,"internal-error");const a=b_(i.idToken);Ze(a,r,"internal-error");const{sub:u}=a;return Ze(t.uid===u,r,"user-mismatch"),Do._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&yi(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kS(t,e,n=!1){if(Gs(t.app))return Promise.reject(mi(t));const r="signIn",s=await RS(t,r,e),i=await Do._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function W5(t,e){return kS(rl(t),e)}async function $5(t,e){return PS(ut(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DS(t){const e=rl(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function H5(t,e,n){if(Gs(t.app))return Promise.reject(mi(t));const r=rl(t),a=await ux(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",NS).catch(d=>{throw d.code==="auth/password-does-not-meet-requirements"&&DS(t),d}),u=await Do._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(u.user),u}function K5(t,e,n){return Gs(t.app)?Promise.reject(mi(t)):W5(ut(t),xc.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&DS(t),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q5(t,e){return Ki(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OS(t,{displayName:e,photoURL:n}){if(e===void 0&&n===void 0)return;const r=ut(t),i={idToken:await r.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},a=await Xl(r,Q5(r.auth,i));r.displayName=a.displayName||null,r.photoURL=a.photoUrl||null;const u=r.providerData.find(({providerId:d})=>d==="password");u&&(u.displayName=r.displayName,u.photoURL=r.photoURL),await r._updateTokensIfNecessary(a)}function X5(t,e){const n=ut(t);return Gs(n.auth.app)?Promise.reject(mi(n.auth)):MS(n,e,null)}function Y5(t,e){return MS(ut(t),null,e)}async function MS(t,e,n){const{auth:r}=t,i={idToken:await t.getIdToken(),returnSecureToken:!0};e&&(i.email=e),n&&(i.password=n);const a=await Xl(t,M5(r,i));await t._updateTokensIfNecessary(a,!0)}function Z5(t,e,n,r){return ut(t).onIdTokenChanged(e,n,r)}function J5(t,e,n){return ut(t).beforeAuthStateChanged(e,n)}function eM(t,e,n,r){return ut(t).onAuthStateChanged(e,n,r)}function hx(t){return ut(t).signOut()}async function tM(t){return ut(t).delete()}const yg="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LS{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(yg,"1"),this.storage.removeItem(yg),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nM=1e3,rM=10;class jS extends LS{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=bS(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((a,u,d)=>{this.notifyListeners(a,d)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!n&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);y5()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,rM):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},nM)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}jS.type="LOCAL";const sM=jS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS extends LS{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}FS.type="SESSION";const BS=FS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iM(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xp{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new xp(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const u=Array.from(a).map(async m=>m(n.origin,i)),d=await iM(u);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:d})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}xp.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S_(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((u,d)=>{const m=S_("",20);s.port1.start();const y=setTimeout(()=>{d(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(_){const E=_;if(E.data.eventId===m)switch(E.data.status){case"ack":clearTimeout(y),i=setTimeout(()=>{d(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),u(E.data.response);break;default:clearTimeout(y),clearTimeout(i),d(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:m,data:n},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ui(){return window}function aM(t){Ui().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VS(){return typeof Ui().WorkerGlobalScope<"u"&&typeof Ui().importScripts=="function"}async function lM(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function cM(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function uM(){return VS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const US="firebaseLocalStorageDb",hM=1,xg="firebaseLocalStorage",zS="fbase_key";class Bf{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function wp(t,e){return t.transaction([xg],e?"readwrite":"readonly").objectStore(xg)}function dM(){const t=indexedDB.deleteDatabase(US);return new Bf(t).toPromise()}function dx(){const t=indexedDB.open(US,hM);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(xg,{keyPath:zS})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(xg)?e(r):(r.close(),await dM(),e(await dx()))})})}async function ZE(t,e,n){const r=wp(t,!0).put({[zS]:e,value:n});return new Bf(r).toPromise()}async function fM(t,e){const n=wp(t,!1).get(e),r=await new Bf(n).toPromise();return r===void 0?null:r.value}function JE(t,e){const n=wp(t,!0).delete(e);return new Bf(n).toPromise()}const mM=800,gM=3;class GS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await dx(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>gM)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return VS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=xp._getInstance(uM()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await lM(),!this.activeServiceWorker)return;this.sender=new oM(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||cM()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await dx();return await ZE(e,yg,"1"),await JE(e,yg),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>ZE(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>fM(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>JE(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=wp(s,!1).getAll();return new Bf(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),mM)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}GS.type="LOCAL";const pM=GS;new Lf(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yM(t,e){return e?wo(e):(Ze(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N_ extends C_{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return wu(e,this._buildIdpRequest())}_linkToIdToken(e,n){return wu(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return wu(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function xM(t){return kS(t.auth,new N_(t),t.bypassAuthState)}function wM(t){const{auth:e,user:n}=t;return Ze(n,e,"internal-error"),PS(n,new N_(t),t.bypassAuthState)}async function _M(t){const{auth:e,user:n}=t;return Ze(n,e,"internal-error"),q5(n,new N_(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qS{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:a,type:u}=e;if(a){this.reject(a);return}const d={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(d))}catch(m){this.reject(m)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return xM;case"linkViaPopup":case"linkViaRedirect":return _M;case"reauthViaPopup":case"reauthViaRedirect":return wM;default:yi(this.auth,"internal-error")}}resolve(e){ko(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ko(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vM=new Lf(2e3,1e4);class cu extends qS{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,cu.currentPopupAction&&cu.currentPopupAction.cancel(),cu.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ze(e,this.auth,"internal-error"),e}async onExecution(){ko(this.filter.length===1,"Popup operations only handle one event");const e=S_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Vi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Vi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,cu.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Vi(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,vM.get())};e()}}cu.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EM="pendingRedirect",_m=new Map;class AM extends qS{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=_m.get(this.auth._key());if(!e){try{const r=await bM(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}_m.set(this.auth._key(),e)}return this.bypassAuthState||_m.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function bM(t,e){const n=TM(e),r=CM(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function IM(t,e){_m.set(t._key(),e)}function CM(t){return wo(t._redirectPersistence)}function TM(t){return wm(EM,t.config.apiKey,t.name)}async function SM(t,e,n=!1){if(Gs(t.app))return Promise.reject(mi(t));const r=rl(t),s=yM(r,e),a=await new AM(r,s,n).execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NM=10*60*1e3;class RM{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!PM(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!WS(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(Vi(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=NM&&this.cachedEventUids.clear(),this.cachedEventUids.has(eA(e))}saveEventToCache(e){this.cachedEventUids.add(eA(e)),this.lastProcessedEventTime=Date.now()}}function eA(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function WS({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function PM(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return WS(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kM(t,e={}){return Ki(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DM=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,OM=/^https?/;async function MM(t){if(t.config.emulator)return;const{authorizedDomains:e}=await kM(t);for(const n of e)try{if(LM(n))return}catch{}yi(t,"unauthorized-domain")}function LM(t){const e=lx(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&a.hostname===r}if(!OM.test(n))return!1;if(DM.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jM=new Lf(3e4,6e4);function tA(){const t=Ui().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function FM(t){return new Promise((e,n)=>{var r,s,i;function a(){tA(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{tA(),n(Vi(t,"network-request-failed"))},timeout:jM.get()})}if(!((s=(r=Ui().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Ui().gapi)===null||i===void 0)&&i.load)a();else{const u=C5("iframefcb");return Ui()[u]=()=>{gapi.load?a():n(Vi(t,"network-request-failed"))},CS(`${I5()}?onload=${u}`).catch(d=>n(d))}}).catch(e=>{throw vm=null,e})}let vm=null;function BM(t){return vm=vm||FM(t),vm}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VM=new Lf(5e3,15e3),UM="__/auth/iframe",zM="emulator/auth/iframe",GM={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},qM=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function WM(t){const e=t.config;Ze(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?A_(e,zM):`https://${t.config.authDomain}/${UM}`,r={apiKey:e.apiKey,appName:t.name,v:yc},s=qM.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Mf(r).slice(1)}`}async function $M(t){const e=await BM(t),n=Ui().gapi;return Ze(n,t,"internal-error"),e.open({where:document.body,url:WM(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:GM,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=Vi(t,"network-request-failed"),u=Ui().setTimeout(()=>{i(a)},VM.get());function d(){Ui().clearTimeout(u),s(r)}r.ping(d).then(d,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HM={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},KM=500,QM=600,XM="_blank",YM="http://localhost";class nA{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function ZM(t,e,n,r=KM,s=QM){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let u="";const d=Object.assign(Object.assign({},HM),{width:r.toString(),height:s.toString(),top:i,left:a}),m=cr().toLowerCase();n&&(u=wS(m)?XM:n),yS(m)&&(e=e||YM,d.scrollbars="yes");const y=Object.entries(d).reduce((E,[b,k])=>`${E}${b}=${k},`,"");if(p5(m)&&u!=="_self")return JM(e||"",u),new nA(null);const _=window.open(e||"",u,y);Ze(_,t,"popup-blocked");try{_.focus()}catch{}return new nA(_)}function JM(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eL="__/auth/handler",tL="emulator/auth/handler",nL=encodeURIComponent("fac");async function rA(t,e,n,r,s,i){Ze(t.config.authDomain,t,"auth-domain-config-required"),Ze(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:yc,eventId:s};if(e instanceof SS){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",B6(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[y,_]of Object.entries(i||{}))a[y]=_}if(e instanceof Ff){const y=e.getScopes().filter(_=>_!=="");y.length>0&&(a.scopes=y.join(","))}t.tenantId&&(a.tid=t.tenantId);const u=a;for(const y of Object.keys(u))u[y]===void 0&&delete u[y];const d=await t._getAppCheckToken(),m=d?`#${nL}=${encodeURIComponent(d)}`:"";return`${rL(t)}?${Mf(u).slice(1)}${m}`}function rL({config:t}){return t.emulator?A_(t,tL):`https://${t.authDomain}/${eL}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L1="webStorageSupport";class sL{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=BS,this._completeRedirectFn=SM,this._overrideRedirectResult=IM}async _openPopup(e,n,r,s){var i;ko((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await rA(e,n,r,lx(),s);return ZM(e,a,S_())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await rA(e,n,r,lx(),s);return aM(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(ko(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await $M(e),r=new RM(e);return n.register("authEvent",s=>(Ze(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(L1,{type:L1},s=>{var i;const a=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[L1];a!==void 0&&n(!!a),yi(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=MM(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return bS()||xS()||I_()}}const iL=sL;var sA="@firebase/auth",iA="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oL{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ze(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aL(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function lL(t){Ba(new Ro("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;Ze(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const d={apiKey:a,authDomain:u,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:IS(t)},m=new E5(r,s,i,d);return P5(m,n),m},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Ba(new Ro("auth-internal",e=>{const n=rl(e.getProvider("auth").getImmediate());return(r=>new oL(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ws(sA,iA,aL(t)),Ws(sA,iA,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cL=5*60,uL=JT("authIdTokenMaxAge")||cL;let oA=null;const hL=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>uL)return;const s=n==null?void 0:n.token;oA!==s&&(oA=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function dL(t=pp()){const e=pc(t,"auth");if(e.isInitialized())return e.getImmediate();const n=R5(t,{popupRedirectResolver:iL,persistence:[pM,sM,BS]}),r=JT("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=hL(i.toString());J5(n,a,()=>a(n.currentUser)),Z5(n,u=>a(u))}}const s=YT("auth");return s&&k5(n,`http://${s}`),n}function fL(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}A5({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Vi("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",fL().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});lL("Browser");var aA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Bl,$S;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(D,B){function F(){}F.prototype=B.prototype,D.D=B.prototype,D.prototype=new F,D.prototype.constructor=D,D.C=function(W,X,$){for(var z=Array(arguments.length-2),Te=2;Te<arguments.length;Te++)z[Te-2]=arguments[Te];return B.prototype[X].apply(W,z)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(D,B,F){F||(F=0);var W=Array(16);if(typeof B=="string")for(var X=0;16>X;++X)W[X]=B.charCodeAt(F++)|B.charCodeAt(F++)<<8|B.charCodeAt(F++)<<16|B.charCodeAt(F++)<<24;else for(X=0;16>X;++X)W[X]=B[F++]|B[F++]<<8|B[F++]<<16|B[F++]<<24;B=D.g[0],F=D.g[1],X=D.g[2];var $=D.g[3],z=B+($^F&(X^$))+W[0]+3614090360&4294967295;B=F+(z<<7&4294967295|z>>>25),z=$+(X^B&(F^X))+W[1]+3905402710&4294967295,$=B+(z<<12&4294967295|z>>>20),z=X+(F^$&(B^F))+W[2]+606105819&4294967295,X=$+(z<<17&4294967295|z>>>15),z=F+(B^X&($^B))+W[3]+3250441966&4294967295,F=X+(z<<22&4294967295|z>>>10),z=B+($^F&(X^$))+W[4]+4118548399&4294967295,B=F+(z<<7&4294967295|z>>>25),z=$+(X^B&(F^X))+W[5]+1200080426&4294967295,$=B+(z<<12&4294967295|z>>>20),z=X+(F^$&(B^F))+W[6]+2821735955&4294967295,X=$+(z<<17&4294967295|z>>>15),z=F+(B^X&($^B))+W[7]+4249261313&4294967295,F=X+(z<<22&4294967295|z>>>10),z=B+($^F&(X^$))+W[8]+1770035416&4294967295,B=F+(z<<7&4294967295|z>>>25),z=$+(X^B&(F^X))+W[9]+2336552879&4294967295,$=B+(z<<12&4294967295|z>>>20),z=X+(F^$&(B^F))+W[10]+4294925233&4294967295,X=$+(z<<17&4294967295|z>>>15),z=F+(B^X&($^B))+W[11]+2304563134&4294967295,F=X+(z<<22&4294967295|z>>>10),z=B+($^F&(X^$))+W[12]+1804603682&4294967295,B=F+(z<<7&4294967295|z>>>25),z=$+(X^B&(F^X))+W[13]+4254626195&4294967295,$=B+(z<<12&4294967295|z>>>20),z=X+(F^$&(B^F))+W[14]+2792965006&4294967295,X=$+(z<<17&4294967295|z>>>15),z=F+(B^X&($^B))+W[15]+1236535329&4294967295,F=X+(z<<22&4294967295|z>>>10),z=B+(X^$&(F^X))+W[1]+4129170786&4294967295,B=F+(z<<5&4294967295|z>>>27),z=$+(F^X&(B^F))+W[6]+3225465664&4294967295,$=B+(z<<9&4294967295|z>>>23),z=X+(B^F&($^B))+W[11]+643717713&4294967295,X=$+(z<<14&4294967295|z>>>18),z=F+($^B&(X^$))+W[0]+3921069994&4294967295,F=X+(z<<20&4294967295|z>>>12),z=B+(X^$&(F^X))+W[5]+3593408605&4294967295,B=F+(z<<5&4294967295|z>>>27),z=$+(F^X&(B^F))+W[10]+38016083&4294967295,$=B+(z<<9&4294967295|z>>>23),z=X+(B^F&($^B))+W[15]+3634488961&4294967295,X=$+(z<<14&4294967295|z>>>18),z=F+($^B&(X^$))+W[4]+3889429448&4294967295,F=X+(z<<20&4294967295|z>>>12),z=B+(X^$&(F^X))+W[9]+568446438&4294967295,B=F+(z<<5&4294967295|z>>>27),z=$+(F^X&(B^F))+W[14]+3275163606&4294967295,$=B+(z<<9&4294967295|z>>>23),z=X+(B^F&($^B))+W[3]+4107603335&4294967295,X=$+(z<<14&4294967295|z>>>18),z=F+($^B&(X^$))+W[8]+1163531501&4294967295,F=X+(z<<20&4294967295|z>>>12),z=B+(X^$&(F^X))+W[13]+2850285829&4294967295,B=F+(z<<5&4294967295|z>>>27),z=$+(F^X&(B^F))+W[2]+4243563512&4294967295,$=B+(z<<9&4294967295|z>>>23),z=X+(B^F&($^B))+W[7]+1735328473&4294967295,X=$+(z<<14&4294967295|z>>>18),z=F+($^B&(X^$))+W[12]+2368359562&4294967295,F=X+(z<<20&4294967295|z>>>12),z=B+(F^X^$)+W[5]+4294588738&4294967295,B=F+(z<<4&4294967295|z>>>28),z=$+(B^F^X)+W[8]+2272392833&4294967295,$=B+(z<<11&4294967295|z>>>21),z=X+($^B^F)+W[11]+1839030562&4294967295,X=$+(z<<16&4294967295|z>>>16),z=F+(X^$^B)+W[14]+4259657740&4294967295,F=X+(z<<23&4294967295|z>>>9),z=B+(F^X^$)+W[1]+2763975236&4294967295,B=F+(z<<4&4294967295|z>>>28),z=$+(B^F^X)+W[4]+1272893353&4294967295,$=B+(z<<11&4294967295|z>>>21),z=X+($^B^F)+W[7]+4139469664&4294967295,X=$+(z<<16&4294967295|z>>>16),z=F+(X^$^B)+W[10]+3200236656&4294967295,F=X+(z<<23&4294967295|z>>>9),z=B+(F^X^$)+W[13]+681279174&4294967295,B=F+(z<<4&4294967295|z>>>28),z=$+(B^F^X)+W[0]+3936430074&4294967295,$=B+(z<<11&4294967295|z>>>21),z=X+($^B^F)+W[3]+3572445317&4294967295,X=$+(z<<16&4294967295|z>>>16),z=F+(X^$^B)+W[6]+76029189&4294967295,F=X+(z<<23&4294967295|z>>>9),z=B+(F^X^$)+W[9]+3654602809&4294967295,B=F+(z<<4&4294967295|z>>>28),z=$+(B^F^X)+W[12]+3873151461&4294967295,$=B+(z<<11&4294967295|z>>>21),z=X+($^B^F)+W[15]+530742520&4294967295,X=$+(z<<16&4294967295|z>>>16),z=F+(X^$^B)+W[2]+3299628645&4294967295,F=X+(z<<23&4294967295|z>>>9),z=B+(X^(F|~$))+W[0]+4096336452&4294967295,B=F+(z<<6&4294967295|z>>>26),z=$+(F^(B|~X))+W[7]+1126891415&4294967295,$=B+(z<<10&4294967295|z>>>22),z=X+(B^($|~F))+W[14]+2878612391&4294967295,X=$+(z<<15&4294967295|z>>>17),z=F+($^(X|~B))+W[5]+4237533241&4294967295,F=X+(z<<21&4294967295|z>>>11),z=B+(X^(F|~$))+W[12]+1700485571&4294967295,B=F+(z<<6&4294967295|z>>>26),z=$+(F^(B|~X))+W[3]+2399980690&4294967295,$=B+(z<<10&4294967295|z>>>22),z=X+(B^($|~F))+W[10]+4293915773&4294967295,X=$+(z<<15&4294967295|z>>>17),z=F+($^(X|~B))+W[1]+2240044497&4294967295,F=X+(z<<21&4294967295|z>>>11),z=B+(X^(F|~$))+W[8]+1873313359&4294967295,B=F+(z<<6&4294967295|z>>>26),z=$+(F^(B|~X))+W[15]+4264355552&4294967295,$=B+(z<<10&4294967295|z>>>22),z=X+(B^($|~F))+W[6]+2734768916&4294967295,X=$+(z<<15&4294967295|z>>>17),z=F+($^(X|~B))+W[13]+1309151649&4294967295,F=X+(z<<21&4294967295|z>>>11),z=B+(X^(F|~$))+W[4]+4149444226&4294967295,B=F+(z<<6&4294967295|z>>>26),z=$+(F^(B|~X))+W[11]+3174756917&4294967295,$=B+(z<<10&4294967295|z>>>22),z=X+(B^($|~F))+W[2]+718787259&4294967295,X=$+(z<<15&4294967295|z>>>17),z=F+($^(X|~B))+W[9]+3951481745&4294967295,D.g[0]=D.g[0]+B&4294967295,D.g[1]=D.g[1]+(X+(z<<21&4294967295|z>>>11))&4294967295,D.g[2]=D.g[2]+X&4294967295,D.g[3]=D.g[3]+$&4294967295}r.prototype.u=function(D,B){B===void 0&&(B=D.length);for(var F=B-this.blockSize,W=this.B,X=this.h,$=0;$<B;){if(X==0)for(;$<=F;)s(this,D,$),$+=this.blockSize;if(typeof D=="string"){for(;$<B;)if(W[X++]=D.charCodeAt($++),X==this.blockSize){s(this,W),X=0;break}}else for(;$<B;)if(W[X++]=D[$++],X==this.blockSize){s(this,W),X=0;break}}this.h=X,this.o+=B},r.prototype.v=function(){var D=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);D[0]=128;for(var B=1;B<D.length-8;++B)D[B]=0;var F=8*this.o;for(B=D.length-8;B<D.length;++B)D[B]=F&255,F/=256;for(this.u(D),D=Array(16),B=F=0;4>B;++B)for(var W=0;32>W;W+=8)D[F++]=this.g[B]>>>W&255;return D};function i(D,B){var F=u;return Object.prototype.hasOwnProperty.call(F,D)?F[D]:F[D]=B(D)}function a(D,B){this.h=B;for(var F=[],W=!0,X=D.length-1;0<=X;X--){var $=D[X]|0;W&&$==B||(F[X]=$,W=!1)}this.g=F}var u={};function d(D){return-128<=D&&128>D?i(D,function(B){return new a([B|0],0>B?-1:0)}):new a([D|0],0>D?-1:0)}function m(D){if(isNaN(D)||!isFinite(D))return _;if(0>D)return O(m(-D));for(var B=[],F=1,W=0;D>=F;W++)B[W]=D/F|0,F*=4294967296;return new a(B,0)}function y(D,B){if(D.length==0)throw Error("number format error: empty string");if(B=B||10,2>B||36<B)throw Error("radix out of range: "+B);if(D.charAt(0)=="-")return O(y(D.substring(1),B));if(0<=D.indexOf("-"))throw Error('number format error: interior "-" character');for(var F=m(Math.pow(B,8)),W=_,X=0;X<D.length;X+=8){var $=Math.min(8,D.length-X),z=parseInt(D.substring(X,X+$),B);8>$?($=m(Math.pow(B,$)),W=W.j($).add(m(z))):(W=W.j(F),W=W.add(m(z)))}return W}var _=d(0),E=d(1),b=d(16777216);t=a.prototype,t.m=function(){if(S(this))return-O(this).m();for(var D=0,B=1,F=0;F<this.g.length;F++){var W=this.i(F);D+=(0<=W?W:4294967296+W)*B,B*=4294967296}return D},t.toString=function(D){if(D=D||10,2>D||36<D)throw Error("radix out of range: "+D);if(k(this))return"0";if(S(this))return"-"+O(this).toString(D);for(var B=m(Math.pow(D,6)),F=this,W="";;){var X=j(F,B).g;F=T(F,X.j(B));var $=((0<F.g.length?F.g[0]:F.h)>>>0).toString(D);if(F=X,k(F))return $+W;for(;6>$.length;)$="0"+$;W=$+W}},t.i=function(D){return 0>D?0:D<this.g.length?this.g[D]:this.h};function k(D){if(D.h!=0)return!1;for(var B=0;B<D.g.length;B++)if(D.g[B]!=0)return!1;return!0}function S(D){return D.h==-1}t.l=function(D){return D=T(this,D),S(D)?-1:k(D)?0:1};function O(D){for(var B=D.g.length,F=[],W=0;W<B;W++)F[W]=~D.g[W];return new a(F,~D.h).add(E)}t.abs=function(){return S(this)?O(this):this},t.add=function(D){for(var B=Math.max(this.g.length,D.g.length),F=[],W=0,X=0;X<=B;X++){var $=W+(this.i(X)&65535)+(D.i(X)&65535),z=($>>>16)+(this.i(X)>>>16)+(D.i(X)>>>16);W=z>>>16,$&=65535,z&=65535,F[X]=z<<16|$}return new a(F,F[F.length-1]&-2147483648?-1:0)};function T(D,B){return D.add(O(B))}t.j=function(D){if(k(this)||k(D))return _;if(S(this))return S(D)?O(this).j(O(D)):O(O(this).j(D));if(S(D))return O(this.j(O(D)));if(0>this.l(b)&&0>D.l(b))return m(this.m()*D.m());for(var B=this.g.length+D.g.length,F=[],W=0;W<2*B;W++)F[W]=0;for(W=0;W<this.g.length;W++)for(var X=0;X<D.g.length;X++){var $=this.i(W)>>>16,z=this.i(W)&65535,Te=D.i(X)>>>16,ie=D.i(X)&65535;F[2*W+2*X]+=z*ie,C(F,2*W+2*X),F[2*W+2*X+1]+=$*ie,C(F,2*W+2*X+1),F[2*W+2*X+1]+=z*Te,C(F,2*W+2*X+1),F[2*W+2*X+2]+=$*Te,C(F,2*W+2*X+2)}for(W=0;W<B;W++)F[W]=F[2*W+1]<<16|F[2*W];for(W=B;W<2*B;W++)F[W]=0;return new a(F,0)};function C(D,B){for(;(D[B]&65535)!=D[B];)D[B+1]+=D[B]>>>16,D[B]&=65535,B++}function R(D,B){this.g=D,this.h=B}function j(D,B){if(k(B))throw Error("division by zero");if(k(D))return new R(_,_);if(S(D))return B=j(O(D),B),new R(O(B.g),O(B.h));if(S(B))return B=j(D,O(B)),new R(O(B.g),B.h);if(30<D.g.length){if(S(D)||S(B))throw Error("slowDivide_ only works with positive integers.");for(var F=E,W=B;0>=W.l(D);)F=K(F),W=K(W);var X=Q(F,1),$=Q(W,1);for(W=Q(W,2),F=Q(F,2);!k(W);){var z=$.add(W);0>=z.l(D)&&(X=X.add(F),$=z),W=Q(W,1),F=Q(F,1)}return B=T(D,X.j(B)),new R(X,B)}for(X=_;0<=D.l(B);){for(F=Math.max(1,Math.floor(D.m()/B.m())),W=Math.ceil(Math.log(F)/Math.LN2),W=48>=W?1:Math.pow(2,W-48),$=m(F),z=$.j(B);S(z)||0<z.l(D);)F-=W,$=m(F),z=$.j(B);k($)&&($=E),X=X.add($),D=T(D,z)}return new R(X,D)}t.A=function(D){return j(this,D).h},t.and=function(D){for(var B=Math.max(this.g.length,D.g.length),F=[],W=0;W<B;W++)F[W]=this.i(W)&D.i(W);return new a(F,this.h&D.h)},t.or=function(D){for(var B=Math.max(this.g.length,D.g.length),F=[],W=0;W<B;W++)F[W]=this.i(W)|D.i(W);return new a(F,this.h|D.h)},t.xor=function(D){for(var B=Math.max(this.g.length,D.g.length),F=[],W=0;W<B;W++)F[W]=this.i(W)^D.i(W);return new a(F,this.h^D.h)};function K(D){for(var B=D.g.length+1,F=[],W=0;W<B;W++)F[W]=D.i(W)<<1|D.i(W-1)>>>31;return new a(F,D.h)}function Q(D,B){var F=B>>5;B%=32;for(var W=D.g.length-F,X=[],$=0;$<W;$++)X[$]=0<B?D.i($+F)>>>B|D.i($+F+1)<<32-B:D.i($+F);return new a(X,D.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,$S=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=m,a.fromString=y,Bl=a}).apply(typeof aA<"u"?aA:typeof self<"u"?self:typeof window<"u"?window:{});var V0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var HS,ad,KS,Em,fx,QS,XS,YS;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(x,I,P){return x==Array.prototype||x==Object.prototype||(x[I]=P.value),x};function n(x){x=[typeof globalThis=="object"&&globalThis,x,typeof window=="object"&&window,typeof self=="object"&&self,typeof V0=="object"&&V0];for(var I=0;I<x.length;++I){var P=x[I];if(P&&P.Math==Math)return P}throw Error("Cannot find global object")}var r=n(this);function s(x,I){if(I)e:{var P=r;x=x.split(".");for(var U=0;U<x.length-1;U++){var te=x[U];if(!(te in P))break e;P=P[te]}x=x[x.length-1],U=P[x],I=I(U),I!=U&&I!=null&&e(P,x,{configurable:!0,writable:!0,value:I})}}function i(x,I){x instanceof String&&(x+="");var P=0,U=!1,te={next:function(){if(!U&&P<x.length){var le=P++;return{value:I(le,x[le]),done:!1}}return U=!0,{done:!0,value:void 0}}};return te[Symbol.iterator]=function(){return te},te}s("Array.prototype.values",function(x){return x||function(){return i(this,function(I,P){return P})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},u=this||self;function d(x){var I=typeof x;return I=I!="object"?I:x?Array.isArray(x)?"array":I:"null",I=="array"||I=="object"&&typeof x.length=="number"}function m(x){var I=typeof x;return I=="object"&&x!=null||I=="function"}function y(x,I,P){return x.call.apply(x.bind,arguments)}function _(x,I,P){if(!x)throw Error();if(2<arguments.length){var U=Array.prototype.slice.call(arguments,2);return function(){var te=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(te,U),x.apply(I,te)}}return function(){return x.apply(I,arguments)}}function E(x,I,P){return E=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?y:_,E.apply(null,arguments)}function b(x,I){var P=Array.prototype.slice.call(arguments,1);return function(){var U=P.slice();return U.push.apply(U,arguments),x.apply(this,U)}}function k(x,I){function P(){}P.prototype=I.prototype,x.aa=I.prototype,x.prototype=new P,x.prototype.constructor=x,x.Qb=function(U,te,le){for(var be=Array(arguments.length-2),Tt=2;Tt<arguments.length;Tt++)be[Tt-2]=arguments[Tt];return I.prototype[te].apply(U,be)}}function S(x){const I=x.length;if(0<I){const P=Array(I);for(let U=0;U<I;U++)P[U]=x[U];return P}return[]}function O(x,I){for(let P=1;P<arguments.length;P++){const U=arguments[P];if(d(U)){const te=x.length||0,le=U.length||0;x.length=te+le;for(let be=0;be<le;be++)x[te+be]=U[be]}else x.push(U)}}class T{constructor(I,P){this.i=I,this.j=P,this.h=0,this.g=null}get(){let I;return 0<this.h?(this.h--,I=this.g,this.g=I.next,I.next=null):I=this.i(),I}}function C(x){return/^[\s\xa0]*$/.test(x)}function R(){var x=u.navigator;return x&&(x=x.userAgent)?x:""}function j(x){return j[" "](x),x}j[" "]=function(){};var K=R().indexOf("Gecko")!=-1&&!(R().toLowerCase().indexOf("webkit")!=-1&&R().indexOf("Edge")==-1)&&!(R().indexOf("Trident")!=-1||R().indexOf("MSIE")!=-1)&&R().indexOf("Edge")==-1;function Q(x,I,P){for(const U in x)I.call(P,x[U],U,x)}function D(x,I){for(const P in x)I.call(void 0,x[P],P,x)}function B(x){const I={};for(const P in x)I[P]=x[P];return I}const F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function W(x,I){let P,U;for(let te=1;te<arguments.length;te++){U=arguments[te];for(P in U)x[P]=U[P];for(let le=0;le<F.length;le++)P=F[le],Object.prototype.hasOwnProperty.call(U,P)&&(x[P]=U[P])}}function X(x){var I=1;x=x.split(":");const P=[];for(;0<I&&x.length;)P.push(x.shift()),I--;return x.length&&P.push(x.join(":")),P}function $(x){u.setTimeout(()=>{throw x},0)}function z(){var x=Ce;let I=null;return x.g&&(I=x.g,x.g=x.g.next,x.g||(x.h=null),I.next=null),I}class Te{constructor(){this.h=this.g=null}add(I,P){const U=ie.get();U.set(I,P),this.h?this.h.next=U:this.g=U,this.h=U}}var ie=new T(()=>new Xe,x=>x.reset());class Xe{constructor(){this.next=this.g=this.h=null}set(I,P){this.h=I,this.g=P,this.next=null}reset(){this.next=this.g=this.h=null}}let de,he=!1,Ce=new Te,Me=()=>{const x=u.Promise.resolve(void 0);de=()=>{x.then(ht)}};var ht=()=>{for(var x;x=z();){try{x.h.call(x.g)}catch(P){$(P)}var I=ie;I.j(x),100>I.h&&(I.h++,x.next=I.g,I.g=x)}he=!1};function Ge(){this.s=this.s,this.C=this.C}Ge.prototype.s=!1,Ge.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ge.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function _t(x,I){this.type=x,this.g=this.target=I,this.defaultPrevented=!1}_t.prototype.h=function(){this.defaultPrevented=!0};var zt=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var x=!1,I=Object.defineProperty({},"passive",{get:function(){x=!0}});try{const P=()=>{};u.addEventListener("test",P,I),u.removeEventListener("test",P,I)}catch{}return x}();function Pr(x,I){if(_t.call(this,x?x.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,x){var P=this.type=x.type,U=x.changedTouches&&x.changedTouches.length?x.changedTouches[0]:null;if(this.target=x.target||x.srcElement,this.g=I,I=x.relatedTarget){if(K){e:{try{j(I.nodeName);var te=!0;break e}catch{}te=!1}te||(I=null)}}else P=="mouseover"?I=x.fromElement:P=="mouseout"&&(I=x.toElement);this.relatedTarget=I,U?(this.clientX=U.clientX!==void 0?U.clientX:U.pageX,this.clientY=U.clientY!==void 0?U.clientY:U.pageY,this.screenX=U.screenX||0,this.screenY=U.screenY||0):(this.clientX=x.clientX!==void 0?x.clientX:x.pageX,this.clientY=x.clientY!==void 0?x.clientY:x.pageY,this.screenX=x.screenX||0,this.screenY=x.screenY||0),this.button=x.button,this.key=x.key||"",this.ctrlKey=x.ctrlKey,this.altKey=x.altKey,this.shiftKey=x.shiftKey,this.metaKey=x.metaKey,this.pointerId=x.pointerId||0,this.pointerType=typeof x.pointerType=="string"?x.pointerType:Fe[x.pointerType]||"",this.state=x.state,this.i=x,x.defaultPrevented&&Pr.aa.h.call(this)}}k(Pr,_t);var Fe={2:"touch",3:"pen",4:"mouse"};Pr.prototype.h=function(){Pr.aa.h.call(this);var x=this.i;x.preventDefault?x.preventDefault():x.returnValue=!1};var fr="closure_listenable_"+(1e6*Math.random()|0),pn=0;function Xs(x,I,P,U,te){this.listener=x,this.proxy=null,this.src=I,this.type=P,this.capture=!!U,this.ha=te,this.key=++pn,this.da=this.fa=!1}function rs(x){x.da=!0,x.listener=null,x.proxy=null,x.src=null,x.ha=null}function Mn(x){this.src=x,this.g={},this.h=0}Mn.prototype.add=function(x,I,P,U,te){var le=x.toString();x=this.g[le],x||(x=this.g[le]=[],this.h++);var be=dt(x,I,U,te);return-1<be?(I=x[be],P||(I.fa=!1)):(I=new Xs(I,this.src,le,!!U,te),I.fa=P,x.push(I)),I};function Ys(x,I){var P=I.type;if(P in x.g){var U=x.g[P],te=Array.prototype.indexOf.call(U,I,void 0),le;(le=0<=te)&&Array.prototype.splice.call(U,te,1),le&&(rs(I),x.g[P].length==0&&(delete x.g[P],x.h--))}}function dt(x,I,P,U){for(var te=0;te<x.length;++te){var le=x[te];if(!le.da&&le.listener==I&&le.capture==!!P&&le.ha==U)return te}return-1}var ws="closure_lm_"+(1e6*Math.random()|0),_r={};function xi(x,I,P,U,te){if(U&&U.once)return lt(x,I,P,U,te);if(Array.isArray(I)){for(var le=0;le<I.length;le++)xi(x,I[le],P,U,te);return null}return P=Pe(P),x&&x[fr]?x.K(I,P,m(U)?!!U.capture:!!U,te):In(x,I,P,!1,U,te)}function In(x,I,P,U,te,le){if(!I)throw Error("Invalid event type");var be=m(te)?!!te.capture:!!te,Tt=_e(x);if(Tt||(x[ws]=Tt=new Mn(x)),P=Tt.add(I,P,U,be,le),P.proxy)return P;if(U=Dt(),P.proxy=U,U.src=x,U.listener=P,x.addEventListener)zt||(te=be),te===void 0&&(te=!1),x.addEventListener(I.toString(),U,te);else if(x.attachEvent)x.attachEvent(ue(I.toString()),U);else if(x.addListener&&x.removeListener)x.addListener(U);else throw Error("addEventListener and attachEvent are unavailable.");return P}function Dt(){function x(P){return I.call(x.src,x.listener,P)}const I=Ne;return x}function lt(x,I,P,U,te){if(Array.isArray(I)){for(var le=0;le<I.length;le++)lt(x,I[le],P,U,te);return null}return P=Pe(P),x&&x[fr]?x.L(I,P,m(U)?!!U.capture:!!U,te):In(x,I,P,!0,U,te)}function Y(x,I,P,U,te){if(Array.isArray(I))for(var le=0;le<I.length;le++)Y(x,I[le],P,U,te);else U=m(U)?!!U.capture:!!U,P=Pe(P),x&&x[fr]?(x=x.i,I=String(I).toString(),I in x.g&&(le=x.g[I],P=dt(le,P,U,te),-1<P&&(rs(le[P]),Array.prototype.splice.call(le,P,1),le.length==0&&(delete x.g[I],x.h--)))):x&&(x=_e(x))&&(I=x.g[I.toString()],x=-1,I&&(x=dt(I,P,U,te)),(P=-1<x?I[x]:null)&&Z(P))}function Z(x){if(typeof x!="number"&&x&&!x.da){var I=x.src;if(I&&I[fr])Ys(I.i,x);else{var P=x.type,U=x.proxy;I.removeEventListener?I.removeEventListener(P,U,x.capture):I.detachEvent?I.detachEvent(ue(P),U):I.addListener&&I.removeListener&&I.removeListener(U),(P=_e(I))?(Ys(P,x),P.h==0&&(P.src=null,I[ws]=null)):rs(x)}}}function ue(x){return x in _r?_r[x]:_r[x]="on"+x}function Ne(x,I){if(x.da)x=!0;else{I=new Pr(I,this);var P=x.listener,U=x.ha||x.src;x.fa&&Z(x),x=P.call(U,I)}return x}function _e(x){return x=x[ws],x instanceof Mn?x:null}var xe="__closure_events_fn_"+(1e9*Math.random()>>>0);function Pe(x){return typeof x=="function"?x:(x[xe]||(x[xe]=function(I){return x.handleEvent(I)}),x[xe])}function Qe(){Ge.call(this),this.i=new Mn(this),this.M=this,this.F=null}k(Qe,Ge),Qe.prototype[fr]=!0,Qe.prototype.removeEventListener=function(x,I,P,U){Y(this,x,I,P,U)};function He(x,I){var P,U=x.F;if(U)for(P=[];U;U=U.F)P.push(U);if(x=x.M,U=I.type||I,typeof I=="string")I=new _t(I,x);else if(I instanceof _t)I.target=I.target||x;else{var te=I;I=new _t(U,x),W(I,te)}if(te=!0,P)for(var le=P.length-1;0<=le;le--){var be=I.g=P[le];te=Ct(be,U,!0,I)&&te}if(be=I.g=x,te=Ct(be,U,!0,I)&&te,te=Ct(be,U,!1,I)&&te,P)for(le=0;le<P.length;le++)be=I.g=P[le],te=Ct(be,U,!1,I)&&te}Qe.prototype.N=function(){if(Qe.aa.N.call(this),this.i){var x=this.i,I;for(I in x.g){for(var P=x.g[I],U=0;U<P.length;U++)rs(P[U]);delete x.g[I],x.h--}}this.F=null},Qe.prototype.K=function(x,I,P,U){return this.i.add(String(x),I,!1,P,U)},Qe.prototype.L=function(x,I,P,U){return this.i.add(String(x),I,!0,P,U)};function Ct(x,I,P,U){if(I=x.i.g[String(I)],!I)return!0;I=I.concat();for(var te=!0,le=0;le<I.length;++le){var be=I[le];if(be&&!be.da&&be.capture==P){var Tt=be.listener,sr=be.ha||be.src;be.fa&&Ys(x.i,be),te=Tt.call(sr,U)!==!1&&te}}return te&&!U.defaultPrevented}function wi(x,I,P){if(typeof x=="function")P&&(x=E(x,P));else if(x&&typeof x.handleEvent=="function")x=E(x.handleEvent,x);else throw Error("Invalid listener argument");return 2147483647<Number(I)?-1:u.setTimeout(x,I||0)}function kr(x){x.g=wi(()=>{x.g=null,x.i&&(x.i=!1,kr(x))},x.l);const I=x.h;x.h=null,x.m.apply(null,I)}class Ah extends Ge{constructor(I,P){super(),this.m=I,this.l=P,this.h=null,this.i=!1,this.g=null}j(I){this.h=arguments,this.g?this.i=!0:kr(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function kt(x){Ge.call(this),this.h=x,this.g={}}k(kt,Ge);var Ae=[];function ln(x){Q(x.g,function(I,P){this.g.hasOwnProperty(P)&&Z(I)},x),x.g={}}kt.prototype.N=function(){kt.aa.N.call(this),ln(this)},kt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var vt=u.JSON.stringify,Kt=u.JSON.parse,_i=class{stringify(x){return u.JSON.stringify(x,void 0)}parse(x){return u.JSON.parse(x,void 0)}};function hl(){}hl.prototype.h=null;function bh(x){return x.h||(x.h=x.i())}function Et(){}var _s={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ic(){_t.call(this,"d")}k(Ic,_t);function Cc(){_t.call(this,"c")}k(Cc,_t);var er={},Tc=null;function Ln(){return Tc=Tc||new Qe}er.La="serverreachability";function Yi(x){_t.call(this,er.La,x)}k(Yi,_t);function vi(x){const I=Ln();He(I,new Yi(I))}er.STAT_EVENT="statevent";function vs(x,I){_t.call(this,er.STAT_EVENT,x),this.stat=I}k(vs,_t);function vr(x){const I=Ln();He(I,new vs(I,x))}er.Ma="timingevent";function Ei(x,I){_t.call(this,er.Ma,x),this.size=I}k(Ei,_t);function Zi(x,I){if(typeof x!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){x()},I)}function qn(){this.g=!0}qn.prototype.xa=function(){this.g=!1};function Ji(x,I,P,U,te,le){x.info(function(){if(x.g)if(le)for(var be="",Tt=le.split("&"),sr=0;sr<Tt.length;sr++){var it=Tt[sr].split("=");if(1<it.length){var Fn=it[0];it=it[1];var Ot=Fn.split("_");be=2<=Ot.length&&Ot[1]=="type"?be+(Fn+"="+it+"&"):be+(Fn+"=redacted&")}}else be=null;else be=le;return"XMLHTTP REQ ("+U+") [attempt "+te+"]: "+I+`
`+P+`
`+be})}function ss(x,I,P,U,te,le,be){x.info(function(){return"XMLHTTP RESP ("+U+") [ attempt "+te+"]: "+I+`
`+P+`
`+le+" "+be})}function Re(x,I,P,U){x.info(function(){return"XMLHTTP TEXT ("+I+"): "+Ih(x,P)+(U?" "+U:"")})}function Go(x,I){x.info(function(){return"TIMEOUT: "+I})}qn.prototype.info=function(){};function Ih(x,I){if(!x.g)return I;if(!I)return null;try{var P=JSON.parse(I);if(P){for(x=0;x<P.length;x++)if(Array.isArray(P[x])){var U=P[x];if(!(2>U.length)){var te=U[1];if(Array.isArray(te)&&!(1>te.length)){var le=te[0];if(le!="noop"&&le!="stop"&&le!="close")for(var be=1;be<te.length;be++)te[be]=""}}}}return vt(P)}catch{return I}}var tr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eo={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},qo;function to(){}k(to,hl),to.prototype.g=function(){return new XMLHttpRequest},to.prototype.i=function(){return{}},qo=new to;function nr(x,I,P,U){this.j=x,this.i=I,this.l=P,this.R=U||1,this.U=new kt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new c0}function c0(){this.i=null,this.g="",this.h=!1}var u0={},is={};function rr(x,I,P){x.L=1,x.v=Er(Qt(I)),x.m=P,x.P=!0,Gt(x,null)}function Gt(x,I){x.F=Date.now(),Wo(x),x.A=Qt(x.v);var P=x.A,U=x.R;Array.isArray(U)||(U=[String(U)]),Ho(P.i,"t",U),x.C=0,P=x.j.J,x.h=new c0,x.g=Bt(x.j,P?I:null,!x.m),0<x.O&&(x.M=new Ah(E(x.Y,x,x.g),x.O)),I=x.U,P=x.g,U=x.ca;var te="readystatechange";Array.isArray(te)||(te&&(Ae[0]=te.toString()),te=Ae);for(var le=0;le<te.length;le++){var be=xi(P,te[le],U||I.handleEvent,!1,I.h||I);if(!be)break;I.g[be.key]=be}I=x.H?B(x.H):{},x.m?(x.u||(x.u="POST"),I["Content-Type"]="application/x-www-form-urlencoded",x.g.ea(x.A,x.u,x.m,I)):(x.u="GET",x.g.ea(x.A,x.u,null,I)),vi(),Ji(x.i,x.u,x.A,x.l,x.R,x.m)}nr.prototype.ca=function(x){x=x.target;const I=this.M;I&&ni(x)==3?I.j():this.Y(x)},nr.prototype.Y=function(x){try{if(x==this.g)e:{const Ot=ni(this.g);var I=this.g.Ba();const so=this.g.Z();if(!(3>Ot)&&(Ot!=3||this.g&&(this.h.h||this.g.oa()||Pt(this.g)))){this.J||Ot!=4||I==7||(I==8||0>=so?vi(3):vi(2)),Th(this);var P=this.g.Z();this.X=P;t:if(Ch(this)){var U=Pt(this.g);x="";var te=U.length,le=ni(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){os(this),jt(this);var be="";break t}this.h.i=new u.TextDecoder}for(I=0;I<te;I++)this.h.h=!0,x+=this.h.i.decode(U[I],{stream:!(le&&I==te-1)});U.length=0,this.h.g+=x,this.C=0,be=this.h.g}else be=this.g.oa();if(this.o=P==200,ss(this.i,this.u,this.A,this.l,this.R,Ot,P),this.o){if(this.T&&!this.K){t:{if(this.g){var Tt,sr=this.g;if((Tt=sr.g?sr.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(Tt)){var it=Tt;break t}}it=null}if(P=it)Re(this.i,this.l,P,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Sh(this,P);else{this.o=!1,this.s=3,vr(12),os(this),jt(this);break e}}if(this.P){P=!0;let Sn;for(;!this.J&&this.C<be.length;)if(Sn=Ai(this,be),Sn==is){Ot==4&&(this.s=4,vr(14),P=!1),Re(this.i,this.l,null,"[Incomplete Response]");break}else if(Sn==u0){this.s=4,vr(15),Re(this.i,this.l,be,"[Invalid Chunk]"),P=!1;break}else Re(this.i,this.l,Sn,null),Sh(this,Sn);if(Ch(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ot!=4||be.length!=0||this.h.h||(this.s=1,vr(16),P=!1),this.o=this.o&&P,!P)Re(this.i,this.l,be,"[Invalid Chunked Response]"),os(this),jt(this);else if(0<be.length&&!this.W){this.W=!0;var Fn=this.j;Fn.g==this&&Fn.ba&&!Fn.M&&(Fn.j.info("Great, no buffering proxy detected. Bytes received: "+be.length),xn(Fn),Fn.M=!0,vr(11))}}else Re(this.i,this.l,be,null),Sh(this,be);Ot==4&&os(this),this.o&&!this.J&&(Ot==4?wl(this.j,this):(this.o=!1,Wo(this)))}else p0(this.g),P==400&&0<be.indexOf("Unknown SID")?(this.s=3,vr(12)):(this.s=0,vr(13)),os(this),jt(this)}}}catch{}finally{}};function Ch(x){return x.g?x.u=="GET"&&x.L!=2&&x.j.Ca:!1}function Ai(x,I){var P=x.C,U=I.indexOf(`
`,P);return U==-1?is:(P=Number(I.substring(P,U)),isNaN(P)?u0:(U+=1,U+P>I.length?is:(I=I.slice(U,U+P),x.C=U+P,I)))}nr.prototype.cancel=function(){this.J=!0,os(this)};function Wo(x){x.S=Date.now()+x.I,fe(x,x.I)}function fe(x,I){if(x.B!=null)throw Error("WatchDog timer not null");x.B=Zi(E(x.ba,x),I)}function Th(x){x.B&&(u.clearTimeout(x.B),x.B=null)}nr.prototype.ba=function(){this.B=null;const x=Date.now();0<=x-this.S?(Go(this.i,this.A),this.L!=2&&(vi(),vr(17)),os(this),this.s=2,jt(this)):fe(this,this.S-x)};function jt(x){x.j.G==0||x.J||wl(x.j,x)}function os(x){Th(x);var I=x.M;I&&typeof I.ma=="function"&&I.ma(),x.M=null,ln(x.U),x.g&&(I=x.g,x.g=null,I.abort(),I.ma())}function Sh(x,I){try{var P=x.j;if(P.G!=0&&(P.g==x||dl(P.h,x))){if(!x.K&&dl(P.h,x)&&P.G==3){try{var U=P.Da.g.parse(I)}catch{U=null}if(Array.isArray(U)&&U.length==3){var te=U;if(te[0]==0){e:if(!P.u){if(P.g)if(P.g.F+3e3<x.F)qt(P),oe(P);else break e;xl(P),vr(18)}}else P.za=te[1],0<P.za-P.T&&37500>te[2]&&P.F&&P.v==0&&!P.C&&(P.C=Zi(E(P.Za,P),6e3));if(1>=Sc(P.h)&&P.ca){try{P.ca()}catch{}P.ca=void 0}}else wt(P,11)}else if((x.K||P.g==x)&&qt(P),!C(I))for(te=P.Da.g.parse(I),I=0;I<te.length;I++){let it=te[I];if(P.T=it[0],it=it[1],P.G==2)if(it[0]=="c"){P.K=it[1],P.ia=it[2];const Fn=it[3];Fn!=null&&(P.la=Fn,P.j.info("VER="+P.la));const Ot=it[4];Ot!=null&&(P.Aa=Ot,P.j.info("SVER="+P.Aa));const so=it[5];so!=null&&typeof so=="number"&&0<so&&(U=1.5*so,P.L=U,P.j.info("backChannelRequestTimeoutMs_="+U)),U=P;const Sn=x.g;if(Sn){const Oc=Sn.g?Sn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Oc){var le=U.h;le.g||Oc.indexOf("spdy")==-1&&Oc.indexOf("quic")==-1&&Oc.indexOf("h2")==-1||(le.j=le.l,le.g=new Set,le.h&&(fl(le,le.h),le.h=null))}if(U.D){const _l=Sn.g?Sn.g.getResponseHeader("X-HTTP-Session-Id"):null;_l&&(U.ya=_l,et(U.I,U.D,_l))}}P.G=3,P.l&&P.l.ua(),P.ba&&(P.R=Date.now()-x.F,P.j.info("Handshake RTT: "+P.R+"ms")),U=P;var be=x;if(U.qa=w0(U,U.J?U.ia:null,U.W),be.K){Cn(U.h,be);var Tt=be,sr=U.L;sr&&(Tt.I=sr),Tt.B&&(Th(Tt),Wo(Tt)),U.g=be}else x0(U);0<P.i.length&&Tn(P)}else it[0]!="stop"&&it[0]!="close"||wt(P,7);else P.G==3&&(it[0]=="stop"||it[0]=="close"?it[0]=="stop"?wt(P,7):Oh(P):it[0]!="noop"&&P.l&&P.l.ta(it),P.v=0)}}vi(4)}catch{}}var Rt=class{constructor(x,I){this.g=x,this.map=I}};function At(x){this.l=x||10,u.PerformanceNavigationTiming?(x=u.performance.getEntriesByType("navigation"),x=0<x.length&&(x[0].nextHopProtocol=="hq"||x[0].nextHopProtocol=="h2")):x=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=x?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ct(x){return x.h?!0:x.g?x.g.size>=x.j:!1}function Sc(x){return x.h?1:x.g?x.g.size:0}function dl(x,I){return x.h?x.h==I:x.g?x.g.has(I):!1}function fl(x,I){x.g?x.g.add(I):x.h=I}function Cn(x,I){x.h&&x.h==I?x.h=null:x.g&&x.g.has(I)&&x.g.delete(I)}At.prototype.cancel=function(){if(this.i=Zs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const x of this.g.values())x.cancel();this.g.clear()}};function Zs(x){if(x.h!=null)return x.i.concat(x.h.D);if(x.g!=null&&x.g.size!==0){let I=x.i;for(const P of x.g.values())I=I.concat(P.D);return I}return S(x.i)}function Zp(x){if(x.V&&typeof x.V=="function")return x.V();if(typeof Map<"u"&&x instanceof Map||typeof Set<"u"&&x instanceof Set)return Array.from(x.values());if(typeof x=="string")return x.split("");if(d(x)){for(var I=[],P=x.length,U=0;U<P;U++)I.push(x[U]);return I}I=[],P=0;for(U in x)I[P++]=x[U];return I}function yn(x){if(x.na&&typeof x.na=="function")return x.na();if(!x.V||typeof x.V!="function"){if(typeof Map<"u"&&x instanceof Map)return Array.from(x.keys());if(!(typeof Set<"u"&&x instanceof Set)){if(d(x)||typeof x=="string"){var I=[];x=x.length;for(var P=0;P<x;P++)I.push(P);return I}I=[],P=0;for(const U in x)I[P++]=U;return I}}}function Js(x,I){if(x.forEach&&typeof x.forEach=="function")x.forEach(I,void 0);else if(d(x)||typeof x=="string")Array.prototype.forEach.call(x,I,void 0);else for(var P=yn(x),U=Zp(x),te=U.length,le=0;le<te;le++)I.call(void 0,U[le],P&&P[le],x)}var h0=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $o(x,I){if(x){x=x.split("&");for(var P=0;P<x.length;P++){var U=x[P].indexOf("="),te=null;if(0<=U){var le=x[P].substring(0,U);te=x[P].substring(U+1)}else le=x[P];I(le,te?decodeURIComponent(te.replace(/\+/g," ")):"")}}}function bt(x){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,x instanceof bt){this.h=x.h,re(this,x.j),this.o=x.o,this.g=x.g,G(this,x.s),this.l=x.l;var I=x.i,P=new bi;P.i=I.i,I.g&&(P.g=new Map(I.g),P.h=I.h),Ve(this,P),this.m=x.m}else x&&(I=String(x).match(h0))?(this.h=!1,re(this,I[1]||"",!0),this.o=ml(I[2]||""),this.g=ml(I[3]||"",!0),G(this,I[4]),this.l=ml(I[5]||"",!0),Ve(this,I[6]||"",!0),this.m=ml(I[7]||"")):(this.h=!1,this.i=new bi(null,this.h))}bt.prototype.toString=function(){var x=[],I=this.j;I&&x.push(no(I,ze,!0),":");var P=this.g;return(P||I=="file")&&(x.push("//"),(I=this.o)&&x.push(no(I,ze,!0),"@"),x.push(encodeURIComponent(String(P)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),P=this.s,P!=null&&x.push(":",String(P))),(P=this.l)&&(this.g&&P.charAt(0)!="/"&&x.push("/"),x.push(no(P,P.charAt(0)=="/"?d0:en,!0))),(P=this.i.toString())&&x.push("?",P),(P=this.m)&&x.push("#",no(P,Nh)),x.join("")};function Qt(x){return new bt(x)}function re(x,I,P){x.j=P?ml(I,!0):I,x.j&&(x.j=x.j.replace(/:$/,""))}function G(x,I){if(I){if(I=Number(I),isNaN(I)||0>I)throw Error("Bad port number "+I);x.s=I}else x.s=null}function Ve(x,I,P){I instanceof bi?(x.i=I,Ke(x.i,x.h)):(P||(I=no(I,Jp)),x.i=new bi(I,x.h))}function et(x,I,P){x.i.set(I,P)}function Er(x){return et(x,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),x}function ml(x,I){return x?I?decodeURI(x.replace(/%25/g,"%2525")):decodeURIComponent(x):""}function no(x,I,P){return typeof x=="string"?(x=encodeURI(x).replace(I,as),P&&(x=x.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),x):null}function as(x){return x=x.charCodeAt(0),"%"+(x>>4&15).toString(16)+(x&15).toString(16)}var ze=/[#\/\?@]/g,en=/[#\?:]/g,d0=/[#\?]/g,Jp=/[#\?@]/g,Nh=/#/g;function bi(x,I){this.h=this.g=null,this.i=x||null,this.j=!!I}function Fs(x){x.g||(x.g=new Map,x.h=0,x.i&&$o(x.i,function(I,P){x.add(decodeURIComponent(I.replace(/\+/g," ")),P)}))}t=bi.prototype,t.add=function(x,I){Fs(this),this.i=null,x=$r(this,x);var P=this.g.get(x);return P||this.g.set(x,P=[]),P.push(I),this.h+=1,this};function f0(x,I){Fs(x),I=$r(x,I),x.g.has(I)&&(x.i=null,x.h-=x.g.get(I).length,x.g.delete(I))}function jn(x,I){return Fs(x),I=$r(x,I),x.g.has(I)}t.forEach=function(x,I){Fs(this),this.g.forEach(function(P,U){P.forEach(function(te){x.call(I,te,U,this)},this)},this)},t.na=function(){Fs(this);const x=Array.from(this.g.values()),I=Array.from(this.g.keys()),P=[];for(let U=0;U<I.length;U++){const te=x[U];for(let le=0;le<te.length;le++)P.push(I[U])}return P},t.V=function(x){Fs(this);let I=[];if(typeof x=="string")jn(this,x)&&(I=I.concat(this.g.get($r(this,x))));else{x=Array.from(this.g.values());for(let P=0;P<x.length;P++)I=I.concat(x[P])}return I},t.set=function(x,I){return Fs(this),this.i=null,x=$r(this,x),jn(this,x)&&(this.h-=this.g.get(x).length),this.g.set(x,[I]),this.h+=1,this},t.get=function(x,I){return x?(x=this.V(x),0<x.length?String(x[0]):I):I};function Ho(x,I,P){f0(x,I),0<P.length&&(x.i=null,x.g.set($r(x,I),S(P)),x.h+=P.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const x=[],I=Array.from(this.g.keys());for(var P=0;P<I.length;P++){var U=I[P];const le=encodeURIComponent(String(U)),be=this.V(U);for(U=0;U<be.length;U++){var te=le;be[U]!==""&&(te+="="+encodeURIComponent(String(be[U]))),x.push(te)}}return this.i=x.join("&")};function $r(x,I){return I=String(I),x.j&&(I=I.toLowerCase()),I}function Ke(x,I){I&&!x.j&&(Fs(x),x.i=null,x.g.forEach(function(P,U){var te=U.toLowerCase();U!=te&&(f0(this,U),Ho(this,te,P))},x)),x.j=I}function e1(x,I){const P=new qn;if(u.Image){const U=new Image;U.onload=b(Xt,P,"TestLoadImage: loaded",!0,I,U),U.onerror=b(Xt,P,"TestLoadImage: error",!1,I,U),U.onabort=b(Xt,P,"TestLoadImage: abort",!1,I,U),U.ontimeout=b(Xt,P,"TestLoadImage: timeout",!1,I,U),u.setTimeout(function(){U.ontimeout&&U.ontimeout()},1e4),U.src=x}else I(!1)}function tt(x,I){const P=new qn,U=new AbortController,te=setTimeout(()=>{U.abort(),Xt(P,"TestPingServer: timeout",!1,I)},1e4);fetch(x,{signal:U.signal}).then(le=>{clearTimeout(te),le.ok?Xt(P,"TestPingServer: ok",!0,I):Xt(P,"TestPingServer: server error",!1,I)}).catch(()=>{clearTimeout(te),Xt(P,"TestPingServer: error",!1,I)})}function Xt(x,I,P,U,te){try{te&&(te.onload=null,te.onerror=null,te.onabort=null,te.ontimeout=null),U(P)}catch{}}function t1(){this.g=new _i}function Rh(x,I,P){const U=P||"";try{Js(x,function(te,le){let be=te;m(te)&&(be=vt(te)),I.push(U+le+"="+encodeURIComponent(be))})}catch(te){throw I.push(U+"type="+encodeURIComponent("_badmap")),te}}function gl(x){this.l=x.Ub||null,this.j=x.eb||!1}k(gl,hl),gl.prototype.g=function(){return new Bs(this.l,this.j)},gl.prototype.i=function(x){return function(){return x}}({});function Bs(x,I){Qe.call(this),this.D=x,this.o=I,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(Bs,Qe),t=Bs.prototype,t.open=function(x,I){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=x,this.A=I,this.readyState=1,ti(this)},t.send=function(x){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const I={headers:this.u,method:this.B,credentials:this.m,cache:void 0};x&&(I.body=x),(this.D||u).fetch(new Request(this.A,I)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ei(this)),this.readyState=0},t.Sa=function(x){if(this.g&&(this.l=x,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=x.headers,this.readyState=2,ti(this)),this.g&&(this.readyState=3,ti(this),this.g)))if(this.responseType==="arraybuffer")x.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in x){if(this.j=x.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;m0(this)}else x.text().then(this.Ra.bind(this),this.ga.bind(this))};function m0(x){x.j.read().then(x.Pa.bind(x)).catch(x.ga.bind(x))}t.Pa=function(x){if(this.g){if(this.o&&x.value)this.response.push(x.value);else if(!this.o){var I=x.value?x.value:new Uint8Array(0);(I=this.v.decode(I,{stream:!x.done}))&&(this.response=this.responseText+=I)}x.done?ei(this):ti(this),this.readyState==3&&m0(this)}},t.Ra=function(x){this.g&&(this.response=this.responseText=x,ei(this))},t.Qa=function(x){this.g&&(this.response=x,ei(this))},t.ga=function(){this.g&&ei(this)};function ei(x){x.readyState=4,x.l=null,x.j=null,x.v=null,ti(x)}t.setRequestHeader=function(x,I){this.u.append(x,I)},t.getResponseHeader=function(x){return this.h&&this.h.get(x.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const x=[],I=this.h.entries();for(var P=I.next();!P.done;)P=P.value,x.push(P[0]+": "+P[1]),P=I.next();return x.join(`\r
`)};function ti(x){x.onreadystatechange&&x.onreadystatechange.call(x)}Object.defineProperty(Bs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(x){this.m=x?"include":"same-origin"}});function Ko(x){let I="";return Q(x,function(P,U){I+=U,I+=":",I+=P,I+=`\r
`}),I}function Nc(x,I,P){e:{for(U in P){var U=!1;break e}U=!0}U||(P=Ko(P),typeof x=="string"?P!=null&&encodeURIComponent(String(P)):et(x,I,P))}function Ft(x){Qe.call(this),this.headers=new Map,this.o=x||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(Ft,Qe);var pl=/^https?$/i,Dr=["POST","PUT"];t=Ft.prototype,t.Ha=function(x){this.J=x},t.ea=function(x,I,P,U){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+x);I=I?I.toUpperCase():"GET",this.D=x,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():qo.g(),this.v=this.o?bh(this.o):bh(qo),this.g.onreadystatechange=E(this.Ea,this);try{this.B=!0,this.g.open(I,String(x),!0),this.B=!1}catch(le){Ph(this,le);return}if(x=P||"",P=new Map(this.headers),U)if(Object.getPrototypeOf(U)===Object.prototype)for(var te in U)P.set(te,U[te]);else if(typeof U.keys=="function"&&typeof U.get=="function")for(const le of U.keys())P.set(le,U.get(le));else throw Error("Unknown input type for opt_headers: "+String(U));U=Array.from(P.keys()).find(le=>le.toLowerCase()=="content-type"),te=u.FormData&&x instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Dr,I,void 0))||U||te||P.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[le,be]of P)this.g.setRequestHeader(le,be);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{g0(this),this.u=!0,this.g.send(x),this.u=!1}catch(le){Ph(this,le)}};function Ph(x,I){x.h=!1,x.g&&(x.j=!0,x.g.abort(),x.j=!1),x.l=I,x.m=5,kh(x),Rc(x)}function kh(x){x.A||(x.A=!0,He(x,"complete"),He(x,"error"))}t.abort=function(x){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=x||7,He(this,"complete"),He(this,"abort"),Rc(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Rc(this,!0)),Ft.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Dh(this):this.bb())},t.bb=function(){Dh(this)};function Dh(x){if(x.h&&typeof a<"u"&&(!x.v[1]||ni(x)!=4||x.Z()!=2)){if(x.u&&ni(x)==4)wi(x.Ea,0,x);else if(He(x,"readystatechange"),ni(x)==4){x.h=!1;try{const be=x.Z();e:switch(be){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var I=!0;break e;default:I=!1}var P;if(!(P=I)){var U;if(U=be===0){var te=String(x.D).match(h0)[1]||null;!te&&u.self&&u.self.location&&(te=u.self.location.protocol.slice(0,-1)),U=!pl.test(te?te.toLowerCase():"")}P=U}if(P)He(x,"complete"),He(x,"success");else{x.m=6;try{var le=2<ni(x)?x.g.statusText:""}catch{le=""}x.l=le+" ["+x.Z()+"]",kh(x)}}finally{Rc(x)}}}}function Rc(x,I){if(x.g){g0(x);const P=x.g,U=x.v[0]?()=>{}:null;x.g=null,x.v=null,I||He(x,"ready");try{P.onreadystatechange=U}catch{}}}function g0(x){x.I&&(u.clearTimeout(x.I),x.I=null)}t.isActive=function(){return!!this.g};function ni(x){return x.g?x.g.readyState:0}t.Z=function(){try{return 2<ni(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(x){if(this.g){var I=this.g.responseText;return x&&I.indexOf(x)==0&&(I=I.substring(x.length)),Kt(I)}};function Pt(x){try{if(!x.g)return null;if("response"in x.g)return x.g.response;switch(x.H){case"":case"text":return x.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in x.g)return x.g.mozResponseArrayBuffer}return null}catch{return null}}function p0(x){const I={};x=(x.g&&2<=ni(x)&&x.g.getAllResponseHeaders()||"").split(`\r
`);for(let U=0;U<x.length;U++){if(C(x[U]))continue;var P=X(x[U]);const te=P[0];if(P=P[1],typeof P!="string")continue;P=P.trim();const le=I[te]||[];I[te]=le,le.push(P)}D(I,function(U){return U.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ii(x,I,P){return P&&P.internalChannelParams&&P.internalChannelParams[x]||I}function ri(x){this.Aa=0,this.i=[],this.j=new qn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ii("failFast",!1,x),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ii("baseRetryDelayMs",5e3,x),this.cb=Ii("retryDelaySeedMs",1e4,x),this.Wa=Ii("forwardChannelMaxRetries",2,x),this.wa=Ii("forwardChannelRequestTimeoutMs",2e4,x),this.pa=x&&x.xmlHttpFactory||void 0,this.Xa=x&&x.Tb||void 0,this.Ca=x&&x.useFetchStreams||!1,this.L=void 0,this.J=x&&x.supportsCrossDomainXhr||!1,this.K="",this.h=new At(x&&x.concurrentRequestLimit),this.Da=new t1,this.P=x&&x.fastHandshake||!1,this.O=x&&x.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=x&&x.Rb||!1,x&&x.xa&&this.j.xa(),x&&x.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&x&&x.detectBufferingProxy||!1,this.ja=void 0,x&&x.longPollingTimeout&&0<x.longPollingTimeout&&(this.ja=x.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=ri.prototype,t.la=8,t.G=1,t.connect=function(x,I,P,U){vr(0),this.W=x,this.H=I||{},P&&U!==void 0&&(this.H.OSID=P,this.H.OAID=U),this.F=this.X,this.I=w0(this,null,this.W),Tn(this)};function Oh(x){if(nt(x),x.G==3){var I=x.U++,P=Qt(x.I);if(et(P,"SID",x.K),et(P,"RID",I),et(P,"TYPE","terminate"),yl(x,P),I=new nr(x,x.j,I),I.L=2,I.v=Er(Qt(P)),P=!1,u.navigator&&u.navigator.sendBeacon)try{P=u.navigator.sendBeacon(I.v.toString(),"")}catch{}!P&&u.Image&&(new Image().src=I.v,P=!0),P||(I.g=Bt(I.j,null),I.g.ea(I.v)),I.F=Date.now(),Wo(I)}qe(x)}function oe(x){x.g&&(xn(x),x.g.cancel(),x.g=null)}function nt(x){oe(x),x.u&&(u.clearTimeout(x.u),x.u=null),qt(x),x.h.cancel(),x.s&&(typeof x.s=="number"&&u.clearTimeout(x.s),x.s=null)}function Tn(x){if(!ct(x.h)&&!x.s){x.s=!0;var I=x.Ga;de||Me(),he||(de(),he=!0),Ce.add(I,x),x.B=0}}function Pc(x,I){return Sc(x.h)>=x.h.j-(x.s?1:0)?!1:x.s?(x.i=I.D.concat(x.i),!0):x.G==1||x.G==2||x.B>=(x.Va?0:x.Wa)?!1:(x.s=Zi(E(x.Ga,x,I),Ci(x,x.B)),x.B++,!0)}t.Ga=function(x){if(this.s)if(this.s=null,this.G==1){if(!x){this.U=Math.floor(1e5*Math.random()),x=this.U++;const te=new nr(this,this.j,x);let le=this.o;if(this.S&&(le?(le=B(le),W(le,this.S)):le=this.S),this.m!==null||this.O||(te.H=le,le=null),this.P)e:{for(var I=0,P=0;P<this.i.length;P++){t:{var U=this.i[P];if("__data__"in U.map&&(U=U.map.__data__,typeof U=="string")){U=U.length;break t}U=void 0}if(U===void 0)break;if(I+=U,4096<I){I=P;break e}if(I===4096||P===this.i.length-1){I=P+1;break e}}I=1e3}else I=1e3;I=y0(this,te,I),P=Qt(this.I),et(P,"RID",x),et(P,"CVER",22),this.D&&et(P,"X-HTTP-Session-Id",this.D),yl(this,P),le&&(this.O?I="headers="+encodeURIComponent(String(Ko(le)))+"&"+I:this.m&&Nc(P,this.m,le)),fl(this.h,te),this.Ua&&et(P,"TYPE","init"),this.P?(et(P,"$req",I),et(P,"SID","null"),te.T=!0,rr(te,P,null)):rr(te,P,I),this.G=2}}else this.G==3&&(x?Mh(this,x):this.i.length==0||ct(this.h)||Mh(this))};function Mh(x,I){var P;I?P=I.l:P=x.U++;const U=Qt(x.I);et(U,"SID",x.K),et(U,"RID",P),et(U,"AID",x.T),yl(x,U),x.m&&x.o&&Nc(U,x.m,x.o),P=new nr(x,x.j,P,x.B+1),x.m===null&&(P.H=x.o),I&&(x.i=I.D.concat(x.i)),I=y0(x,P,1e3),P.I=Math.round(.5*x.wa)+Math.round(.5*x.wa*Math.random()),fl(x.h,P),rr(P,U,I)}function yl(x,I){x.H&&Q(x.H,function(P,U){et(I,U,P)}),x.l&&Js({},function(P,U){et(I,U,P)})}function y0(x,I,P){P=Math.min(x.i.length,P);var U=x.l?E(x.l.Na,x.l,x):null;e:{var te=x.i;let le=-1;for(;;){const be=["count="+P];le==-1?0<P?(le=te[0].g,be.push("ofs="+le)):le=0:be.push("ofs="+le);let Tt=!0;for(let sr=0;sr<P;sr++){let it=te[sr].g;const Fn=te[sr].map;if(it-=le,0>it)le=Math.max(0,te[sr].g-100),Tt=!1;else try{Rh(Fn,be,"req"+it+"_")}catch{U&&U(Fn)}}if(Tt){U=be.join("&");break e}}}return x=x.i.splice(0,P),I.D=x,U}function x0(x){if(!x.g&&!x.u){x.Y=1;var I=x.Fa;de||Me(),he||(de(),he=!0),Ce.add(I,x),x.v=0}}function xl(x){return x.g||x.u||3<=x.v?!1:(x.Y++,x.u=Zi(E(x.Fa,x),Ci(x,x.v)),x.v++,!0)}t.Fa=function(){if(this.u=null,kc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var x=2*this.R;this.j.info("BP detection timer enabled: "+x),this.A=Zi(E(this.ab,this),x)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,vr(10),oe(this),kc(this))};function xn(x){x.A!=null&&(u.clearTimeout(x.A),x.A=null)}function kc(x){x.g=new nr(x,x.j,"rpc",x.Y),x.m===null&&(x.g.H=x.o),x.g.O=0;var I=Qt(x.qa);et(I,"RID","rpc"),et(I,"SID",x.K),et(I,"AID",x.T),et(I,"CI",x.F?"0":"1"),!x.F&&x.ja&&et(I,"TO",x.ja),et(I,"TYPE","xmlhttp"),yl(x,I),x.m&&x.o&&Nc(I,x.m,x.o),x.L&&(x.g.I=x.L);var P=x.g;x=x.ia,P.L=1,P.v=Er(Qt(I)),P.m=null,P.P=!0,Gt(P,x)}t.Za=function(){this.C!=null&&(this.C=null,oe(this),xl(this),vr(19))};function qt(x){x.C!=null&&(u.clearTimeout(x.C),x.C=null)}function wl(x,I){var P=null;if(x.g==I){qt(x),xn(x),x.g=null;var U=2}else if(dl(x.h,I))P=I.D,Cn(x.h,I),U=1;else return;if(x.G!=0){if(I.o)if(U==1){P=I.m?I.m.length:0,I=Date.now()-I.F;var te=x.B;U=Ln(),He(U,new Ei(U,P)),Tn(x)}else x0(x);else if(te=I.s,te==3||te==0&&0<I.X||!(U==1&&Pc(x,I)||U==2&&xl(x)))switch(P&&0<P.length&&(I=x.h,I.i=I.i.concat(P)),te){case 1:wt(x,5);break;case 4:wt(x,10);break;case 3:wt(x,6);break;default:wt(x,2)}}}function Ci(x,I){let P=x.Ta+Math.floor(Math.random()*x.cb);return x.isActive()||(P*=2),P*I}function wt(x,I){if(x.j.info("Error code "+I),I==2){var P=E(x.fb,x),U=x.Xa;const te=!U;U=new bt(U||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||re(U,"https"),Er(U),te?e1(U.toString(),P):tt(U.toString(),P)}else vr(2);x.G=0,x.l&&x.l.sa(I),qe(x),nt(x)}t.fb=function(x){x?(this.j.info("Successfully pinged google.com"),vr(2)):(this.j.info("Failed to ping google.com"),vr(1))};function qe(x){if(x.G=0,x.ka=[],x.l){const I=Zs(x.h);(I.length!=0||x.i.length!=0)&&(O(x.ka,I),O(x.ka,x.i),x.h.i.length=0,S(x.i),x.i.length=0),x.l.ra()}}function w0(x,I,P){var U=P instanceof bt?Qt(P):new bt(P);if(U.g!="")I&&(U.g=I+"."+U.g),G(U,U.s);else{var te=u.location;U=te.protocol,I=I?I+"."+te.hostname:te.hostname,te=+te.port;var le=new bt(null);U&&re(le,U),I&&(le.g=I),te&&G(le,te),P&&(le.l=P),U=le}return P=x.D,I=x.ya,P&&I&&et(U,P,I),et(U,"VER",x.la),yl(x,U),U}function Bt(x,I,P){if(I&&!x.J)throw Error("Can't create secondary domain capable XhrIo object.");return I=x.Ca&&!x.pa?new Ft(new gl({eb:P})):new Ft(x.pa),I.Ha(x.J),I}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ti(){}t=Ti.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function si(){}si.prototype.g=function(x,I){return new Hr(x,I)};function Hr(x,I){Qe.call(this),this.g=new ri(I),this.l=x,this.h=I&&I.messageUrlParams||null,x=I&&I.messageHeaders||null,I&&I.clientProtocolHeaderRequired&&(x?x["X-Client-Protocol"]="webchannel":x={"X-Client-Protocol":"webchannel"}),this.g.o=x,x=I&&I.initMessageHeaders||null,I&&I.messageContentType&&(x?x["X-WebChannel-Content-Type"]=I.messageContentType:x={"X-WebChannel-Content-Type":I.messageContentType}),I&&I.va&&(x?x["X-WebChannel-Client-Profile"]=I.va:x={"X-WebChannel-Client-Profile":I.va}),this.g.S=x,(x=I&&I.Sb)&&!C(x)&&(this.g.m=x),this.v=I&&I.supportsCrossDomainXhr||!1,this.u=I&&I.sendRawJson||!1,(I=I&&I.httpSessionIdParam)&&!C(I)&&(this.g.D=I,x=this.h,x!==null&&I in x&&(x=this.h,I in x&&delete x[I])),this.j=new ro(this)}k(Hr,Qe),Hr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Hr.prototype.close=function(){Oh(this.g)},Hr.prototype.o=function(x){var I=this.g;if(typeof x=="string"){var P={};P.__data__=x,x=P}else this.u&&(P={},P.__data__=vt(x),x=P);I.i.push(new Rt(I.Ya++,x)),I.G==3&&Tn(I)},Hr.prototype.N=function(){this.g.l=null,delete this.j,Oh(this.g),delete this.g,Hr.aa.N.call(this)};function Es(x){Ic.call(this),x.__headers__&&(this.headers=x.__headers__,this.statusCode=x.__status__,delete x.__headers__,delete x.__status__);var I=x.__sm__;if(I){e:{for(const P in I){x=P;break e}x=void 0}(this.i=x)&&(x=this.i,I=I!==null&&x in I?I[x]:void 0),this.data=I}else this.data=x}k(Es,Ic);function Dc(){Cc.call(this),this.status=1}k(Dc,Cc);function ro(x){this.g=x}k(ro,Ti),ro.prototype.ua=function(){He(this.g,"a")},ro.prototype.ta=function(x){He(this.g,new Es(x))},ro.prototype.sa=function(x){He(this.g,new Dc)},ro.prototype.ra=function(){He(this.g,"b")},si.prototype.createWebChannel=si.prototype.g,Hr.prototype.send=Hr.prototype.o,Hr.prototype.open=Hr.prototype.m,Hr.prototype.close=Hr.prototype.close,YS=function(){return new si},XS=function(){return Ln()},QS=er,fx={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},tr.NO_ERROR=0,tr.TIMEOUT=8,tr.HTTP_ERROR=6,Em=tr,eo.COMPLETE="complete",KS=eo,Et.EventType=_s,_s.OPEN="a",_s.CLOSE="b",_s.ERROR="c",_s.MESSAGE="d",Qe.prototype.listen=Qe.prototype.K,ad=Et,Ft.prototype.listenOnce=Ft.prototype.L,Ft.prototype.getLastError=Ft.prototype.Ka,Ft.prototype.getLastErrorCode=Ft.prototype.Ba,Ft.prototype.getStatus=Ft.prototype.Z,Ft.prototype.getResponseJson=Ft.prototype.Oa,Ft.prototype.getResponseText=Ft.prototype.oa,Ft.prototype.send=Ft.prototype.ea,Ft.prototype.setWithCredentials=Ft.prototype.Ha,HS=Ft}).apply(typeof V0<"u"?V0:typeof self<"u"?self:typeof window<"u"?window:{});const lA="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yr=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};yr.UNAUTHENTICATED=new yr(null),yr.GOOGLE_CREDENTIALS=new yr("google-credentials-uid"),yr.FIRST_PARTY=new yr("first-party-uid"),yr.MOCK_USER=new yr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lh="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Va=new w_("@firebase/firestore");function Wc(){return Va.logLevel}function zG(t){Va.setLogLevel(t)}function me(t,...e){if(Va.logLevel<=pt.DEBUG){const n=e.map(R_);Va.debug(`Firestore (${lh}): ${t}`,...n)}}function Vn(t,...e){if(Va.logLevel<=pt.ERROR){const n=e.map(R_);Va.error(`Firestore (${lh}): ${t}`,...n)}}function Ks(t,...e){if(Va.logLevel<=pt.WARN){const n=e.map(R_);Va.warn(`Firestore (${lh}): ${t}`,...n)}}function R_(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ke(t="Unexpected state"){const e=`FIRESTORE (${lh}) INTERNAL ASSERTION FAILED: `+t;throw Vn(e),new Error(e)}function je(t,e){t||ke()}function GG(t,e){t||ke()}function Ie(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ae={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ge extends Hi{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZS{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class mL{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(yr.UNAUTHENTICATED))}shutdown(){}}class gL{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class pL{constructor(e){this.t=e,this.currentUser=yr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){je(this.o===void 0);let r=this.i;const s=d=>this.i!==r?(r=this.i,n(d)):Promise.resolve();let i=new wr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new wr,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const d=i;e.enqueueRetryable(async()=>{await d.promise,await s(this.currentUser)})},u=d=>{me("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(d=>u(d)),setTimeout(()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?u(d):(me("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new wr)}},0),a()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(me("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(je(typeof r.accessToken=="string"),new ZS(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return je(e===null||typeof e=="string"),new yr(e)}}class yL{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=yr.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class xL{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new yL(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(yr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class JS{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class wL{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){je(this.o===void 0);const r=i=>{i.error!=null&&me("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.R;return this.R=i.token,me("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{me("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):me("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(je(typeof n.token=="string"),this.R=n.token,new JS(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class qG{getToken(){return Promise.resolve(new JS(""))}invalidateToken(){}start(e,n){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _L(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eN{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=_L(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%e.length))}return r}}function Je(t,e){return t<e?-1:t>e?1:0}function ku(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}function tN(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new ge(ae.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ge(ae.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new ge(ae.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ge(ae.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return vn.fromMillis(Date.now())}static fromDate(e){return vn.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new vn(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Je(this.nanoseconds,e.nanoseconds):Je(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ue{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ue(e)}static min(){return new Ue(new vn(0,0))}static max(){return new Ue(new vn(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class of{constructor(e,n,r){n===void 0?n=0:n>e.length&&ke(),r===void 0?r=e.length-n:r>e.length-n&&ke(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return of.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof of?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=e.get(s),a=n.get(s);if(i<a)return-1;if(i>a)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class yt extends of{construct(e,n,r){return new yt(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new ge(ae.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new yt(n)}static emptyPath(){return new yt([])}}const vL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class fn extends of{construct(e,n,r){return new fn(e,n,r)}static isValidIdentifier(e){return vL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),fn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new fn(["__name__"])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ge(ae.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let a=!1;for(;s<e.length;){const u=e[s];if(u==="\\"){if(s+1===e.length)throw new ge(ae.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[s+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new ge(ae.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(r+=u,s++):(i(),s++)}if(i(),a)throw new ge(ae.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new fn(n)}static emptyPath(){return new fn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(e){this.path=e}static fromPath(e){return new Se(yt.fromString(e))}static fromName(e){return new Se(yt.fromString(e).popFirst(5))}static empty(){return new Se(yt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&yt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return yt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Se(new yt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du{constructor(e,n,r,s){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=s}}function mx(t){return t.fields.find(e=>e.kind===2)}function Cl(t){return t.fields.filter(e=>e.kind!==2)}function EL(t,e){let n=Je(t.collectionGroup,e.collectionGroup);if(n!==0)return n;for(let r=0;r<Math.min(t.fields.length,e.fields.length);++r)if(n=AL(t.fields[r],e.fields[r]),n!==0)return n;return Je(t.fields.length,e.fields.length)}Du.UNKNOWN_ID=-1;class Vl{constructor(e,n){this.fieldPath=e,this.kind=n}}function AL(t,e){const n=fn.comparator(t.fieldPath,e.fieldPath);return n!==0?n:Je(t.kind,e.kind)}class Ou{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new Ou(0,ks.min())}}function nN(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=Ue.fromTimestamp(r===1e9?new vn(n+1,0):new vn(n,r));return new ks(s,Se.empty(),e)}function rN(t){return new ks(t.readTime,t.key,-1)}class ks{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new ks(Ue.min(),Se.empty(),-1)}static max(){return new ks(Ue.max(),Se.empty(),-1)}}function P_(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Se.comparator(t.documentKey,e.documentKey),n!==0?n:Je(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sN="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class iN{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sl(t){if(t.code!==ae.FAILED_PRECONDITION||t.message!==sN)throw t;me("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ne{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ke(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ne((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof ne?n:ne.resolve(n)}catch(n){return ne.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):ne.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):ne.reject(n)}static resolve(e){return new ne((n,r)=>{n(e)})}static reject(e){return new ne((n,r)=>{r(e)})}static waitFor(e){return new ne((n,r)=>{let s=0,i=0,a=!1;e.forEach(u=>{++s,u.next(()=>{++i,a&&i===s&&n()},d=>r(d))}),a=!0,i===s&&n()})}static or(e){let n=ne.resolve(!1);for(const r of e)n=n.next(s=>s?ne.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new ne((r,s)=>{const i=e.length,a=new Array(i);let u=0;for(let d=0;d<i;d++){const m=d;n(e[m]).next(y=>{a[m]=y,++u,u===i&&r(a)},y=>s(y))}})}static doWhile(e,n){return new ne((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _p{constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.V=new wr,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{n.error?this.V.reject(new Ad(e,n.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=k_(r.target.error);this.V.reject(new Ad(e,s))}}static open(e,n,r,s){try{return new _p(n,e.transaction(s,r))}catch(i){throw new Ad(n,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(me("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new IL(n)}}class zi{constructor(e,n,r){this.name=e,this.version=n,this.p=r,zi.S(cr())===12.2&&Vn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return me("SimpleDb","Removing database:",e),Tl(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!nS())return!1;if(zi.v())return!0;const e=cr(),n=zi.S(e),r=0<n&&n<10,s=oN(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,n){return e.store(n)}static S(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(me("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;n(a)},s.onblocked=()=>{r(new Ad(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?r(new ge(ae.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new ge(ae.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new Ad(e,a))},s.onupgradeneeded=i=>{me("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;this.p.O(a,s.transaction,i.oldVersion,this.version).next(()=>{me("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=n=>this.N(n)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,s){const i=n==="readonly";let a=0;for(;;){++a;try{this.db=await this.M(e);const u=_p.open(this.db,e,i?"readonly":"readwrite",r),d=s(u).next(m=>(u.g(),m)).catch(m=>(u.abort(m),ne.reject(m))).toPromise();return d.catch(()=>{}),await u.m,d}catch(u){const d=u,m=d.name!=="FirebaseError"&&a<3;if(me("SimpleDb","Transaction failed with error:",d.message,"Retrying:",m),this.close(),!m)return Promise.reject(d)}}}close(){this.db&&this.db.close(),this.db=void 0}}function oN(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class bL{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Tl(this.B.delete())}}class Ad extends ge{constructor(e,n){super(ae.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function il(t){return t.name==="IndexedDbTransactionError"}class IL{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(me("SimpleDb","PUT",this.store.name,e,n),r=this.store.put(n,e)):(me("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Tl(r)}add(e){return me("SimpleDb","ADD",this.store.name,e,e),Tl(this.store.add(e))}get(e){return Tl(this.store.get(e)).next(n=>(n===void 0&&(n=null),me("SimpleDb","GET",this.store.name,e,n),n))}delete(e){return me("SimpleDb","DELETE",this.store.name,e),Tl(this.store.delete(e))}count(){return me("SimpleDb","COUNT",this.store.name),Tl(this.store.count())}U(e,n){const r=this.options(e,n),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new ne((a,u)=>{i.onerror=d=>{u(d.target.error)},i.onsuccess=d=>{a(d.target.result)}})}{const i=this.cursor(r),a=[];return this.W(i,(u,d)=>{a.push(d)}).next(()=>a)}}G(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new ne((s,i)=>{r.onerror=a=>{i(a.target.error)},r.onsuccess=a=>{s(a.target.result)}})}j(e,n){me("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,n);r.H=!1;const s=this.cursor(r);return this.W(s,(i,a,u)=>u.delete())}J(e,n){let r;n?r=e:(r={},n=e);const s=this.cursor(r);return this.W(s,n)}Y(e){const n=this.cursor({});return new ne((r,s)=>{n.onerror=i=>{const a=k_(i.target.error);s(a)},n.onsuccess=i=>{const a=i.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():r()}):r()}})}W(e,n){const r=[];return new ne((s,i)=>{e.onerror=a=>{i(a.target.error)},e.onsuccess=a=>{const u=a.target.result;if(!u)return void s();const d=new bL(u),m=n(u.primaryKey,u.value,d);if(m instanceof ne){const y=m.catch(_=>(d.done(),ne.reject(_)));r.push(y)}d.isDone?s():d.K===null?u.continue():u.continue(d.K)}}).next(()=>ne.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function Tl(t){return new ne((e,n)=>{t.onsuccess=r=>{const s=r.target.result;e(s)},t.onerror=r=>{const s=k_(r.target.error);n(s)}})}let cA=!1;function k_(t){const e=zi.S(cr());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new ge("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return cA||(cA=!0,setTimeout(()=>{throw r},0)),r}}return t}class CL{constructor(e,n){this.asyncQueue=e,this.Z=n,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){me("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{me("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(n){il(n)?me("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):await sl(n)}await this.X(6e4)})}}class TL{constructor(e,n){this.localStore=e,this.persistence=n}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.te(n,e))}te(e,n){const r=new Set;let s=n,i=!0;return ne.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!r.has(a))return me("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,s).next(u=>{s-=u,r.add(a)});i=!1})).next(()=>n-s)}ne(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(s=>this.localStore.localDocuments.getNextDocuments(e,n,s,r).next(i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(s,i)).next(u=>(me("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,n,u))).next(()=>a.size)}))}re(e,n){let r=e;return n.changes.forEach((s,i)=>{const a=rN(i);P_(a,r)>0&&(r=a)}),new ks(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fs{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}fs.oe=-1;function Vf(t){return t==null}function af(t){return t===0&&1/t==-1/0}function aN(t){return typeof t=="number"&&Number.isInteger(t)&&!af(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zr(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=uA(e)),e=SL(t.get(n),e);return uA(e)}function SL(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const i=t.charAt(s);switch(i){case"\0":n+="";break;case"":n+="";break;default:n+=i}}return n}function uA(t){return t+""}function Mi(t){const e=t.length;if(je(e>=2),e===2)return je(t.charAt(0)===""&&t.charAt(1)===""),yt.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const a=t.indexOf("",i);switch((a<0||a>n)&&ke(),t.charAt(a+1)){case"":const u=t.substring(i,a);let d;s.length===0?d=u:(s+=u,d=s,s=""),r.push(d);break;case"":s+=t.substring(i,a),s+="\0";break;case"":s+=t.substring(i,a+1);break;default:ke()}i=a+2}return new yt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hA=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Am(t,e){return[t,zr(e)]}function lN(t,e,n){return[t,zr(e),n]}const NL={},RL=["prefixPath","collectionGroup","readTime","documentId"],PL=["prefixPath","collectionGroup","documentId"],kL=["collectionGroup","readTime","prefixPath","documentId"],DL=["canonicalId","targetId"],OL=["targetId","path"],ML=["path","targetId"],LL=["collectionId","parent"],jL=["indexId","uid"],FL=["uid","sequenceNumber"],BL=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],VL=["indexId","uid","orderedDocumentKey"],UL=["userId","collectionPath","documentId"],zL=["userId","collectionPath","largestBatchId"],GL=["userId","collectionGroup","largestBatchId"],cN=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],qL=[...cN,"documentOverlays"],uN=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],hN=uN,D_=[...hN,"indexConfiguration","indexState","indexEntries"],WL=D_,$L=[...D_,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx extends iN{constructor(e,n){super(),this._e=e,this.currentSequenceNumber=n}}function dr(t,e){const n=Ie(t);return zi.F(n._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dA(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ol(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function dN(t,e){const n=[];for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.push(e(t[r],r,t));return n}function fN(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jt{constructor(e,n){this.comparator=e,this.root=n||Ir.EMPTY}insert(e,n){return new Jt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Ir.BLACK,null,null))}remove(e){return new Jt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ir.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new U0(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new U0(this.root,e,this.comparator,!1)}getReverseIterator(){return new U0(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new U0(this.root,e,this.comparator,!0)}}class U0{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ir{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??Ir.RED,this.left=s??Ir.EMPTY,this.right=i??Ir.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new Ir(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ir.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return Ir.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ir.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ir.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ke();const e=this.left.check();if(e!==this.right.check())throw ke();return e+(this.isRed()?0:1)}}Ir.EMPTY=null,Ir.RED=!0,Ir.BLACK=!1;Ir.EMPTY=new class{constructor(){this.size=0}get key(){throw ke()}get value(){throw ke()}get color(){throw ke()}get left(){throw ke()}get right(){throw ke()}copy(e,n,r,s,i){return this}insert(e,n,r){return new Ir(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e){this.comparator=e,this.data=new Jt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new fA(this.data.getIterator())}getIteratorFrom(e){return new fA(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof Ut)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Ut(this.comparator);return n.data=e,n}}class fA{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Fc(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e){this.fields=e,e.sort(fn.comparator)}static empty(){return new ms([])}unionWith(e){let n=new Ut(fn.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new ms(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return ku(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mN extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $G(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new mN("Invalid base64 string: "+i):i}}(e);return new kn(n)}static fromUint8Array(e){const n=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new kn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Je(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}kn.EMPTY_BYTE_STRING=new kn("");const HL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Oo(t){if(je(!!t),typeof t=="string"){let e=0;const n=HL.exec(t);if(je(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:hn(t.seconds),nanos:hn(t.nanos)}}function hn(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Mo(t){return typeof t=="string"?kn.fromBase64String(t):kn.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vp(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Ep(t){const e=t.mapValue.fields.__previous_value__;return vp(e)?Ep(e):e}function lf(t){const e=Oo(t.mapValue.fields.__local_write_time__.timestampValue);return new vn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KL{constructor(e,n,r,s,i,a,u,d,m){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=d,this.useFetchStreams=m}}class Zl{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new Zl("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Zl&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _a={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},bm={nullValue:"NULL_VALUE"};function Ua(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?vp(t)?4:gN(t)?9007199254740991:Ap(t)?10:11:ke()}function Wi(t,e){if(t===e)return!0;const n=Ua(t);if(n!==Ua(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return lf(t).isEqual(lf(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=Oo(s.timestampValue),u=Oo(i.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return Mo(s.bytesValue).isEqual(Mo(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return hn(s.geoPointValue.latitude)===hn(i.geoPointValue.latitude)&&hn(s.geoPointValue.longitude)===hn(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return hn(s.integerValue)===hn(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=hn(s.doubleValue),u=hn(i.doubleValue);return a===u?af(a)===af(u):isNaN(a)&&isNaN(u)}return!1}(t,e);case 9:return ku(t.arrayValue.values||[],e.arrayValue.values||[],Wi);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},u=i.mapValue.fields||{};if(dA(a)!==dA(u))return!1;for(const d in a)if(a.hasOwnProperty(d)&&(u[d]===void 0||!Wi(a[d],u[d])))return!1;return!0}(t,e);default:return ke()}}function cf(t,e){return(t.values||[]).find(n=>Wi(n,e))!==void 0}function za(t,e){if(t===e)return 0;const n=Ua(t),r=Ua(e);if(n!==r)return Je(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Je(t.booleanValue,e.booleanValue);case 2:return function(i,a){const u=hn(i.integerValue||i.doubleValue),d=hn(a.integerValue||a.doubleValue);return u<d?-1:u>d?1:u===d?0:isNaN(u)?isNaN(d)?0:-1:1}(t,e);case 3:return mA(t.timestampValue,e.timestampValue);case 4:return mA(lf(t),lf(e));case 5:return Je(t.stringValue,e.stringValue);case 6:return function(i,a){const u=Mo(i),d=Mo(a);return u.compareTo(d)}(t.bytesValue,e.bytesValue);case 7:return function(i,a){const u=i.split("/"),d=a.split("/");for(let m=0;m<u.length&&m<d.length;m++){const y=Je(u[m],d[m]);if(y!==0)return y}return Je(u.length,d.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,a){const u=Je(hn(i.latitude),hn(a.latitude));return u!==0?u:Je(hn(i.longitude),hn(a.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return gA(t.arrayValue,e.arrayValue);case 10:return function(i,a){var u,d,m,y;const _=i.fields||{},E=a.fields||{},b=(u=_.value)===null||u===void 0?void 0:u.arrayValue,k=(d=E.value)===null||d===void 0?void 0:d.arrayValue,S=Je(((m=b==null?void 0:b.values)===null||m===void 0?void 0:m.length)||0,((y=k==null?void 0:k.values)===null||y===void 0?void 0:y.length)||0);return S!==0?S:gA(b,k)}(t.mapValue,e.mapValue);case 11:return function(i,a){if(i===_a.mapValue&&a===_a.mapValue)return 0;if(i===_a.mapValue)return 1;if(a===_a.mapValue)return-1;const u=i.fields||{},d=Object.keys(u),m=a.fields||{},y=Object.keys(m);d.sort(),y.sort();for(let _=0;_<d.length&&_<y.length;++_){const E=Je(d[_],y[_]);if(E!==0)return E;const b=za(u[d[_]],m[y[_]]);if(b!==0)return b}return Je(d.length,y.length)}(t.mapValue,e.mapValue);default:throw ke()}}function mA(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Je(t,e);const n=Oo(t),r=Oo(e),s=Je(n.seconds,r.seconds);return s!==0?s:Je(n.nanos,r.nanos)}function gA(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=za(n[s],r[s]);if(i)return i}return Je(n.length,r.length)}function Mu(t){return px(t)}function px(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=Oo(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Mo(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return Se.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=px(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${px(n.fields[a])}`;return s+"}"}(t.mapValue):ke()}function Im(t){switch(Ua(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ep(t);return e?16+Im(e):16;case 5:return 2*t.stringValue.length;case 6:return Mo(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Im(i),0)}(t.arrayValue);case 10:case 11:return function(r){let s=0;return ol(r.fields,(i,a)=>{s+=i.length+Im(a)}),s}(t.mapValue);default:throw ke()}}function Jl(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function yx(t){return!!t&&"integerValue"in t}function uf(t){return!!t&&"arrayValue"in t}function pA(t){return!!t&&"nullValue"in t}function yA(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Cm(t){return!!t&&"mapValue"in t}function Ap(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function bd(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ol(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=bd(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=bd(t.arrayValue.values[n]);return e}return Object.assign({},t)}function gN(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const pN={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function QL(t){return"nullValue"in t?bm:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?Jl(Zl.empty(),Se.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?Ap(t)?pN:{mapValue:{}}:ke()}function XL(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?Jl(Zl.empty(),Se.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?pN:"mapValue"in t?Ap(t)?{mapValue:{}}:_a:ke()}function xA(t,e){const n=za(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function wA(t,e){const n=za(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(e){this.value=e}static empty(){return new Cr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Cm(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=bd(n)}setAll(e){let n=fn.emptyPath(),r={},s=[];e.forEach((a,u)=>{if(!n.isImmediateParentOf(u)){const d=this.getFieldsMap(n);this.applyChanges(d,r,s),r={},s=[],n=u.popLast()}a?r[u.lastSegment()]=bd(a):s.push(u.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());Cm(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Wi(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Cm(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){ol(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Cr(bd(this.value))}}function yN(t){const e=[];return ol(t.fields,(n,r)=>{const s=new fn([n]);if(Cm(r)){const i=yN(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new ms(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(e,n,r,s,i,a,u){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=u}static newInvalidDocument(e){return new rn(e,0,Ue.min(),Ue.min(),Ue.min(),Cr.empty(),0)}static newFoundDocument(e,n,r,s){return new rn(e,1,n,Ue.min(),r,s,0)}static newNoDocument(e,n){return new rn(e,2,n,Ue.min(),Ue.min(),Cr.empty(),0)}static newUnknownDocument(e,n){return new rn(e,3,n,Ue.min(),Ue.min(),Cr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Ue.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Cr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Cr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ue.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof rn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new rn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ga{constructor(e,n){this.position=e,this.inclusive=n}}function _A(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],a=t.position[s];if(i.field.isKeyField()?r=Se.comparator(Se.fromName(a.referenceValue),n.key):r=za(a,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function vA(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Wi(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf{constructor(e,n="asc"){this.field=e,this.dir=n}}function YL(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xN{}class xt extends xN{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new ZL(e,n,r):n==="array-contains"?new t9(e,r):n==="in"?new bN(e,r):n==="not-in"?new n9(e,r):n==="array-contains-any"?new r9(e,r):new xt(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new JL(e,r):new e9(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(za(n,this.value)):n!==null&&Ua(this.value)===Ua(n)&&this.matchesComparison(za(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ke()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Mt extends xN{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new Mt(e,n)}matches(e){return Lu(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Lu(t){return t.op==="and"}function xx(t){return t.op==="or"}function O_(t){return wN(t)&&Lu(t)}function wN(t){for(const e of t.filters)if(e instanceof Mt)return!1;return!0}function wx(t){if(t instanceof xt)return t.field.canonicalString()+t.op.toString()+Mu(t.value);if(O_(t))return t.filters.map(e=>wx(e)).join(",");{const e=t.filters.map(n=>wx(n)).join(",");return`${t.op}(${e})`}}function _N(t,e){return t instanceof xt?function(r,s){return s instanceof xt&&r.op===s.op&&r.field.isEqual(s.field)&&Wi(r.value,s.value)}(t,e):t instanceof Mt?function(r,s){return s instanceof Mt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,u)=>i&&_N(a,s.filters[u]),!0):!1}(t,e):void ke()}function vN(t,e){const n=t.filters.concat(e);return Mt.create(n,t.op)}function EN(t){return t instanceof xt?function(n){return`${n.field.canonicalString()} ${n.op} ${Mu(n.value)}`}(t):t instanceof Mt?function(n){return n.op.toString()+" {"+n.getFilters().map(EN).join(" ,")+"}"}(t):"Filter"}class ZL extends xt{constructor(e,n,r){super(e,n,r),this.key=Se.fromName(r.referenceValue)}matches(e){const n=Se.comparator(e.key,this.key);return this.matchesComparison(n)}}class JL extends xt{constructor(e,n){super(e,"in",n),this.keys=AN("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class e9 extends xt{constructor(e,n){super(e,"not-in",n),this.keys=AN("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function AN(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>Se.fromName(r.referenceValue))}class t9 extends xt{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return uf(n)&&cf(n.arrayValue,this.value)}}class bN extends xt{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&cf(this.value.arrayValue,n)}}class n9 extends xt{constructor(e,n){super(e,"not-in",n)}matches(e){if(cf(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!cf(this.value.arrayValue,n)}}class r9 extends xt{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!uf(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>cf(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s9{constructor(e,n=null,r=[],s=[],i=null,a=null,u=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=u,this.ue=null}}function _x(t,e=null,n=[],r=[],s=null,i=null,a=null){return new s9(t,e,n,r,s,i,a)}function ec(t){const e=Ie(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>wx(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Vf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Mu(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Mu(r)).join(",")),e.ue=n}return e.ue}function Uf(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!YL(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!_N(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!vA(t.startAt,e.startAt)&&vA(t.endAt,e.endAt)}function wg(t){return Se.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function _g(t,e){return t.filters.filter(n=>n instanceof xt&&n.field.isEqual(e))}function EA(t,e,n){let r=bm,s=!0;for(const i of _g(t,e)){let a=bm,u=!0;switch(i.op){case"<":case"<=":a=QL(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,u=!1;break;case"!=":case"not-in":a=bm}xA({value:r,inclusive:s},{value:a,inclusive:u})<0&&(r=a,s=u)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const a=n.position[i];xA({value:r,inclusive:s},{value:a,inclusive:n.inclusive})<0&&(r=a,s=n.inclusive);break}}return{value:r,inclusive:s}}function AA(t,e,n){let r=_a,s=!0;for(const i of _g(t,e)){let a=_a,u=!0;switch(i.op){case">=":case">":a=XL(i.value),u=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,u=!1;break;case"!=":case"not-in":a=_a}wA({value:r,inclusive:s},{value:a,inclusive:u})>0&&(r=a,s=u)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const a=n.position[i];wA({value:r,inclusive:s},{value:a,inclusive:n.inclusive})>0&&(r=a,s=n.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(e,n=null,r=[],s=[],i=null,a="F",u=null,d=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=u,this.endAt=d,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function IN(t,e,n,r,s,i,a,u){return new Bo(t,e,n,r,s,i,a,u)}function ch(t){return new Bo(t)}function bA(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function M_(t){return t.collectionGroup!==null}function _u(t){const e=Ie(t);if(e.ce===null){e.ce=[];const n=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new Ut(fn.comparator);return a.filters.forEach(d=>{d.getFlattenedFilters().forEach(m=>{m.isInequality()&&(u=u.add(m.field))})}),u})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.ce.push(new hf(i,r))}),n.has(fn.keyField().canonicalString())||e.ce.push(new hf(fn.keyField(),r))}return e.ce}function Gr(t){const e=Ie(t);return e.le||(e.le=TN(e,_u(t))),e.le}function CN(t){const e=Ie(t);return e.he||(e.he=TN(e,t.explicitOrderBy)),e.he}function TN(t,e){if(t.limitType==="F")return _x(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new hf(s.field,i)});const n=t.endAt?new Ga(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Ga(t.startAt.position,t.startAt.inclusive):null;return _x(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function vx(t,e){const n=t.filters.concat([e]);return new Bo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function vg(t,e,n){return new Bo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function zf(t,e){return Uf(Gr(t),Gr(e))&&t.limitType===e.limitType}function SN(t){return`${ec(Gr(t))}|lt:${t.limitType}`}function $c(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>EN(s)).join(", ")}]`),Vf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Mu(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Mu(s)).join(",")),`Target(${r})`}(Gr(t))}; limitType=${t.limitType})`}function Gf(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Se.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of _u(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(a,u,d){const m=_A(a,u,d);return a.inclusive?m<=0:m<0}(r.startAt,_u(r),s)||r.endAt&&!function(a,u,d){const m=_A(a,u,d);return a.inclusive?m>=0:m>0}(r.endAt,_u(r),s))}(t,e)}function NN(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function RN(t){return(e,n)=>{let r=!1;for(const s of _u(t)){const i=i9(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function i9(t,e,n){const r=t.field.isKeyField()?Se.comparator(e.key,n.key):function(i,a,u){const d=a.data.field(i),m=u.data.field(i);return d!==null&&m!==null?za(d,m):ke()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ke()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){ol(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return fN(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o9=new Jt(Se.comparator);function gs(){return o9}const PN=new Jt(Se.comparator);function ld(...t){let e=PN;for(const n of t)e=e.insert(n.key,n);return e}function kN(t){let e=PN;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Li(){return Id()}function DN(){return Id()}function Id(){return new Vo(t=>t.toString(),(t,e)=>t.isEqual(e))}const a9=new Jt(Se.comparator),l9=new Ut(Se.comparator);function st(...t){let e=l9;for(const n of t)e=e.add(n);return e}const c9=new Ut(Je);function L_(){return c9}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j_(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:af(e)?"-0":e}}function ON(t){return{integerValue:""+t}}function MN(t,e){return aN(e)?ON(e):j_(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp{constructor(){this._=void 0}}function u9(t,e,n){return t instanceof ju?function(s,i){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&vp(i)&&(i=Ep(i)),i&&(a.fields.__previous_value__=i),{mapValue:a}}(n,e):t instanceof tc?jN(t,e):t instanceof nc?FN(t,e):function(s,i){const a=LN(s,i),u=IA(a)+IA(s.Pe);return yx(a)&&yx(s.Pe)?ON(u):j_(s.serializer,u)}(t,e)}function h9(t,e,n){return t instanceof tc?jN(t,e):t instanceof nc?FN(t,e):n}function LN(t,e){return t instanceof Fu?function(r){return yx(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class ju extends bp{}class tc extends bp{constructor(e){super(),this.elements=e}}function jN(t,e){const n=BN(e);for(const r of t.elements)n.some(s=>Wi(s,r))||n.push(r);return{arrayValue:{values:n}}}class nc extends bp{constructor(e){super(),this.elements=e}}function FN(t,e){let n=BN(e);for(const r of t.elements)n=n.filter(s=>!Wi(s,r));return{arrayValue:{values:n}}}class Fu extends bp{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function IA(t){return hn(t.integerValue||t.doubleValue)}function BN(t){return uf(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qf{constructor(e,n){this.field=e,this.transform=n}}function d9(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof tc&&s instanceof tc||r instanceof nc&&s instanceof nc?ku(r.elements,s.elements,Wi):r instanceof Fu&&s instanceof Fu?Wi(r.Pe,s.Pe):r instanceof ju&&s instanceof ju}(t.transform,e.transform)}class f9{constructor(e,n){this.version=e,this.transformResults=n}}class mn{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new mn}static exists(e){return new mn(void 0,e)}static updateTime(e){return new mn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Tm(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Ip{}function VN(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new hh(t.key,mn.none()):new uh(t.key,t.data,mn.none());{const n=t.data,r=Cr.empty();let s=new Ut(fn.comparator);for(let i of e.fields)if(!s.has(i)){let a=n.field(i);a===null&&i.length>1&&(i=i.popLast(),a=n.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Uo(t.key,r,new ms(s.toArray()),mn.none())}}function m9(t,e,n){t instanceof uh?function(s,i,a){const u=s.value.clone(),d=TA(s.fieldTransforms,i,a.transformResults);u.setAll(d),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(t,e,n):t instanceof Uo?function(s,i,a){if(!Tm(s.precondition,i))return void i.convertToUnknownDocument(a.version);const u=TA(s.fieldTransforms,i,a.transformResults),d=i.data;d.setAll(UN(s)),d.setAll(u),i.convertToFoundDocument(a.version,d).setHasCommittedMutations()}(t,e,n):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,n)}function Cd(t,e,n,r){return t instanceof uh?function(i,a,u,d){if(!Tm(i.precondition,a))return u;const m=i.value.clone(),y=SA(i.fieldTransforms,d,a);return m.setAll(y),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),null}(t,e,n,r):t instanceof Uo?function(i,a,u,d){if(!Tm(i.precondition,a))return u;const m=SA(i.fieldTransforms,d,a),y=a.data;return y.setAll(UN(i)),y.setAll(m),a.convertToFoundDocument(a.version,y).setHasLocalMutations(),u===null?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(_=>_.field))}(t,e,n,r):function(i,a,u){return Tm(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(t,e,n)}function g9(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=LN(r.transform,s||null);i!=null&&(n===null&&(n=Cr.empty()),n.set(r.field,i))}return n||null}function CA(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ku(r,s,(i,a)=>d9(i,a))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class uh extends Ip{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Uo extends Ip{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function UN(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function TA(t,e,n){const r=new Map;je(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],a=i.transform,u=e.data.field(i.field);r.set(i.field,h9(a,u,n[s]))}return r}function SA(t,e,n){const r=new Map;for(const s of t){const i=s.transform,a=n.data.field(s.field);r.set(s.field,u9(i,a,e))}return r}class hh extends Ip{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class F_ extends Ip{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B_{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&m9(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Cd(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Cd(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=DN();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let u=this.applyToLocalView(a,i.mutatedFields);u=n.has(s.key)?null:u;const d=VN(a,u);d!==null&&r.set(s.key,d),a.isValidDocument()||a.convertToNoDocument(Ue.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),st())}isEqual(e){return this.batchId===e.batchId&&ku(this.mutations,e.mutations,(n,r)=>CA(n,r))&&ku(this.baseMutations,e.baseMutations,(n,r)=>CA(n,r))}}class V_{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){je(e.mutations.length===r.length);let s=function(){return a9}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new V_(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U_{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zN{constructor(e,n,r){this.alias=e,this.aggregateType=n,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p9{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kn,It;function GN(t){switch(t){default:return ke();case ae.CANCELLED:case ae.UNKNOWN:case ae.DEADLINE_EXCEEDED:case ae.RESOURCE_EXHAUSTED:case ae.INTERNAL:case ae.UNAVAILABLE:case ae.UNAUTHENTICATED:return!1;case ae.INVALID_ARGUMENT:case ae.NOT_FOUND:case ae.ALREADY_EXISTS:case ae.PERMISSION_DENIED:case ae.FAILED_PRECONDITION:case ae.ABORTED:case ae.OUT_OF_RANGE:case ae.UNIMPLEMENTED:case ae.DATA_LOSS:return!0}}function qN(t){if(t===void 0)return Vn("GRPC error has no .code"),ae.UNKNOWN;switch(t){case Kn.OK:return ae.OK;case Kn.CANCELLED:return ae.CANCELLED;case Kn.UNKNOWN:return ae.UNKNOWN;case Kn.DEADLINE_EXCEEDED:return ae.DEADLINE_EXCEEDED;case Kn.RESOURCE_EXHAUSTED:return ae.RESOURCE_EXHAUSTED;case Kn.INTERNAL:return ae.INTERNAL;case Kn.UNAVAILABLE:return ae.UNAVAILABLE;case Kn.UNAUTHENTICATED:return ae.UNAUTHENTICATED;case Kn.INVALID_ARGUMENT:return ae.INVALID_ARGUMENT;case Kn.NOT_FOUND:return ae.NOT_FOUND;case Kn.ALREADY_EXISTS:return ae.ALREADY_EXISTS;case Kn.PERMISSION_DENIED:return ae.PERMISSION_DENIED;case Kn.FAILED_PRECONDITION:return ae.FAILED_PRECONDITION;case Kn.ABORTED:return ae.ABORTED;case Kn.OUT_OF_RANGE:return ae.OUT_OF_RANGE;case Kn.UNIMPLEMENTED:return ae.UNIMPLEMENTED;case Kn.DATA_LOSS:return ae.DATA_LOSS;default:return ke()}}(It=Kn||(Kn={}))[It.OK=0]="OK",It[It.CANCELLED=1]="CANCELLED",It[It.UNKNOWN=2]="UNKNOWN",It[It.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",It[It.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",It[It.NOT_FOUND=5]="NOT_FOUND",It[It.ALREADY_EXISTS=6]="ALREADY_EXISTS",It[It.PERMISSION_DENIED=7]="PERMISSION_DENIED",It[It.UNAUTHENTICATED=16]="UNAUTHENTICATED",It[It.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",It[It.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",It[It.ABORTED=10]="ABORTED",It[It.OUT_OF_RANGE=11]="OUT_OF_RANGE",It[It.UNIMPLEMENTED=12]="UNIMPLEMENTED",It[It.INTERNAL=13]="INTERNAL",It[It.UNAVAILABLE=14]="UNAVAILABLE",It[It.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Eg=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WN(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y9=new Bl([4294967295,4294967295],0);function NA(t){const e=WN().encode(t),n=new $S;return n.update(e),new Uint8Array(n.digest())}function RA(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Bl([n,r],0),new Bl([s,i],0)]}class z_{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new cd(`Invalid padding: ${n}`);if(r<0)throw new cd(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new cd(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new cd(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=Bl.fromNumber(this.Ie)}Ee(e,n,r){let s=e.add(n.multiply(Bl.fromNumber(r)));return s.compare(y9)===1&&(s=new Bl([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const n=NA(e),[r,s]=RA(n);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);if(!this.de(a))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new z_(i,s,n);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.Ie===0)return;const n=NA(e),[r,s]=RA(n);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);this.Ae(a)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class cd extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wf{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,$f.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new Wf(Ue.min(),s,new Jt(Je),gs(),st())}}class $f{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new $f(r,n,st(),st(),st())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm{constructor(e,n,r,s){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=s}}class $N{constructor(e,n){this.targetId=e,this.me=n}}class HN{constructor(e,n,r=kn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class PA{constructor(){this.fe=0,this.ge=DA(),this.pe=kn.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=st(),n=st(),r=st();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:ke()}}),new $f(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=DA()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,je(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class x9{constructor(e){this.Le=e,this.Be=new Map,this.ke=gs(),this.qe=kA(),this.Qe=new Jt(Je)}Ke(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{const r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:ke()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,s)=>{this.ze(s)&&n(s)})}He(e){const n=e.targetId,r=e.me.count,s=this.Je(n);if(s){const i=s.target;if(wg(i))if(r===0){const a=new Se(i.path);this.Ue(n,a,rn.newNoDocument(a,Ue.min()))}else je(r===1);else{const a=this.Ye(n);if(a!==r){const u=this.Ze(e),d=u?this.Xe(u,e,a):1;if(d!==0){this.je(n);const m=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,m)}Eg==null||Eg.et(function(y,_,E,b,k){var S,O,T,C,R,j;const K={localCacheCount:y,existenceFilterCount:_.count,databaseId:E.database,projectId:E.projectId},Q=_.unchangedNames;return Q&&(K.bloomFilter={applied:k===0,hashCount:(S=Q==null?void 0:Q.hashCount)!==null&&S!==void 0?S:0,bitmapLength:(C=(T=(O=Q==null?void 0:Q.bits)===null||O===void 0?void 0:O.bitmap)===null||T===void 0?void 0:T.length)!==null&&C!==void 0?C:0,padding:(j=(R=Q==null?void 0:Q.bits)===null||R===void 0?void 0:R.padding)!==null&&j!==void 0?j:0,mightContain:D=>{var B;return(B=b==null?void 0:b.mightContain(D))!==null&&B!==void 0&&B}}),K}(a,e.me,this.Le.tt(),u,d))}}}}Ze(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let a,u;try{a=Mo(r).toUint8Array()}catch(d){if(d instanceof mN)return Ks("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{u=new z_(a,s,i)}catch(d){return Ks(d instanceof cd?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return u.Ie===0?null:u}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(u)||(this.Ue(n,i,null),s++)}),s}rt(e){const n=new Map;this.Be.forEach((i,a)=>{const u=this.Je(a);if(u){if(i.current&&wg(u.target)){const d=new Se(u.target.path);this.ke.get(d)!==null||this.it(a,d)||this.Ue(a,d,rn.newNoDocument(d,e))}i.be&&(n.set(a,i.ve()),i.Ce())}});let r=st();this.qe.forEach((i,a)=>{let u=!0;a.forEachWhile(d=>{const m=this.Je(d);return!m||m.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(i))}),this.ke.forEach((i,a)=>a.setReadTime(e));const s=new Wf(e,n,this.Qe,this.ke,r);return this.ke=gs(),this.qe=kA(),this.Qe=new Jt(Je),s}$e(e,n){if(!this.ze(e))return;const r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,n)?s.Fe(n,1):s.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const n=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new PA,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new Ut(Je),this.qe=this.qe.insert(e,n)),n}ze(e){const n=this.Je(e)!==null;return n||me("WatchChangeAggregator","Detected inactive target",e),n}Je(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new PA),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function kA(){return new Jt(Se.comparator)}function DA(){return new Jt(Se.comparator)}const w9=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),_9=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),v9=(()=>({and:"AND",or:"OR"}))();class E9{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Ex(t,e){return t.useProto3Json||Vf(e)?e:{value:e}}function Bu(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function KN(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function A9(t,e){return Bu(t,e.toTimestamp())}function zn(t){return je(!!t),Ue.fromTimestamp(function(n){const r=Oo(n);return new vn(r.seconds,r.nanos)}(t))}function G_(t,e){return Ax(t,e).canonicalString()}function Ax(t,e){const n=function(s){return new yt(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function QN(t){const e=yt.fromString(t);return je(iR(e)),e}function df(t,e){return G_(t.databaseId,e.path)}function Gi(t,e){const n=QN(e);if(n.get(1)!==t.databaseId.projectId)throw new ge(ae.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ge(ae.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Se(ZN(n))}function XN(t,e){return G_(t.databaseId,e)}function YN(t){const e=QN(t);return e.length===4?yt.emptyPath():ZN(e)}function bx(t){return new yt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ZN(t){return je(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function OA(t,e,n){return{name:df(t,e),fields:n.value.mapValue.fields}}function JN(t,e,n){const r=Gi(t,e.name),s=zn(e.updateTime),i=e.createTime?zn(e.createTime):Ue.min(),a=new Cr({mapValue:{fields:e.fields}}),u=rn.newFoundDocument(r,s,i,a);return n&&u.setHasCommittedMutations(),n?u.setHasCommittedMutations():u}function b9(t,e){return"found"in e?function(r,s){je(!!s.found),s.found.name,s.found.updateTime;const i=Gi(r,s.found.name),a=zn(s.found.updateTime),u=s.found.createTime?zn(s.found.createTime):Ue.min(),d=new Cr({mapValue:{fields:s.found.fields}});return rn.newFoundDocument(i,a,u,d)}(t,e):"missing"in e?function(r,s){je(!!s.missing),je(!!s.readTime);const i=Gi(r,s.missing),a=zn(s.readTime);return rn.newNoDocument(i,a)}(t,e):ke()}function I9(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:ke()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(m,y){return m.useProto3Json?(je(y===void 0||typeof y=="string"),kn.fromBase64String(y||"")):(je(y===void 0||y instanceof Buffer||y instanceof Uint8Array),kn.fromUint8Array(y||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(m){const y=m.code===void 0?ae.UNKNOWN:qN(m.code);return new ge(y,m.message||"")}(a);n=new HN(r,s,i,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Gi(t,r.document.name),i=zn(r.document.updateTime),a=r.document.createTime?zn(r.document.createTime):Ue.min(),u=new Cr({mapValue:{fields:r.document.fields}}),d=rn.newFoundDocument(s,i,a,u),m=r.targetIds||[],y=r.removedTargetIds||[];n=new Sm(m,y,d.key,d)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Gi(t,r.document),i=r.readTime?zn(r.readTime):Ue.min(),a=rn.newNoDocument(s,i),u=r.removedTargetIds||[];n=new Sm([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Gi(t,r.document),i=r.removedTargetIds||[];n=new Sm([],i,s,null)}else{if(!("filter"in e))return ke();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new p9(s,i),u=r.targetId;n=new $N(u,a)}}return n}function ff(t,e){let n;if(e instanceof uh)n={update:OA(t,e.key,e.value)};else if(e instanceof hh)n={delete:df(t,e.key)};else if(e instanceof Uo)n={update:OA(t,e.key,e.data),updateMask:P9(e.fieldMask)};else{if(!(e instanceof F_))return ke();n={verify:df(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,a){const u=a.transform;if(u instanceof ju)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof tc)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof nc)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Fu)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw ke()}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:A9(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ke()}(t,e.precondition)),n}function Ix(t,e){const n=e.currentDocument?function(i){return i.updateTime!==void 0?mn.updateTime(zn(i.updateTime)):i.exists!==void 0?mn.exists(i.exists):mn.none()}(e.currentDocument):mn.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(a,u){let d=null;if("setToServerValue"in u)je(u.setToServerValue==="REQUEST_TIME"),d=new ju;else if("appendMissingElements"in u){const y=u.appendMissingElements.values||[];d=new tc(y)}else if("removeAllFromArray"in u){const y=u.removeAllFromArray.values||[];d=new nc(y)}else"increment"in u?d=new Fu(a,u.increment):ke();const m=fn.fromServerFormat(u.fieldPath);return new qf(m,d)}(t,s)):[];if(e.update){e.update.name;const s=Gi(t,e.update.name),i=new Cr({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=function(d){const m=d.fieldPaths||[];return new ms(m.map(y=>fn.fromServerFormat(y)))}(e.updateMask);return new Uo(s,i,a,n,r)}return new uh(s,i,n,r)}if(e.delete){const s=Gi(t,e.delete);return new hh(s,n)}if(e.verify){const s=Gi(t,e.verify);return new F_(s,n)}return ke()}function C9(t,e){return t&&t.length>0?(je(e!==void 0),t.map(n=>function(s,i){let a=s.updateTime?zn(s.updateTime):zn(i);return a.isEqual(Ue.min())&&(a=zn(i)),new f9(a,s.transformResults||[])}(n,e))):[]}function eR(t,e){return{documents:[XN(t,e.path)]}}function Cp(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=XN(t,s);const i=function(m){if(m.length!==0)return sR(Mt.create(m,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const a=function(m){if(m.length!==0)return m.map(y=>function(E){return{field:ha(E.field),direction:S9(E.dir)}}(y))}(e.orderBy);a&&(n.structuredQuery.orderBy=a);const u=Ex(t,e.limit);return u!==null&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=function(m){return{before:m.inclusive,values:m.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(m){return{before:!m.inclusive,values:m.position}}(e.endAt)),{_t:n,parent:s}}function tR(t,e,n,r){const{_t:s,parent:i}=Cp(t,e),a={},u=[];let d=0;return n.forEach(m=>{const y=r?m.alias:"aggregate_"+d++;a[y]=m.alias,m.aggregateType==="count"?u.push({alias:y,count:{}}):m.aggregateType==="avg"?u.push({alias:y,avg:{field:ha(m.fieldPath)}}):m.aggregateType==="sum"&&u.push({alias:y,sum:{field:ha(m.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:u,structuredQuery:s.structuredQuery},parent:s.parent},ut:a,parent:i}}function nR(t){let e=YN(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){je(r===1);const y=n.from[0];y.allDescendants?s=y.collectionId:e=e.child(y.collectionId)}let i=[];n.where&&(i=function(_){const E=rR(_);return E instanceof Mt&&O_(E)?E.getFilters():[E]}(n.where));let a=[];n.orderBy&&(a=function(_){return _.map(E=>function(k){return new hf(Hc(k.field),function(O){switch(O){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(E))}(n.orderBy));let u=null;n.limit&&(u=function(_){let E;return E=typeof _=="object"?_.value:_,Vf(E)?null:E}(n.limit));let d=null;n.startAt&&(d=function(_){const E=!!_.before,b=_.values||[];return new Ga(b,E)}(n.startAt));let m=null;return n.endAt&&(m=function(_){const E=!_.before,b=_.values||[];return new Ga(b,E)}(n.endAt)),IN(e,s,a,i,u,"F",d,m)}function T9(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ke()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function rR(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Hc(n.unaryFilter.field);return xt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Hc(n.unaryFilter.field);return xt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Hc(n.unaryFilter.field);return xt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Hc(n.unaryFilter.field);return xt.create(a,"!=",{nullValue:"NULL_VALUE"});default:return ke()}}(t):t.fieldFilter!==void 0?function(n){return xt.create(Hc(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ke()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Mt.create(n.compositeFilter.filters.map(r=>rR(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ke()}}(n.compositeFilter.op))}(t):ke()}function S9(t){return w9[t]}function N9(t){return _9[t]}function R9(t){return v9[t]}function ha(t){return{fieldPath:t.canonicalString()}}function Hc(t){return fn.fromServerFormat(t.fieldPath)}function sR(t){return t instanceof xt?function(n){if(n.op==="=="){if(yA(n.value))return{unaryFilter:{field:ha(n.field),op:"IS_NAN"}};if(pA(n.value))return{unaryFilter:{field:ha(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(yA(n.value))return{unaryFilter:{field:ha(n.field),op:"IS_NOT_NAN"}};if(pA(n.value))return{unaryFilter:{field:ha(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ha(n.field),op:N9(n.op),value:n.value}}}(t):t instanceof Mt?function(n){const r=n.getFilters().map(s=>sR(s));return r.length===1?r[0]:{compositeFilter:{op:R9(n.op),filters:r}}}(t):ke()}function P9(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function iR(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(e,n,r,s,i=Ue.min(),a=Ue.min(),u=kn.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=d}withSequenceNumber(e){return new _o(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new _o(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new _o(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new _o(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oR{constructor(e){this.ct=e}}function k9(t,e){let n;if(e.document)n=JN(t.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Se.fromSegments(e.noDocument.path),s=sc(e.noDocument.readTime);n=rn.newNoDocument(r,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return ke();{const r=Se.fromSegments(e.unknownDocument.path),s=sc(e.unknownDocument.version);n=rn.newUnknownDocument(r,s)}}return e.readTime&&n.setReadTime(function(s){const i=new vn(s[0],s[1]);return Ue.fromTimestamp(i)}(e.readTime)),n}function MA(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Ag(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,a){return{name:df(i,a.key),fields:a.data.value.mapValue.fields,updateTime:Bu(i,a.version.toTimestamp()),createTime:Bu(i,a.createTime.toTimestamp())}}(t.ct,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:rc(e.version)};else{if(!e.isUnknownDocument())return ke();r.unknownDocument={path:n.path.toArray(),version:rc(e.version)}}return r}function Ag(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function rc(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function sc(t){const e=new vn(t.seconds,t.nanoseconds);return Ue.fromTimestamp(e)}function Sl(t,e){const n=(e.baseMutations||[]).map(i=>Ix(t.ct,i));for(let i=0;i<e.mutations.length-1;++i){const a=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const u=e.mutations[i+1];a.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Ix(t.ct,i)),s=vn.fromMillis(e.localWriteTimeMs);return new B_(e.batchId,s,n,r)}function ud(t){const e=sc(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?sc(t.lastLimboFreeSnapshotVersion):Ue.min();let r;return r=function(i){return i.documents!==void 0}(t.query)?function(i){return je(i.documents.length===1),Gr(ch(YN(i.documents[0])))}(t.query):function(i){return Gr(nR(i))}(t.query),new _o(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,kn.fromBase64String(t.resumeToken))}function aR(t,e){const n=rc(e.snapshotVersion),r=rc(e.lastLimboFreeSnapshotVersion);let s;s=wg(e.target)?eR(t.ct,e.target):Cp(t.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ec(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function q_(t){const e=nR({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?vg(e,e.limit,"L"):e}function j1(t,e){return new U_(e.largestBatchId,Ix(t.ct,e.overlayMutation))}function LA(t,e){const n=e.path.lastSegment();return[t,zr(e.path.popLast()),n]}function jA(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:rc(r.readTime),documentKey:zr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D9{getBundleMetadata(e,n){return FA(e).get(n).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:sc(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,n){return FA(e).put(function(s){return{bundleId:s.id,createTime:rc(zn(s.createTime)),version:s.version}}(n))}getNamedQuery(e,n){return BA(e).get(n).next(r=>{if(r)return function(i){return{name:i.name,query:q_(i.bundledQuery),readTime:sc(i.readTime)}}(r)})}saveNamedQuery(e,n){return BA(e).put(function(s){return{name:s.name,readTime:rc(zn(s.readTime)),bundledQuery:s.bundledQuery}}(n))}}function FA(t){return dr(t,"bundles")}function BA(t){return dr(t,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp{constructor(e,n){this.serializer=e,this.userId=n}static lt(e,n){const r=n.uid||"";return new Tp(e,r)}getOverlay(e,n){return Hh(e).get(LA(this.userId,n)).next(r=>r?j1(this.serializer,r):null)}getOverlays(e,n){const r=Li();return ne.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){const s=[];return r.forEach((i,a)=>{const u=new U_(n,a);s.push(this.ht(e,u))}),ne.waitFor(s)}removeOverlaysForBatchId(e,n,r){const s=new Set;n.forEach(a=>s.add(zr(a.getCollectionPath())));const i=[];return s.forEach(a=>{const u=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);i.push(Hh(e).j("collectionPathOverlayIndex",u))}),ne.waitFor(i)}getOverlaysForCollection(e,n,r){const s=Li(),i=zr(n),a=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Hh(e).U("collectionPathOverlayIndex",a).next(u=>{for(const d of u){const m=j1(this.serializer,d);s.set(m.getKey(),m)}return s})}getOverlaysForCollectionGroup(e,n,r,s){const i=Li();let a;const u=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return Hh(e).J({index:"collectionGroupOverlayIndex",range:u},(d,m,y)=>{const _=j1(this.serializer,m);i.size()<s||_.largestBatchId===a?(i.set(_.getKey(),_),a=_.largestBatchId):y.done()}).next(()=>i)}ht(e,n){return Hh(e).put(function(s,i,a){const[u,d,m]=LA(i,a.mutation.key);return{userId:i,collectionPath:d,documentId:m,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:ff(s.ct,a.mutation)}}(this.serializer,this.userId,n))}}function Hh(t){return dr(t,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O9{Pt(e){return dr(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(n=>{const r=n==null?void 0:n.value;return r?kn.fromUint8Array(r):kn.EMPTY_BYTE_STRING})}setSessionToken(e,n){return this.Pt(e).put({name:"sessionToken",value:n.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nl{constructor(){}It(e,n){this.Tt(e,n),n.Et()}Tt(e,n){if("nullValue"in e)this.dt(n,5);else if("booleanValue"in e)this.dt(n,10),n.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(n,15),n.At(hn(e.integerValue));else if("doubleValue"in e){const r=hn(e.doubleValue);isNaN(r)?this.dt(n,13):(this.dt(n,15),af(r)?n.At(0):n.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(n,20),typeof r=="string"&&(r=Oo(r)),n.Rt(`${r.seconds||""}`),n.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,n),this.ft(n);else if("bytesValue"in e)this.dt(n,30),n.gt(Mo(e.bytesValue)),this.ft(n);else if("referenceValue"in e)this.yt(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(n,45),n.At(r.latitude||0),n.At(r.longitude||0)}else"mapValue"in e?gN(e)?this.dt(n,Number.MAX_SAFE_INTEGER):Ap(e)?this.wt(e.mapValue,n):(this.St(e.mapValue,n),this.ft(n)):"arrayValue"in e?(this.bt(e.arrayValue,n),this.ft(n)):ke()}Vt(e,n){this.dt(n,25),this.Dt(e,n)}Dt(e,n){n.Rt(e)}St(e,n){const r=e.fields||{};this.dt(n,55);for(const s of Object.keys(r))this.Vt(s,n),this.Tt(r[s],n)}wt(e,n){var r,s;const i=e.fields||{};this.dt(n,53);const a="value",u=((s=(r=i[a].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(n,15),n.At(hn(u)),this.Vt(a,n),this.Tt(i[a],n)}bt(e,n){const r=e.values||[];this.dt(n,50);for(const s of r)this.Tt(s,n)}yt(e,n){this.dt(n,37),Se.fromName(e).path.forEach(r=>{this.dt(n,60),this.Dt(r,n)})}dt(e,n){e.At(n)}ft(e){e.At(2)}}Nl.vt=new Nl;function M9(t){if(t===0)return 8;let e=0;return!(t>>4)&&(e+=4,t<<=4),!(t>>6)&&(e+=2,t<<=2),!(t>>7)&&(e+=1),e}function VA(t){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const a=M9(255&r[i]);if(s+=a,a!==8)break}return s}(t);return Math.ceil(e/8)}class L9{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Ft(r.value),r=n.next();this.Mt()}xt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Ot(r.value),r=n.next();this.Nt()}Lt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=n.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=n.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const n=this.qt(e),r=VA(n);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=255&n[s]}Kt(e){const n=this.qt(e),r=VA(n);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=~(255&n[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const n=function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(e),r=(128&n[0])!=0;n[0]^=r?255:128;for(let s=1;s<n.length;++s)n[s]^=r?255:0;return n}Ft(e){const n=255&e;n===0?(this.Ut(0),this.Ut(255)):n===255?(this.Ut(255),this.Ut(0)):this.Ut(n)}Ot(e){const n=255&e;n===0?(this.Gt(0),this.Gt(255)):n===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class j9{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class F9{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Kh{constructor(){this.jt=new L9,this.Ht=new j9(this.jt),this.Jt=new F9(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rl{constructor(e,n,r,s){this.indexId=e,this.documentKey=n,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,n=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Rl(this.indexId,this.documentKey,this.arrayValue,r)}}function Zo(t,e){let n=t.indexId-e.indexId;return n!==0?n:(n=UA(t.arrayValue,e.arrayValue),n!==0?n:(n=UA(t.directionalValue,e.directionalValue),n!==0?n:Se.comparator(t.documentKey,e.documentKey)))}function UA(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zA{constructor(e){this.Xt=new Ut((n,r)=>fn.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const n of e.filters){const r=n;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(je(e.collectionGroup===this.collectionId),this.nn)return!1;const n=mx(e);if(n!==void 0&&!this.sn(n))return!1;const r=Cl(e);let s=new Set,i=0,a=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const u=this.Xt.getIterator().getNext();if(!s.has(u.field.canonicalString())){const d=r[i];if(!this.on(u,d)||!this._n(this.en[a++],d))return!1}++i}for(;i<r.length;++i){const u=r[i];if(a>=this.en.length||!this._n(this.en[a++],u))return!1}return!0}an(){if(this.nn)return null;let e=new Ut(fn.comparator);const n=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new Vl(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new Vl(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new Vl(r.field,r.dir==="asc"?0:1)));return new Du(Du.UNKNOWN_ID,this.collectionId,n,Ou.empty())}sn(e){for(const n of this.tn)if(this.on(n,e))return!0;return!1}on(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}_n(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lR(t){var e,n;if(je(t instanceof xt||t instanceof Mt),t instanceof xt){if(t instanceof bN){const s=((n=(e=t.value.arrayValue)===null||e===void 0?void 0:e.values)===null||n===void 0?void 0:n.map(i=>xt.create(t.field,"==",i)))||[];return Mt.create(s,"or")}return t}const r=t.filters.map(s=>lR(s));return Mt.create(r,t.op)}function B9(t){if(t.getFilters().length===0)return[];const e=Sx(lR(t));return je(cR(e)),Cx(e)||Tx(e)?[e]:e.getFilters()}function Cx(t){return t instanceof xt}function Tx(t){return t instanceof Mt&&O_(t)}function cR(t){return Cx(t)||Tx(t)||function(n){if(n instanceof Mt&&xx(n)){for(const r of n.getFilters())if(!Cx(r)&&!Tx(r))return!1;return!0}return!1}(t)}function Sx(t){if(je(t instanceof xt||t instanceof Mt),t instanceof xt)return t;if(t.filters.length===1)return Sx(t.filters[0]);const e=t.filters.map(r=>Sx(r));let n=Mt.create(e,t.op);return n=bg(n),cR(n)?n:(je(n instanceof Mt),je(Lu(n)),je(n.filters.length>1),n.filters.reduce((r,s)=>W_(r,s)))}function W_(t,e){let n;return je(t instanceof xt||t instanceof Mt),je(e instanceof xt||e instanceof Mt),n=t instanceof xt?e instanceof xt?function(s,i){return Mt.create([s,i],"and")}(t,e):GA(t,e):e instanceof xt?GA(e,t):function(s,i){if(je(s.filters.length>0&&i.filters.length>0),Lu(s)&&Lu(i))return vN(s,i.getFilters());const a=xx(s)?s:i,u=xx(s)?i:s,d=a.filters.map(m=>W_(m,u));return Mt.create(d,"or")}(t,e),bg(n)}function GA(t,e){if(Lu(e))return vN(e,t.getFilters());{const n=e.filters.map(r=>W_(t,r));return Mt.create(n,"or")}}function bg(t){if(je(t instanceof xt||t instanceof Mt),t instanceof xt)return t;const e=t.getFilters();if(e.length===1)return bg(e[0]);if(wN(t))return t;const n=e.map(s=>bg(s)),r=[];return n.forEach(s=>{s instanceof xt?r.push(s):s instanceof Mt&&(s.op===t.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Mt.create(r,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V9{constructor(){this.un=new $_}addToCollectionParentIndex(e,n){return this.un.add(n),ne.resolve()}getCollectionParents(e,n){return ne.resolve(this.un.getEntries(n))}addFieldIndex(e,n){return ne.resolve()}deleteFieldIndex(e,n){return ne.resolve()}deleteAllFieldIndexes(e){return ne.resolve()}createTargetIndexes(e,n){return ne.resolve()}getDocumentsMatchingTarget(e,n){return ne.resolve(null)}getIndexType(e,n){return ne.resolve(0)}getFieldIndexes(e,n){return ne.resolve([])}getNextCollectionGroupToUpdate(e){return ne.resolve(null)}getMinOffset(e,n){return ne.resolve(ks.min())}getMinOffsetFromCollectionGroup(e,n){return ne.resolve(ks.min())}updateCollectionGroup(e,n,r){return ne.resolve()}updateIndexEntries(e,n){return ne.resolve()}}class $_{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new Ut(yt.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Ut(yt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z0=new Uint8Array(0);class U9{constructor(e,n){this.databaseId=n,this.cn=new $_,this.ln=new Vo(r=>ec(r),(r,s)=>Uf(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.cn.has(n)){const r=n.lastSegment(),s=n.popLast();e.addOnCommittedListener(()=>{this.cn.add(n)});const i={collectionId:r,parent:zr(s)};return qA(e).put(i)}return ne.resolve()}getCollectionParents(e,n){const r=[],s=IDBKeyRange.bound([n,""],[tN(n),""],!1,!0);return qA(e).U(s).next(i=>{for(const a of i){if(a.collectionId!==n)break;r.push(Mi(a.parent))}return r})}addFieldIndex(e,n){const r=Qh(e),s=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(d=>[d.fieldPath.canonicalString(),d.kind])}}(n);delete s.indexId;const i=r.add(s);if(n.indexState){const a=Vc(e);return i.next(u=>{a.put(jA(u,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return i.next()}deleteFieldIndex(e,n){const r=Qh(e),s=Vc(e),i=Bc(e);return r.delete(n.indexId).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const n=Qh(e),r=Bc(e),s=Vc(e);return n.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,n){return ne.forEach(this.hn(n),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new zA(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,n){const r=Bc(e);let s=!0;const i=new Map;return ne.forEach(this.hn(n),a=>this.Pn(e,a).next(u=>{s&&(s=!!u),i.set(a,u)})).next(()=>{if(s){let a=st();const u=[];return ne.forEach(i,(d,m)=>{me("IndexedDbIndexManager",`Using index ${function(R){return`id=${R.indexId}|cg=${R.collectionGroup}|f=${R.fields.map(j=>`${j.fieldPath}:${j.kind}`).join(",")}`}(d)} to execute ${ec(n)}`);const y=function(R,j){const K=mx(j);if(K===void 0)return null;for(const Q of _g(R,K.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null}(m,d),_=function(R,j){const K=new Map;for(const Q of Cl(j))for(const D of _g(R,Q.fieldPath))switch(D.op){case"==":case"in":K.set(Q.fieldPath.canonicalString(),D.value);break;case"not-in":case"!=":return K.set(Q.fieldPath.canonicalString(),D.value),Array.from(K.values())}return null}(m,d),E=function(R,j){const K=[];let Q=!0;for(const D of Cl(j)){const B=D.kind===0?EA(R,D.fieldPath,R.startAt):AA(R,D.fieldPath,R.startAt);K.push(B.value),Q&&(Q=B.inclusive)}return new Ga(K,Q)}(m,d),b=function(R,j){const K=[];let Q=!0;for(const D of Cl(j)){const B=D.kind===0?AA(R,D.fieldPath,R.endAt):EA(R,D.fieldPath,R.endAt);K.push(B.value),Q&&(Q=B.inclusive)}return new Ga(K,Q)}(m,d),k=this.In(d,m,E),S=this.In(d,m,b),O=this.Tn(d,m,_),T=this.En(d.indexId,y,k,E.inclusive,S,b.inclusive,O);return ne.forEach(T,C=>r.G(C,n.limit).next(R=>{R.forEach(j=>{const K=Se.fromSegments(j.documentKey);a.has(K)||(a=a.add(K),u.push(K))})}))}).next(()=>u)}return ne.resolve(null)})}hn(e){let n=this.ln.get(e);return n||(e.filters.length===0?n=[e]:n=B9(Mt.create(e.filters,"and")).map(r=>_x(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,n),n)}En(e,n,r,s,i,a,u){const d=(n!=null?n.length:1)*Math.max(r.length,i.length),m=d/(n!=null?n.length:1),y=[];for(let _=0;_<d;++_){const E=n?this.dn(n[_/m]):z0,b=this.An(e,E,r[_%m],s),k=this.Rn(e,E,i[_%m],a),S=u.map(O=>this.An(e,E,O,!0));y.push(...this.createRange(b,k,S))}return y}An(e,n,r,s){const i=new Rl(e,Se.empty(),n,r);return s?i:i.Zt()}Rn(e,n,r,s){const i=new Rl(e,Se.empty(),n,r);return s?i.Zt():i}Pn(e,n){const r=new zA(n),s=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let a=null;for(const u of i)r.rn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,n){let r=2;const s=this.hn(n);return ne.forEach(s,i=>this.Pn(e,i).next(a=>{a?r!==0&&a.fields.length<function(d){let m=new Ut(fn.comparator),y=!1;for(const _ of d.filters)for(const E of _.getFlattenedFilters())E.field.isKeyField()||(E.op==="array-contains"||E.op==="array-contains-any"?y=!0:m=m.add(E.field));for(const _ of d.orderBy)_.field.isKeyField()||(m=m.add(_.field));return m.size+(y?1:0)}(i)&&(r=1):r=0})).next(()=>function(a){return a.limit!==null}(n)&&s.length>1&&r===2?1:r)}Vn(e,n){const r=new Kh;for(const s of Cl(e)){const i=n.data.field(s.fieldPath);if(i==null)return null;const a=r.Yt(s.kind);Nl.vt.It(i,a)}return r.zt()}dn(e){const n=new Kh;return Nl.vt.It(e,n.Yt(0)),n.zt()}mn(e,n){const r=new Kh;return Nl.vt.It(Jl(this.databaseId,n),r.Yt(function(i){const a=Cl(i);return a.length===0?0:a[a.length-1].kind}(e))),r.zt()}Tn(e,n,r){if(r===null)return[];let s=[];s.push(new Kh);let i=0;for(const a of Cl(e)){const u=r[i++];for(const d of s)if(this.fn(n,a.fieldPath)&&uf(u))s=this.gn(s,a,u);else{const m=d.Yt(a.kind);Nl.vt.It(u,m)}}return this.pn(s)}In(e,n,r){return this.Tn(e,n,r.position)}pn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].zt();return n}gn(e,n,r){const s=[...e],i=[];for(const a of r.arrayValue.values||[])for(const u of s){const d=new Kh;d.seed(u.zt()),Nl.vt.It(a,d.Yt(n.kind)),i.push(d)}return i}fn(e,n){return!!e.filters.find(r=>r instanceof xt&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=Qh(e),s=Vc(e);return(n?r.U("collectionGroupIndex",IDBKeyRange.bound(n,n)):r.U()).next(i=>{const a=[];return ne.forEach(i,u=>s.get([u.indexId,this.uid]).next(d=>{a.push(function(y,_){const E=_?new Ou(_.sequenceNumber,new ks(sc(_.readTime),new Se(Mi(_.documentKey)),_.largestBatchId)):Ou.empty(),b=y.fields.map(([k,S])=>new Vl(fn.fromServerFormat(k),S));return new Du(y.indexId,y.collectionGroup,b,E)}(u,d))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Je(r.collectionGroup,s.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=Qh(e),i=Vc(e);return this.yn(e).next(a=>s.U("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(u=>ne.forEach(u,d=>i.put(jA(d.indexId,this.uid,a,r)))))}updateIndexEntries(e,n){const r=new Map;return ne.forEach(n,(s,i)=>{const a=r.get(s.collectionGroup);return(a?ne.resolve(a):this.getFieldIndexes(e,s.collectionGroup)).next(u=>(r.set(s.collectionGroup,u),ne.forEach(u,d=>this.wn(e,s,d).next(m=>{const y=this.Sn(i,d);return m.isEqual(y)?ne.resolve():this.bn(e,i,d,m,y)}))))})}Dn(e,n,r,s){return Bc(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,n.key),documentKey:n.key.path.toArray()})}vn(e,n,r,s){return Bc(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,n.key),n.key.path.toArray()])}wn(e,n,r){const s=Bc(e);let i=new Ut(Zo);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,n)])},(a,u)=>{i=i.add(new Rl(r.indexId,n,u.arrayValue,u.directionalValue))}).next(()=>i)}Sn(e,n){let r=new Ut(Zo);const s=this.Vn(n,e);if(s==null)return r;const i=mx(n);if(i!=null){const a=e.data.field(i.fieldPath);if(uf(a))for(const u of a.arrayValue.values||[])r=r.add(new Rl(n.indexId,e.key,this.dn(u),s))}else r=r.add(new Rl(n.indexId,e.key,z0,s));return r}bn(e,n,r,s,i){me("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const a=[];return function(d,m,y,_,E){const b=d.getIterator(),k=m.getIterator();let S=Fc(b),O=Fc(k);for(;S||O;){let T=!1,C=!1;if(S&&O){const R=y(S,O);R<0?C=!0:R>0&&(T=!0)}else S!=null?C=!0:T=!0;T?(_(O),O=Fc(k)):C?(E(S),S=Fc(b)):(S=Fc(b),O=Fc(k))}}(s,i,Zo,u=>{a.push(this.Dn(e,n,r,u))},u=>{a.push(this.vn(e,n,r,u))}),ne.waitFor(a)}yn(e){let n=1;return Vc(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),n=s.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((a,u)=>Zo(a,u)).filter((a,u,d)=>!u||Zo(a,d[u-1])!==0);const s=[];s.push(e);for(const a of r){const u=Zo(a,e),d=Zo(a,n);if(u===0)s[0]=e.Zt();else if(u>0&&d<0)s.push(a),s.push(a.Zt());else if(d>0)break}s.push(n);const i=[];for(let a=0;a<s.length;a+=2){if(this.Cn(s[a],s[a+1]))return[];const u=[s[a].indexId,this.uid,s[a].arrayValue,s[a].directionalValue,z0,[]],d=[s[a+1].indexId,this.uid,s[a+1].arrayValue,s[a+1].directionalValue,z0,[]];i.push(IDBKeyRange.bound(u,d))}return i}Cn(e,n){return Zo(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(WA)}getMinOffset(e,n){return ne.mapArray(this.hn(n),r=>this.Pn(e,r).next(s=>s||ke())).next(WA)}}function qA(t){return dr(t,"collectionParents")}function Bc(t){return dr(t,"indexEntries")}function Qh(t){return dr(t,"indexConfiguration")}function Vc(t){return dr(t,"indexState")}function WA(t){je(t.length!==0);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const s=t[r].indexState.offset;P_(s,e)<0&&(e=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new ks(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $A={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Fr{constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Fr(e,Fr.DEFAULT_COLLECTION_PERCENTILE,Fr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uR(t,e,n){const r=t.store("mutations"),s=t.store("documentMutations"),i=[],a=IDBKeyRange.only(n.batchId);let u=0;const d=r.J({range:a},(y,_,E)=>(u++,E.delete()));i.push(d.next(()=>{je(u===1)}));const m=[];for(const y of n.mutations){const _=lN(e,y.key.path,n.batchId);i.push(s.delete(_)),m.push(y.key)}return ne.waitFor(i).next(()=>m)}function Ig(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw ke();e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Fr.DEFAULT_COLLECTION_PERCENTILE=10,Fr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Fr.DEFAULT=new Fr(41943040,Fr.DEFAULT_COLLECTION_PERCENTILE,Fr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Fr.DISABLED=new Fr(-1,0,0);class Sp{constructor(e,n,r,s){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,n,r,s){je(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Sp(i,n,r,s)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Jo(e).J({index:"userMutationsIndex",range:r},(s,i,a)=>{n=!1,a.done()}).next(()=>n)}addMutationBatch(e,n,r,s){const i=Kc(e),a=Jo(e);return a.add({}).next(u=>{je(typeof u=="number");const d=new B_(u,n,r,s),m=function(b,k,S){const O=S.baseMutations.map(C=>ff(b.ct,C)),T=S.mutations.map(C=>ff(b.ct,C));return{userId:k,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:O,mutations:T}}(this.serializer,this.userId,d),y=[];let _=new Ut((E,b)=>Je(E.canonicalString(),b.canonicalString()));for(const E of s){const b=lN(this.userId,E.key.path,u);_=_.add(E.key.path.popLast()),y.push(a.put(m)),y.push(i.put(b,NL))}return _.forEach(E=>{y.push(this.indexManager.addToCollectionParentIndex(e,E))}),e.addOnCommittedListener(()=>{this.Fn[u]=d.keys()}),ne.waitFor(y).next(()=>d)})}lookupMutationBatch(e,n){return Jo(e).get(n).next(r=>r?(je(r.userId===this.userId),Sl(this.serializer,r)):null)}Mn(e,n){return this.Fn[n]?ne.resolve(this.Fn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const s=r.keys();return this.Fn[n]=s,s}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Jo(e).J({index:"userMutationsIndex",range:s},(a,u,d)=>{u.userId===this.userId&&(je(u.batchId>=r),i=Sl(this.serializer,u)),d.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Jo(e).J({index:"userMutationsIndex",range:n,reverse:!0},(s,i,a)=>{r=i.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Jo(e).U("userMutationsIndex",n).next(r=>r.map(s=>Sl(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=Am(this.userId,n.path),s=IDBKeyRange.lowerBound(r),i=[];return Kc(e).J({range:s},(a,u,d)=>{const[m,y,_]=a,E=Mi(y);if(m===this.userId&&n.path.isEqual(E))return Jo(e).get(_).next(b=>{if(!b)throw ke();je(b.userId===this.userId),i.push(Sl(this.serializer,b))});d.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Ut(Je);const s=[];return n.forEach(i=>{const a=Am(this.userId,i.path),u=IDBKeyRange.lowerBound(a),d=Kc(e).J({range:u},(m,y,_)=>{const[E,b,k]=m,S=Mi(b);E===this.userId&&i.path.isEqual(S)?r=r.add(k):_.done()});s.push(d)}),ne.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1,i=Am(this.userId,r),a=IDBKeyRange.lowerBound(i);let u=new Ut(Je);return Kc(e).J({range:a},(d,m,y)=>{const[_,E,b]=d,k=Mi(E);_===this.userId&&r.isPrefixOf(k)?k.length===s&&(u=u.add(b)):y.done()}).next(()=>this.xn(e,u))}xn(e,n){const r=[],s=[];return n.forEach(i=>{s.push(Jo(e).get(i).next(a=>{if(a===null)throw ke();je(a.userId===this.userId),r.push(Sl(this.serializer,a))}))}),ne.waitFor(s).next(()=>r)}removeMutationBatch(e,n){return uR(e._e,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.On(n.batchId)}),ne.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return ne.resolve();const r=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return Kc(e).J({range:r},(i,a,u)=>{if(i[0]===this.userId){const d=Mi(i[1]);s.push(d)}else u.done()}).next(()=>{je(s.length===0)})})}containsKey(e,n){return hR(e,this.userId,n)}Nn(e){return dR(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function hR(t,e,n){const r=Am(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let a=!1;return Kc(t).J({range:i,H:!0},(u,d,m)=>{const[y,_,E]=u;y===e&&_===s&&(a=!0),m.done()}).next(()=>a)}function Jo(t){return dr(t,"mutations")}function Kc(t){return dr(t,"documentMutations")}function dR(t){return dr(t,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ic{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ic(0)}static kn(){return new ic(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z9{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.qn(e).next(n=>{const r=new ic(n.highestTargetId);return n.highestTargetId=r.next(),this.Qn(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(n=>Ue.fromTimestamp(new vn(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=n,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),n>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=n),this.Qn(e,s)))}addTargetData(e,n){return this.Kn(e,n).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(n,r),this.Qn(e,r))))}updateTargetData(e,n){return this.Kn(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>Uc(e).delete(n.targetId)).next(()=>this.qn(e)).next(r=>(je(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,n,r){let s=0;const i=[];return Uc(e).J((a,u)=>{const d=ud(u);d.sequenceNumber<=n&&r.get(d.targetId)===null&&(s++,i.push(this.removeTargetData(e,d)))}).next(()=>ne.waitFor(i)).next(()=>s)}forEachTarget(e,n){return Uc(e).J((r,s)=>{const i=ud(s);n(i)})}qn(e){return HA(e).get("targetGlobalKey").next(n=>(je(n!==null),n))}Qn(e,n){return HA(e).put("targetGlobalKey",n)}Kn(e,n){return Uc(e).put(aR(this.serializer,n))}$n(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(n=>n.targetCount)}getTargetData(e,n){const r=ec(n),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Uc(e).J({range:s,index:"queryTargetsIndex"},(a,u,d)=>{const m=ud(u);Uf(n,m.target)&&(i=m,d.done())}).next(()=>i)}addMatchingKeys(e,n,r){const s=[],i=da(e);return n.forEach(a=>{const u=zr(a.path);s.push(i.put({targetId:r,path:u})),s.push(this.referenceDelegate.addReference(e,r,a))}),ne.waitFor(s)}removeMatchingKeys(e,n,r){const s=da(e);return ne.forEach(n,i=>{const a=zr(i.path);return ne.waitFor([s.delete([r,a]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,n){const r=da(e),s=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),s=da(e);let i=st();return s.J({range:r,H:!0},(a,u,d)=>{const m=Mi(a[1]),y=new Se(m);i=i.add(y)}).next(()=>i)}containsKey(e,n){const r=zr(n.path),s=IDBKeyRange.bound([r],[tN(r)],!1,!0);let i=0;return da(e).J({index:"documentTargetsIndex",H:!0,range:s},([a,u],d,m)=>{a!==0&&(i++,m.done())}).next(()=>i>0)}ot(e,n){return Uc(e).get(n).next(r=>r?ud(r):null)}}function Uc(t){return dr(t,"targets")}function HA(t){return dr(t,"targetGlobal")}function da(t){return dr(t,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KA([t,e],[n,r]){const s=Je(t,n);return s===0?Je(e,r):s}class G9{constructor(e){this.Un=e,this.buffer=new Ut(KA),this.Wn=0}Gn(){return++this.Wn}zn(e){const n=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();KA(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class fR{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){me("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){il(n)?me("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):await sl(n)}await this.Hn(3e5)})}}class q9{constructor(e,n){this.Jn=e,this.params=n}calculateTargetCount(e,n){return this.Jn.Yn(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return ne.resolve(fs.oe);const r=new G9(n);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.Jn.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.Jn.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(me("LruGarbageCollector","Garbage collection skipped; disabled"),ne.resolve($A)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(me("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$A):this.Xn(e,n))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,n){let r,s,i,a,u,d,m;const y=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(_=>(_>this.params.maximumSequenceNumbersToCollect?(me("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),s=this.params.maximumSequenceNumbersToCollect):s=_,a=Date.now(),this.nthSequenceNumber(e,s))).next(_=>(r=_,u=Date.now(),this.removeTargets(e,r,n))).next(_=>(i=_,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(_=>(m=Date.now(),Wc()<=pt.DEBUG&&me("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-y}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${i} targets in `+(d-u)+`ms
	Removed ${_} documents in `+(m-d)+`ms
Total Duration: ${m-y}ms`),ne.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:_})))}}function mR(t,e){return new q9(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W9{constructor(e,n){this.db=e,this.garbageCollector=mR(this,n)}Yn(e){const n=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}er(e){let n=0;return this.Zn(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}Zn(e,n){return this.tr(e,(r,s)=>n(s))}addReference(e,n,r){return G0(e,r)}removeReference(e,n,r){return G0(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return G0(e,n)}nr(e,n){return function(s,i){let a=!1;return dR(s).Y(u=>hR(s,u,i).next(d=>(d&&(a=!0),ne.resolve(!d)))).next(()=>a)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(a,u)=>{if(u<=n){const d=this.nr(e,a).next(m=>{if(!m)return i++,r.getEntry(e,a).next(()=>(r.removeEntry(a,Ue.min()),da(e).delete(function(_){return[0,zr(_.path)]}(a))))});s.push(d)}}).next(()=>ne.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return G0(e,n)}tr(e,n){const r=da(e);let s,i=fs.oe;return r.J({index:"documentTargetsIndex"},([a,u],{path:d,sequenceNumber:m})=>{a===0?(i!==fs.oe&&n(new Se(Mi(s)),i),i=m,s=d):i=fs.oe}).next(()=>{i!==fs.oe&&n(new Se(Mi(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function G0(t,e){return da(t).put(function(r,s){return{targetId:0,path:zr(r.path),sequenceNumber:s}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(){this.changes=new Vo(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,rn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ne.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $9{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return vl(e).put(r)}removeEntry(e,n,r){return vl(e).delete(function(i,a){const u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Ag(a),u[u.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.rr(e,r)))}getEntry(e,n){let r=rn.newInvalidDocument(n);return vl(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Xh(n))},(s,i)=>{r=this.ir(n,i)}).next(()=>r)}sr(e,n){let r={size:0,document:rn.newInvalidDocument(n)};return vl(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Xh(n))},(s,i)=>{r={document:this.ir(n,i),size:Ig(i)}}).next(()=>r)}getEntries(e,n){let r=gs();return this._r(e,n,(s,i)=>{const a=this.ir(s,i);r=r.insert(s,a)}).next(()=>r)}ar(e,n){let r=gs(),s=new Jt(Se.comparator);return this._r(e,n,(i,a)=>{const u=this.ir(i,a);r=r.insert(i,u),s=s.insert(i,Ig(a))}).next(()=>({documents:r,ur:s}))}_r(e,n,r){if(n.isEmpty())return ne.resolve();let s=new Ut(YA);n.forEach(d=>s=s.add(d));const i=IDBKeyRange.bound(Xh(s.first()),Xh(s.last())),a=s.getIterator();let u=a.getNext();return vl(e).J({index:"documentKeyIndex",range:i},(d,m,y)=>{const _=Se.fromSegments([...m.prefixPath,m.collectionGroup,m.documentId]);for(;u&&YA(u,_)<0;)r(u,null),u=a.getNext();u&&u.isEqual(_)&&(r(u,m),u=a.hasNext()?a.getNext():null),u?y.$(Xh(u)):y.done()}).next(()=>{for(;u;)r(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,n,r,s,i){const a=n.path,u=[a.popLast().toArray(),a.lastSegment(),Ag(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],d=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return vl(e).U(IDBKeyRange.bound(u,d,!0)).next(m=>{i==null||i.incrementDocumentReadCount(m.length);let y=gs();for(const _ of m){const E=this.ir(Se.fromSegments(_.prefixPath.concat(_.collectionGroup,_.documentId)),_);E.isFoundDocument()&&(Gf(n,E)||s.has(E.key))&&(y=y.insert(E.key,E))}return y})}getAllFromCollectionGroup(e,n,r,s){let i=gs();const a=XA(n,r),u=XA(n,ks.max());return vl(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(d,m,y)=>{const _=this.ir(Se.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);i=i.insert(_.key,_),i.size===s&&y.done()}).next(()=>i)}newChangeBuffer(e){return new H9(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return QA(e).get("remoteDocumentGlobalKey").next(n=>(je(!!n),n))}rr(e,n){return QA(e).put("remoteDocumentGlobalKey",n)}ir(e,n){if(n){const r=k9(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(Ue.min())))return r}return rn.newInvalidDocument(e)}}function pR(t){return new $9(t)}class H9 extends gR{constructor(e,n){super(),this.cr=e,this.trackRemovals=n,this.lr=new Vo(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const n=[];let r=0,s=new Ut((i,a)=>Je(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{const u=this.lr.get(i);if(n.push(this.cr.removeEntry(e,i,u.readTime)),a.isValidDocument()){const d=MA(this.cr.serializer,a);s=s.add(i.path.popLast());const m=Ig(d);r+=m-u.size,n.push(this.cr.addEntry(e,i,d))}else if(r-=u.size,this.trackRemovals){const d=MA(this.cr.serializer,a.convertToNoDocument(Ue.min()));n.push(this.cr.addEntry(e,i,d))}}),s.forEach(i=>{n.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),n.push(this.cr.updateMetadata(e,r)),ne.waitFor(n)}getFromCache(e,n){return this.cr.sr(e,n).next(r=>(this.lr.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.cr.ar(e,n).next(({documents:r,ur:s})=>(s.forEach((i,a)=>{this.lr.set(i,{size:a,readTime:r.get(i).readTime})}),r))}}function QA(t){return dr(t,"remoteDocumentGlobal")}function vl(t){return dr(t,"remoteDocumentsV14")}function Xh(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function XA(t,e){const n=e.documentKey.path.toArray();return[t,Ag(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function YA(t,e){const n=t.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<n.length-2&&i<r.length-2;++i)if(s=Je(n[i],r[i]),s)return s;return s=Je(n.length,r.length),s||(s=Je(n[n.length-2],r[r.length-2]),s||Je(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K9{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yR{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&Cd(r.mutation,s,ms.empty(),vn.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,st()).next(()=>r))}getLocalViewOfDocuments(e,n,r=st()){const s=Li();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let a=ld();return i.forEach((u,d)=>{a=a.insert(u,d.overlayedDocument)}),a}))}getOverlayedDocuments(e,n){const r=Li();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,st()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,u)=>{n.set(a,u)})})}computeViews(e,n,r,s){let i=gs();const a=Id(),u=function(){return Id()}();return n.forEach((d,m)=>{const y=r.get(m.key);s.has(m.key)&&(y===void 0||y.mutation instanceof Uo)?i=i.insert(m.key,m):y!==void 0?(a.set(m.key,y.mutation.getFieldMask()),Cd(y.mutation,m,y.mutation.getFieldMask(),vn.now())):a.set(m.key,ms.empty())}),this.recalculateAndSaveOverlays(e,i).next(d=>(d.forEach((m,y)=>a.set(m,y)),n.forEach((m,y)=>{var _;return u.set(m,new K9(y,(_=a.get(m))!==null&&_!==void 0?_:null))}),u))}recalculateAndSaveOverlays(e,n){const r=Id();let s=new Jt((a,u)=>a-u),i=st();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(a=>{for(const u of a)u.keys().forEach(d=>{const m=n.get(d);if(m===null)return;let y=r.get(d)||ms.empty();y=u.applyToLocalView(m,y),r.set(d,y);const _=(s.get(u.batchId)||st()).add(d);s=s.insert(u.batchId,_)})}).next(()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const d=u.getNext(),m=d.key,y=d.value,_=DN();y.forEach(E=>{if(!i.has(E)){const b=VN(n.get(E),r.get(E));b!==null&&_.set(E,b),i=i.add(E)}}),a.push(this.documentOverlayCache.saveOverlays(e,m,_))}return ne.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(a){return Se.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):M_(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):ne.resolve(Li());let u=-1,d=i;return a.next(m=>ne.forEach(m,(y,_)=>(u<_.largestBatchId&&(u=_.largestBatchId),i.get(y)?ne.resolve():this.remoteDocumentCache.getEntry(e,y).next(E=>{d=d.insert(y,E)}))).next(()=>this.populateOverlays(e,m,i)).next(()=>this.computeViews(e,d,m,st())).next(y=>({batchId:u,changes:kN(y)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Se(n)).next(r=>{let s=ld();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let a=ld();return this.indexManager.getCollectionParents(e,i).next(u=>ne.forEach(u,d=>{const m=function(_,E){return new Bo(E,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)}(n,d.child(i));return this.getDocumentsMatchingCollectionQuery(e,m,r,s).next(y=>{y.forEach((_,E)=>{a=a.insert(_,E)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(a=>{i.forEach((d,m)=>{const y=m.getKey();a.get(y)===null&&(a=a.insert(y,rn.newInvalidDocument(y)))});let u=ld();return a.forEach((d,m)=>{const y=i.get(d);y!==void 0&&Cd(y.mutation,m,ms.empty(),vn.now()),Gf(n,m)&&(u=u.insert(d,m))}),u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q9{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,n){return ne.resolve(this.hr.get(n))}saveBundleMetadata(e,n){return this.hr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:zn(s.createTime)}}(n)),ne.resolve()}getNamedQuery(e,n){return ne.resolve(this.Pr.get(n))}saveNamedQuery(e,n){return this.Pr.set(n.name,function(s){return{name:s.name,query:q_(s.bundledQuery),readTime:zn(s.readTime)}}(n)),ne.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X9{constructor(){this.overlays=new Jt(Se.comparator),this.Ir=new Map}getOverlay(e,n){return ne.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Li();return ne.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.ht(e,n,i)}),ne.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),ne.resolve()}getOverlaysForCollection(e,n,r){const s=Li(),i=n.length+1,a=new Se(n.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const d=u.getNext().value,m=d.getKey();if(!n.isPrefixOf(m.path))break;m.path.length===i&&d.largestBatchId>r&&s.set(d.getKey(),d)}return ne.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new Jt((m,y)=>m-y);const a=this.overlays.getIterator();for(;a.hasNext();){const m=a.getNext().value;if(m.getKey().getCollectionGroup()===n&&m.largestBatchId>r){let y=i.get(m.largestBatchId);y===null&&(y=Li(),i=i.insert(m.largestBatchId,y)),y.set(m.getKey(),m)}}const u=Li(),d=i.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((m,y)=>u.set(m,y)),!(u.size()>=s)););return ne.resolve(u)}ht(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new U_(n,r));let i=this.Ir.get(n);i===void 0&&(i=st(),this.Ir.set(n,i)),this.Ir.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y9{constructor(){this.sessionToken=kn.EMPTY_BYTE_STRING}getSessionToken(e){return ne.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ne.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H_{constructor(){this.Tr=new Ut(gr.Er),this.dr=new Ut(gr.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,n){const r=new gr(e,n);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Vr(new gr(e,n))}mr(e,n){e.forEach(r=>this.removeReference(r,n))}gr(e){const n=new Se(new yt([])),r=new gr(n,e),s=new gr(n,e+1),i=[];return this.dr.forEachInRange([r,s],a=>{this.Vr(a),i.push(a.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const n=new Se(new yt([])),r=new gr(n,e),s=new gr(n,e+1);let i=st();return this.dr.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){const n=new gr(e,0),r=this.Tr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class gr{constructor(e,n){this.key=e,this.wr=n}static Er(e,n){return Se.comparator(e.key,n.key)||Je(e.wr,n.wr)}static Ar(e,n){return Je(e.wr,n.wr)||Se.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z9{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new Ut(gr.Er)}checkEmpty(e){return ne.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new B_(i,n,r,s);this.mutationQueue.push(a);for(const u of s)this.br=this.br.add(new gr(u.key,i)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return ne.resolve(a)}lookupMutationBatch(e,n){return ne.resolve(this.Dr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.vr(r),i=s<0?0:s;return ne.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ne.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return ne.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new gr(n,0),s=new gr(n,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],a=>{const u=this.Dr(a.wr);i.push(u)}),ne.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Ut(Je);return n.forEach(s=>{const i=new gr(s,0),a=new gr(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,a],u=>{r=r.add(u.wr)})}),ne.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;Se.isDocumentKey(i)||(i=i.child(""));const a=new gr(new Se(i),0);let u=new Ut(Je);return this.br.forEachWhile(d=>{const m=d.key.path;return!!r.isPrefixOf(m)&&(m.length===s&&(u=u.add(d.wr)),!0)},a),ne.resolve(this.Cr(u))}Cr(e){const n=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){je(this.Fr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return ne.forEach(n.mutations,s=>{const i=new gr(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,n){const r=new gr(n,0),s=this.br.firstAfterOrEqual(r);return ne.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,ne.resolve()}Fr(e,n){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const n=this.vr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J9{constructor(e){this.Mr=e,this.docs=function(){return new Jt(Se.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,a=this.Mr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ne.resolve(r?r.document.mutableCopy():rn.newInvalidDocument(n))}getEntries(e,n){let r=gs();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():rn.newInvalidDocument(s))}),ne.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=gs();const a=n.path,u=new Se(a.child("")),d=this.docs.getIteratorFrom(u);for(;d.hasNext();){const{key:m,value:{document:y}}=d.getNext();if(!a.isPrefixOf(m.path))break;m.path.length>a.length+1||P_(rN(y),r)<=0||(s.has(y.key)||Gf(n,y))&&(i=i.insert(y.key,y.mutableCopy()))}return ne.resolve(i)}getAllFromCollectionGroup(e,n,r,s){ke()}Or(e,n){return ne.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new e7(this)}getSize(e){return ne.resolve(this.size)}}class e7 extends gR{constructor(e){super(),this.cr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),ne.waitFor(n)}getFromCache(e,n){return this.cr.getEntry(e,n)}getAllFromCache(e,n){return this.cr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t7{constructor(e){this.persistence=e,this.Nr=new Vo(n=>ec(n),Uf),this.lastRemoteSnapshotVersion=Ue.min(),this.highestTargetId=0,this.Lr=0,this.Br=new H_,this.targetCount=0,this.kr=ic.Bn()}forEachTarget(e,n){return this.Nr.forEach((r,s)=>n(s)),ne.resolve()}getLastRemoteSnapshotVersion(e){return ne.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ne.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ne.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Lr&&(this.Lr=n),ne.resolve()}Kn(e){this.Nr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.kr=new ic(n),this.highestTargetId=n),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,n){return this.Kn(n),this.targetCount+=1,ne.resolve()}updateTargetData(e,n){return this.Kn(n),ne.resolve()}removeTargetData(e,n){return this.Nr.delete(n.target),this.Br.gr(n.targetId),this.targetCount-=1,ne.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.Nr.forEach((a,u)=>{u.sequenceNumber<=n&&r.get(u.targetId)===null&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)}),ne.waitFor(i).next(()=>s)}getTargetCount(e){return ne.resolve(this.targetCount)}getTargetData(e,n){const r=this.Nr.get(n)||null;return ne.resolve(r)}addMatchingKeys(e,n,r){return this.Br.Rr(n,r),ne.resolve()}removeMatchingKeys(e,n,r){this.Br.mr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),ne.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.Br.gr(n),ne.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Br.yr(n);return ne.resolve(r)}containsKey(e,n){return ne.resolve(this.Br.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K_{constructor(e,n){this.qr={},this.overlays={},this.Qr=new fs(0),this.Kr=!1,this.Kr=!0,this.$r=new Y9,this.referenceDelegate=e(this),this.Ur=new t7(this),this.indexManager=new V9,this.remoteDocumentCache=function(s){return new J9(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new oR(n),this.Gr=new Q9(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new X9,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.qr[e.toKey()];return r||(r=new Z9(n,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,n,r){me("MemoryPersistence","Starting transaction:",e);const s=new n7(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,n){return ne.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,n)))}}class n7 extends iN{constructor(e){super(),this.currentSequenceNumber=e}}class Np{constructor(e){this.persistence=e,this.Jr=new H_,this.Yr=null}static Zr(e){return new Np(e)}get Xr(){if(this.Yr)return this.Yr;throw ke()}addReference(e,n,r){return this.Jr.addReference(r,n),this.Xr.delete(r.toString()),ne.resolve()}removeReference(e,n,r){return this.Jr.removeReference(r,n),this.Xr.add(r.toString()),ne.resolve()}markPotentiallyOrphaned(e,n){return this.Xr.add(n.toString()),ne.resolve()}removeTarget(e,n){this.Jr.gr(n.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}zr(){this.Yr=new Set}jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ne.forEach(this.Xr,r=>{const s=Se.fromPath(r);return this.ei(e,s).next(i=>{i||n.removeEntry(s,Ue.min())})}).next(()=>(this.Yr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ei(e,n).next(r=>{r?this.Xr.delete(n.toString()):this.Xr.add(n.toString())})}Wr(e){return 0}ei(e,n){return ne.or([()=>ne.resolve(this.Jr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Hr(e,n)])}}class Cg{constructor(e,n){this.persistence=e,this.ti=new Vo(r=>zr(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=mR(this,n)}static Zr(e,n){return new Cg(e,n)}zr(){}jr(e){return ne.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}Yn(e){const n=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}er(e){let n=0;return this.Zn(e,r=>{n++}).next(()=>n)}Zn(e,n){return ne.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?ne.resolve():n(s)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,a=>this.nr(e,a,n).next(u=>{u||(r++,i.removeEntry(a,Ue.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.ti.set(n,e.currentSequenceNumber),ne.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.ti.set(r,e.currentSequenceNumber),ne.resolve()}removeReference(e,n,r){return this.ti.set(r,e.currentSequenceNumber),ne.resolve()}updateLimboDocument(e,n){return this.ti.set(n,e.currentSequenceNumber),ne.resolve()}Wr(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Im(e.data.value)),n}nr(e,n,r){return ne.or([()=>this.persistence.Hr(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.ti.get(n);return ne.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r7{constructor(e){this.serializer=e}O(e,n,r,s){const i=new _p("createOrUpgrade",n);r<1&&s>=1&&(function(d){d.createObjectStore("owner")}(e),function(d){d.createObjectStore("mutationQueues",{keyPath:"userId"}),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hA,{unique:!0}),d.createObjectStore("documentMutations")}(e),ZA(e),function(d){d.createObjectStore("remoteDocuments")}(e));let a=ne.resolve();return r<3&&s>=3&&(r!==0&&(function(d){d.deleteObjectStore("targetDocuments"),d.deleteObjectStore("targets"),d.deleteObjectStore("targetGlobal")}(e),ZA(e)),a=a.next(()=>function(d){const m=d.store("targetGlobal"),y={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ue.min().toTimestamp(),targetCount:0};return m.put("targetGlobalKey",y)}(i))),r<4&&s>=4&&(r!==0&&(a=a.next(()=>function(d,m){return m.store("mutations").U().next(y=>{d.deleteObjectStore("mutations"),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hA,{unique:!0});const _=m.store("mutations"),E=y.map(b=>_.put(b));return ne.waitFor(E)})}(e,i))),a=a.next(()=>{(function(d){d.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(a=a.next(()=>this.ni(i))),r<6&&s>=6&&(a=a.next(()=>(function(d){d.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(a=a.next(()=>this.ii(i))),r<8&&s>=8&&(a=a.next(()=>this.si(e,i))),r<9&&s>=9&&(a=a.next(()=>{(function(d){d.objectStoreNames.contains("remoteDocumentChanges")&&d.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(a=a.next(()=>this.oi(i))),r<11&&s>=11&&(a=a.next(()=>{(function(d){d.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(d){d.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(a=a.next(()=>{(function(d){const m=d.createObjectStore("documentOverlays",{keyPath:UL});m.createIndex("collectionPathOverlayIndex",zL,{unique:!1}),m.createIndex("collectionGroupOverlayIndex",GL,{unique:!1})})(e)})),r<13&&s>=13&&(a=a.next(()=>function(d){const m=d.createObjectStore("remoteDocumentsV14",{keyPath:RL});m.createIndex("documentKeyIndex",PL),m.createIndex("collectionGroupIndex",kL)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(a=a.next(()=>this.ai(e,i))),r<15&&s>=15&&(a=a.next(()=>function(d){d.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),d.createObjectStore("indexState",{keyPath:jL}).createIndex("sequenceNumberIndex",FL,{unique:!1}),d.createObjectStore("indexEntries",{keyPath:BL}).createIndex("documentKeyIndex",VL,{unique:!1})}(e))),r<16&&s>=16&&(a=a.next(()=>{n.objectStore("indexState").clear()}).next(()=>{n.objectStore("indexEntries").clear()})),r<17&&s>=17&&(a=a.next(()=>{(function(d){d.createObjectStore("globals",{keyPath:"name"})})(e)})),a}ri(e){let n=0;return e.store("remoteDocuments").J((r,s)=>{n+=Ig(s)}).next(()=>{const r={byteSize:n};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const n=e.store("mutationQueues"),r=e.store("mutations");return n.U().next(s=>ne.forEach(s,i=>{const a=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",a).next(u=>ne.forEach(u,d=>{je(d.userId===i.userId);const m=Sl(this.serializer,d);return uR(e,i.userId,m).next(()=>{})}))}))}ii(e){const n=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((a,u)=>{const d=new yt(a),m=function(_){return[0,zr(_)]}(d);i.push(n.get(m).next(y=>y?ne.resolve():(_=>n.put({targetId:0,path:zr(_),sequenceNumber:s.highestListenSequenceNumber}))(d)))}).next(()=>ne.waitFor(i))})}si(e,n){e.createObjectStore("collectionParents",{keyPath:LL});const r=n.store("collectionParents"),s=new $_,i=a=>{if(s.add(a)){const u=a.lastSegment(),d=a.popLast();return r.put({collectionId:u,parent:zr(d)})}};return n.store("remoteDocuments").J({H:!0},(a,u)=>{const d=new yt(a);return i(d.popLast())}).next(()=>n.store("documentMutations").J({H:!0},([a,u,d],m)=>{const y=Mi(u);return i(y.popLast())}))}oi(e){const n=e.store("targets");return n.J((r,s)=>{const i=ud(s),a=aR(this.serializer,i);return n.put(a)})}_i(e,n){const r=n.store("remoteDocuments"),s=[];return r.J((i,a)=>{const u=n.store("remoteDocumentsV14"),d=function(_){return _.document?new Se(yt.fromString(_.document.name).popFirst(5)):_.noDocument?Se.fromSegments(_.noDocument.path):_.unknownDocument?Se.fromSegments(_.unknownDocument.path):ke()}(a).path.toArray(),m={prefixPath:d.slice(0,d.length-2),collectionGroup:d[d.length-2],documentId:d[d.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(u.put(m))}).next(()=>ne.waitFor(s))}ai(e,n){const r=n.store("mutations"),s=pR(this.serializer),i=new K_(Np.Zr,this.serializer.ct);return r.U().next(a=>{const u=new Map;return a.forEach(d=>{var m;let y=(m=u.get(d.userId))!==null&&m!==void 0?m:st();Sl(this.serializer,d).keys().forEach(_=>y=y.add(_)),u.set(d.userId,y)}),ne.forEach(u,(d,m)=>{const y=new yr(m),_=Tp.lt(this.serializer,y),E=i.getIndexManager(y),b=Sp.lt(y,this.serializer,E,i.referenceDelegate);return new yR(s,b,_,E).recalculateAndSaveOverlaysForDocumentKeys(new gx(n,fs.oe),d).next()})})}}function ZA(t){t.createObjectStore("targetDocuments",{keyPath:OL}).createIndex("documentTargetsIndex",ML,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",DL,{unique:!0}),t.createObjectStore("targetGlobal")}const F1="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Q_{constructor(e,n,r,s,i,a,u,d,m,y,_=17){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.ui=i,this.window=a,this.document=u,this.ci=m,this.li=y,this.hi=_,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=E=>Promise.resolve(),!Q_.D())throw new ge(ae.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new W9(this,s),this.Ai=n+"main",this.serializer=new oR(d),this.Ri=new zi(this.Ai,this.hi,new r7(this.serializer)),this.$r=new O9,this.Ur=new z9(this.referenceDelegate,this.serializer),this.remoteDocumentCache=pR(this.serializer),this.Gr=new D9,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,y===!1&&Vn("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ge(ae.FAILED_PRECONDITION,F1);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new fs(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>q0(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(n=>{n||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(n=>this.isPrimary&&!n?this.bi(e).next(()=>!1):!!n&&this.Di(e).next(()=>!0))).catch(e=>{if(il(e))return me("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return me("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Yh(e).get("owner").next(n=>ne.resolve(this.vi(n)))}Ci(e){return q0(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=dr(n,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),a=s.filter(u=>i.indexOf(u)===-1);return ne.forEach(a,u=>r.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Vi)for(const n of e)this.Vi.removeItem(this.Oi(n.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?ne.resolve(!0):Yh(e).get("owner").next(n=>{if(n!==null&&this.Mi(n.leaseTimestampMs,5e3)&&!this.Ni(n.ownerId)){if(this.vi(n)&&this.networkEnabled)return!0;if(!this.vi(n)){if(!n.allowTabSynchronization)throw new ge(ae.FAILED_PRECONDITION,F1);return!1}}return!(!this.networkEnabled||!this.inForeground)||q0(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,u=this.networkEnabled===s.networkEnabled;if(i||a&&u)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&me("IndexedDbPersistence",`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const n=new gx(e,fs.oe);return this.bi(n).next(()=>this.Ci(n))}),this.Ri.close(),this.qi()}xi(e,n){return e.filter(r=>this.Mi(r.updateTimeMs,n)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>q0(e).U().next(n=>this.xi(n,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,n){return Sp.lt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new U9(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Tp.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,n,r){me("IndexedDbPersistence","Starting transaction:",e);const s=n==="readonly"?"readonly":"readwrite",i=function(d){return d===17?$L:d===16?WL:d===15?D_:d===14?hN:d===13?uN:d===12?qL:d===11?cN:void ke()}(this.hi);let a;return this.Ri.runTransaction(e,s,i,u=>(a=new gx(u,this.Qr?this.Qr.next():fs.oe),n==="readwrite-primary"?this.wi(a).next(d=>!!d||this.Si(a)).next(d=>{if(!d)throw Vn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new ge(ae.FAILED_PRECONDITION,sN);return r(a)}).next(d=>this.Di(a).next(()=>d)):this.Ki(a).next(()=>r(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ki(e){return Yh(e).get("owner").next(n=>{if(n!==null&&this.Mi(n.leaseTimestampMs,5e3)&&!this.Ni(n.ownerId)&&!this.vi(n)&&!(this.li||this.allowTabSynchronization&&n.allowTabSynchronization))throw new ge(ae.FAILED_PRECONDITION,F1)})}Di(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Yh(e).put("owner",n)}static D(){return zi.D()}bi(e){const n=Yh(e);return n.get("owner").next(r=>this.vi(r)?(me("IndexedDbPersistence","Releasing primary lease."),n.delete("owner")):ne.resolve())}Mi(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(Vn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const n=/(?:Version|Mobile)\/1[456]/;tS()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var n;try{const r=((n=this.Vi)===null||n===void 0?void 0:n.getItem(this.Oi(e)))!==null;return me("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Vn("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Vn("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Yh(t){return dr(t,"owner")}function q0(t){return dr(t,"clientMetadata")}function X_(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y_{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.$i=r,this.Ui=s}static Wi(e,n){let r=st(),s=st();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Y_(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s7{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return tS()?8:oN(cr())>0?6:4}()}initialize(e,n){this.Ji=e,this.indexManager=n,this.Gi=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.Yi(e,n).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.Zi(e,n,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new s7;return this.Xi(e,n,a).next(u=>{if(i.result=u,this.zi)return this.es(e,n,a,u.size)})}).next(()=>i.result)}es(e,n,r,s){return r.documentReadCount<this.ji?(Wc()<=pt.DEBUG&&me("QueryEngine","SDK will not create cache indexes for query:",$c(n),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ne.resolve()):(Wc()<=pt.DEBUG&&me("QueryEngine","Query:",$c(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Wc()<=pt.DEBUG&&me("QueryEngine","The SDK decides to create cache indexes for query:",$c(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Gr(n))):ne.resolve())}Yi(e,n){if(bA(n))return ne.resolve(null);let r=Gr(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=vg(n,null,"F"),r=Gr(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const a=st(...i);return this.Ji.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(d=>{const m=this.ts(n,u);return this.ns(n,m,a,d.readTime)?this.Yi(e,vg(n,null,"F")):this.rs(e,m,n,d)}))})))}Zi(e,n,r,s){return bA(n)||s.isEqual(Ue.min())?ne.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const a=this.ts(n,i);return this.ns(n,a,r,s)?ne.resolve(null):(Wc()<=pt.DEBUG&&me("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),$c(n)),this.rs(e,a,n,nN(s,-1)).next(u=>u))})}ts(e,n){let r=new Ut(RN(e));return n.forEach((s,i)=>{Gf(e,i)&&(r=r.add(i))}),r}ns(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,n,r){return Wc()<=pt.DEBUG&&me("QueryEngine","Using full collection scan to execute query:",$c(n)),this.Ji.getDocumentsMatchingQuery(e,n,ks.min(),r)}rs(e,n,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i7{constructor(e,n,r,s){this.persistence=e,this.ss=n,this.serializer=s,this.os=new Jt(Je),this._s=new Vo(i=>ec(i),Uf),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new yR(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.os))}}function wR(t,e,n,r){return new i7(t,e,n,r)}async function _R(t,e){const n=Ie(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.ls(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const a=[],u=[];let d=st();for(const m of s){a.push(m.batchId);for(const y of m.mutations)d=d.add(y.key)}for(const m of i){u.push(m.batchId);for(const y of m.mutations)d=d.add(y.key)}return n.localDocuments.getDocuments(r,d).next(m=>({hs:m,removedBatchIds:a,addedBatchIds:u}))})})}function o7(t,e){const n=Ie(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(u,d,m,y){const _=m.batch,E=_.keys();let b=ne.resolve();return E.forEach(k=>{b=b.next(()=>y.getEntry(d,k)).next(S=>{const O=m.docVersions.get(k);je(O!==null),S.version.compareTo(O)<0&&(_.applyToRemoteDocument(S,m),S.isValidDocument()&&(S.setReadTime(m.commitVersion),y.addEntry(S)))})}),b.next(()=>u.mutationQueue.removeMutationBatch(d,_))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let d=st();for(let m=0;m<u.mutationResults.length;++m)u.mutationResults[m].transformResults.length>0&&(d=d.add(u.batch.mutations[m].key));return d}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function vR(t){const e=Ie(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ur.getLastRemoteSnapshotVersion(n))}function a7(t,e){const n=Ie(t),r=e.snapshotVersion;let s=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=n.cs.newChangeBuffer({trackRemovals:!0});s=n.os;const u=[];e.targetChanges.forEach((y,_)=>{const E=s.get(_);if(!E)return;u.push(n.Ur.removeMatchingKeys(i,y.removedDocuments,_).next(()=>n.Ur.addMatchingKeys(i,y.addedDocuments,_)));let b=E.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(_)!==null?b=b.withResumeToken(kn.EMPTY_BYTE_STRING,Ue.min()).withLastLimboFreeSnapshotVersion(Ue.min()):y.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(y.resumeToken,r)),s=s.insert(_,b),function(S,O,T){return S.resumeToken.approximateByteSize()===0||O.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:T.addedDocuments.size+T.modifiedDocuments.size+T.removedDocuments.size>0}(E,b,y)&&u.push(n.Ur.updateTargetData(i,b))});let d=gs(),m=st();if(e.documentUpdates.forEach(y=>{e.resolvedLimboDocuments.has(y)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(i,y))}),u.push(ER(i,a,e.documentUpdates).next(y=>{d=y.Ps,m=y.Is})),!r.isEqual(Ue.min())){const y=n.Ur.getLastRemoteSnapshotVersion(i).next(_=>n.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));u.push(y)}return ne.waitFor(u).next(()=>a.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,d,m)).next(()=>d)}).then(i=>(n.os=s,i))}function ER(t,e,n){let r=st(),s=st();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let a=gs();return n.forEach((u,d)=>{const m=i.get(u);d.isFoundDocument()!==m.isFoundDocument()&&(s=s.add(u)),d.isNoDocument()&&d.version.isEqual(Ue.min())?(e.removeEntry(u,d.readTime),a=a.insert(u,d)):!m.isValidDocument()||d.version.compareTo(m.version)>0||d.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(d),a=a.insert(u,d)):me("LocalStore","Ignoring outdated watch update for ",u,". Current version:",m.version," Watch version:",d.version)}),{Ps:a,Is:s}})}function l7(t,e){const n=Ie(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Vu(t,e){const n=Ie(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Ur.getTargetData(r,e).next(i=>i?(s=i,ne.resolve(s)):n.Ur.allocateTargetId(r).next(a=>(s=new _o(e,a,"TargetPurposeListen",r.currentSequenceNumber),n.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.os=n.os.insert(r.targetId,r),n._s.set(e,r.targetId)),r})}async function Uu(t,e,n){const r=Ie(t),s=r.os.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!il(a))throw a;me("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Tg(t,e,n){const r=Ie(t);let s=Ue.min(),i=st();return r.persistence.runTransaction("Execute query","readwrite",a=>function(d,m,y){const _=Ie(d),E=_._s.get(y);return E!==void 0?ne.resolve(_.os.get(E)):_.Ur.getTargetData(m,y)}(r,a,Gr(e)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,u.targetId).next(d=>{i=d})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,n?s:Ue.min(),n?i:st())).next(u=>(IR(r,NN(e),u),{documents:u,Ts:i})))}function AR(t,e){const n=Ie(t),r=Ie(n.Ur),s=n.os.get(e);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(a=>a?a.target:null))}function bR(t,e){const n=Ie(t),r=n.us.get(e)||Ue.min();return n.persistence.runTransaction("Get new document changes","readonly",s=>n.cs.getAllFromCollectionGroup(s,e,nN(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(IR(n,e,s),s))}function IR(t,e,n){let r=t.us.get(e)||Ue.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.us.set(e,r)}async function c7(t,e,n,r){const s=Ie(t);let i=st(),a=gs();for(const m of n){const y=e.Es(m.metadata.name);m.document&&(i=i.add(y));const _=e.ds(m);_.setReadTime(e.As(m.metadata.readTime)),a=a.insert(y,_)}const u=s.cs.newChangeBuffer({trackRemovals:!0}),d=await Vu(s,function(y){return Gr(ch(yt.fromString(`__bundle__/docs/${y}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",m=>ER(m,u,a).next(y=>(u.apply(m),y)).next(y=>s.Ur.removeMatchingKeysForTargetId(m,d.targetId).next(()=>s.Ur.addMatchingKeys(m,i,d.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(m,y.Ps,y.Is)).next(()=>y.Ps)))}async function u7(t,e,n=st()){const r=await Vu(t,Gr(q_(e.bundledQuery))),s=Ie(t);return s.persistence.runTransaction("Save named query","readwrite",i=>{const a=zn(e.readTime);if(r.snapshotVersion.compareTo(a)>=0)return s.Gr.saveNamedQuery(i,e);const u=r.withResumeToken(kn.EMPTY_BYTE_STRING,a);return s.os=s.os.insert(u.targetId,u),s.Ur.updateTargetData(i,u).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,n,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function JA(t,e){return`firestore_clients_${t}_${e}`}function eb(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function B1(t,e){return`firestore_targets_${t}_${e}`}class Sg{constructor(e,n,r,s){this.user=e,this.batchId=n,this.state=r,this.error=s}static Rs(e,n,r){const s=JSON.parse(r);let i,a=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return a&&s.error&&(a=typeof s.error.message=="string"&&typeof s.error.code=="string",a&&(i=new ge(s.error.code,s.error.message))),a?new Sg(e,n,s.state,i):(Vn("SharedClientState",`Failed to parse mutation state for ID '${n}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Td{constructor(e,n,r){this.targetId=e,this.state=n,this.error=r}static Rs(e,n){const r=JSON.parse(n);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new ge(r.error.code,r.error.message))),i?new Td(e,r.state,s):(Vn("SharedClientState",`Failed to parse target state for ID '${e}': ${n}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ng{constructor(e,n){this.clientId=e,this.activeTargetIds=n}static Rs(e,n){const r=JSON.parse(n);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=L_();for(let a=0;s&&a<r.activeTargetIds.length;++a)s=aN(r.activeTargetIds[a]),i=i.add(r.activeTargetIds[a]);return s?new Ng(e,i):(Vn("SharedClientState",`Failed to parse client data for instance '${e}': ${n}`),null)}}class Z_{constructor(e,n){this.clientId=e,this.onlineState=n}static Rs(e){const n=JSON.parse(e);return typeof n=="object"&&["Unknown","Online","Offline"].indexOf(n.onlineState)!==-1&&typeof n.clientId=="string"?new Z_(n.clientId,n.onlineState):(Vn("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Nx{constructor(){this.activeTargetIds=L_()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class V1{constructor(e,n,r,s,i){this.window=e,this.ui=n,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Jt(Je),this.started=!1,this.bs=[];const a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=JA(this.persistenceKey,this.ps),this.vs=function(d){return`firestore_sequence_number_${d}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Nx),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=function(d){return`firestore_online_state_${d}`}(this.persistenceKey),this.Os=function(d){return`firestore_bundle_loaded_v2_${d}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(JA(this.persistenceKey,r));if(s){const i=Ng.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const n=this.storage.getItem(this.xs);if(n){const r=this.Ls(n);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let n=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(n=!0)}),n}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,n,r){this.qs(e,n,r),this.Qs(e)}addLocalQueryTarget(e,n=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(B1(this.persistenceKey,e));if(s){const i=Td.Rs(e,s);i&&(r=i.state)}}return n&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(B1(this.persistenceKey,e))}updateQueryState(e,n,r){this.$s(e,n,r)}handleUserChange(e,n,r){n.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const n=this.storage.getItem(e);return me("SharedClientState","READ",e,n),n}setItem(e,n){me("SharedClientState","SET",e,n),this.storage.setItem(e,n)}removeItem(e){me("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const n=e;if(n.storageArea===this.storage){if(me("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ds)return void Vn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(n.key!==null){if(this.Cs.test(n.key)){if(n.newValue==null){const r=this.Gs(n.key);return this.zs(r,null)}{const r=this.js(n.key,n.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(n.key)){if(n.newValue!==null){const r=this.Hs(n.key,n.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(n.key)){if(n.newValue!==null){const r=this.Ys(n.key,n.newValue);if(r)return this.Zs(r)}}else if(n.key===this.xs){if(n.newValue!==null){const r=this.Ls(n.newValue);if(r)return this.Bs(r)}}else if(n.key===this.vs){const r=function(i){let a=fs.oe;if(i!=null)try{const u=JSON.parse(i);je(typeof u=="number"),a=u}catch(u){Vn("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(n.newValue);r!==fs.oe&&this.sequenceNumberHandler(r)}else if(n.key===this.Os){const r=this.Xs(n.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(n)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,n,r){const s=new Sg(this.currentUser,e,n,r),i=eb(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const n=eb(this.persistenceKey,this.currentUser,e);this.removeItem(n)}Us(e){const n={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(n))}$s(e,n,r){const s=B1(this.persistenceKey,e),i=new Td(e,n,r);this.setItem(s,i.Vs())}Ws(e){const n=JSON.stringify(Array.from(e));this.setItem(this.Os,n)}Gs(e){const n=this.Cs.exec(e);return n?n[1]:null}js(e,n){const r=this.Gs(e);return Ng.Rs(r,n)}Hs(e,n){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Sg.Rs(new yr(i),s,n)}Ys(e,n){const r=this.Ms.exec(e),s=Number(r[1]);return Td.Rs(s,n)}Ls(e){return Z_.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);me("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,n){const r=n?this.Ss.insert(e,n):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),a=[],u=[];return i.forEach(d=>{s.has(d)||a.push(d)}),s.forEach(d=>{i.has(d)||u.push(d)}),this.syncEngine.io(a,u).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let n=L_();return e.forEach((r,s)=>{n=n.unionWith(s.activeTargetIds)}),n}}class CR{constructor(){this.so=new Nx,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,n,r){this.oo[e]=n}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Nx,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h7{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tb{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){me("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){me("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let W0=null;function U1(){return W0===null?W0=function(){return 268435456+Math.round(2147483648*Math.random())}():W0++,"0x"+W0.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d7={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f7{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lr="WebChannelConnection";class m7 extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+n.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(n,r,s,i,a){const u=U1(),d=this.xo(n,r.toUriEncodedString());me("RestConnection",`Sending RPC '${n}' ${u}:`,d,s);const m={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(m,i,a),this.No(n,d,m,s).then(y=>(me("RestConnection",`Received RPC '${n}' ${u}: `,y),y),y=>{throw Ks("RestConnection",`RPC '${n}' ${u} failed with error: `,y,"url: ",d,"request:",s),y})}Lo(n,r,s,i,a,u){return this.Mo(n,r,s,i,a)}Oo(n,r,s){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+lh}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,a)=>n[a]=i),s&&s.headers.forEach((i,a)=>n[a]=i)}xo(n,r){const s=d7[n];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,n,r,s){const i=U1();return new Promise((a,u)=>{const d=new HS;d.setWithCredentials(!0),d.listenOnce(KS.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Em.NO_ERROR:const y=d.getResponseJson();me(Lr,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(y)),a(y);break;case Em.TIMEOUT:me(Lr,`RPC '${e}' ${i} timed out`),u(new ge(ae.DEADLINE_EXCEEDED,"Request time out"));break;case Em.HTTP_ERROR:const _=d.getStatus();if(me(Lr,`RPC '${e}' ${i} failed with status:`,_,"response text:",d.getResponseText()),_>0){let E=d.getResponseJson();Array.isArray(E)&&(E=E[0]);const b=E==null?void 0:E.error;if(b&&b.status&&b.message){const k=function(O){const T=O.toLowerCase().replace(/_/g,"-");return Object.values(ae).indexOf(T)>=0?T:ae.UNKNOWN}(b.status);u(new ge(k,b.message))}else u(new ge(ae.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new ge(ae.UNAVAILABLE,"Connection failed."));break;default:ke()}}finally{me(Lr,`RPC '${e}' ${i} completed.`)}});const m=JSON.stringify(s);me(Lr,`RPC '${e}' ${i} sending request:`,s),d.send(n,"POST",m,r,15)})}Bo(e,n,r){const s=U1(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=YS(),u=XS(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(d.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(d.useFetchStreams=!0),this.Oo(d.initMessageHeaders,n,r),d.encodeInitMessageHeaders=!0;const y=i.join("");me(Lr,`Creating RPC '${e}' stream ${s}: ${y}`,d);const _=a.createWebChannel(y,d);let E=!1,b=!1;const k=new f7({Io:O=>{b?me(Lr,`Not sending because RPC '${e}' stream ${s} is closed:`,O):(E||(me(Lr,`Opening RPC '${e}' stream ${s} transport.`),_.open(),E=!0),me(Lr,`RPC '${e}' stream ${s} sending:`,O),_.send(O))},To:()=>_.close()}),S=(O,T,C)=>{O.listen(T,R=>{try{C(R)}catch(j){setTimeout(()=>{throw j},0)}})};return S(_,ad.EventType.OPEN,()=>{b||(me(Lr,`RPC '${e}' stream ${s} transport opened.`),k.yo())}),S(_,ad.EventType.CLOSE,()=>{b||(b=!0,me(Lr,`RPC '${e}' stream ${s} transport closed`),k.So())}),S(_,ad.EventType.ERROR,O=>{b||(b=!0,Ks(Lr,`RPC '${e}' stream ${s} transport errored:`,O),k.So(new ge(ae.UNAVAILABLE,"The operation could not be completed")))}),S(_,ad.EventType.MESSAGE,O=>{var T;if(!b){const C=O.data[0];je(!!C);const R=C,j=R.error||((T=R[0])===null||T===void 0?void 0:T.error);if(j){me(Lr,`RPC '${e}' stream ${s} received error:`,j);const K=j.status;let Q=function(F){const W=Kn[F];if(W!==void 0)return qN(W)}(K),D=j.message;Q===void 0&&(Q=ae.INTERNAL,D="Unknown error status: "+K+" with message "+j.message),b=!0,k.So(new ge(Q,D)),_.close()}else me(Lr,`RPC '${e}' stream ${s} received:`,C),k.bo(C)}}),S(u,QS.STAT_EVENT,O=>{O.stat===fx.PROXY?me(Lr,`RPC '${e}' stream ${s} detected buffering proxy`):O.stat===fx.NOPROXY&&me(Lr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{k.wo()},0),k}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TR(){return typeof window<"u"?window:null}function Nm(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hf(t){return new E9(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J_{constructor(e,n,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=n,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,n-r);s>0&&me("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(e,n,r,s,i,a,u,d){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=d,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new J_(e,n)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,n){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():n&&n.code===ae.RESOURCE_EXHAUSTED?(Vn(n.toString()),Vn("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===ae.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(n)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===n&&this.P_(r,s)},r=>{e(()=>{const s=new ge(ae.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,n){const r=this.h_(this.Yo);this.stream=this.T_(e,n),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return me("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return n=>{this.ui.enqueueAndForget(()=>this.Yo===e?n():(me("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class g7 extends SR{constructor(e,n,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}T_(e,n){return this.connection.Bo("Listen",e,n)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const n=I9(this.serializer,e),r=function(i){if(!("targetChange"in i))return Ue.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?Ue.min():a.readTime?zn(a.readTime):Ue.min()}(e);return this.listener.d_(n,r)}A_(e){const n={};n.database=bx(this.serializer),n.addTarget=function(i,a){let u;const d=a.target;if(u=wg(d)?{documents:eR(i,d)}:{query:Cp(i,d)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=KN(i,a.resumeToken);const m=Ex(i,a.expectedCount);m!==null&&(u.expectedCount=m)}else if(a.snapshotVersion.compareTo(Ue.min())>0){u.readTime=Bu(i,a.snapshotVersion.toTimestamp());const m=Ex(i,a.expectedCount);m!==null&&(u.expectedCount=m)}return u}(this.serializer,e);const r=T9(this.serializer,e);r&&(n.labels=r),this.a_(n)}R_(e){const n={};n.database=bx(this.serializer),n.removeTarget=e,this.a_(n)}}class p7 extends SR{constructor(e,n,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,n){return this.connection.Bo("Write",e,n)}E_(e){return je(!!e.streamToken),this.lastStreamToken=e.streamToken,je(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){je(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const n=C9(e.writeResults,e.commitTime),r=zn(e.commitTime);return this.listener.g_(r,n)}p_(){const e={};e.database=bx(this.serializer),this.a_(e)}m_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>ff(this.serializer,r))};this.a_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y7 extends class{}{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new ge(ae.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,n,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Mo(e,Ax(n,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===ae.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ge(ae.UNKNOWN,i.toString())})}Lo(e,n,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Lo(e,Ax(n,r),s,a,u,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===ae.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new ge(ae.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class x7{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Vn(n),this.D_=!1):me("OnlineStateTracker",n)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w7{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(a=>{r.enqueueAndForget(async()=>{al(this)&&(me("RemoteStore","Restarting streams for network reachability change."),await async function(d){const m=Ie(d);m.L_.add(4),await dh(m),m.q_.set("Unknown"),m.L_.delete(4),await Kf(m)}(this))})}),this.q_=new x7(r,s)}}async function Kf(t){if(al(t))for(const e of t.B_)await e(!0)}async function dh(t){for(const e of t.B_)await e(!1)}function Rp(t,e){const n=Ie(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),nv(n)?tv(n):mh(n).r_()&&ev(n,e))}function zu(t,e){const n=Ie(t),r=mh(n);n.N_.delete(e),r.r_()&&NR(n,e),n.N_.size===0&&(r.r_()?r.o_():al(n)&&n.q_.set("Unknown"))}function ev(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ue.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}mh(t).A_(e)}function NR(t,e){t.Q_.xe(e),mh(t).R_(e)}function tv(t){t.Q_=new x9({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),mh(t).start(),t.q_.v_()}function nv(t){return al(t)&&!mh(t).n_()&&t.N_.size>0}function al(t){return Ie(t).L_.size===0}function RR(t){t.Q_=void 0}async function _7(t){t.q_.set("Online")}async function v7(t){t.N_.forEach((e,n)=>{ev(t,e)})}async function E7(t,e){RR(t),nv(t)?(t.q_.M_(e),tv(t)):t.q_.set("Unknown")}async function A7(t,e,n){if(t.q_.set("Online"),e instanceof HN&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const u of i.targetIds)s.N_.has(u)&&(await s.remoteSyncer.rejectListen(u,a),s.N_.delete(u),s.Q_.removeTarget(u))}(t,e)}catch(r){me("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Rg(t,r)}else if(e instanceof Sm?t.Q_.Ke(e):e instanceof $N?t.Q_.He(e):t.Q_.We(e),!n.isEqual(Ue.min()))try{const r=await vR(t.localStore);n.compareTo(r)>=0&&await function(i,a){const u=i.Q_.rt(a);return u.targetChanges.forEach((d,m)=>{if(d.resumeToken.approximateByteSize()>0){const y=i.N_.get(m);y&&i.N_.set(m,y.withResumeToken(d.resumeToken,a))}}),u.targetMismatches.forEach((d,m)=>{const y=i.N_.get(d);if(!y)return;i.N_.set(d,y.withResumeToken(kn.EMPTY_BYTE_STRING,y.snapshotVersion)),NR(i,d);const _=new _o(y.target,d,m,y.sequenceNumber);ev(i,_)}),i.remoteSyncer.applyRemoteEvent(u)}(t,n)}catch(r){me("RemoteStore","Failed to raise snapshot:",r),await Rg(t,r)}}async function Rg(t,e,n){if(!il(e))throw e;t.L_.add(1),await dh(t),t.q_.set("Offline"),n||(n=()=>vR(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{me("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await Kf(t)})}function PR(t,e){return e().catch(n=>Rg(t,n,e))}async function fh(t){const e=Ie(t),n=qa(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;b7(e);)try{const s=await l7(e.localStore,r);if(s===null){e.O_.length===0&&n.o_();break}r=s.batchId,I7(e,s)}catch(s){await Rg(e,s)}kR(e)&&DR(e)}function b7(t){return al(t)&&t.O_.length<10}function I7(t,e){t.O_.push(e);const n=qa(t);n.r_()&&n.V_&&n.m_(e.mutations)}function kR(t){return al(t)&&!qa(t).n_()&&t.O_.length>0}function DR(t){qa(t).start()}async function C7(t){qa(t).p_()}async function T7(t){const e=qa(t);for(const n of t.O_)e.m_(n.mutations)}async function S7(t,e,n){const r=t.O_.shift(),s=V_.from(r,e,n);await PR(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await fh(t)}async function N7(t,e){e&&qa(t).V_&&await async function(r,s){if(function(a){return GN(a)&&a!==ae.ABORTED}(s.code)){const i=r.O_.shift();qa(r).s_(),await PR(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await fh(r)}}(t,e),kR(t)&&DR(t)}async function nb(t,e){const n=Ie(t);n.asyncQueue.verifyOperationInProgress(),me("RemoteStore","RemoteStore received new credentials");const r=al(n);n.L_.add(3),await dh(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await Kf(n)}async function Rx(t,e){const n=Ie(t);e?(n.L_.delete(2),await Kf(n)):e||(n.L_.add(2),await dh(n),n.q_.set("Unknown"))}function mh(t){return t.K_||(t.K_=function(n,r,s){const i=Ie(n);return i.w_(),new g7(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:_7.bind(null,t),Ro:v7.bind(null,t),mo:E7.bind(null,t),d_:A7.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),nv(t)?tv(t):t.q_.set("Unknown")):(await t.K_.stop(),RR(t))})),t.K_}function qa(t){return t.U_||(t.U_=function(n,r,s){const i=Ie(n);return i.w_(),new p7(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:C7.bind(null,t),mo:N7.bind(null,t),f_:T7.bind(null,t),g_:S7.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await fh(t)):(await t.U_.stop(),t.O_.length>0&&(me("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rv{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new wr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const a=Date.now()+r,u=new rv(e,n,a,s,i);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ge(ae.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function gh(t,e){if(Vn("AsyncQueue",`${e}: ${t}`),il(t))return new ge(ae.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vu{constructor(e){this.comparator=e?(n,r)=>e(n,r)||Se.comparator(n.key,r.key):(n,r)=>Se.comparator(n.key,r.key),this.keyedMap=ld(),this.sortedSet=new Jt(this.comparator)}static emptySet(e){return new vu(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof vu)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new vu;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rb{constructor(){this.W_=new Jt(Se.comparator)}track(e){const n=e.doc.key,r=this.W_.get(n);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(n,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(n):e.type===1&&r.type===2?this.W_=this.W_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):ke():this.W_=this.W_.insert(n,e)}G_(){const e=[];return this.W_.inorderTraversal((n,r)=>{e.push(r)}),e}}class Gu{constructor(e,n,r,s,i,a,u,d,m){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=d,this.hasCachedResults=m}static fromInitialDocuments(e,n,r,s,i){const a=[];return n.forEach(u=>{a.push({type:0,doc:u})}),new Gu(e,n,vu.emptySet(n),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&zf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R7{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class P7{constructor(){this.queries=sb(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(n,r){const s=Ie(n),i=s.queries;s.queries=sb(),i.forEach((a,u)=>{for(const d of u.j_)d.onError(r)})})(this,new ge(ae.ABORTED,"Firestore shutting down"))}}function sb(){return new Vo(t=>SN(t),zf)}async function sv(t,e){const n=Ie(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new R7,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await n.onListen(s,!0);break;case 1:i.z_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(a){const u=gh(a,`Initialization of query '${$c(e.query)}' failed`);return void e.onError(u)}n.queries.set(s,i),i.j_.push(e),e.Z_(n.onlineState),i.z_&&e.X_(i.z_)&&ov(n)}async function iv(t,e){const n=Ie(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const a=i.j_.indexOf(e);a>=0&&(i.j_.splice(a,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function k7(t,e){const n=Ie(t);let r=!1;for(const s of e){const i=s.query,a=n.queries.get(i);if(a){for(const u of a.j_)u.X_(s)&&(r=!0);a.z_=s}}r&&ov(n)}function D7(t,e,n){const r=Ie(t),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(n);r.queries.delete(e)}function ov(t){t.Y_.forEach(e=>{e.next()})}var Px,ib;(ib=Px||(Px={})).ea="default",ib.Cache="cache";class av{constructor(e,n,r){this.query=e,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Gu(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.na?this.ia(e)&&(this.ta.next(e),n=!0):this.sa(e,this.onlineState)&&(this.oa(e),n=!0),this.ra=e,n}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let n=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),n=!0),n}sa(e,n){if(!e.fromCache||!this.J_())return!0;const r=n!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const n=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}oa(e){e=Gu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Px.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O7{constructor(e,n){this.aa=e,this.byteLength=n}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ob{constructor(e){this.serializer=e}Es(e){return Gi(this.serializer,e)}ds(e){return e.metadata.exists?JN(this.serializer,e.document,!1):rn.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return zn(e)}}class M7{constructor(e,n,r){this.ca=e,this.localStore=n,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=OR(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let n=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++n;const r=yt.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++n);return n!==this.progress.documentsLoaded?(this.progress.documentsLoaded=n,Object.assign({},this.progress)):null}ha(e){const n=new Map,r=new ob(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const a of s.metadata.queries){const u=(n.get(a)||st()).add(i);n.set(a,u)}}return n}async complete(){const e=await c7(this.localStore,new ob(this.serializer),this.documents,this.ca.id),n=this.ha(this.documents);for(const r of this.queries)await u7(this.localStore,r,n.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function OR(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MR{constructor(e){this.key=e}}class LR{constructor(e){this.key=e}}class jR{constructor(e,n){this.query=e,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=st(),this.mutatedKeys=st(),this.Aa=RN(e),this.Ra=new vu(this.Aa)}get Va(){return this.Ta}ma(e,n){const r=n?n.fa:new rb,s=n?n.Ra:this.Ra;let i=n?n.mutatedKeys:this.mutatedKeys,a=s,u=!1;const d=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,m=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((y,_)=>{const E=s.get(y),b=Gf(this.query,_)?_:null,k=!!E&&this.mutatedKeys.has(E.key),S=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let O=!1;E&&b?E.data.isEqual(b.data)?k!==S&&(r.track({type:3,doc:b}),O=!0):this.ga(E,b)||(r.track({type:2,doc:b}),O=!0,(d&&this.Aa(b,d)>0||m&&this.Aa(b,m)<0)&&(u=!0)):!E&&b?(r.track({type:0,doc:b}),O=!0):E&&!b&&(r.track({type:1,doc:E}),O=!0,(d||m)&&(u=!0)),O&&(b?(a=a.add(b),i=S?i.add(y):i.delete(y)):(a=a.delete(y),i=i.delete(y)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const y=this.query.limitType==="F"?a.last():a.first();a=a.delete(y.key),i=i.delete(y.key),r.track({type:1,doc:y})}return{Ra:a,fa:r,ns:u,mutatedKeys:i}}ga(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((y,_)=>function(b,k){const S=O=>{switch(O){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ke()}};return S(b)-S(k)}(y.type,_.type)||this.Aa(y.doc,_.doc)),this.pa(r),s=s!=null&&s;const u=n&&!s?this.ya():[],d=this.da.size===0&&this.current&&!s?1:0,m=d!==this.Ea;return this.Ea=d,a.length!==0||m?{snapshot:new Gu(this.query,e.Ra,i,a,e.mutatedKeys,d===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new rb,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(n=>this.Ta=this.Ta.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ta=this.Ta.delete(n)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=st(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const n=[];return e.forEach(r=>{this.da.has(r)||n.push(new LR(r))}),this.da.forEach(r=>{e.has(r)||n.push(new MR(r))}),n}ba(e){this.Ta=e.Ts,this.da=st();const n=this.ma(e.documents);return this.applyChanges(n,!0)}Da(){return Gu.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class L7{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class j7{constructor(e){this.key=e,this.va=!1}}class F7{constructor(e,n,r,s,i,a){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new Vo(u=>SN(u),zf),this.Ma=new Map,this.xa=new Set,this.Oa=new Jt(Se.comparator),this.Na=new Map,this.La=new H_,this.Ba={},this.ka=new Map,this.qa=ic.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function B7(t,e,n=!0){const r=Pp(t);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await FR(r,e,n,!0),s}async function V7(t,e){const n=Pp(t);await FR(n,e,!0,!1)}async function FR(t,e,n,r){const s=await Vu(t.localStore,Gr(e)),i=s.targetId,a=t.sharedClientState.addLocalQueryTarget(i,n);let u;return r&&(u=await lv(t,e,i,a==="current",s.resumeToken)),t.isPrimaryClient&&n&&Rp(t.remoteStore,s),u}async function lv(t,e,n,r,s){t.Ka=(_,E,b)=>async function(S,O,T,C){let R=O.view.ma(T);R.ns&&(R=await Tg(S.localStore,O.query,!1).then(({documents:D})=>O.view.ma(D,R)));const j=C&&C.targetChanges.get(O.targetId),K=C&&C.targetMismatches.get(O.targetId)!=null,Q=O.view.applyChanges(R,S.isPrimaryClient,j,K);return kx(S,O.targetId,Q.wa),Q.snapshot}(t,_,E,b);const i=await Tg(t.localStore,e,!0),a=new jR(e,i.Ts),u=a.ma(i.documents),d=$f.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),m=a.applyChanges(u,t.isPrimaryClient,d);kx(t,n,m.wa);const y=new L7(e,n,a);return t.Fa.set(e,y),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),m.snapshot}async function U7(t,e,n){const r=Ie(t),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(a=>!zf(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Uu(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&zu(r.remoteStore,s.targetId),qu(r,s.targetId)}).catch(sl)):(qu(r,s.targetId),await Uu(r.localStore,s.targetId,!0))}async function z7(t,e){const n=Ie(t),r=n.Fa.get(e),s=n.Ma.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),zu(n.remoteStore,r.targetId))}async function G7(t,e,n){const r=dv(t);try{const s=await function(a,u){const d=Ie(a),m=vn.now(),y=u.reduce((b,k)=>b.add(k.key),st());let _,E;return d.persistence.runTransaction("Locally write mutations","readwrite",b=>{let k=gs(),S=st();return d.cs.getEntries(b,y).next(O=>{k=O,k.forEach((T,C)=>{C.isValidDocument()||(S=S.add(T))})}).next(()=>d.localDocuments.getOverlayedDocuments(b,k)).next(O=>{_=O;const T=[];for(const C of u){const R=g9(C,_.get(C.key).overlayedDocument);R!=null&&T.push(new Uo(C.key,R,yN(R.value.mapValue),mn.exists(!0)))}return d.mutationQueue.addMutationBatch(b,m,T,u)}).next(O=>{E=O;const T=O.applyToLocalDocumentSet(_,S);return d.documentOverlayCache.saveOverlays(b,O.batchId,T)})}).then(()=>({batchId:E.batchId,changes:kN(_)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,u,d){let m=a.Ba[a.currentUser.toKey()];m||(m=new Jt(Je)),m=m.insert(u,d),a.Ba[a.currentUser.toKey()]=m}(r,s.batchId,n),await zo(r,s.changes),await fh(r.remoteStore)}catch(s){const i=gh(s,"Failed to persist write");n.reject(i)}}async function BR(t,e){const n=Ie(t);try{const r=await a7(n.localStore,e);e.targetChanges.forEach((s,i)=>{const a=n.Na.get(i);a&&(je(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.va=!0:s.modifiedDocuments.size>0?je(a.va):s.removedDocuments.size>0&&(je(a.va),a.va=!1))}),await zo(n,r,e)}catch(r){await sl(r)}}function ab(t,e,n){const r=Ie(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Fa.forEach((i,a)=>{const u=a.view.Z_(e);u.snapshot&&s.push(u.snapshot)}),function(a,u){const d=Ie(a);d.onlineState=u;let m=!1;d.queries.forEach((y,_)=>{for(const E of _.j_)E.Z_(u)&&(m=!0)}),m&&ov(d)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function q7(t,e,n){const r=Ie(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Na.get(e),i=s&&s.key;if(i){let a=new Jt(Se.comparator);a=a.insert(i,rn.newNoDocument(i,Ue.min()));const u=st().add(i),d=new Wf(Ue.min(),new Map,new Jt(Je),a,u);await BR(r,d),r.Oa=r.Oa.remove(i),r.Na.delete(e),hv(r)}else await Uu(r.localStore,e,!1).then(()=>qu(r,e,n)).catch(sl)}async function W7(t,e){const n=Ie(t),r=e.batch.batchId;try{const s=await o7(n.localStore,e);uv(n,r,null),cv(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await zo(n,s)}catch(s){await sl(s)}}async function $7(t,e,n){const r=Ie(t);try{const s=await function(a,u){const d=Ie(a);return d.persistence.runTransaction("Reject batch","readwrite-primary",m=>{let y;return d.mutationQueue.lookupMutationBatch(m,u).next(_=>(je(_!==null),y=_.keys(),d.mutationQueue.removeMutationBatch(m,_))).next(()=>d.mutationQueue.performConsistencyCheck(m)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(m,y,u)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,y)).next(()=>d.localDocuments.getDocuments(m,y))})}(r.localStore,e);uv(r,e,n),cv(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await zo(r,s)}catch(s){await sl(s)}}async function H7(t,e){const n=Ie(t);al(n.remoteStore)||me("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(a){const u=Ie(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",d=>u.mutationQueue.getHighestUnacknowledgedBatchId(d))}(n.localStore);if(r===-1)return void e.resolve();const s=n.ka.get(r)||[];s.push(e),n.ka.set(r,s)}catch(r){const s=gh(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function cv(t,e){(t.ka.get(e)||[]).forEach(n=>{n.resolve()}),t.ka.delete(e)}function uv(t,e,n){const r=Ie(t);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function qu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||VR(t,r)})}function VR(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);n!==null&&(zu(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),hv(t))}function kx(t,e,n){for(const r of n)r instanceof MR?(t.La.addReference(r.key,e),K7(t,r)):r instanceof LR?(me("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||VR(t,r.key)):ke()}function K7(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(me("SyncEngine","New document in limbo: "+n),t.xa.add(r),hv(t))}function hv(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new Se(yt.fromString(e)),r=t.qa.next();t.Na.set(r,new j7(n)),t.Oa=t.Oa.insert(n,r),Rp(t.remoteStore,new _o(Gr(ch(n.path)),r,"TargetPurposeLimboResolution",fs.oe))}}async function zo(t,e,n){const r=Ie(t),s=[],i=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((u,d)=>{a.push(r.Ka(d,e,n).then(m=>{var y;if((m||n)&&r.isPrimaryClient){const _=m?!m.fromCache:(y=n==null?void 0:n.targetChanges.get(d.targetId))===null||y===void 0?void 0:y.current;r.sharedClientState.updateQueryState(d.targetId,_?"current":"not-current")}if(m){s.push(m);const _=Y_.Wi(d.targetId,m);i.push(_)}}))}),await Promise.all(a),r.Ca.d_(s),await async function(d,m){const y=Ie(d);try{await y.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>ne.forEach(m,E=>ne.forEach(E.$i,b=>y.persistence.referenceDelegate.addReference(_,E.targetId,b)).next(()=>ne.forEach(E.Ui,b=>y.persistence.referenceDelegate.removeReference(_,E.targetId,b)))))}catch(_){if(!il(_))throw _;me("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of m){const E=_.targetId;if(!_.fromCache){const b=y.os.get(E),k=b.snapshotVersion,S=b.withLastLimboFreeSnapshotVersion(k);y.os=y.os.insert(E,S)}}}(r.localStore,i))}async function Q7(t,e){const n=Ie(t);if(!n.currentUser.isEqual(e)){me("SyncEngine","User change. New user:",e.toKey());const r=await _R(n.localStore,e);n.currentUser=e,function(i,a){i.ka.forEach(u=>{u.forEach(d=>{d.reject(new ge(ae.CANCELLED,a))})}),i.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await zo(n,r.hs)}}function X7(t,e){const n=Ie(t),r=n.Na.get(e);if(r&&r.va)return st().add(r.key);{let s=st();const i=n.Ma.get(e);if(!i)return s;for(const a of i){const u=n.Fa.get(a);s=s.unionWith(u.view.Va)}return s}}async function Y7(t,e){const n=Ie(t),r=await Tg(n.localStore,e.query,!0),s=e.view.ba(r);return n.isPrimaryClient&&kx(n,e.targetId,s.wa),s}async function Z7(t,e){const n=Ie(t);return bR(n.localStore,e).then(r=>zo(n,r))}async function J7(t,e,n,r){const s=Ie(t),i=await function(u,d){const m=Ie(u),y=Ie(m.mutationQueue);return m.persistence.runTransaction("Lookup mutation documents","readonly",_=>y.Mn(_,d).next(E=>E?m.localDocuments.getDocuments(_,E):ne.resolve(null)))}(s.localStore,e);i!==null?(n==="pending"?await fh(s.remoteStore):n==="acknowledged"||n==="rejected"?(uv(s,e,r||null),cv(s,e),function(u,d){Ie(Ie(u).mutationQueue).On(d)}(s.localStore,e)):ke(),await zo(s,i)):me("SyncEngine","Cannot apply mutation batch with id: "+e)}async function ej(t,e){const n=Ie(t);if(Pp(n),dv(n),e===!0&&n.Qa!==!0){const r=n.sharedClientState.getAllActiveQueryTargets(),s=await lb(n,r.toArray());n.Qa=!0,await Rx(n.remoteStore,!0);for(const i of s)Rp(n.remoteStore,i)}else if(e===!1&&n.Qa!==!1){const r=[];let s=Promise.resolve();n.Ma.forEach((i,a)=>{n.sharedClientState.isLocalQueryTarget(a)?r.push(a):s=s.then(()=>(qu(n,a),Uu(n.localStore,a,!0))),zu(n.remoteStore,a)}),await s,await lb(n,r),function(a){const u=Ie(a);u.Na.forEach((d,m)=>{zu(u.remoteStore,m)}),u.La.pr(),u.Na=new Map,u.Oa=new Jt(Se.comparator)}(n),n.Qa=!1,await Rx(n.remoteStore,!1)}}async function lb(t,e,n){const r=Ie(t),s=[],i=[];for(const a of e){let u;const d=r.Ma.get(a);if(d&&d.length!==0){u=await Vu(r.localStore,Gr(d[0]));for(const m of d){const y=r.Fa.get(m),_=await Y7(r,y);_.snapshot&&i.push(_.snapshot)}}else{const m=await AR(r.localStore,a);u=await Vu(r.localStore,m),await lv(r,UR(m),a,!1,u.resumeToken)}s.push(u)}return r.Ca.d_(i),s}function UR(t){return IN(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function tj(t){return function(n){return Ie(Ie(n).persistence).Qi()}(Ie(t).localStore)}async function nj(t,e,n,r){const s=Ie(t);if(s.Qa)return void me("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(n){case"current":case"not-current":{const a=await bR(s.localStore,NN(i[0])),u=Wf.createSynthesizedRemoteEventForCurrentChange(e,n==="current",kn.EMPTY_BYTE_STRING);await zo(s,a,u);break}case"rejected":await Uu(s.localStore,e,!0),qu(s,e,r);break;default:ke()}}async function rj(t,e,n){const r=Pp(t);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){me("SyncEngine","Adding an already active target "+s);continue}const i=await AR(r.localStore,s),a=await Vu(r.localStore,i);await lv(r,UR(i),a.targetId,!1,a.resumeToken),Rp(r.remoteStore,a)}for(const s of n)r.Ma.has(s)&&await Uu(r.localStore,s,!1).then(()=>{zu(r.remoteStore,s),qu(r,s)}).catch(sl)}}function Pp(t){const e=Ie(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=BR.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=X7.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=q7.bind(null,e),e.Ca.d_=k7.bind(null,e.eventManager),e.Ca.$a=D7.bind(null,e.eventManager),e}function dv(t){const e=Ie(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=W7.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=$7.bind(null,e),e}function sj(t,e,n){const r=Ie(t);(async function(i,a,u){try{const d=await a.getMetadata();if(await function(b,k){const S=Ie(b),O=zn(k.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",T=>S.Gr.getBundleMetadata(T,k.id)).then(T=>!!T&&T.createTime.compareTo(O)>=0)}(i.localStore,d))return await a.close(),u._completeWith(function(b){return{taskState:"Success",documentsLoaded:b.totalDocuments,bytesLoaded:b.totalBytes,totalDocuments:b.totalDocuments,totalBytes:b.totalBytes}}(d)),Promise.resolve(new Set);u._updateProgress(OR(d));const m=new M7(d,i.localStore,a.serializer);let y=await a.Ua();for(;y;){const E=await m.la(y);E&&u._updateProgress(E),y=await a.Ua()}const _=await m.complete();return await zo(i,_.Ia,void 0),await function(b,k){const S=Ie(b);return S.persistence.runTransaction("Save bundle","readwrite",O=>S.Gr.saveBundleMetadata(O,k))}(i.localStore,d),u._completeWith(_.progress),Promise.resolve(_.Pa)}catch(d){return Ks("SyncEngine",`Loading bundle failed with ${d}`),u._failWith(d),Promise.resolve(new Set)}})(r,e,n).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Wa{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Hf(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,n){return null}Ha(e,n){return null}za(e){return wR(this.persistence,new xR,e.initialUser,this.serializer)}Ga(e){return new K_(Np.Zr,this.serializer)}Wa(e){return new CR}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Wa.provider={build:()=>new Wa};class ij extends Wa{constructor(e){super(),this.cacheSizeBytes=e}ja(e,n){je(this.persistence.referenceDelegate instanceof Cg);const r=this.persistence.referenceDelegate.garbageCollector;return new fR(r,e.asyncQueue,n)}Ga(e){const n=this.cacheSizeBytes!==void 0?Fr.withCacheSize(this.cacheSizeBytes):Fr.DEFAULT;return new K_(r=>Cg.Zr(r,n),this.serializer)}}class fv extends Wa{constructor(e,n,r){super(),this.Ja=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await dv(this.Ja.syncEngine),await fh(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return wR(this.persistence,new xR,e.initialUser,this.serializer)}ja(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new fR(r,e.asyncQueue,n)}Ha(e,n){const r=new TL(n,this.persistence);return new CL(e.asyncQueue,r)}Ga(e){const n=X_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Fr.withCacheSize(this.cacheSizeBytes):Fr.DEFAULT;return new Q_(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,TR(),Nm(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new CR}}class zR extends fv{constructor(e,n){super(e,n,!1),this.Ja=e,this.cacheSizeBytes=n,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const n=this.Ja.syncEngine;this.sharedClientState instanceof V1&&(this.sharedClientState.syncEngine={no:J7.bind(null,n),ro:nj.bind(null,n),io:rj.bind(null,n),Qi:tj.bind(null,n),eo:Z7.bind(null,n)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await ej(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const n=TR();if(!V1.D(n))throw new ge(ae.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=X_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new V1(n,e.asyncQueue,r,e.clientId,e.initialUser)}}class $a{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>ab(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Q7.bind(null,this.syncEngine),await Rx(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new P7}()}createDatastore(e){const n=Hf(e.databaseInfo.databaseId),r=function(i){return new m7(i)}(e.databaseInfo);return function(i,a,u,d){return new y7(i,a,u,d)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,a,u){return new w7(r,s,i,a,u)}(this.localStore,this.datastore,e.asyncQueue,n=>ab(this.syncEngine,n,0),function(){return tb.D()?new tb:new h7}())}createSyncEngine(e,n){return function(s,i,a,u,d,m,y){const _=new F7(s,i,a,u,d,m);return y&&(_.Qa=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=Ie(s);me("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await dh(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}$a.provider={build:()=>new $a};function cb(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const r={value:t.slice(n,n+e),done:!1};return n+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Vn("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oj{constructor(e,n){this.Xa=e,this.serializer=n,this.metadata=new wr,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const n=this.eu.decode(e),r=Number(n);isNaN(r)&&this.ru(`length string (${n}) is not valid number`);const s=await this.iu(r);return new O7(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const n=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),n}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const n=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),n}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const n=new Uint8Array(this.buffer.length+e.value.length);n.set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aj{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ge(ae.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const n=await async function(s,i){const a=Ie(s),u={documents:i.map(_=>df(a.serializer,_))},d=await a.Lo("BatchGetDocuments",a.serializer.databaseId,yt.emptyPath(),u,i.length),m=new Map;d.forEach(_=>{const E=b9(a.serializer,_);m.set(E.key.toString(),E)});const y=[];return i.forEach(_=>{const E=m.get(_.toString());je(!!E),y.push(E)}),y}(this.datastore,e);return n.forEach(r=>this.recordVersion(r)),n}set(e,n){this.write(n.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,n){try{this.write(n.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new hh(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(n=>{e.delete(n.key.toString())}),e.forEach((n,r)=>{const s=Se.fromPath(r);this.mutations.push(new F_(s,this.precondition(s)))}),await async function(r,s){const i=Ie(r),a={writes:s.map(u=>ff(i.serializer,u))};await i.Mo("Commit",i.serializer.databaseId,yt.emptyPath(),a)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let n;if(e.isFoundDocument())n=e.version;else{if(!e.isNoDocument())throw ke();n=Ue.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!n.isEqual(r))throw new ge(ae.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),n)}precondition(e){const n=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&n?n.isEqual(Ue.min())?mn.exists(!1):mn.updateTime(n):mn.none()}preconditionForUpdate(e){const n=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&n){if(n.isEqual(Ue.min()))throw new ge(ae.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return mn.updateTime(n)}return mn.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lj{constructor(e,n,r,s,i){this.asyncQueue=e,this.datastore=n,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new J_(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new aj(this.datastore),n=this.cu(e);n&&n.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const n=this.updateFunction(e);return!Vf(n)&&n.catch&&n.then?n:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(n){return this.deferred.reject(n),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const n=e.code;return n==="aborted"||n==="failed-precondition"||n==="already-exists"||!GN(n)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cj{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=yr.UNAUTHENTICATED,this.clientId=eN.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{me("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(me("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new wr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=gh(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function z1(t,e){t.asyncQueue.verifyOperationInProgress(),me("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await _R(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function ub(t,e){t.asyncQueue.verifyOperationInProgress();const n=await mv(t);me("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>nb(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>nb(e.remoteStore,s)),t._onlineComponents=e}async function mv(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){me("FirestoreClient","Using user provided OfflineComponentProvider");try{await z1(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===ae.FAILED_PRECONDITION||s.code===ae.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;Ks("Error using user provided cache. Falling back to memory cache: "+n),await z1(t,new Wa)}}else me("FirestoreClient","Using default OfflineComponentProvider"),await z1(t,new Wa);return t._offlineComponents}async function Dp(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(me("FirestoreClient","Using user provided OnlineComponentProvider"),await ub(t,t._uninitializedComponentsProvider._online)):(me("FirestoreClient","Using default OnlineComponentProvider"),await ub(t,new $a))),t._onlineComponents}function GR(t){return mv(t).then(e=>e.persistence)}function ph(t){return mv(t).then(e=>e.localStore)}function qR(t){return Dp(t).then(e=>e.remoteStore)}function gv(t){return Dp(t).then(e=>e.syncEngine)}function WR(t){return Dp(t).then(e=>e.datastore)}async function Wu(t){const e=await Dp(t),n=e.eventManager;return n.onListen=B7.bind(null,e.syncEngine),n.onUnlisten=U7.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=V7.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=z7.bind(null,e.syncEngine),n}function uj(t){return t.asyncQueue.enqueue(async()=>{const e=await GR(t),n=await qR(t);return e.setNetworkEnabled(!0),function(s){const i=Ie(s);return i.L_.delete(0),Kf(i)}(n)})}function hj(t){return t.asyncQueue.enqueue(async()=>{const e=await GR(t),n=await qR(t);return e.setNetworkEnabled(!1),async function(s){const i=Ie(s);i.L_.add(0),await dh(i),i.q_.set("Offline")}(n)})}function dj(t,e){const n=new wr;return t.asyncQueue.enqueueAndForget(async()=>async function(s,i,a){try{const u=await function(m,y){const _=Ie(m);return _.persistence.runTransaction("read document","readonly",E=>_.localDocuments.getDocument(E,y))}(s,i);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new ge(ae.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){const d=gh(u,`Failed to get document '${i} from cache`);a.reject(d)}}(await ph(t),e,n)),n.promise}function $R(t,e,n={}){const r=new wr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,u,d,m){const y=new kp({next:E=>{y.Za(),a.enqueueAndForget(()=>iv(i,_));const b=E.docs.has(u);!b&&E.fromCache?m.reject(new ge(ae.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&E.fromCache&&d&&d.source==="server"?m.reject(new ge(ae.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(E)},error:E=>m.reject(E)}),_=new av(ch(u.path),y,{includeMetadataChanges:!0,_a:!0});return sv(i,_)}(await Wu(t),t.asyncQueue,e,n,r)),r.promise}function fj(t,e){const n=new wr;return t.asyncQueue.enqueueAndForget(async()=>async function(s,i,a){try{const u=await Tg(s,i,!0),d=new jR(i,u.Ts),m=d.ma(u.documents),y=d.applyChanges(m,!1);a.resolve(y.snapshot)}catch(u){const d=gh(u,`Failed to execute query '${i} against cache`);a.reject(d)}}(await ph(t),e,n)),n.promise}function HR(t,e,n={}){const r=new wr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,u,d,m){const y=new kp({next:E=>{y.Za(),a.enqueueAndForget(()=>iv(i,_)),E.fromCache&&d.source==="server"?m.reject(new ge(ae.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(E)},error:E=>m.reject(E)}),_=new av(u,y,{includeMetadataChanges:!0,_a:!0});return sv(i,_)}(await Wu(t),t.asyncQueue,e,n,r)),r.promise}function mj(t,e,n){const r=new wr;return t.asyncQueue.enqueueAndForget(async()=>{try{const s=await WR(t);r.resolve(async function(a,u,d){var m;const y=Ie(a),{request:_,ut:E,parent:b}=tR(y.serializer,CN(u),d);y.connection.Fo||delete _.parent;const k=(await y.Lo("RunAggregationQuery",y.serializer.databaseId,b,_,1)).filter(O=>!!O.result);je(k.length===1);const S=(m=k[0].result)===null||m===void 0?void 0:m.aggregateFields;return Object.keys(S).reduce((O,T)=>(O[E[T]]=S[T],O),{})}(s,e,n))}catch(s){r.reject(s)}}),r.promise}function gj(t,e){const n=new kp(e);return t.asyncQueue.enqueueAndForget(async()=>function(s,i){Ie(s).Y_.add(i),i.next()}(await Wu(t),n)),()=>{n.Za(),t.asyncQueue.enqueueAndForget(async()=>function(s,i){Ie(s).Y_.delete(i)}(await Wu(t),n))}}function pj(t,e,n,r){const s=function(a,u){let d;return d=typeof a=="string"?WN().encode(a):a,function(y,_){return new oj(y,_)}(function(y,_){if(y instanceof Uint8Array)return cb(y,_);if(y instanceof ArrayBuffer)return cb(new Uint8Array(y),_);if(y instanceof ReadableStream)return y.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(d),u)}(n,Hf(e));t.asyncQueue.enqueueAndForget(async()=>{sj(await gv(t),s,r)})}function yj(t,e){return t.asyncQueue.enqueue(async()=>function(r,s){const i=Ie(r);return i.persistence.runTransaction("Get named query","readonly",a=>i.Gr.getNamedQuery(a,s))}(await ph(t),e))}function xj(t,e){return t.asyncQueue.enqueue(async()=>async function(r,s){const i=Ie(r),a=i.indexManager,u=[];return i.persistence.runTransaction("Configure indexes","readwrite",d=>a.getFieldIndexes(d).next(m=>function(_,E,b,k,S){_=[..._],E=[...E],_.sort(b),E.sort(b);const O=_.length,T=E.length;let C=0,R=0;for(;C<T&&R<O;){const j=b(_[R],E[C]);j<0?S(_[R++]):j>0?k(E[C++]):(C++,R++)}for(;C<T;)k(E[C++]);for(;R<O;)S(_[R++])}(m,s,EL,y=>{u.push(a.addFieldIndex(d,y))},y=>{u.push(a.deleteFieldIndex(d,y))})).next(()=>ne.waitFor(u)))}(await ph(t),e))}function wj(t,e){return t.asyncQueue.enqueue(async()=>function(r,s){Ie(r).ss.zi=s}(await ph(t),e))}function _j(t){return t.asyncQueue.enqueue(async()=>function(n){const r=Ie(n),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await ph(t)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KR(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hb=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pv(t,e,n){if(!n)throw new ge(ae.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function vj(t,e,n,r){if(e===!0&&r===!0)throw new ge(ae.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function db(t){if(!Se.isDocumentKey(t))throw new ge(ae.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function fb(t){if(Se.isDocumentKey(t))throw new ge(ae.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Op(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ke()}function ft(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ge(ae.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Op(t);throw new ge(ae.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function QR(t,e){if(e<=0)throw new ge(ae.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mb{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new ge(ae.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ge(ae.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}vj("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=KR((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ge(ae.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ge(ae.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ge(ae.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Qf{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new mb({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ge(ae.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ge(ae.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new mb(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new mL;switch(r.type){case"firstParty":return new xL(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ge(ae.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=hb.get(n);r&&(me("ComponentProvider","Removing Datastore"),hb.delete(n),r.terminate())}(this),Promise.resolve()}}function Ej(t,e,n,r={}){var s;const i=(t=ft(t,Qf))._getSettings(),a=`${e}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==a&&Ks("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:a,ssl:!1})),r.mockUserToken){let u,d;if(typeof r.mockUserToken=="string")u=r.mockUserToken,d=yr.MOCK_USER;else{u=eS(r.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new ge(ae.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new yr(m)}t._authCredentials=new gL(new ZS(u,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Nr(this.firestore,e,this._query)}}class Gn{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qi(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Gn(this.firestore,e,this._key)}}class qi extends Nr{constructor(e,n,r){super(e,n,ch(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Gn(this.firestore,null,new Se(e))}withConverter(e){return new qi(this.firestore,e,this._path)}}function an(t,e,...n){if(t=ut(t),pv("collection","path",e),t instanceof Qf){const r=yt.fromString(e,...n);return fb(r),new qi(t,null,r)}{if(!(t instanceof Gn||t instanceof qi))throw new ge(ae.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(yt.fromString(e,...n));return fb(r),new qi(t.firestore,null,r)}}function QG(t,e){if(t=ft(t,Qf),pv("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new ge(ae.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Nr(t,null,function(r){return new Bo(yt.emptyPath(),r)}(e))}function Vt(t,e,...n){if(t=ut(t),arguments.length===1&&(e=eN.newId()),pv("doc","path",e),t instanceof Qf){const r=yt.fromString(e,...n);return db(r),new Gn(t,null,new Se(r))}{if(!(t instanceof Gn||t instanceof qi))throw new ge(ae.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(yt.fromString(e,...n));return db(r),new Gn(t.firestore,t instanceof qi?t.converter:null,new Se(r))}}function XG(t,e){return t=ut(t),e=ut(e),(t instanceof Gn||t instanceof qi)&&(e instanceof Gn||e instanceof qi)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function XR(t,e){return t=ut(t),e=ut(e),t instanceof Nr&&e instanceof Nr&&t.firestore===e.firestore&&zf(t._query,e._query)&&t.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gb{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new J_(this,"async_queue_retry"),this.Vu=()=>{const r=Nm();r&&me("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const n=Nm();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const n=Nm();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const n=new wr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!il(e))throw e;me("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const n=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(r);throw Vn("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=n,n}enqueueAfterDelay(e,n,r){this.fu(),this.Ru.indexOf(e)>-1&&(n=0);const s=rv.createAndSchedule(this,e,n,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&ke()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const n of this.Tu)if(n.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Tu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const n=this.Tu.indexOf(e);this.Tu.splice(n,1)}}function Dx(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class Aj{constructor(){this._progressObserver={},this._taskCompletionResolver=new wr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,n,r){this._progressObserver={next:e,error:n,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,n){return this._taskCompletionResolver.promise.then(e,n)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YG=-1;class Ht extends Qf{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new gb,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new gb(e),this._firestoreClient=void 0,await e}}}function ZG(t,e,n){n||(n="(default)");const r=pc(t,"firestore");if(r.isInitialized(n)){const s=r.getImmediate({identifier:n}),i=r.getOptions(n);if(Fa(i,e))return s;throw new ge(ae.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new ge(ae.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ge(ae.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:n})}function bj(t,e){const n=typeof t=="object"?t:pp(),r=typeof t=="string"?t:e||"(default)",s=pc(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=x_("firestore");i&&Ej(s,...i)}return s}function An(t){if(t._terminated)throw new ge(ae.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||YR(t),t._firestoreClient}function YR(t){var e,n,r;const s=t._freezeSettings(),i=function(u,d,m,y){return new KL(u,d,m,y.host,y.ssl,y.experimentalForceLongPolling,y.experimentalAutoDetectLongPolling,KR(y.experimentalLongPollingOptions),y.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new cj(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(u){const d=u==null?void 0:u._online.build();return{_offline:u==null?void 0:u._offline.build(d),_online:d}}(t._componentsProvider))}function JG(t,e){Ks("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings();return ZR(t,$a.provider,{build:r=>new fv(r,n.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function eq(t){Ks("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=t._freezeSettings();ZR(t,$a.provider,{build:n=>new zR(n,e.cacheSizeBytes)})}function ZR(t,e,n){if((t=ft(t,Ht))._firestoreClient||t._terminated)throw new ge(ae.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new ge(ae.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:n},YR(t)}function tq(t){if(t._initialized&&!t._terminated)throw new ge(ae.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new wr;return t._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!zi.D())return Promise.resolve();const s=r+"main";await zi.delete(s)}(X_(t._databaseId,t._persistenceKey)),e.resolve()}catch(n){e.reject(n)}}),e.promise}function nq(t){return function(n){const r=new wr;return n.asyncQueue.enqueueAndForget(async()=>H7(await gv(n),r)),r.promise}(An(t=ft(t,Ht)))}function rq(t){return uj(An(t=ft(t,Ht)))}function sq(t){return hj(An(t=ft(t,Ht)))}function iq(t){return BO(t.app,"firestore",t._databaseId.database),t._delete()}function oq(t,e){const n=An(t=ft(t,Ht)),r=new Aj;return pj(n,t._databaseId,e,r),r}function aq(t,e){return yj(An(t=ft(t,Ht)),e).then(n=>n?new Nr(t,null,n.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(e="count",n){this._internalFieldPath=n,this.type="AggregateField",this.aggregateType=e}}class Ij{constructor(e,n,r){this._userDataWriter=n,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new oc(kn.fromBase64String(e))}catch(n){throw new ge(ae.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new oc(kn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new ge(ae.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new fn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function lq(){return new wc("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yv{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new ge(ae.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new ge(ae.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Je(this._lat,e._lat)||Je(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mp{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cj=/^__.*__$/;class Tj{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Uo(e,this.data,this.fieldMask,n,this.fieldTransforms):new uh(e,this.data,n,this.fieldTransforms)}}class JR{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Uo(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function e3(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ke()}}class Lp{constructor(e,n,r,s,i,a){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Lp(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Pg(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(e3(this.Cu)&&Cj.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Sj{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||Hf(e)}Qu(e,n,r,s=!1){return new Lp({Cu:e,methodName:n,qu:r,path:fn.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function vc(t){const e=t._freezeSettings(),n=Hf(t._databaseId);return new Sj(t._databaseId,!!e.ignoreUndefinedProperties,n)}function jp(t,e,n,r,s,i={}){const a=t.Qu(i.merge||i.mergeFields?2:0,e,n,s);bv("Data must be an object, but it was:",a,r);const u=r3(r,a);let d,m;if(i.merge)d=new ms(a.fieldMask),m=a.fieldTransforms;else if(i.mergeFields){const y=[];for(const _ of i.mergeFields){const E=gf(e,_,n);if(!a.contains(E))throw new ge(ae.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);i3(y,E)||y.push(E)}d=new ms(y),m=a.fieldTransforms.filter(_=>d.covers(_.field))}else d=null,m=a.fieldTransforms;return new Tj(new Cr(u),d,m)}class Xf extends _c{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Xf}}function t3(t,e,n){return new Lp({Cu:3,qu:e.settings.qu,methodName:t._methodName,xu:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class xv extends _c{_toFieldTransform(e){return new qf(e.path,new ju)}isEqual(e){return e instanceof xv}}class wv extends _c{constructor(e,n){super(e),this.Ku=n}_toFieldTransform(e){const n=t3(this,e,!0),r=this.Ku.map(i=>Ec(i,n)),s=new tc(r);return new qf(e.path,s)}isEqual(e){return e instanceof wv&&Fa(this.Ku,e.Ku)}}class _v extends _c{constructor(e,n){super(e),this.Ku=n}_toFieldTransform(e){const n=t3(this,e,!0),r=this.Ku.map(i=>Ec(i,n)),s=new nc(r);return new qf(e.path,s)}isEqual(e){return e instanceof _v&&Fa(this.Ku,e.Ku)}}class vv extends _c{constructor(e,n){super(e),this.$u=n}_toFieldTransform(e){const n=new Fu(e.serializer,MN(e.serializer,this.$u));return new qf(e.path,n)}isEqual(e){return e instanceof vv&&this.$u===e.$u}}function Ev(t,e,n,r){const s=t.Qu(1,e,n);bv("Data must be an object, but it was:",s,r);const i=[],a=Cr.empty();ol(r,(d,m)=>{const y=Fp(e,d,n);m=ut(m);const _=s.Nu(y);if(m instanceof Xf)i.push(y);else{const E=Ec(m,_);E!=null&&(i.push(y),a.set(y,E))}});const u=new ms(i);return new JR(a,u,s.fieldTransforms)}function Av(t,e,n,r,s,i){const a=t.Qu(1,e,n),u=[gf(e,r,n)],d=[s];if(i.length%2!=0)throw new ge(ae.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let E=0;E<i.length;E+=2)u.push(gf(e,i[E])),d.push(i[E+1]);const m=[],y=Cr.empty();for(let E=u.length-1;E>=0;--E)if(!i3(m,u[E])){const b=u[E];let k=d[E];k=ut(k);const S=a.Nu(b);if(k instanceof Xf)m.push(b);else{const O=Ec(k,S);O!=null&&(m.push(b),y.set(b,O))}}const _=new ms(m);return new JR(y,_,a.fieldTransforms)}function n3(t,e,n,r=!1){return Ec(n,t.Qu(r?4:3,e))}function Ec(t,e){if(s3(t=ut(t)))return bv("Unsupported field value:",e,t),r3(t,e);if(t instanceof _c)return function(r,s){if(!e3(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let a=0;for(const u of r){let d=Ec(u,s.Lu(a));d==null&&(d={nullValue:"NULL_VALUE"}),i.push(d),a++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=ut(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return MN(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=vn.fromDate(r);return{timestampValue:Bu(s.serializer,i)}}if(r instanceof vn){const i=new vn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Bu(s.serializer,i)}}if(r instanceof yv)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof oc)return{bytesValue:KN(s.serializer,r._byteString)};if(r instanceof Gn){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:G_(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Mp)return function(a,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw u.Bu("VectorValues must only contain numeric values.");return j_(u.serializer,d)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Op(r)}`)}(t,e)}function r3(t,e){const n={};return fN(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ol(t,(r,s)=>{const i=Ec(s,e.Mu(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function s3(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof vn||t instanceof yv||t instanceof oc||t instanceof Gn||t instanceof _c||t instanceof Mp)}function bv(t,e,n){if(!s3(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const r=Op(n);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function gf(t,e,n){if((e=ut(e))instanceof wc)return e._internalPath;if(typeof e=="string")return Fp(t,e);throw Pg("Field path arguments must be of type string or ",t,!1,void 0,n)}const Nj=new RegExp("[~\\*/\\[\\]]");function Fp(t,e,n){if(e.search(Nj)>=0)throw Pg(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new wc(...e.split("."))._internalPath}catch{throw Pg(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Pg(t,e,n,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let u=`Function ${e}() called with invalid data`;n&&(u+=" (via `toFirestore()`)"),u+=". ";let d="";return(i||a)&&(d+=" (found",i&&(d+=` in field ${r}`),a&&(d+=` in document ${s}`),d+=")"),new ge(ae.INVALID_ARGUMENT,u+t+d)}function i3(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Gn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Rj(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Bp("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class Rj extends pf{data(){return super.data()}}function Bp(t,e){return typeof e=="string"?Fp(t,e):e instanceof wc?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o3(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new ge(ae.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Iv{}class Yf extends Iv{}function ur(t,e,...n){let r=[];e instanceof Iv&&r.push(e),r=r.concat(n),function(i){const a=i.filter(d=>d instanceof yh).length,u=i.filter(d=>d instanceof Zf).length;if(a>1||a>0&&u>0)throw new ge(ae.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Zf extends Yf{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Zf(e,n,r)}_apply(e){const n=this._parse(e);return l3(e._query,n),new Nr(e.firestore,e.converter,vx(e._query,n))}_parse(e){const n=vc(e.firestore);return function(i,a,u,d,m,y,_){let E;if(m.isKeyField()){if(y==="array-contains"||y==="array-contains-any")throw new ge(ae.INVALID_ARGUMENT,`Invalid Query. You can't perform '${y}' queries on documentId().`);if(y==="in"||y==="not-in"){yb(_,y);const b=[];for(const k of _)b.push(pb(d,i,k));E={arrayValue:{values:b}}}else E=pb(d,i,_)}else y!=="in"&&y!=="not-in"&&y!=="array-contains-any"||yb(_,y),E=n3(u,a,_,y==="in"||y==="not-in");return xt.create(m,y,E)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function Zt(t,e,n){const r=e,s=Bp("where",t);return Zf._create(s,r,n)}class yh extends Iv{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new yh(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Mt.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let a=s;const u=i.getFlattenedFilters();for(const d of u)l3(a,d),a=vx(a,d)}(e._query,n),new Nr(e.firestore,e.converter,vx(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function cq(...t){return t.forEach(e=>c3("or",e)),yh._create("or",t)}function uq(...t){return t.forEach(e=>c3("and",e)),yh._create("and",t)}class Cv extends Yf{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new Cv(e,n)}_apply(e){const n=function(s,i,a){if(s.startAt!==null)throw new ge(ae.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new ge(ae.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new hf(i,a)}(e._query,this._field,this._direction);return new Nr(e.firestore,e.converter,function(s,i){const a=s.explicitOrderBy.concat([i]);return new Bo(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function Jf(t,e="asc"){const n=e,r=Bp("orderBy",t);return Cv._create(r,n)}class Vp extends Yf{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new Vp(e,n,r)}_apply(e){return new Nr(e.firestore,e.converter,vg(e._query,this._limit,this._limitType))}}function hq(t){return QR("limit",t),Vp._create("limit",t,"F")}function dq(t){return QR("limitToLast",t),Vp._create("limitToLast",t,"L")}class Up extends Yf{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Up(e,n,r)}_apply(e){const n=a3(e,this.type,this._docOrFields,this._inclusive);return new Nr(e.firestore,e.converter,function(s,i){return new Bo(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,n))}}function fq(...t){return Up._create("startAt",t,!0)}function mq(...t){return Up._create("startAfter",t,!1)}class zp extends Yf{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new zp(e,n,r)}_apply(e){const n=a3(e,this.type,this._docOrFields,this._inclusive);return new Nr(e.firestore,e.converter,function(s,i){return new Bo(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,n))}}function gq(...t){return zp._create("endBefore",t,!1)}function pq(...t){return zp._create("endAt",t,!0)}function a3(t,e,n,r){if(n[0]=ut(n[0]),n[0]instanceof pf)return function(i,a,u,d,m){if(!d)throw new ge(ae.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const y=[];for(const _ of _u(i))if(_.field.isKeyField())y.push(Jl(a,d.key));else{const E=d.data.field(_.field);if(vp(E))throw new ge(ae.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+_.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(E===null){const b=_.field.canonicalString();throw new ge(ae.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${b}' (used as the orderBy) does not exist.`)}y.push(E)}return new Ga(y,m)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=vc(t.firestore);return function(a,u,d,m,y,_){const E=a.explicitOrderBy;if(y.length>E.length)throw new ge(ae.INVALID_ARGUMENT,`Too many arguments provided to ${m}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const b=[];for(let k=0;k<y.length;k++){const S=y[k];if(E[k].field.isKeyField()){if(typeof S!="string")throw new ge(ae.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${m}(), but got a ${typeof S}`);if(!M_(a)&&S.indexOf("/")!==-1)throw new ge(ae.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${m}() must be a plain document ID, but '${S}' contains a slash.`);const O=a.path.child(yt.fromString(S));if(!Se.isDocumentKey(O))throw new ge(ae.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${m}() must result in a valid document path, but '${O}' is not because it contains an odd number of segments.`);const T=new Se(O);b.push(Jl(u,T))}else{const O=n3(d,m,S);b.push(O)}}return new Ga(b,_)}(t._query,t.firestore._databaseId,s,e,n,r)}}function pb(t,e,n){if(typeof(n=ut(n))=="string"){if(n==="")throw new ge(ae.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!M_(e)&&n.indexOf("/")!==-1)throw new ge(ae.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(yt.fromString(n));if(!Se.isDocumentKey(r))throw new ge(ae.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Jl(t,new Se(r))}if(n instanceof Gn)return Jl(t,n._key);throw new ge(ae.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Op(n)}.`)}function yb(t,e){if(!Array.isArray(t)||t.length===0)throw new ge(ae.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function l3(t,e){const n=function(s,i){for(const a of s)for(const u of a.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new ge(ae.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ge(ae.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function c3(t,e){if(!(e instanceof Zf||e instanceof yh))throw new ge(ae.INVALID_ARGUMENT,`Function ${t}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class u3{convertValue(e,n="none"){switch(Ua(e)){case 0:return null;case 1:return e.booleanValue;case 2:return hn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Mo(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw ke()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return ol(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var n,r,s;const i=(s=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(a=>hn(a.doubleValue));return new Mp(i)}convertGeoPoint(e){return new yv(hn(e.latitude),hn(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Ep(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(lf(e));default:return null}}convertTimestamp(e){const n=Oo(e);return new vn(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=yt.fromString(e);je(iR(r));const s=new Zl(r.get(1),r.get(3)),i=new Se(r.popFirst(5));return s.isEqual(n)||Vn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gp(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Pj extends u3{constructor(e){super(),this.firestore=e}convertBytes(e){return new oc(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Gn(this.firestore,null,n)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yq(t){return new mf("sum",gf("sum",t))}function xq(t){return new mf("avg",gf("average",t))}function kj(){return new mf("count")}function wq(t,e){var n,r;return t instanceof mf&&e instanceof mf&&t.aggregateType===e.aggregateType&&((n=t._internalFieldPath)===null||n===void 0?void 0:n.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function _q(t,e){return XR(t.query,e.query)&&Fa(t.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class $u extends pf{constructor(e,n,r,s,i,a){super(e,n,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Rm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Bp("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class Rm extends $u{data(e={}){return super.data(e)}}class Hu{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Ol(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Rm(this._firestore,this._userDataWriter,r.key,r,new Ol(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new ge(ae.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(u=>{const d=new Rm(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Ol(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:d,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>i||u.type!==3).map(u=>{const d=new Rm(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Ol(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let m=-1,y=-1;return u.type!==0&&(m=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),y=a.indexOf(u.doc.key)),{type:Dj(u.type),doc:d,oldIndex:m,newIndex:y}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function Dj(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ke()}}function vq(t,e){return t instanceof $u&&e instanceof $u?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(t._document===null?e._document===null:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Hu&&e instanceof Hu&&t._firestore===e._firestore&&XR(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ll(t){t=ft(t,Gn);const e=ft(t.firestore,Ht);return $R(An(e),t._key).then(n=>Tv(e,t,n))}class cl extends u3{constructor(e){super(),this.firestore=e}convertBytes(e){return new oc(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Gn(this.firestore,null,n)}}function Eq(t){t=ft(t,Gn);const e=ft(t.firestore,Ht),n=An(e),r=new cl(e);return dj(n,t._key).then(s=>new $u(e,r,t._key,s,new Ol(s!==null&&s.hasLocalMutations,!0),t.converter))}function Aq(t){t=ft(t,Gn);const e=ft(t.firestore,Ht);return $R(An(e),t._key,{source:"server"}).then(n=>Tv(e,t,n))}function hr(t){t=ft(t,Nr);const e=ft(t.firestore,Ht),n=An(e),r=new cl(e);return o3(t._query),HR(n,t._query).then(s=>new Hu(e,r,t,s))}function bq(t){t=ft(t,Nr);const e=ft(t.firestore,Ht),n=An(e),r=new cl(e);return fj(n,t._query).then(s=>new Hu(e,r,t,s))}function Iq(t){t=ft(t,Nr);const e=ft(t.firestore,Ht),n=An(e),r=new cl(e);return HR(n,t._query,{source:"server"}).then(s=>new Hu(e,r,t,s))}function $0(t,e,n){t=ft(t,Gn);const r=ft(t.firestore,Ht),s=Gp(t.converter,e,n);return e0(r,[jp(vc(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,mn.none())])}function Wr(t,e,n,...r){t=ft(t,Gn);const s=ft(t.firestore,Ht),i=vc(s);let a;return a=typeof(e=ut(e))=="string"||e instanceof wc?Av(i,"updateDoc",t._key,e,n,r):Ev(i,"updateDoc",t._key,e),e0(s,[a.toMutation(t._key,mn.exists(!0))])}function Oj(t){return e0(ft(t.firestore,Ht),[new hh(t._key,mn.none())])}function Ku(t,e){const n=ft(t.firestore,Ht),r=Vt(t),s=Gp(t.converter,e);return e0(n,[jp(vc(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,mn.exists(!1))]).then(()=>r)}function Cq(t,...e){var n,r,s;t=ut(t);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Dx(e[a])||(i=e[a],a++);const u={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Dx(e[a])){const _=e[a];e[a]=(n=_.next)===null||n===void 0?void 0:n.bind(_),e[a+1]=(r=_.error)===null||r===void 0?void 0:r.bind(_),e[a+2]=(s=_.complete)===null||s===void 0?void 0:s.bind(_)}let d,m,y;if(t instanceof Gn)m=ft(t.firestore,Ht),y=ch(t._key.path),d={next:_=>{e[a]&&e[a](Tv(m,t,_))},error:e[a+1],complete:e[a+2]};else{const _=ft(t,Nr);m=ft(_.firestore,Ht),y=_._query;const E=new cl(m);d={next:b=>{e[a]&&e[a](new Hu(m,E,_,b))},error:e[a+1],complete:e[a+2]},o3(t._query)}return function(E,b,k,S){const O=new kp(S),T=new av(b,O,k);return E.asyncQueue.enqueueAndForget(async()=>sv(await Wu(E),T)),()=>{O.Za(),E.asyncQueue.enqueueAndForget(async()=>iv(await Wu(E),T))}}(An(m),y,u,d)}function Tq(t,e){return gj(An(t=ft(t,Ht)),Dx(e)?e:{next:e})}function e0(t,e){return function(r,s){const i=new wr;return r.asyncQueue.enqueueAndForget(async()=>G7(await gv(r),s,i)),i.promise}(An(t),e)}function Tv(t,e,n){const r=n.docs.get(e._key),s=new cl(t);return new $u(t,s,e._key,r,new Ol(n.hasPendingWrites,n.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sq(t){return Mj(t,{count:kj()})}function Mj(t,e){const n=ft(t.firestore,Ht),r=An(n),s=dN(e,(i,a)=>new zN(a,i.aggregateType,i._internalFieldPath));return mj(r,t._query,s).then(i=>function(u,d,m){const y=new cl(u);return new Ij(d,y,m)}(n,t,i))}class Lj{constructor(e){this.kind="memory",this._onlineComponentProvider=$a.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Wa.provider}toJSON(){return{kind:this.kind}}}class jj{constructor(e){let n;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),n=e.tabManager):(n=zj(void 0),n._initialize(e)),this._onlineComponentProvider=n._onlineComponentProvider,this._offlineComponentProvider=n._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class Fj{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Wa.provider}toJSON(){return{kind:this.kind}}}class Bj{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new ij(e)}}toJSON(){return{kind:this.kind}}}function Nq(){return new Fj}function Rq(t){return new Bj(t==null?void 0:t.cacheSizeBytes)}function Pq(t){return new Lj(t)}function kq(t){return new jj(t)}class Vj{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=$a.provider,this._offlineComponentProvider={build:n=>new fv(n,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class Uj{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=$a.provider,this._offlineComponentProvider={build:n=>new zR(n,e==null?void 0:e.cacheSizeBytes)}}}function zj(t){return new Vj(t==null?void 0:t.forceOwnership)}function Dq(){return new Uj}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gj={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qj{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=vc(e)}set(e,n,r){this._verifyNotCommitted();const s=fa(e,this._firestore),i=Gp(s.converter,n,r),a=jp(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(a.toMutation(s._key,mn.none())),this}update(e,n,r,...s){this._verifyNotCommitted();const i=fa(e,this._firestore);let a;return a=typeof(n=ut(n))=="string"||n instanceof wc?Av(this._dataReader,"WriteBatch.update",i._key,n,r,s):Ev(this._dataReader,"WriteBatch.update",i._key,n),this._mutations.push(a.toMutation(i._key,mn.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=fa(e,this._firestore);return this._mutations=this._mutations.concat(new hh(n._key,mn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ge(ae.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function fa(t,e){if((t=ut(t)).firestore!==e)throw new ge(ae.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wj extends class{constructor(n,r){this._firestore=n,this._transaction=r,this._dataReader=vc(n)}get(n){const r=fa(n,this._firestore),s=new Pj(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return ke();const a=i[0];if(a.isFoundDocument())return new pf(this._firestore,s,a.key,a,r.converter);if(a.isNoDocument())return new pf(this._firestore,s,r._key,null,r.converter);throw ke()})}set(n,r,s){const i=fa(n,this._firestore),a=Gp(i.converter,r,s),u=jp(this._dataReader,"Transaction.set",i._key,a,i.converter!==null,s);return this._transaction.set(i._key,u),this}update(n,r,s,...i){const a=fa(n,this._firestore);let u;return u=typeof(r=ut(r))=="string"||r instanceof wc?Av(this._dataReader,"Transaction.update",a._key,r,s,i):Ev(this._dataReader,"Transaction.update",a._key,r),this._transaction.update(a._key,u),this}delete(n){const r=fa(n,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,n){super(e,n),this._firestore=e}get(e){const n=fa(e,this._firestore),r=new cl(this._firestore);return super.get(e).then(s=>new $u(this._firestore,r,n._key,s._document,new Ol(!1,!1),n.converter))}}function Mq(t,e,n){t=ft(t,Ht);const r=Object.assign(Object.assign({},Gj),n);return function(i){if(i.maxAttempts<1)throw new ge(ae.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,a,u){const d=new wr;return i.asyncQueue.enqueueAndForget(async()=>{const m=await WR(i);new lj(i.asyncQueue,m,u,a,d).au()}),d.promise}(An(t),s=>e(new Wj(t,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lq(){return new Xf("deleteField")}function Pn(){return new xv("serverTimestamp")}function jq(...t){return new wv("arrayUnion",t)}function Fq(...t){return new _v("arrayRemove",t)}function Bq(t){return new vv("increment",t)}function Vq(t){return new Mp(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uq(t){return An(t=ft(t,Ht)),new qj(t,e=>e0(t,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zq(t,e){const n=An(t=ft(t,Ht));if(!n._uninitializedComponentsProvider||n._uninitializedComponentsProvider._offline.kind==="memory")return Ks("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const a=typeof i=="string"?function(m){try{return JSON.parse(m)}catch(y){throw new ge(ae.INVALID_ARGUMENT,"Failed to parse JSON: "+(y==null?void 0:y.message))}}(i):i,u=[];if(Array.isArray(a.indexes))for(const d of a.indexes){const m=xb(d,"collectionGroup"),y=[];if(Array.isArray(d.fields))for(const _ of d.fields){const E=Fp("setIndexConfiguration",xb(_,"fieldPath"));_.arrayConfig==="CONTAINS"?y.push(new Vl(E,2)):_.order==="ASCENDING"?y.push(new Vl(E,0)):_.order==="DESCENDING"&&y.push(new Vl(E,1))}u.push(new Du(Du.UNKNOWN_ID,m,y,Ou.empty()))}return u}(e);return xj(n,r)}function xb(t,e){if(typeof t[e]!="string")throw new ge(ae.INVALID_ARGUMENT,"Missing string value for: "+e);return t[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $j{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function Gq(t){var e;t=ft(t,Ht);const n=wb.get(t);if(n)return n;if(((e=An(t)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new $j(t);return wb.set(t,r),r}function qq(t){h3(t,!0)}function Wq(t){h3(t,!1)}function $q(t){_j(An(t._firestore)).then(e=>me("deleting all persistent cache indexes succeeded")).catch(e=>Ks("deleting all persistent cache indexes failed",e))}function h3(t,e){wj(An(t._firestore),e).then(n=>me(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(n=>Ks(`setting persistent cache index auto creation isEnabled=${e} failed`,n))}const wb=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hq(t){var e;const n=(e=An(ft(t.firestore,Ht))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return n===void 0?null:Cp(n,Gr(t._query))._t}function Kq(t,e){var n;const r=dN(e,(i,a)=>new zN(a,i.aggregateType,i._internalFieldPath)),s=(n=An(ft(t.firestore,Ht))._onlineComponents)===null||n===void 0?void 0:n.datastore.serializer;return s===void 0?null:tR(s,CN(t._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qq{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Sv.instance.onExistenceFilterMismatch(e)}}class Sv{constructor(){this.Uu=new Map}static get instance(){return H0||(H0=new Sv,function(n){if(Eg)throw new Error("a TestingHooksSpi instance is already set");Eg=n}(H0)),H0}et(e){this.Uu.forEach(n=>n(e))}onExistenceFilterMismatch(e){const n=Symbol(),r=this.Uu;return r.set(n,e),()=>r.delete(n)}}let H0=null;(function(e,n=!0){(function(s){lh=s})(yc),Ba(new Ro("firestore",(r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),u=new Ht(new pL(r.getProvider("auth-internal")),new wL(r.getProvider("app-check-internal")),function(m,y){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new ge(ae.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zl(m.options.projectId,y)}(a,s),a);return i=Object.assign({useFetchStreams:n},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),Ws(lA,"4.7.3",e),Ws(lA,"4.7.3","esm2017")})();var Hj="firebase",Kj="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ws(Hj,Kj,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d3="firebasestorage.googleapis.com",f3="storageBucket",Qj=2*60*1e3,Xj=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On extends Hi{constructor(e,n,r=0){super(G1(e),`Firebase Storage: ${n} (${G1(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,On.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return G1(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Dn;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Dn||(Dn={}));function G1(t){return"storage/"+t}function Nv(){const t="An unknown error occurred, please check the error payload for server response.";return new On(Dn.UNKNOWN,t)}function Yj(t){return new On(Dn.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function Zj(t){return new On(Dn.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Jj(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new On(Dn.UNAUTHENTICATED,t)}function eF(){return new On(Dn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function tF(t){return new On(Dn.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function nF(){return new On(Dn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function rF(){return new On(Dn.CANCELED,"User canceled the upload/download.")}function sF(t){return new On(Dn.INVALID_URL,"Invalid URL '"+t+"'.")}function iF(t){return new On(Dn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function oF(){return new On(Dn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+f3+"' property when initializing the app?")}function aF(){return new On(Dn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function lF(){return new On(Dn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function cF(t){return new On(Dn.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Ox(t){return new On(Dn.INVALID_ARGUMENT,t)}function m3(){return new On(Dn.APP_DELETED,"The Firebase app was deleted.")}function uF(t){return new On(Dn.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Sd(t,e){return new On(Dn.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Zh(t){throw new On(Dn.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=Ns.makeFromUrl(e,n)}catch{return new Ns(e,"")}if(r.path==="")return r;throw iF(e)}static makeFromUrl(e,n){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(j){j.path.charAt(j.path.length-1)==="/"&&(j.path_=j.path_.slice(0,-1))}const a="(/(.*))?$",u=new RegExp("^gs://"+s+a,"i"),d={bucket:1,path:3};function m(j){j.path_=decodeURIComponent(j.path)}const y="v[A-Za-z0-9_]+",_=n.replace(/[.]/g,"\\."),E="(/([^?#]*).*)?$",b=new RegExp(`^https?://${_}/${y}/b/${s}/o${E}`,"i"),k={bucket:1,path:3},S=n===d3?"(?:storage.googleapis.com|storage.cloud.google.com)":n,O="([^?#]*)",T=new RegExp(`^https?://${S}/${s}/${O}`,"i"),R=[{regex:u,indices:d,postModify:i},{regex:b,indices:k,postModify:m},{regex:T,indices:{bucket:1,path:2},postModify:m}];for(let j=0;j<R.length;j++){const K=R[j],Q=K.regex.exec(e);if(Q){const D=Q[K.indices.bucket];let B=Q[K.indices.path];B||(B=""),r=new Ns(D,B),K.postModify(r);break}}if(r==null)throw sF(e);return r}}class hF{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dF(t,e,n){let r=1,s=null,i=null,a=!1,u=0;function d(){return u===2}let m=!1;function y(...O){m||(m=!0,e.apply(null,O))}function _(O){s=setTimeout(()=>{s=null,t(b,d())},O)}function E(){i&&clearTimeout(i)}function b(O,...T){if(m){E();return}if(O){E(),y.call(null,O,...T);return}if(d()||a){E(),y.call(null,O,...T);return}r<64&&(r*=2);let R;u===1?(u=2,R=0):R=(r+Math.random())*1e3,_(R)}let k=!1;function S(O){k||(k=!0,E(),!m&&(s!==null?(O||(u=2),clearTimeout(s),_(0)):O||(u=1)))}return _(0),i=setTimeout(()=>{a=!0,S(!0)},n),S}function fF(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mF(t){return t!==void 0}function gF(t){return typeof t=="object"&&!Array.isArray(t)}function Rv(t){return typeof t=="string"||t instanceof String}function _b(t){return Pv()&&t instanceof Blob}function Pv(){return typeof Blob<"u"}function vb(t,e,n,r){if(r<e)throw Ox(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw Ox(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kv(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function g3(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const s=e(r)+"="+e(t[r]);n=n+s+"&"}return n=n.slice(0,-1),n}var Ul;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(Ul||(Ul={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pF(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return n||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yF{constructor(e,n,r,s,i,a,u,d,m,y,_,E=!0){this.url_=e,this.method_=n,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=a,this.callback_=u,this.errorCallback_=d,this.timeout_=m,this.progressCallback_=y,this.connectionFactory_=_,this.retry=E,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((b,k)=>{this.resolve_=b,this.reject_=k,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new K0(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const a=u=>{const d=u.loaded,m=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,m)};this.progressCallback_!==null&&i.addUploadProgressListener(a),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(a),this.pendingConnection_=null;const u=i.getErrorCode()===Ul.NO_ERROR,d=i.getStatus();if(!u||pF(d,this.additionalRetryCodes_)&&this.retry){const y=i.getErrorCode()===Ul.ABORT;r(!1,new K0(!1,null,y));return}const m=this.successCodes_.indexOf(d)!==-1;r(!0,new K0(m,i))})},n=(r,s)=>{const i=this.resolve_,a=this.reject_,u=s.connection;if(s.wasSuccessCode)try{const d=this.callback_(u,u.getResponse());mF(d)?i(d):i()}catch(d){a(d)}else if(u!==null){const d=Nv();d.serverResponse=u.getErrorText(),this.errorCallback_?a(this.errorCallback_(u,d)):a(d)}else if(s.canceled){const d=this.appDelete_?m3():rF();a(d)}else{const d=nF();a(d)}};this.canceled_?n(!1,new K0(!1,null,!0)):this.backoffId_=dF(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&fF(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class K0{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function xF(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function wF(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function _F(t,e){e&&(t["X-Firebase-GMPID"]=e)}function vF(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function EF(t,e,n,r,s,i,a=!0){const u=g3(t.urlParams),d=t.url+u,m=Object.assign({},t.headers);return _F(m,e),xF(m,n),wF(m,i),vF(m,r),new yF(d,t.method,m,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AF(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function bF(...t){const e=AF();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(Pv())return new Blob(t);throw new On(Dn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function IF(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CF(t){if(typeof atob>"u")throw cF("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ji={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class q1{constructor(e,n){this.data=e,this.contentType=n||null}}function TF(t,e){switch(t){case ji.RAW:return new q1(p3(e));case ji.BASE64:case ji.BASE64URL:return new q1(y3(t,e));case ji.DATA_URL:return new q1(NF(e),RF(e))}throw Nv()}function p3(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const i=r,a=t.charCodeAt(++n);r=65536|(i&1023)<<10|a&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function SF(t){let e;try{e=decodeURIComponent(t)}catch{throw Sd(ji.DATA_URL,"Malformed data URL.")}return p3(e)}function y3(t,e){switch(t){case ji.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw Sd(t,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case ji.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw Sd(t,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=CF(e)}catch(s){throw s.message.includes("polyfill")?s:Sd(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class x3{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw Sd(ji.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=PF(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function NF(t){const e=new x3(t);return e.base64?y3(ji.BASE64,e.rest):SF(e.rest)}function RF(t){return new x3(t).contentType}function PF(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(e,n){let r=0,s="";_b(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,n){if(_b(this.data_)){const r=this.data_,s=IF(r,e,n);return s===null?null:new ma(s)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new ma(r,!0)}}static getBlob(...e){if(Pv()){const n=e.map(r=>r instanceof ma?r.data_:r);return new ma(bF.apply(null,n))}else{const n=e.map(a=>Rv(a)?TF(ji.RAW,a).data:a.data_);let r=0;n.forEach(a=>{r+=a.byteLength});const s=new Uint8Array(r);let i=0;return n.forEach(a=>{for(let u=0;u<a.length;u++)s[i++]=a[u]}),new ma(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w3(t){let e;try{e=JSON.parse(t)}catch{return null}return gF(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kF(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function DF(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function _3(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OF(t,e){return e}class Kr{constructor(e,n,r,s){this.server=e,this.local=n||e,this.writable=!!r,this.xform=s||OF}}let Q0=null;function MF(t){return!Rv(t)||t.length<2?t:_3(t)}function v3(){if(Q0)return Q0;const t=[];t.push(new Kr("bucket")),t.push(new Kr("generation")),t.push(new Kr("metageneration")),t.push(new Kr("name","fullPath",!0));function e(i,a){return MF(a)}const n=new Kr("name");n.xform=e,t.push(n);function r(i,a){return a!==void 0?Number(a):a}const s=new Kr("size");return s.xform=r,t.push(s),t.push(new Kr("timeCreated")),t.push(new Kr("updated")),t.push(new Kr("md5Hash",null,!0)),t.push(new Kr("cacheControl",null,!0)),t.push(new Kr("contentDisposition",null,!0)),t.push(new Kr("contentEncoding",null,!0)),t.push(new Kr("contentLanguage",null,!0)),t.push(new Kr("contentType",null,!0)),t.push(new Kr("metadata","customMetadata",!0)),Q0=t,Q0}function LF(t,e){function n(){const r=t.bucket,s=t.fullPath,i=new Ns(r,s);return e._makeStorageReference(i)}Object.defineProperty(t,"ref",{get:n})}function jF(t,e,n){const r={};r.type="file";const s=n.length;for(let i=0;i<s;i++){const a=n[i];r[a.local]=a.xform(r,e[a.server])}return LF(r,t),r}function E3(t,e,n){const r=w3(e);return r===null?null:jF(t,r,n)}function FF(t,e,n,r){const s=w3(e);if(s===null||!Rv(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const a=encodeURIComponent;return i.split(",").map(m=>{const y=t.bucket,_=t.fullPath,E="/b/"+a(y)+"/o/"+a(_),b=kv(E,n,r),k=g3({alt:"media",token:m});return b+k})[0]}function BF(t,e){const n={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(n[i.server]=t[i.local])}return JSON.stringify(n)}class A3{constructor(e,n,r,s){this.url=e,this.method=n,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b3(t){if(!t)throw Nv()}function VF(t,e){function n(r,s){const i=E3(t,s,e);return b3(i!==null),i}return n}function UF(t,e){function n(r,s){const i=E3(t,s,e);return b3(i!==null),FF(i,s,t.host,t._protocol)}return n}function I3(t){function e(n,r){let s;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?s=eF():s=Jj():n.getStatus()===402?s=Zj(t.bucket):n.getStatus()===403?s=tF(t.path):s=r,s.status=n.getStatus(),s.serverResponse=r.serverResponse,s}return e}function zF(t){const e=I3(t);function n(r,s){let i=e(r,s);return r.getStatus()===404&&(i=Yj(t.path)),i.serverResponse=s.serverResponse,i}return n}function GF(t,e,n){const r=e.fullServerUrl(),s=kv(r,t.host,t._protocol),i="GET",a=t.maxOperationRetryTime,u=new A3(s,i,UF(t,n),a);return u.errorHandler=zF(e),u}function qF(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function WF(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=qF(null,e)),r}function $F(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};function u(){let R="";for(let j=0;j<2;j++)R=R+Math.random().toString().slice(2);return R}const d=u();a["Content-Type"]="multipart/related; boundary="+d;const m=WF(e,r,s),y=BF(m,n),_="--"+d+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+y+`\r
--`+d+`\r
Content-Type: `+m.contentType+`\r
\r
`,E=`\r
--`+d+"--",b=ma.getBlob(_,r,E);if(b===null)throw aF();const k={name:m.fullPath},S=kv(i,t.host,t._protocol),O="POST",T=t.maxUploadRetryTime,C=new A3(S,O,VF(t,n),T);return C.urlParams=k,C.headers=a,C.body=b.uploadData(),C.errorHandler=I3(e),C}class HF{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Ul.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Ul.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Ul.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,s){if(this.sent_)throw Zh("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(n,e,!0),s!==void 0)for(const i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Zh("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Zh("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Zh("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Zh("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class KF extends HF{initXhr(){this.xhr_.responseType="text"}}function C3(){return new KF}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac{constructor(e,n){this._service=e,n instanceof Ns?this._location=n:this._location=Ns.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new ac(e,n)}get root(){const e=new Ns(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return _3(this._location.path)}get storage(){return this._service}get parent(){const e=kF(this._location.path);if(e===null)return null;const n=new Ns(this._location.bucket,e);return new ac(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw uF(e)}}function QF(t,e,n){t._throwIfRoot("uploadBytes");const r=$F(t.storage,t._location,v3(),new ma(e,!0),n);return t.storage.makeRequestWithTokens(r,C3).then(s=>({metadata:s,ref:t}))}function XF(t){t._throwIfRoot("getDownloadURL");const e=GF(t.storage,t._location,v3());return t.storage.makeRequestWithTokens(e,C3).then(n=>{if(n===null)throw lF();return n})}function YF(t,e){const n=DF(t._location.path,e),r=new Ns(t._location.bucket,n);return new ac(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZF(t){return/^[A-Za-z]+:\/\//.test(t)}function JF(t,e){return new ac(t,e)}function T3(t,e){if(t instanceof Dv){const n=t;if(n._bucket==null)throw oF();const r=new ac(n,n._bucket);return e!=null?T3(r,e):r}else return e!==void 0?YF(t,e):t}function eB(t,e){if(e&&ZF(e)){if(t instanceof Dv)return JF(t,e);throw Ox("To use ref(service, url), the first argument must be a Storage instance.")}else return T3(t,e)}function Eb(t,e){const n=e==null?void 0:e[f3];return n==null?null:Ns.makeFromBucketSpec(n,t)}function tB(t,e,n,r={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:s}=r;s&&(t._overrideAuthToken=typeof s=="string"?s:eS(s,t.app.options.projectId))}class Dv{constructor(e,n,r,s,i){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._bucket=null,this._host=d3,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Qj,this._maxUploadRetryTime=Xj,this._requests=new Set,s!=null?this._bucket=Ns.makeFromBucketSpec(s,this._host):this._bucket=Eb(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ns.makeFromBucketSpec(this._url,e):this._bucket=Eb(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){vb("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){vb("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ac(this,e)}_makeRequest(e,n,r,s,i=!0){if(this._deleted)return new hF(m3());{const a=EF(e,this._appId,r,s,n,this._firebaseVersion,i);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,n){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,s).getPromise()}}const Ab="@firebase/storage",bb="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S3="storage";function nB(t,e,n){return t=ut(t),QF(t,e,n)}function rB(t){return t=ut(t),XF(t)}function sB(t,e){return t=ut(t),eB(t,e)}function iB(t=pp(),e){t=ut(t);const r=pc(t,S3).getImmediate({identifier:e}),s=x_("storage");return s&&oB(r,...s),r}function oB(t,e,n,r={}){tB(t,e,n,r)}function aB(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new Dv(n,r,s,e,yc)}function lB(){Ba(new Ro(S3,aB,"PUBLIC").setMultipleInstances(!0)),Ws(Ab,bb,""),Ws(Ab,bb,"esm2017")}lB();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N3="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cB{constructor(e,n,r){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||e.get().then(s=>this.auth=s,()=>{}),this.messaging||n.get().then(s=>this.messaging=s,()=>{}),this.appCheck||r.get().then(s=>this.appCheck=s,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const n=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return n.error?null:n.token}return null}async getContext(e){const n=await this.getAuthToken(),r=await this.getMessagingToken(),s=await this.getAppCheckToken(e);return{authToken:n,messagingToken:r,appCheckToken:s}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mx="us-central1";class uB{constructor(e,n,r,s,i=Mx,a){this.app=e,this.fetchImpl=a,this.emulatorOrigin=null,this.contextProvider=new cB(n,r,s),this.cancelAllRequests=new Promise(u=>{this.deleteService=()=>Promise.resolve(u())});try{const u=new URL(i);this.customDomain=u.origin+(u.pathname==="/"?"":u.pathname),this.region=Mx}catch{this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const n=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${n}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${n}.cloudfunctions.net/${e}`}}function hB(t,e,n){t.emulatorOrigin=`http://${e}:${n}`}const Ib="@firebase/functions",Cb="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dB="auth-internal",fB="app-check-internal",mB="messaging-internal";function gB(t,e){const n=(r,{instanceIdentifier:s})=>{const i=r.getProvider("app").getImmediate(),a=r.getProvider(dB),u=r.getProvider(mB),d=r.getProvider(fB);return new uB(i,a,u,d,s,t)};Ba(new Ro(N3,n,"PUBLIC").setMultipleInstances(!0)),Ws(Ib,Cb,e),Ws(Ib,Cb,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pB(t=pp(),e=Mx){const r=pc(ut(t),N3).getImmediate({identifier:e}),s=x_("functions");return s&&yB(r,...s),r}function yB(t,e,n){hB(ut(t),e,n)}gB(fetch.bind(self));const xB={apiKey:"AIzaSyBhwyN85XAMKQmZqT6NqCBKeGq7c7niou8",authDomain:"eshaan-createch.firebaseapp.com",projectId:"eshaan-createch",storageBucket:"eshaan-createch.firebasestorage.app",messagingSenderId:"770507129209",appId:"1:770507129209:web:37a251e0b652911988afa8",measurementId:"G-Q837NJ8KC2"},t0=iS(xB),ot=dL(t0),$e=bj(t0),R3=iB(t0),wB=pB(t0);console.log(" Using production Firebase services");const _B=Object.freeze(Object.defineProperty({__proto__:null,auth:ot,db:$e,default:t0,functions:wB,storage:R3},Symbol.toStringTag,{value:"Module"}));class vB{constructor(){Qo(this,"currentUser",null);Qo(this,"authStateListeners",[]);eM(ot,async e=>{e?(console.log(" Auth state changed. Fetching user profile for:",e.email),this.currentUser=await this.getUserProfile(e.uid),console.log(" Auth state updated. Current user role:",this.currentUser.role)):this.currentUser=null,this.authStateListeners.forEach(n=>n(this.currentUser))})}async login(e){try{const n=await K5(ot,e.email,e.password),r=await this.getUserProfile(n.user.uid);if(!r.isActive)throw await hx(ot),new Error("Your account has been deactivated by an administrator. Please contact support.");const s=await n.user.getIdToken();return{user:r,token:s,expiresIn:"3600"}}catch(n){throw this.handleAuthError(n)}}async register(e){try{const n=await H5(ot,e.email,e.password);await OS(n.user,{displayName:e.displayName||e.username});const r={id:n.user.uid,email:e.email,username:e.username,role:e.role,displayName:e.displayName,createdAt:new Date().toISOString(),lastLoginAt:new Date().toISOString(),isActive:!0};await $0(Vt($e,"users",r.id),r);const s=await n.user.getIdToken();return{user:r,token:s}}catch(n){throw this.handleAuthError(n)}}async loginAsGuest(){try{const e=await G5(ot),n=e.user.uid,r=Date.now().toString().slice(-6),s={id:n,email:`guest_${r}@guest.local`,username:`Guest_${r}`,role:"guest",displayName:"Guest User",createdAt:new Date().toISOString(),lastLoginAt:new Date().toISOString(),isActive:!0};await $0(Vt($e,"users",n),s);const i=await e.user.getIdToken();return console.log(" Guest user created:",s.username),{user:s,token:i,expiresIn:"3600"}}catch(e){throw this.handleAuthError(e)}}async logout(){try{await hx(ot)}catch(e){throw this.handleAuthError(e)}}async getCurrentUser(){return this.currentUser}async getUserProfile(e){var n;try{const r=await ll(Vt($e,"users",e));if(!r.exists()){const i=ot.currentUser;if(i){const a={id:i.uid,email:i.email||"",username:i.displayName||((n=i.email)==null?void 0:n.split("@")[0])||"user",role:"archaeologist",displayName:i.displayName||void 0,createdAt:new Date().toISOString(),lastLoginAt:new Date().toISOString(),isActive:!0};return console.log(" Creating new user profile for:",i.email,"with role:",a.role),await $0(Vt($e,"users",e),a),a}throw new Error("User profile not found and could not create one")}const s=r.data();return console.log(" Loaded user profile:",s.email,"with role:",s.role),s}catch(r){throw console.error(" Error in getUserProfile:",r),this.handleAuthError(r)}}async updateUserProfile(e,n){try{const r=Vt($e,"users",e);await $0(r,n,{merge:!0});const s=await this.getUserProfile(e);return this.currentUser=s,s}catch(r){throw this.handleAuthError(r)}}async refreshToken(){try{const e=ot.currentUser;if(!e)throw new Error("No authenticated user");return await e.getIdToken(!0)}catch(e){throw this.handleAuthError(e)}}onAuthStateChange(e){return this.authStateListeners.push(e),()=>{const n=this.authStateListeners.indexOf(e);n>-1&&this.authStateListeners.splice(n,1)}}isAuthenticated(){return this.currentUser!==null}hasRole(e){var n;return((n=this.currentUser)==null?void 0:n.role)===e}hasAnyRole(e){return this.currentUser?e.includes(this.currentUser.role):!1}handleAuthError(e){let n="AUTHENTICATION_ERROR",r="An authentication error occurred";switch(e.code){case"auth/user-not-found":n="USER_NOT_FOUND",r="No user found with this email address";break;case"auth/wrong-password":n="INVALID_CREDENTIALS",r="Invalid email or password";break;case"auth/email-already-in-use":n="EMAIL_ALREADY_EXISTS",r="An account with this email already exists";break;case"auth/weak-password":n="WEAK_PASSWORD",r="Password should be at least 6 characters";break;case"auth/invalid-email":n="INVALID_EMAIL",r="Invalid email address";break;case"auth/too-many-requests":n="TOO_MANY_REQUESTS",r="Too many failed attempts. Please try again later";break;case"auth/network-request-failed":n="NETWORK_ERROR",r="Network error. Please check your connection";break;default:r=e.message||r}return{code:n,message:r,details:{originalError:e.code,timestamp:new Date().toISOString()}}}}const uo=new vB,Ac=t=>{switch(t){case"admin":return{canCreateArtifacts:!0,canEditArtifacts:!0,canDeleteArtifacts:!0,canUploadPhotos:!0,canDeletePhotos:!0,canManageUsers:!0};case"archaeologist":return{canCreateArtifacts:!0,canEditArtifacts:!0,canDeleteArtifacts:!0,canUploadPhotos:!0,canDeletePhotos:!0,canManageUsers:!1};case"researcher":return{canCreateArtifacts:!1,canEditArtifacts:!1,canDeleteArtifacts:!1,canUploadPhotos:!1,canDeletePhotos:!1,canManageUsers:!1};case"guest":return{canCreateArtifacts:!1,canEditArtifacts:!1,canDeleteArtifacts:!1,canUploadPhotos:!1,canDeletePhotos:!1,canManageUsers:!1};default:return{canCreateArtifacts:!1,canEditArtifacts:!1,canDeleteArtifacts:!1,canUploadPhotos:!1,canDeletePhotos:!1,canManageUsers:!1}}},P3=(t,e)=>{const n=Ac(t);return t==="admin"||!e?n:{canCreateArtifacts:n.canCreateArtifacts&&e.canCreateArtifacts,canEditArtifacts:n.canEditArtifacts&&e.canEditArtifacts,canDeleteArtifacts:n.canDeleteArtifacts&&e.canDeleteArtifacts,canUploadPhotos:n.canUploadPhotos&&e.canCreateArtifacts,canDeletePhotos:n.canDeletePhotos&&e.canDeleteArtifacts,canManageUsers:n.canManageUsers}},k3=H.createContext(void 0),EB=({children:t})=>{const[e,n]=H.useState(null),[r,s]=H.useState(!0),[i,a]=H.useState(null),u=H.useCallback(()=>{a(null)},[]),d=H.useCallback(async O=>{try{s(!0),a(null);const T=await uo.login(O);n(T.user)}catch(T){throw a(T),T}finally{s(!1)}},[]),m=H.useCallback(async O=>{try{s(!0),a(null);const T=await uo.register(O);n(T.user)}catch(T){throw a(T),T}finally{s(!1)}},[]),y=H.useCallback(async()=>{try{s(!0),a(null),await uo.logout(),n(null)}catch(O){throw a(O),O}finally{s(!1)}},[]),_=H.useCallback(async O=>{if(!e)throw new Error("No authenticated user");try{s(!0),a(null);const T=await uo.updateUserProfile(e.id,O);n(T)}catch(T){throw a(T),T}finally{s(!1)}},[e]),E=H.useCallback(async()=>{try{return a(null),await uo.refreshToken()}catch(O){throw a(O),O}},[]);H.useEffect(()=>{const O=uo.onAuthStateChange(C=>{n(C),s(!1)});return(async()=>{try{const C=await uo.getCurrentUser();n(C)}catch{n(null)}finally{s(!1)}})(),O},[]);const b=e!==null,k=e?Ac(e.role):null,S={user:e,loading:r,error:i,login:d,register:m,logout:y,updateProfile:_,refreshToken:E,isAuthenticated:b,permissions:k,clearError:u};return p.jsx(k3.Provider,{value:S,children:t})},bn=()=>{const t=H.useContext(k3);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},xh=()=>{const[t,e]=H.useState(navigator.onLine);return H.useEffect(()=>{const n=()=>{console.log(" Connection restored"),e(!0)},r=()=>{console.log(" Connection lost"),e(!1)};return window.addEventListener("online",n),window.addEventListener("offline",r),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}},[]),t},sn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Zn=Object.keys,Ur=Array.isArray;function es(t,e){return typeof e!="object"||Zn(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||sn.Promise||(sn.Promise=Promise);const yf=Object.getPrototypeOf,AB={}.hasOwnProperty;function Ds(t,e){return AB.call(t,e)}function Qu(t,e){typeof e=="function"&&(e=e(yf(t))),(typeof Reflect>"u"?Zn:Reflect.ownKeys)(e).forEach(n=>{Ao(t,n,e[n])})}const D3=Object.defineProperty;function Ao(t,e,n,r){D3(t,e,es(n&&Ds(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Eu(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Ao(t.prototype,"constructor",t),{extend:Qu.bind(null,t.prototype)}}}}const bB=Object.getOwnPropertyDescriptor;function Ov(t,e){let n;return bB(t,e)||(n=yf(t))&&Ov(n,e)}const IB=[].slice;function kg(t,e,n){return IB.call(t,e,n)}function O3(t,e){return e(t)}function hd(t){if(!t)throw new Error("Assertion Failed")}function M3(t){sn.setImmediate?setImmediate(t):setTimeout(t,0)}function L3(t,e){return t.reduce((n,r,s)=>{var i=e(r,s);return i&&(n[i[0]]=i[1]),n},{})}function bo(t,e){if(typeof e=="string"&&Ds(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,s=e.length;r<s;++r){var i=bo(t,e[r]);n.push(i)}return n}var a=e.indexOf(".");if(a!==-1){var u=t[e.substr(0,a)];return u==null?void 0:bo(u,e.substr(a+1))}}function gi(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){hd(typeof n!="string"&&"length"in n);for(var r=0,s=e.length;r<s;++r)gi(t,e[r],n[r])}else{var i=e.indexOf(".");if(i!==-1){var a=e.substr(0,i),u=e.substr(i+1);if(u==="")n===void 0?Ur(t)&&!isNaN(parseInt(a))?t.splice(a,1):delete t[a]:t[a]=n;else{var d=t[a];d&&Ds(t,a)||(d=t[a]={}),gi(d,u,n)}}else n===void 0?Ur(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function j3(t){var e={};for(var n in t)Ds(t,n)&&(e[n]=t[n]);return e}const CB=[].concat;function F3(t){return CB.apply([],t)}const B3="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(F3([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>sn[t]),TB=B3.map(t=>sn[t]);L3(B3,t=>[t,!0]);let ra=null;function n0(t){ra=typeof WeakMap<"u"&&new WeakMap;const e=Lx(t);return ra=null,e}function Lx(t){if(!t||typeof t!="object")return t;let e=ra&&ra.get(t);if(e)return e;if(Ur(t)){e=[],ra&&ra.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(Lx(t[n]))}else if(TB.indexOf(t.constructor)>=0)e=t;else{const i=yf(t);for(var s in e=i===Object.prototype?{}:Object.create(i),ra&&ra.set(t,e),t)Ds(t,s)&&(e[s]=Lx(t[s]))}return e}const{toString:SB}={};function jx(t){return SB.call(t).slice(8,-1)}const Fx=typeof Symbol<"u"?Symbol.iterator:"@@iterator",NB=typeof Fx=="symbol"?function(t){var e;return t!=null&&(e=t[Fx])&&e.apply(t)}:function(){return null},Qc={};function mo(t){var e,n,r,s;if(arguments.length===1){if(Ur(t))return t.slice();if(this===Qc&&typeof t=="string")return[t];if(s=NB(t)){for(n=[];!(r=s.next()).done;)n.push(r.value);return n}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const Mv=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var Qi=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function V3(t,e){Qi=t,U3=e}var U3=()=>!0;const RB=!new Error("").stack;function bc(){if(RB)try{throw bc.arguments,new Error}catch(t){return t}return new Error}function Bx(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(U3).map(r=>`
`+r).join("")):""}var z3=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Lv=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(z3),PB={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Au(t,e){this._e=bc(),this.name=t,this.message=e}function G3(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,s)=>s.indexOf(n)===r).join(`
`)}function Dg(t,e,n,r){this._e=bc(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=G3(t,e)}function Nd(t,e){this._e=bc(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=G3(t,e)}Eu(Au).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Bx(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Eu(Dg).from(Au),Eu(Nd).from(Au);var jv=Lv.reduce((t,e)=>(t[e]=e+"Error",t),{});const kB=Au;var Ye=Lv.reduce((t,e)=>{var n=e+"Error";function r(s,i){this._e=bc(),this.name=n,s?typeof s=="string"?(this.message=`${s}${i?`
 `+i:""}`,this.inner=i||null):typeof s=="object"&&(this.message=`${s.name} ${s.message}`,this.inner=s):(this.message=PB[e]||n,this.inner=null)}return Eu(r).from(kB),t[e]=r,t},{});Ye.Syntax=SyntaxError,Ye.Type=TypeError,Ye.Range=RangeError;var Tb=z3.reduce((t,e)=>(t[e+"Error"]=Ye[e],t),{}),Pm=Lv.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=Ye[e]),t),{});function $t(){}function xf(t){return t}function DB(t,e){return t==null||t===xf?e:function(n){return e(t(n))}}function lc(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function OB(t,e){return t===$t?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var i=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?lc(r,this.onsuccess):r),s&&(this.onerror=this.onerror?lc(s,this.onerror):s),i!==void 0?i:n}}function MB(t,e){return t===$t?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?lc(n,this.onsuccess):n),r&&(this.onerror=this.onerror?lc(r,this.onerror):r)}}function LB(t,e){return t===$t?e:function(n){var r=t.apply(this,arguments);es(n,r);var s=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?lc(s,this.onsuccess):s),i&&(this.onerror=this.onerror?lc(i,this.onerror):i),r===void 0?a===void 0?void 0:a:es(r,a)}}function jB(t,e){return t===$t?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function Fv(t,e){return t===$t?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,s=arguments.length,i=new Array(s);s--;)i[s]=arguments[s];return n.then(function(){return e.apply(r,i)})}return e.apply(this,arguments)}}Pm.ModifyError=Dg,Pm.DexieError=Au,Pm.BulkError=Nd;var wf={};const q3=100,[Vx,Og,Ux]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,yf(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,yf(e),t]})(),W3=Og&&Og.then,km=Vx&&Vx.constructor,Bv=!!Ux;var zx=!1,FB=Ux?()=>{Ux.then(X0)}:sn.setImmediate?setImmediate.bind(null,X0):sn.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{X0(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(X0,0)},Rd=function(t,e){dd.push([t,e]),Mg&&(FB(),Mg=!1)},Gx=!0,Mg=!0,zl=[],Dm=[],qx=null,Wx=xf,bu={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Rb,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{Rb(t[0],t[1])}catch{}})}},We=bu,dd=[],Gl=0,Om=[];function De(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=$t,this._lib=!1;var e=this._PSD=We;if(Qi&&(this._stackHolder=bc(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==wf)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Hx(this,this._value))}this._state=null,this._value=null,++e.ref,H3(this,t)}const $x={get:function(){var t=We,e=Lg;function n(r,s){var i=!t.global&&(t!==We||e!==Lg);const a=i&&!Lo();var u=new De((d,m)=>{Vv(this,new $3(jg(r,t,i,a),jg(s,t,i,a),d,m,t))});return Qi&&X3(u,this),u}return n.prototype=wf,n},set:function(t){Ao(this,"then",t&&t.prototype===wf?$x:{get:function(){return t},set:$x.set})}};function $3(t,e,n,r,s){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=s}function H3(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&r0();n&&typeof n.then=="function"?H3(t,(s,i)=>{n instanceof De?n._then(s,i):n.then(s,i)}):(t._state=!0,t._value=n,K3(t)),r&&s0()}},Hx.bind(null,t))}catch(n){Hx(t,n)}}function Hx(t,e){if(Dm.push(e),t._state===null){var n=t._lib&&r0();e=Wx(e),t._state=!1,t._value=e,Qi&&e!==null&&typeof e=="object"&&!e._promise&&function(r,s,i){try{r.apply(null,i)}catch(a){s&&s(a)}}(()=>{var r=Ov(e,"stack");e._promise=t,Ao(e,"stack",{get:()=>zx?r&&(r.get?r.get.apply(e):r.value):t.stack})}),function(r){zl.some(s=>s._value===r._value)||zl.push(r)}(t),K3(t),n&&s0()}}function K3(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)Vv(t,e[n]);var s=t._PSD;--s.ref||s.finalize(),Gl===0&&(++Gl,Rd(()=>{--Gl==0&&Uv()},[]))}function Vv(t,e){if(t._state!==null){var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Gl,Rd(BB,[n,t,e])}else t._listeners.push(e)}function BB(t,e,n){try{qx=e;var r,s=e._value;e._state?r=t(s):(Dm.length&&(Dm=[]),r=t(s),Dm.indexOf(s)===-1&&function(i){for(var a=zl.length;a;)if(zl[--a]._value===i._value)return void zl.splice(a,1)}(e)),n.resolve(r)}catch(i){n.reject(i)}finally{qx=null,--Gl==0&&Uv(),--n.psd.ref||n.psd.finalize()}}function Q3(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var s,i,a=t._value;a!=null?(s=a.name||"Error",i=a.message||a,r=Bx(a,0)):(s=a,i=""),e.push(s+(i?": "+i:"")+r)}return Qi&&((r=Bx(t._stackHolder,2))&&e.indexOf(r)===-1&&e.push(r),t._prev&&Q3(t._prev,e,n)),e}function X3(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function X0(){r0()&&s0()}function r0(){var t=Gx;return Gx=!1,Mg=!1,t}function s0(){var t,e,n;do for(;dd.length>0;)for(t=dd,dd=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(dd.length>0);Gx=!0,Mg=!0}function Uv(){var t=zl;zl=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=Om.slice(0),n=e.length;n;)e[--n]()}function Y0(t){return new De(wf,!1,t)}function un(t,e){var n=We;return function(){var r=r0(),s=We;try{return Ka(n,!0),t.apply(this,arguments)}catch(i){e&&e(i)}finally{Ka(s,!1),r&&s0()}}}Qu(De.prototype,{then:$x,_then:function(t,e){Vv(this,new $3(null,null,t,e,We))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):Y0(r)):this.then(null,r=>r&&r.name===e?n(r):Y0(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),Y0(e)))},stack:{get:function(){if(this._stack)return this._stack;try{zx=!0;var t=Q3(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{zx=!1}}},timeout:function(t,e){return t<1/0?new De((n,r)=>{var s=setTimeout(()=>r(new Ye.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,s))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Ao(De.prototype,Symbol.toStringTag,"Dexie.Promise"),bu.env=Y3(),Qu(De,{all:function(){var t=mo.apply(null,arguments).map(Z0);return new De(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((s,i)=>De.resolve(s).then(a=>{t[i]=a,--r||e(t)},n))})},resolve:t=>{if(t instanceof De)return t;if(t&&typeof t.then=="function")return new De((n,r)=>{t.then(n,r)});var e=new De(wf,!0,t);return X3(e,qx),e},reject:Y0,race:function(){var t=mo.apply(null,arguments).map(Z0);return new De((e,n)=>{t.map(r=>De.resolve(r).then(e,n))})},PSD:{get:()=>We,set:t=>We=t},totalEchoes:{get:()=>Lg},newPSD:Ha,usePSD:_h,scheduler:{get:()=>Rd,set:t=>{Rd=t}},rejectionMapper:{get:()=>Wx,set:t=>{Wx=t}},follow:(t,e)=>new De((n,r)=>Ha((s,i)=>{var a=We;a.unhandleds=[],a.onunhandled=i,a.finalize=lc(function(){(function(u){function d(){u(),Om.splice(Om.indexOf(d),1)}Om.push(d),++Gl,Rd(()=>{--Gl==0&&Uv()},[])})(()=>{this.unhandleds.length===0?s():i(this.unhandleds[0])})},a.finalize),t()},e,n,r))}),km&&(km.allSettled&&Ao(De,"allSettled",function(){const t=mo.apply(null,arguments).map(Z0);return new De(e=>{t.length===0&&e([]);let n=t.length;const r=new Array(n);t.forEach((s,i)=>De.resolve(s).then(a=>r[i]={status:"fulfilled",value:a},a=>r[i]={status:"rejected",reason:a}).then(()=>--n||e(r)))})}),km.any&&typeof AggregateError<"u"&&Ao(De,"any",function(){const t=mo.apply(null,arguments).map(Z0);return new De((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length;const s=new Array(r);t.forEach((i,a)=>De.resolve(i).then(u=>e(u),u=>{s[a]=u,--r||n(new AggregateError(s))}))})}));const Vr={awaits:0,echoes:0,id:0};var VB=0,Mm=[],W1=0,Lg=0,UB=0;function Ha(t,e,n,r){var s=We,i=Object.create(s);i.parent=s,i.ref=0,i.global=!1,i.id=++UB;var a=bu.env;i.env=Bv?{Promise:De,PromiseProp:{value:De,configurable:!0,writable:!0},all:De.all,race:De.race,allSettled:De.allSettled,any:De.any,resolve:De.resolve,reject:De.reject,nthen:Sb(a.nthen,i),gthen:Sb(a.gthen,i)}:{},e&&es(i,e),++s.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=_h(i,t,n,r);return i.ref===0&&i.finalize(),u}function wh(){return Vr.id||(Vr.id=++VB),++Vr.awaits,Vr.echoes+=q3,Vr.id}function Lo(){return!!Vr.awaits&&(--Vr.awaits==0&&(Vr.id=0),Vr.echoes=Vr.awaits*q3,!0)}function Z0(t){return Vr.echoes&&t&&t.constructor===km?(wh(),t.then(e=>(Lo(),e),e=>(Lo(),lr(e)))):t}function zB(t){++Lg,Vr.echoes&&--Vr.echoes!=0||(Vr.echoes=Vr.id=0),Mm.push(We),Ka(t,!0)}function GB(){var t=Mm[Mm.length-1];Mm.pop(),Ka(t,!1)}function Ka(t,e){var n=We;if((e?!Vr.echoes||W1++&&t===We:!W1||--W1&&t===We)||Z3(e?zB.bind(null,t):GB),t!==We&&(We=t,n===bu&&(bu.env=Y3()),Bv)){var r=bu.env.Promise,s=t.env;Og.then=s.nthen,r.prototype.then=s.gthen,(n.global||t.global)&&(Object.defineProperty(sn,"Promise",s.PromiseProp),r.all=s.all,r.race=s.race,r.resolve=s.resolve,r.reject=s.reject,s.allSettled&&(r.allSettled=s.allSettled),s.any&&(r.any=s.any))}}function Y3(){var t=sn.Promise;return Bv?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(sn,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:Og.then,gthen:t.prototype.then}:{}}function _h(t,e,n,r,s){var i=We;try{return Ka(t,!0),e(n,r,s)}finally{Ka(i,!1)}}function Z3(t){W3.call(Vx,t)}function jg(t,e,n,r){return typeof t!="function"?t:function(){var s=We;n&&wh(),Ka(e,!0);try{return t.apply(this,arguments)}finally{Ka(s,!1),r&&Z3(Lo)}}}function Sb(t,e){return function(n,r){return t.call(this,jg(n,e),jg(r,e))}}(""+W3).indexOf("[native code]")===-1&&(wh=Lo=$t);const Nb="unhandledrejection";function Rb(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,s={promise:e,reason:t};if(sn.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(Nb,!0,!0),es(r,s)):sn.CustomEvent&&es(r=new CustomEvent(Nb,{detail:s}),s),r&&sn.dispatchEvent&&(dispatchEvent(r),!sn.PromiseRejectionEvent&&sn.onunhandledrejection))try{sn.onunhandledrejection(r)}catch{}Qi&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var lr=De.reject;function Kx(t,e,n,r){if(t.idbdb&&(t._state.openComplete||We.letThrough||t._vip)){var s=t._createTransaction(e,n,t._dbSchema);try{s.create(),t._state.PR1398_maxLoop=3}catch(i){return i.name===jv.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Kx(t,e,n,r))):lr(i)}return s._promise(e,(i,a)=>Ha(()=>(We.trans=s,r(i,a,s)))).then(i=>s._completion.then(()=>i))}if(t._state.openComplete)return lr(new Ye.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return lr(new Ye.DatabaseClosed);t.open().catch($t)}return t._state.dbReadyPromise.then(()=>Kx(t,e,n,r))}const Pb="3.2.7",Ml=String.fromCharCode(65535),Qx=-1/0,oo="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",J3="String expected.",Pd=[],qp=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),qB=qp,WB=qp,e4=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),Wp="__dbnames",$1="readonly",H1="readwrite";function cc(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const t4={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function J0(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=n0(e))[t],e)}class $B{_trans(e,n,r){const s=this._tx||We.trans,i=this.name;function a(d,m,y){if(!y.schema[i])throw new Ye.NotFound("Table "+i+" not part of transaction");return n(y.idbtrans,y)}const u=r0();try{return s&&s.db===this.db?s===We.trans?s._promise(e,a,r):Ha(()=>s._promise(e,a,r),{trans:s,transless:We.transless||We}):Kx(this.db,e,[this.name],a)}finally{u&&s0()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(s=>this.hook.reading.fire(s))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Ur(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const n=Zn(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(m=>{if(m.compound&&n.every(y=>m.keyPath.indexOf(y)>=0)){for(let y=0;y<n.length;++y)if(n.indexOf(m.keyPath[y])===-1)return!1;return!0}return!1}).sort((m,y)=>m.keyPath.length-y.keyPath.length)[0];if(r&&this.db._maxKey!==Ml){const m=r.keyPath.slice(0,n.length);return this.where(m).equals(m.map(y=>e[y]))}!r&&Qi&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:s}=this.schema,i=this.db._deps.indexedDB;function a(m,y){try{return i.cmp(m,y)===0}catch{return!1}}const[u,d]=n.reduce(([m,y],_)=>{const E=s[_],b=e[_];return[m||E,m||!E?cc(y,E&&E.multi?k=>{const S=bo(k,_);return Ur(S)&&S.some(O=>a(b,O))}:k=>a(b,bo(k,_))):y]},[null,null]);return u?this.where(u.name).equals(e[u.keyPath]).filter(d):r?this.filter(d):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Ur(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const n=r=>{if(!r)return r;const s=Object.create(e.prototype);for(var i in r)if(Ds(r,i))try{s[i]=r[i]}catch{}return s};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e}defineClass(){return this.mapToClass(function(e){es(this,e)})}add(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let i=e;return s&&r&&(i=J0(s)(e)),this._trans("readwrite",a=>this.core.mutate({trans:a,type:"add",keys:n!=null?[n]:null,values:[i]})).then(a=>a.numFailures?De.reject(a.failures[0]):a.lastResult).then(a=>{if(s)try{gi(e,s,a)}catch{}return a})}update(e,n){if(typeof e!="object"||Ur(e))return this.where(":id").equals(e).modify(n);{const r=bo(e,this.schema.primKey.keyPath);if(r===void 0)return lr(new Ye.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?Zn(n).forEach(s=>{gi(e,s,n[s])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let i=e;return s&&r&&(i=J0(s)(e)),this._trans("readwrite",a=>this.core.mutate({trans:a,type:"put",values:[i],keys:n!=null?[n]:null})).then(a=>a.numFailures?De.reject(a.failures[0]):a.lastResult).then(a=>{if(s)try{gi(e,s,a)}catch{}return a})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?De.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:t4})).then(e=>e.numFailures?De.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(r=>r.map(s=>this.hook.reading.fire(s))))}bulkAdd(e,n,r){const s=Array.isArray(n)?n:void 0,i=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",a=>{const{auto:u,keyPath:d}=this.schema.primKey;if(d&&s)throw new Ye.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new Ye.InvalidArgument("Arguments objects and keys must have the same length");const m=e.length;let y=d&&u?e.map(J0(d)):e;return this.core.mutate({trans:a,type:"add",keys:s,values:y,wantResults:i}).then(({numFailures:_,results:E,lastResult:b,failures:k})=>{if(_===0)return i?E:b;throw new Nd(`${this.name}.bulkAdd(): ${_} of ${m} operations failed`,k)})})}bulkPut(e,n,r){const s=Array.isArray(n)?n:void 0,i=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",a=>{const{auto:u,keyPath:d}=this.schema.primKey;if(d&&s)throw new Ye.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new Ye.InvalidArgument("Arguments objects and keys must have the same length");const m=e.length;let y=d&&u?e.map(J0(d)):e;return this.core.mutate({trans:a,type:"put",keys:s,values:y,wantResults:i}).then(({numFailures:_,results:E,lastResult:b,failures:k})=>{if(_===0)return i?E:b;throw new Nd(`${this.name}.bulkPut(): ${_} of ${m} operations failed`,k)})})}bulkDelete(e){const n=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:s,failures:i})=>{if(r===0)return s;throw new Nd(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,i)})}}function kd(t){var e={},n=function(a,u){if(u){for(var d=arguments.length,m=new Array(d-1);--d;)m[d-1]=arguments[d];return e[a].subscribe.apply(null,m),t}if(typeof a=="string")return e[a]};n.addEventType=i;for(var r=1,s=arguments.length;r<s;++r)i(arguments[r]);return n;function i(a,u,d){if(typeof a!="object"){var m;u||(u=jB),d||(d=$t);var y={subscribers:[],fire:d,subscribe:function(_){y.subscribers.indexOf(_)===-1&&(y.subscribers.push(_),y.fire=u(y.fire,_))},unsubscribe:function(_){y.subscribers=y.subscribers.filter(function(E){return E!==_}),y.fire=y.subscribers.reduce(u,d)}};return e[a]=n[a]=y,y}Zn(m=a).forEach(function(_){var E=m[_];if(Ur(E))i(_,m[_][0],m[_][1]);else{if(E!=="asap")throw new Ye.InvalidArgument("Invalid event config");var b=i(_,xf,function(){for(var k=arguments.length,S=new Array(k);k--;)S[k]=arguments[k];b.subscribers.forEach(function(O){M3(function(){O.apply(null,S)})})})}})}}function Jh(t,e){return Eu(e).from({prototype:t}),e}function zc(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function K1(t,e){t.filter=cc(t.filter,e)}function Q1(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>cc(r(),e()):e,t.justLimit=n&&!r}function Lm(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new Ye.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function kb(t,e,n){const r=Lm(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function em(t,e,n,r){const s=t.replayFilter?cc(t.filter,t.replayFilter()):t.filter;if(t.or){const i={},a=(u,d,m)=>{if(!s||s(d,m,E=>d.stop(E),E=>d.fail(E))){var y=d.primaryKey,_=""+y;_==="[object ArrayBuffer]"&&(_=""+new Uint8Array(y)),Ds(i,_)||(i[_]=!0,e(u,d,m))}};return Promise.all([t.or._iterate(a,n),Db(kb(t,r,n),t.algorithm,a,!t.keysOnly&&t.valueMapper)])}return Db(kb(t,r,n),cc(t.algorithm,s),e,!t.keysOnly&&t.valueMapper)}function Db(t,e,n,r){var s=un(r?(i,a,u)=>n(r(i),a,u):n);return t.then(i=>{if(i)return i.start(()=>{var a=()=>i.continue();e&&!e(i,u=>a=u,u=>{i.stop(u),a=$t},u=>{i.fail(u),a=$t})||s(i.value,i,u=>a=u),a()})})}function Yr(t,e){try{const n=Ob(t),r=Ob(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(s,i){const a=s.length,u=i.length,d=a<u?a:u;for(let m=0;m<d;++m)if(s[m]!==i[m])return s[m]<i[m]?-1:1;return a===u?0:a<u?-1:1}(Mb(t),Mb(e));case"Array":return function(s,i){const a=s.length,u=i.length,d=a<u?a:u;for(let m=0;m<d;++m){const y=Yr(s[m],i[m]);if(y!==0)return y}return a===u?0:a<u?-1:1}(t,e)}}catch{}return NaN}function Ob(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const n=jx(t);return n==="ArrayBuffer"?"binary":n}function Mb(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class HB{_read(e,n){var r=this._ctx;return r.error?r.table._trans(null,lr.bind(null,r.error)):r.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,lr.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=cc(n.algorithm,e)}_iterate(e,n){return em(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&es(r,e),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(r=>em(n,e,r,n.table.core))}count(e){return this._read(n=>{const r=this._ctx,s=r.table.core;if(zc(r,!0))return s.count({trans:n,query:{index:Lm(r,s.schema),range:r.range}}).then(a=>Math.min(a,r.limit));var i=0;return em(r,()=>(++i,!1),n,s).then(()=>i)}).then(e)}sortBy(e,n){const r=e.split(".").reverse(),s=r[0],i=r.length-1;function a(m,y){return y?a(m[r[y]],y-1):m[s]}var u=this._ctx.dir==="next"?1:-1;function d(m,y){var _=a(m,i),E=a(y,i);return _<E?-u:_>E?u:0}return this.toArray(function(m){return m.sort(d)}).then(n)}toArray(e){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&zc(r,!0)&&r.limit>0){const{valueMapper:s}=r,i=Lm(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:i,range:r.range}}).then(({result:a})=>s?a.map(s):a)}{const s=[];return em(r,i=>s.push(i),n,r.table.core).then(()=>s)}},e)}offset(e){var n=this._ctx;return e<=0||(n.offset+=e,zc(n)?Q1(n,()=>{var r=e;return(s,i)=>r===0||(r===1?(--r,!1):(i(()=>{s.advance(r),r=0}),!1))}):Q1(n,()=>{var r=e;return()=>--r<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Q1(this._ctx,()=>{var n=e;return function(r,s,i){return--n<=0&&s(i),n>=0}},!0),this}until(e,n){return K1(this._ctx,function(r,s,i){return!e(r.value)||(s(i),n)}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var n,r;return K1(this._ctx,function(s){return e(s.value)}),n=this._ctx,r=e,n.isMatch=cc(n.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.key,s)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.primaryKey,s)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,i){r.push(i.key)}).then(function(){return r}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&zc(n,!0)&&n.limit>0)return this._read(s=>{var i=Lm(n,n.table.core.schema);return n.table.core.query({trans:s,values:!1,limit:n.limit,query:{index:i,range:n.range}})}).then(({result:s})=>s).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,i){r.push(i.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return K1(this._ctx,function(s){var i=s.primaryKey.toString(),a=Ds(r,i);return r[i]=!0,!a}),this}modify(e){var n=this._ctx;return this._write(r=>{var s;if(typeof e=="function")s=e;else{var i=Zn(e),a=i.length;s=function(S){for(var O=!1,T=0;T<a;++T){var C=i[T],R=e[C];bo(S,C)!==R&&(gi(S,C,R),O=!0)}return O}}const u=n.table.core,{outbound:d,extractKey:m}=u.schema.primaryKey,y=this.db._options.modifyChunkSize||200,_=[];let E=0;const b=[],k=(S,O)=>{const{failures:T,numFailures:C}=O;E+=S-C;for(let R of Zn(T))_.push(T[R])};return this.clone().primaryKeys().then(S=>{const O=T=>{const C=Math.min(y,S.length-T);return u.getMany({trans:r,keys:S.slice(T,T+C),cache:"immutable"}).then(R=>{const j=[],K=[],Q=d?[]:null,D=[];for(let F=0;F<C;++F){const W=R[F],X={value:n0(W),primKey:S[T+F]};s.call(X,X.value,X)!==!1&&(X.value==null?D.push(S[T+F]):d||Yr(m(W),m(X.value))===0?(K.push(X.value),d&&Q.push(S[T+F])):(D.push(S[T+F]),j.push(X.value)))}const B=zc(n)&&n.limit===1/0&&(typeof e!="function"||e===X1)&&{index:n.index,range:n.range};return Promise.resolve(j.length>0&&u.mutate({trans:r,type:"add",values:j}).then(F=>{for(let W in F.failures)D.splice(parseInt(W),1);k(j.length,F)})).then(()=>(K.length>0||B&&typeof e=="object")&&u.mutate({trans:r,type:"put",keys:Q,values:K,criteria:B,changeSpec:typeof e!="function"&&e}).then(F=>k(K.length,F))).then(()=>(D.length>0||B&&e===X1)&&u.mutate({trans:r,type:"delete",keys:D,criteria:B}).then(F=>k(D.length,F))).then(()=>S.length>T+C&&O(T+y))})};return O(0).then(()=>{if(_.length>0)throw new Dg("Error modifying one or more objects",_,E,b);return S.length})})})}delete(){var e=this._ctx,n=e.range;return zc(e)&&(e.isPrimKey&&!WB||n.type===3)?this._write(r=>{const{primaryKey:s}=e.table.core.schema,i=n;return e.table.core.count({trans:r,query:{index:s,range:i}}).then(a=>e.table.core.mutate({trans:r,type:"deleteRange",range:i}).then(({failures:u,lastResult:d,results:m,numFailures:y})=>{if(y)throw new Dg("Could not delete some values",Object.keys(u).map(_=>u[_]),a-y);return a-y}))}):this.modify(X1)}}const X1=(t,e)=>e.value=null;function KB(t,e){return t<e?-1:t===e?0:1}function QB(t,e){return t>e?-1:t===e?0:1}function bs(t,e,n){var r=t instanceof r4?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function Gc(t){return new t.Collection(t,()=>n4("")).limit(0)}function XB(t,e,n,r,s,i){for(var a=Math.min(t.length,r.length),u=-1,d=0;d<a;++d){var m=e[d];if(m!==r[d])return s(t[d],n[d])<0?t.substr(0,d)+n[d]+n.substr(d+1):s(t[d],r[d])<0?t.substr(0,d)+r[d]+n.substr(d+1):u>=0?t.substr(0,u)+e[u]+n.substr(u+1):null;s(t[d],m)<0&&(u=d)}return a<r.length&&i==="next"?t+n.substr(t.length):a<t.length&&i==="prev"?t.substr(0,n.length):u<0?null:t.substr(0,u)+r[u]+n.substr(u+1)}function tm(t,e,n,r){var s,i,a,u,d,m,y,_=n.length;if(!n.every(S=>typeof S=="string"))return bs(t,J3);function E(S){s=function(T){return T==="next"?C=>C.toUpperCase():C=>C.toLowerCase()}(S),i=function(T){return T==="next"?C=>C.toLowerCase():C=>C.toUpperCase()}(S),a=S==="next"?KB:QB;var O=n.map(function(T){return{lower:i(T),upper:s(T)}}).sort(function(T,C){return a(T.lower,C.lower)});u=O.map(function(T){return T.upper}),d=O.map(function(T){return T.lower}),m=S,y=S==="next"?"":r}E("next");var b=new t.Collection(t,()=>ea(u[0],d[_-1]+r));b._ondirectionchange=function(S){E(S)};var k=0;return b._addAlgorithm(function(S,O,T){var C=S.key;if(typeof C!="string")return!1;var R=i(C);if(e(R,d,k))return!0;for(var j=null,K=k;K<_;++K){var Q=XB(C,R,u[K],d[K],a,m);Q===null&&j===null?k=K+1:(j===null||a(j,Q)>0)&&(j=Q)}return O(j!==null?function(){S.continue(j+y)}:T),!1}),b}function ea(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function n4(t){return{type:1,lower:t,upper:t}}class r4{get Collection(){return this._ctx.table.db.Collection}between(e,n,r,s){r=r!==!1,s=s===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||s)&&(!r||!s)?Gc(this):new this.Collection(this,()=>ea(e,n,!r,!s))}catch{return bs(this,oo)}}equals(e){return e==null?bs(this,oo):new this.Collection(this,()=>n4(e))}above(e){return e==null?bs(this,oo):new this.Collection(this,()=>ea(e,void 0,!0))}aboveOrEqual(e){return e==null?bs(this,oo):new this.Collection(this,()=>ea(e,void 0,!1))}below(e){return e==null?bs(this,oo):new this.Collection(this,()=>ea(void 0,e,!1,!0))}belowOrEqual(e){return e==null?bs(this,oo):new this.Collection(this,()=>ea(void 0,e))}startsWith(e){return typeof e!="string"?bs(this,J3):this.between(e,e+Ml,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):tm(this,(n,r)=>n.indexOf(r[0])===0,[e],Ml)}equalsIgnoreCase(e){return tm(this,(n,r)=>n===r[0],[e],"")}anyOfIgnoreCase(){var e=mo.apply(Qc,arguments);return e.length===0?Gc(this):tm(this,(n,r)=>r.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=mo.apply(Qc,arguments);return e.length===0?Gc(this):tm(this,(n,r)=>r.some(s=>n.indexOf(s)===0),e,Ml)}anyOf(){const e=mo.apply(Qc,arguments);let n=this._cmp;try{e.sort(n)}catch{return bs(this,oo)}if(e.length===0)return Gc(this);const r=new this.Collection(this,()=>ea(e[0],e[e.length-1]));r._ondirectionchange=i=>{n=i==="next"?this._ascending:this._descending,e.sort(n)};let s=0;return r._addAlgorithm((i,a,u)=>{const d=i.key;for(;n(d,e[s])>0;)if(++s,s===e.length)return a(u),!1;return n(d,e[s])===0||(a(()=>{i.continue(e[s])}),!1)}),r}notEqual(e){return this.inAnyRange([[Qx,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=mo.apply(Qc,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return bs(this,oo)}const n=e.reduce((r,s)=>r?r.concat([[r[r.length-1][1],s]]):[[Qx,s]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){const r=this._cmp,s=this._ascending,i=this._descending,a=this._min,u=this._max;if(e.length===0)return Gc(this);if(!e.every(C=>C[0]!==void 0&&C[1]!==void 0&&s(C[0],C[1])<=0))return bs(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Ye.InvalidArgument);const d=!n||n.includeLowers!==!1,m=n&&n.includeUppers===!0;let y,_=s;function E(C,R){return _(C[0],R[0])}try{y=e.reduce(function(C,R){let j=0,K=C.length;for(;j<K;++j){const Q=C[j];if(r(R[0],Q[1])<0&&r(R[1],Q[0])>0){Q[0]=a(Q[0],R[0]),Q[1]=u(Q[1],R[1]);break}}return j===K&&C.push(R),C},[]),y.sort(E)}catch{return bs(this,oo)}let b=0;const k=m?C=>s(C,y[b][1])>0:C=>s(C,y[b][1])>=0,S=d?C=>i(C,y[b][0])>0:C=>i(C,y[b][0])>=0;let O=k;const T=new this.Collection(this,()=>ea(y[0][0],y[y.length-1][1],!d,!m));return T._ondirectionchange=C=>{C==="next"?(O=k,_=s):(O=S,_=i),y.sort(E)},T._addAlgorithm((C,R,j)=>{for(var K=C.key;O(K);)if(++b,b===y.length)return R(j),!1;return!!function(Q){return!k(Q)&&!S(Q)}(K)||(this._cmp(K,y[b][1])===0||this._cmp(K,y[b][0])===0||R(()=>{_===s?C.continue(y[b][0]):C.continue(y[b][1])}),!1)}),T}startsWithAnyOf(){const e=mo.apply(Qc,arguments);return e.every(n=>typeof n=="string")?e.length===0?Gc(this):this.inAnyRange(e.map(n=>[n,n+Ml])):bs(this,"startsWithAnyOf() only works with strings")}}function Pi(t){return un(function(e){return _f(e),t(e.target.error),!1})}function _f(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const vf="storagemutated",ga="x-storagemutated-1",Qa=kd(null,vf);class YB{_lock(){return hd(!We.global),++this._reculock,this._reculock!==1||We.global||(We.lockOwnerFor=this),this}_unlock(){if(hd(!We.global),--this._reculock==0)for(We.global||(We.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{_h(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&We.lockOwnerFor!==this}create(e){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(hd(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new Ye.DatabaseClosed(r);case"MissingAPIError":throw new Ye.MissingAPI(r.message,r);default:throw new Ye.OpenFailed(r)}if(!this.active)throw new Ye.TransactionInactive;return hd(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=un(s=>{_f(s),this._reject(e.error)}),e.onabort=un(s=>{_f(s),this.active&&this._reject(new Ye.Abort(e.error)),this.active=!1,this.on("abort").fire(s)}),e.oncomplete=un(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Qa.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,r){if(e==="readwrite"&&this.mode!=="readwrite")return lr(new Ye.ReadOnly("Transaction is readonly"));if(!this.active)return lr(new Ye.TransactionInactive);if(this._locked())return new De((i,a)=>{this._blockedFuncs.push([()=>{this._promise(e,n,r).then(i,a)},We])});if(r)return Ha(()=>{var i=new De((a,u)=>{this._lock();const d=n(a,u,this);d&&d.then&&d.then(a,u)});return i.finally(()=>this._unlock()),i._lib=!0,i});var s=new De((i,a)=>{var u=n(i,a,this);u&&u.then&&u.then(i,a)});return s._lib=!0,s}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();const r=De.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var s=n.idbtrans.objectStore(n.storeNames[0]);(function a(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(s.get(-1/0).onsuccess=a)})()}var i=n._waitingFor;return new De((a,u)=>{r.then(d=>n._waitingQueue.push(un(a.bind(null,d))),d=>n._waitingQueue.push(un(u.bind(null,d)))).finally(()=>{n._waitingFor===i&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Ye.Abort))}table(e){const n=this._memoizedTables||(this._memoizedTables={});if(Ds(n,e))return n[e];const r=this.schema[e];if(!r)throw new Ye.NotFound("Table "+e+" not part of transaction");const s=new this.db.Table(e,r,this);return s.core=this.db.core.table(e),n[e]=s,s}}function Xx(t,e,n,r,s,i,a){return{name:t,keyPath:e,unique:n,multi:r,auto:s,compound:i,src:(n&&!a?"&":"")+(r?"*":"")+(s?"++":"")+s4(e)}}function s4(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function i4(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:L3(n,r=>[r.name,r])}}let Ef=t=>{try{return t.only([[]]),Ef=()=>[[]],[[]]}catch{return Ef=()=>Ml,Ml}};function Yx(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?r=>r[e]:r=>bo(r,e)}(t):e=>bo(e,t)}function Lb(t){return[].slice.call(t)}let ZB=0;function Dd(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function JB(t,e,n){function r(d){if(d.type===3)return null;if(d.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:m,upper:y,lowerOpen:_,upperOpen:E}=d;return m===void 0?y===void 0?null:e.upperBound(y,!!E):y===void 0?e.lowerBound(m,!!_):e.bound(m,y,!!_,!!E)}const{schema:s,hasGetAll:i}=function(d,m){const y=Lb(d.objectStoreNames);return{schema:{name:d.name,tables:y.map(_=>m.objectStore(_)).map(_=>{const{keyPath:E,autoIncrement:b}=_,k=Ur(E),S=E==null,O={},T={name:_.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:S,compound:k,keyPath:E,autoIncrement:b,unique:!0,extractKey:Yx(E)},indexes:Lb(_.indexNames).map(C=>_.index(C)).map(C=>{const{name:R,unique:j,multiEntry:K,keyPath:Q}=C,D={name:R,compound:Ur(Q),keyPath:Q,unique:j,multiEntry:K,extractKey:Yx(Q)};return O[Dd(Q)]=D,D}),getIndexByKeyPath:C=>O[Dd(C)]};return O[":id"]=T.primaryKey,E!=null&&(O[Dd(E)]=T.primaryKey),T})},hasGetAll:y.length>0&&"getAll"in m.objectStore(y[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),a=s.tables.map(d=>function(m){const y=m.name;return{name:y,schema:m,mutate:function({trans:_,type:E,keys:b,values:k,range:S}){return new Promise((O,T)=>{O=un(O);const C=_.objectStore(y),R=C.keyPath==null,j=E==="put"||E==="add";if(!j&&E!=="delete"&&E!=="deleteRange")throw new Error("Invalid operation type: "+E);const{length:K}=b||k||{length:1};if(b&&k&&b.length!==k.length)throw new Error("Given keys array must have same length as given values array.");if(K===0)return O({numFailures:0,failures:{},results:[],lastResult:void 0});let Q;const D=[],B=[];let F=0;const W=$=>{++F,_f($)};if(E==="deleteRange"){if(S.type===4)return O({numFailures:F,failures:B,results:[],lastResult:void 0});S.type===3?D.push(Q=C.clear()):D.push(Q=C.delete(r(S)))}else{const[$,z]=j?R?[k,b]:[k,null]:[b,null];if(j)for(let Te=0;Te<K;++Te)D.push(Q=z&&z[Te]!==void 0?C[E]($[Te],z[Te]):C[E]($[Te])),Q.onerror=W;else for(let Te=0;Te<K;++Te)D.push(Q=C[E]($[Te])),Q.onerror=W}const X=$=>{const z=$.target.result;D.forEach((Te,ie)=>Te.error!=null&&(B[ie]=Te.error)),O({numFailures:F,failures:B,results:E==="delete"?b:D.map(Te=>Te.result),lastResult:z})};Q.onerror=$=>{W($),X($)},Q.onsuccess=X})},getMany:({trans:_,keys:E})=>new Promise((b,k)=>{b=un(b);const S=_.objectStore(y),O=E.length,T=new Array(O);let C,R=0,j=0;const K=D=>{const B=D.target;T[B._pos]=B.result,++j===R&&b(T)},Q=Pi(k);for(let D=0;D<O;++D)E[D]!=null&&(C=S.get(E[D]),C._pos=D,C.onsuccess=K,C.onerror=Q,++R);R===0&&b(T)}),get:({trans:_,key:E})=>new Promise((b,k)=>{b=un(b);const S=_.objectStore(y).get(E);S.onsuccess=O=>b(O.target.result),S.onerror=Pi(k)}),query:function(_){return E=>new Promise((b,k)=>{b=un(b);const{trans:S,values:O,limit:T,query:C}=E,R=T===1/0?void 0:T,{index:j,range:K}=C,Q=S.objectStore(y),D=j.isPrimaryKey?Q:Q.index(j.name),B=r(K);if(T===0)return b({result:[]});if(_){const F=O?D.getAll(B,R):D.getAllKeys(B,R);F.onsuccess=W=>b({result:W.target.result}),F.onerror=Pi(k)}else{let F=0;const W=O||!("openKeyCursor"in D)?D.openCursor(B):D.openKeyCursor(B),X=[];W.onsuccess=$=>{const z=W.result;return z?(X.push(O?z.value:z.primaryKey),++F===T?b({result:X}):void z.continue()):b({result:X})},W.onerror=Pi(k)}})}(i),openCursor:function({trans:_,values:E,query:b,reverse:k,unique:S}){return new Promise((O,T)=>{O=un(O);const{index:C,range:R}=b,j=_.objectStore(y),K=C.isPrimaryKey?j:j.index(C.name),Q=k?S?"prevunique":"prev":S?"nextunique":"next",D=E||!("openKeyCursor"in K)?K.openCursor(r(R),Q):K.openKeyCursor(r(R),Q);D.onerror=Pi(T),D.onsuccess=un(B=>{const F=D.result;if(!F)return void O(null);F.___id=++ZB,F.done=!1;const W=F.continue.bind(F);let X=F.continuePrimaryKey;X&&(X=X.bind(F));const $=F.advance.bind(F),z=()=>{throw new Error("Cursor not stopped")};F.trans=_,F.stop=F.continue=F.continuePrimaryKey=F.advance=()=>{throw new Error("Cursor not started")},F.fail=un(T),F.next=function(){let Te=1;return this.start(()=>Te--?this.continue():this.stop()).then(()=>this)},F.start=Te=>{const ie=new Promise((de,he)=>{de=un(de),D.onerror=Pi(he),F.fail=he,F.stop=Ce=>{F.stop=F.continue=F.continuePrimaryKey=F.advance=z,de(Ce)}}),Xe=()=>{if(D.result)try{Te()}catch(de){F.fail(de)}else F.done=!0,F.start=()=>{throw new Error("Cursor behind last entry")},F.stop()};return D.onsuccess=un(de=>{D.onsuccess=Xe,Xe()}),F.continue=W,F.continuePrimaryKey=X,F.advance=$,Xe(),ie},O(F)},T)})},count({query:_,trans:E}){const{index:b,range:k}=_;return new Promise((S,O)=>{const T=E.objectStore(y),C=b.isPrimaryKey?T:T.index(b.name),R=r(k),j=R?C.count(R):C.count();j.onsuccess=un(K=>S(K.target.result)),j.onerror=Pi(O)})}}}(d)),u={};return a.forEach(d=>u[d.name]=d),{stack:"dbcore",transaction:t.transaction.bind(t),table(d){if(!u[d])throw new Error(`Table '${d}' not found`);return u[d]},MIN_KEY:-1/0,MAX_KEY:Ef(e),schema:s}}function Zx({_novip:t},e){const n=e.db,r=function(s,i,{IDBKeyRange:a,indexedDB:u},d){return{dbcore:function(y,_){return _.reduce((E,{create:b})=>({...E,...b(E)}),y)}(JB(i,a,d),s.dbcore)}}(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(s=>{const i=s.name;t.core.schema.tables.some(a=>a.name===i)&&(s.core=t.core.table(i),t[i]instanceof t.Table&&(t[i].core=s.core))})}function Fg({_novip:t},e,n,r){n.forEach(s=>{const i=r[s];e.forEach(a=>{const u=Ov(a,s);(!u||"value"in u&&u.value===void 0)&&(a===t.Transaction.prototype||a instanceof t.Transaction?Ao(a,s,{get(){return this.table(s)},set(d){D3(this,s,{value:d,writable:!0,configurable:!0,enumerable:!0})}}):a[s]=new t.Table(s,i))})})}function Jx({_novip:t},e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function eV(t,e){return t._cfg.version-e._cfg.version}function tV(t,e,n,r){const s=t._dbSchema,i=t._createTransaction("readwrite",t._storeNames,s);i.create(n),i._completion.catch(r);const a=i._reject.bind(i),u=We.transless||We;Ha(()=>{We.trans=i,We.transless=u,e===0?(Zn(s).forEach(d=>{Y1(n,d,s[d].primKey,s[d].indexes)}),Zx(t,n),De.follow(()=>t.on.populate.fire(i)).catch(a)):function({_novip:d},m,y,_){const E=[],b=d._versions;let k=d._dbSchema=tw(d,d.idbdb,_),S=!1;const O=b.filter(C=>C._cfg.version>=m);function T(){return E.length?De.resolve(E.shift()(y.idbtrans)).then(T):De.resolve()}return O.forEach(C=>{E.push(()=>{const R=k,j=C._cfg.dbschema;nw(d,R,_),nw(d,j,_),k=d._dbSchema=j;const K=o4(R,j);K.add.forEach(D=>{Y1(_,D[0],D[1].primKey,D[1].indexes)}),K.change.forEach(D=>{if(D.recreate)throw new Ye.Upgrade("Not yet support for changing primary key");{const B=_.objectStore(D.name);D.add.forEach(F=>ew(B,F)),D.change.forEach(F=>{B.deleteIndex(F.name),ew(B,F)}),D.del.forEach(F=>B.deleteIndex(F))}});const Q=C._cfg.contentUpgrade;if(Q&&C._cfg.version>m){Zx(d,_),y._memoizedTables={},S=!0;let D=j3(j);K.del.forEach(X=>{D[X]=R[X]}),Jx(d,[d.Transaction.prototype]),Fg(d,[d.Transaction.prototype],Zn(D),D),y.schema=D;const B=Mv(Q);let F;B&&wh();const W=De.follow(()=>{if(F=Q(y),F&&B){var X=Lo.bind(null,null);F.then(X,X)}});return F&&typeof F.then=="function"?De.resolve(F):W.then(()=>F)}}),E.push(R=>{(!S||!qB)&&function(j,K){[].slice.call(K.db.objectStoreNames).forEach(Q=>j[Q]==null&&K.db.deleteObjectStore(Q))}(C._cfg.dbschema,R),Jx(d,[d.Transaction.prototype]),Fg(d,[d.Transaction.prototype],d._storeNames,d._dbSchema),y.schema=d._dbSchema})}),T().then(()=>{var C,R;R=_,Zn(C=k).forEach(j=>{R.db.objectStoreNames.contains(j)||Y1(R,j,C[j].primKey,C[j].indexes)})})}(t,e,i,n).catch(a)})}function o4(t,e){const n={del:[],add:[],change:[]};let r;for(r in t)e[r]||n.del.push(r);for(r in e){const s=t[r],i=e[r];if(s){const a={name:r,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||s.primKey.auto!==i.primKey.auto&&!qp)a.recreate=!0,n.change.push(a);else{const u=s.idxByName,d=i.idxByName;let m;for(m in u)d[m]||a.del.push(m);for(m in d){const y=u[m],_=d[m];y?y.src!==_.src&&a.change.push(_):a.add.push(_)}(a.del.length>0||a.add.length>0||a.change.length>0)&&n.change.push(a)}}else n.add.push([r,i])}return n}function Y1(t,e,n,r){const s=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(i=>ew(s,i)),s}function ew(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function tw(t,e,n){const r={};return kg(e.objectStoreNames,0).forEach(s=>{const i=n.objectStore(s);let a=i.keyPath;const u=Xx(s4(a),a||"",!1,!1,!!i.autoIncrement,a&&typeof a!="string",!0),d=[];for(let y=0;y<i.indexNames.length;++y){const _=i.index(i.indexNames[y]);a=_.keyPath;var m=Xx(_.name,a,!!_.unique,!!_.multiEntry,!1,a&&typeof a!="string",!1);d.push(m)}r[s]=i4(s,u,d)}),r}function nw({_novip:t},e,n){const r=n.db.objectStoreNames;for(let s=0;s<r.length;++s){const i=r[s],a=n.objectStore(i);t._hasGetAll="getAll"in a;for(let u=0;u<a.indexNames.length;++u){const d=a.indexNames[u],m=a.index(d).keyPath,y=typeof m=="string"?m:"["+kg(m).join("+")+"]";if(e[i]){const _=e[i].idxByName[y];_&&(_.name=d,delete e[i].idxByName[y],e[i].idxByName[d]=_)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&sn.WorkerGlobalScope&&sn instanceof sn.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class nV{_parseStoresSpec(e,n){Zn(e).forEach(r=>{if(e[r]!==null){var s=e[r].split(",").map((a,u)=>{const d=(a=a.trim()).replace(/([&*]|\+\+)/g,""),m=/^\[/.test(d)?d.match(/^\[(.*)\]$/)[1].split("+"):d;return Xx(d,m||null,/\&/.test(a),/\*/.test(a),/\+\+/.test(a),Ur(m),u===0)}),i=s.shift();if(i.multi)throw new Ye.Schema("Primary key cannot be multi-valued");s.forEach(a=>{if(a.auto)throw new Ye.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new Ye.Schema("Index must have a name and cannot be an empty string")}),n[r]=i4(r,i,s)}})}stores(e){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?es(this._cfg.storesSource,e):e;const r=n._versions,s={};let i={};return r.forEach(a=>{es(s,a._cfg.storesSource),i=a._cfg.dbschema={},a._parseStoresSpec(s,i)}),n._dbSchema=i,Jx(n,[n._allTables,n,n.Transaction.prototype]),Fg(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],Zn(i),i),n._storeNames=Zn(i),this}upgrade(e){return this._cfg.contentUpgrade=Fv(this._cfg.contentUpgrade||$t,e),this}}function zv(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new ql(Wp,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Gv(t){return t&&typeof t.databases=="function"}function rw(t){return Ha(function(){return We.letThrough=!0,t()})}function rV(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function sV(t){const e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?lr(e.dbOpenError):t);Qi&&(e.openCanceller._stackHolder=bc()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function s(){if(e.openCanceller!==r)throw new Ye.DatabaseClosed("db.open() was cancelled")}let i=e.dbReadyResolve,a=null,u=!1;const d=()=>new De((m,y)=>{if(s(),!n)throw new Ye.MissingAPI;const _=t.name,E=e.autoSchema?n.open(_):n.open(_,Math.round(10*t.verno));if(!E)throw new Ye.MissingAPI;E.onerror=Pi(y),E.onblocked=un(t._fireOnBlocked),E.onupgradeneeded=un(b=>{if(a=E.transaction,e.autoSchema&&!t._options.allowEmptyDB){E.onerror=_f,a.abort(),E.result.close();const S=n.deleteDatabase(_);S.onsuccess=S.onerror=un(()=>{y(new Ye.NoSuchDatabase(`Database ${_} doesnt exist`))})}else{a.onerror=Pi(y);var k=b.oldVersion>Math.pow(2,62)?0:b.oldVersion;u=k<1,t._novip.idbdb=E.result,tV(t,k/10,a,y)}},y),E.onsuccess=un(()=>{a=null;const b=t._novip.idbdb=E.result,k=kg(b.objectStoreNames);if(k.length>0)try{const O=b.transaction((S=k).length===1?S[0]:S,"readonly");e.autoSchema?function({_novip:T},C,R){T.verno=C.version/10;const j=T._dbSchema=tw(0,C,R);T._storeNames=kg(C.objectStoreNames,0),Fg(T,[T._allTables],Zn(j),j)}(t,b,O):(nw(t,t._dbSchema,O),function(T,C){const R=o4(tw(0,T.idbdb,C),T._dbSchema);return!(R.add.length||R.change.some(j=>j.add.length||j.change.length))}(t,O)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Zx(t,O)}catch{}var S;Pd.push(t),b.onversionchange=un(O=>{e.vcFired=!0,t.on("versionchange").fire(O)}),b.onclose=un(O=>{t.on("close").fire(O)}),u&&function({indexedDB:O,IDBKeyRange:T},C){!Gv(O)&&C!==Wp&&zv(O,T).put({name:C}).catch($t)}(t._deps,_),m()},y)}).catch(m=>m&&m.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),d()):De.reject(m));return De.race([r,(typeof navigator>"u"?De.resolve():rV()).then(d)]).then(()=>(s(),e.onReadyBeingFired=[],De.resolve(rw(()=>t.on.ready.fire(t.vip))).then(function m(){if(e.onReadyBeingFired.length>0){let y=e.onReadyBeingFired.reduce(Fv,$t);return e.onReadyBeingFired=[],De.resolve(rw(()=>y(t.vip))).then(m)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(m=>{e.dbOpenError=m;try{a&&a.abort()}catch{}return r===e.openCanceller&&t._close(),lr(m)}).finally(()=>{e.openComplete=!0,i()})}function sw(t){var e=i=>t.next(i),n=s(e),r=s(i=>t.throw(i));function s(i){return a=>{var u=i(a),d=u.value;return u.done?d:d&&typeof d.then=="function"?d.then(n,r):Ur(d)?Promise.all(d).then(n,r):n(d)}}return s(e)()}function iV(t,e,n){var r=arguments.length;if(r<2)throw new Ye.InvalidArgument("Too few arguments");for(var s=new Array(r-1);--r;)s[r-1]=arguments[r];return n=s.pop(),[t,F3(s),n]}function a4(t,e,n,r,s){return De.resolve().then(()=>{const i=We.transless||We,a=t._createTransaction(e,n,t._dbSchema,r),u={trans:a,transless:i};if(r)a.idbtrans=r.idbtrans;else try{a.create(),t._state.PR1398_maxLoop=3}catch(_){return _.name===jv.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>a4(t,e,n,null,s))):lr(_)}const d=Mv(s);let m;d&&wh();const y=De.follow(()=>{if(m=s.call(a,a),m)if(d){var _=Lo.bind(null,null);m.then(_,_)}else typeof m.next=="function"&&typeof m.throw=="function"&&(m=sw(m))},u);return(m&&typeof m.then=="function"?De.resolve(m).then(_=>a.active?_:lr(new Ye.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):y.then(()=>m)).then(_=>(r&&a._resolve(),a._completion.then(()=>_))).catch(_=>(a._reject(_),lr(_)))})}function nm(t,e,n){const r=Ur(t)?t.slice():[t];for(let s=0;s<n;++s)r.push(e);return r}const oV={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:r}=n,s={},i=[];function a(y,_,E){const b=Dd(y),k=s[b]=s[b]||[],S=y==null?0:typeof y=="string"?1:y.length,O=_>0,T={...E,isVirtual:O,keyTail:_,keyLength:S,extractKey:Yx(y),unique:!O&&E.unique};return k.push(T),T.isPrimaryKey||i.push(T),S>1&&a(S===2?y[0]:y.slice(0,S-1),_+1,E),k.sort((C,R)=>C.keyTail-R.keyTail),T}const u=a(r.primaryKey.keyPath,0,r.primaryKey);s[":id"]=[u];for(const y of r.indexes)a(y.keyPath,0,y);function d(y){const _=y.query.index;return _.isVirtual?{...y,query:{index:_,range:(E=y.query.range,b=_.keyTail,{type:E.type===1?2:E.type,lower:nm(E.lower,E.lowerOpen?t.MAX_KEY:t.MIN_KEY,b),lowerOpen:!0,upper:nm(E.upper,E.upperOpen?t.MIN_KEY:t.MAX_KEY,b),upperOpen:!0})}}:y;var E,b}return{...n,schema:{...r,primaryKey:u,indexes:i,getIndexByKeyPath:function(y){const _=s[Dd(y)];return _&&_[0]}},count:y=>n.count(d(y)),query:y=>n.query(d(y)),openCursor(y){const{keyTail:_,isVirtual:E,keyLength:b}=y.query.index;return E?n.openCursor(d(y)).then(k=>k&&function(S){return Object.create(S,{continue:{value:function(T){T!=null?S.continue(nm(T,y.reverse?t.MAX_KEY:t.MIN_KEY,_)):y.unique?S.continue(S.key.slice(0,b).concat(y.reverse?t.MIN_KEY:t.MAX_KEY,_)):S.continue()}},continuePrimaryKey:{value(T,C){S.continuePrimaryKey(nm(T,t.MAX_KEY,_),C)}},primaryKey:{get:()=>S.primaryKey},key:{get(){const T=S.key;return b===1?T[0]:T.slice(0,b)}},value:{get:()=>S.value}})}(k)):n.openCursor(y)}}}}}};function qv(t,e,n,r){return n=n||{},r=r||"",Zn(t).forEach(s=>{if(Ds(e,s)){var i=t[s],a=e[s];if(typeof i=="object"&&typeof a=="object"&&i&&a){const u=jx(i);u!==jx(a)?n[r+s]=e[s]:u==="Object"?qv(i,a,n,r+s+"."):i!==a&&(n[r+s]=e[s])}else i!==a&&(n[r+s]=e[s])}else n[r+s]=void 0}),Zn(e).forEach(s=>{Ds(t,s)||(n[r+s]=e[s])}),n}const aV={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(i){const a=We.trans,{deleting:u,creating:d,updating:m}=a.table(e).hook;switch(i.type){case"add":if(d.fire===$t)break;return a._promise("readwrite",()=>y(i),!0);case"put":if(d.fire===$t&&m.fire===$t)break;return a._promise("readwrite",()=>y(i),!0);case"delete":if(u.fire===$t)break;return a._promise("readwrite",()=>y(i),!0);case"deleteRange":if(u.fire===$t)break;return a._promise("readwrite",()=>function(E){return _(E.trans,E.range,1e4)}(i),!0)}return n.mutate(i);function y(E){const b=We.trans,k=E.keys||function(S,O){return O.type==="delete"?O.keys:O.keys||O.values.map(S.extractKey)}(r,E);if(!k)throw new Error("Keys missing");return(E=E.type==="add"||E.type==="put"?{...E,keys:k}:{...E}).type!=="delete"&&(E.values=[...E.values]),E.keys&&(E.keys=[...E.keys]),function(S,O,T){return O.type==="add"?Promise.resolve([]):S.getMany({trans:O.trans,keys:T,cache:"immutable"})}(n,E,k).then(S=>{const O=k.map((T,C)=>{const R=S[C],j={onerror:null,onsuccess:null};if(E.type==="delete")u.fire.call(j,T,R,b);else if(E.type==="add"||R===void 0){const K=d.fire.call(j,T,E.values[C],b);T==null&&K!=null&&(T=K,E.keys[C]=T,r.outbound||gi(E.values[C],r.keyPath,T))}else{const K=qv(R,E.values[C]),Q=m.fire.call(j,K,T,R,b);if(Q){const D=E.values[C];Object.keys(Q).forEach(B=>{Ds(D,B)?D[B]=Q[B]:gi(D,B,Q[B])})}}return j});return n.mutate(E).then(({failures:T,results:C,numFailures:R,lastResult:j})=>{for(let K=0;K<k.length;++K){const Q=C?C[K]:k[K],D=O[K];Q==null?D.onerror&&D.onerror(T[K]):D.onsuccess&&D.onsuccess(E.type==="put"&&S[K]?E.values[K]:Q)}return{failures:T,results:C,numFailures:R,lastResult:j}}).catch(T=>(O.forEach(C=>C.onerror&&C.onerror(T)),Promise.reject(T)))})}function _(E,b,k){return n.query({trans:E,values:!1,query:{index:r,range:b},limit:k}).then(({result:S})=>y({type:"delete",keys:S,trans:E}).then(O=>O.numFailures>0?Promise.reject(O.failures[0]):S.length<k?{failures:[],numFailures:0,lastResult:void 0}:_(E,{...b,lower:S[S.length-1],lowerOpen:!0},k)))}}}}})};function l4(t,e,n){try{if(!e||e.keys.length<t.length)return null;const r=[];for(let s=0,i=0;s<e.keys.length&&i<t.length;++s)Yr(e.keys[s],t[i])===0&&(r.push(n?n0(e.values[s]):e.values[s]),++i);return r.length===t.length?r:null}catch{return null}}const lV={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const s=l4(r.keys,r.trans._cache,r.cache==="clone");return s?De.resolve(s):n.getMany(r).then(i=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?n0(i):i},i))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function Wv(t){return!("from"in t)}const fo=function(t,e){if(!this){const n=new fo;return t&&"d"in t&&es(n,t),n}es(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function Af(t,e,n){const r=Yr(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Wv(t))return es(t,{from:e,to:n,d:1});const s=t.l,i=t.r;if(Yr(n,t.from)<0)return s?Af(s,e,n):t.l={from:e,to:n,d:1,l:null,r:null},jb(t);if(Yr(e,t.to)>0)return i?Af(i,e,n):t.r={from:e,to:n,d:1,l:null,r:null},jb(t);Yr(e,t.from)<0&&(t.from=e,t.l=null,t.d=i?i.d+1:1),Yr(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const a=!t.r;s&&!t.l&&Bg(t,s),i&&a&&Bg(t,i)}function Bg(t,e){Wv(e)||function n(r,{from:s,to:i,l:a,r:u}){Af(r,s,i),a&&n(r,a),u&&n(r,u)}(t,e)}function cV(t,e){const n=iw(e);let r=n.next();if(r.done)return!1;let s=r.value;const i=iw(t);let a=i.next(s.from),u=a.value;for(;!r.done&&!a.done;){if(Yr(u.from,s.to)<=0&&Yr(u.to,s.from)>=0)return!0;Yr(s.from,u.from)<0?s=(r=n.next(u.from)).value:u=(a=i.next(s.from)).value}return!1}function iw(t){let e=Wv(t)?null:{s:0,n:t};return{next(n){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&Yr(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||Yr(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function jb(t){var e,n;const r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),s=r>1?"r":r<-1?"l":"";if(s){const i=s==="r"?"l":"r",a={...t},u=t[s];t.from=u.from,t.to=u.to,t[s]=u[s],a[s]=u[i],t[i]=a,a.d=Fb(a)}t.d=Fb(t)}function Fb({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}Qu(fo.prototype,{add(t){return Bg(this,t),this},addKey(t){return Af(this,t,t),this},addKeys(t){return t.forEach(e=>Af(this,e,e)),this},[Fx](){return iw(this)}});const uV={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,n=new fo(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{const s=t.table(r),{schema:i}=s,{primaryKey:a}=i,{extractKey:u,outbound:d}=a,m={...s,mutate:E=>{const b=E.trans,k=b.mutatedParts||(b.mutatedParts={}),S=Q=>{const D=`idb://${e}/${r}/${Q}`;return k[D]||(k[D]=new fo)},O=S(""),T=S(":dels"),{type:C}=E;let[R,j]=E.type==="deleteRange"?[E.range]:E.type==="delete"?[E.keys]:E.values.length<50?[[],E.values]:[];const K=E.trans._cache;return s.mutate(E).then(Q=>{if(Ur(R)){C!=="delete"&&(R=Q.results),O.addKeys(R);const D=l4(R,K);D||C==="add"||T.addKeys(R),(D||j)&&function(B,F,W,X){function $(z){const Te=B(z.name||"");function ie(de){return de!=null?z.extractKey(de):null}const Xe=de=>z.multiEntry&&Ur(de)?de.forEach(he=>Te.addKey(he)):Te.addKey(de);(W||X).forEach((de,he)=>{const Ce=W&&ie(W[he]),Me=X&&ie(X[he]);Yr(Ce,Me)!==0&&(Ce!=null&&Xe(Ce),Me!=null&&Xe(Me))})}F.indexes.forEach($)}(S,i,D,j)}else if(R){const D={from:R.lower,to:R.upper};T.add(D),O.add(D)}else O.add(n),T.add(n),i.indexes.forEach(D=>S(D.name).add(n));return Q})}},y=({query:{index:E,range:b}})=>{var k,S;return[E,new fo((k=b.lower)!==null&&k!==void 0?k:t.MIN_KEY,(S=b.upper)!==null&&S!==void 0?S:t.MAX_KEY)]},_={get:E=>[a,new fo(E.key)],getMany:E=>[a,new fo().addKeys(E.keys)],count:y,query:y,openCursor:y};return Zn(_).forEach(E=>{m[E]=function(b){const{subscr:k}=We;if(k){const S=j=>{const K=`idb://${e}/${r}/${j}`;return k[K]||(k[K]=new fo)},O=S(""),T=S(":dels"),[C,R]=_[E](b);if(S(C.name||"").add(R),!C.isPrimaryKey){if(E!=="count"){const j=E==="query"&&d&&b.values&&s.query({...b,values:!1});return s[E].apply(this,arguments).then(K=>{if(E==="query"){if(d&&b.values)return j.then(({result:D})=>(O.addKeys(D),K));const Q=b.values?K.result.map(u):K.result;b.values?O.addKeys(Q):T.addKeys(Q)}else if(E==="openCursor"){const Q=K,D=b.values;return Q&&Object.create(Q,{key:{get:()=>(T.addKey(Q.primaryKey),Q.key)},primaryKey:{get(){const B=Q.primaryKey;return T.addKey(B),B}},value:{get:()=>(D&&O.addKey(Q.primaryKey),Q.value)}})}return K})}T.add(n)}}return s[E].apply(this,arguments)}}),m}}}};class ql{constructor(e,n){this._middlewares={},this.verno=0;const r=ql.dependencies;this._options=n={addons:ql.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:s}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:$t,dbReadyPromise:null,cancelOpen:$t,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var a;i.dbReadyPromise=new De(u=>{i.dbReadyResolve=u}),i.openCanceller=new De((u,d)=>{i.cancelOpen=d}),this._state=i,this.name=e,this.on=kd(this,"populate","blocked","versionchange","close",{ready:[Fv,$t]}),this.on.ready.subscribe=O3(this.on.ready.subscribe,u=>(d,m)=>{ql.vip(()=>{const y=this._state;if(y.openComplete)y.dbOpenError||De.resolve().then(d),m&&u(d);else if(y.onReadyBeingFired)y.onReadyBeingFired.push(d),m&&u(d);else{u(d);const _=this;m||u(function E(){_.on.ready.unsubscribe(d),_.on.ready.unsubscribe(E)})}})}),this.Collection=(a=this,Jh(HB.prototype,function(u,d){this.db=a;let m=t4,y=null;if(d)try{m=d()}catch(k){y=k}const _=u._ctx,E=_.table,b=E.hook.reading.fire;this._ctx={table:E,index:_.index,isPrimKey:!_.index||E.schema.primKey.keyPath&&_.index===E.schema.primKey.name,range:m,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:y,or:_.or,valueMapper:b!==xf?b:null}})),this.Table=function(u){return Jh($B.prototype,function(d,m,y){this.db=u,this._tx=y,this.name=d,this.schema=m,this.hook=u._allTables[d]?u._allTables[d].hook:kd(null,{creating:[OB,$t],reading:[DB,xf],updating:[LB,$t],deleting:[MB,$t]})})}(this),this.Transaction=function(u){return Jh(YB.prototype,function(d,m,y,_,E){this.db=u,this.mode=d,this.storeNames=m,this.schema=y,this.chromeTransactionDurability=_,this.idbtrans=null,this.on=kd(this,"complete","error","abort"),this.parent=E||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new De((b,k)=>{this._resolve=b,this._reject=k}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},b=>{var k=this.active;return this.active=!1,this.on.error.fire(b),this.parent?this.parent._reject(b):k&&this.idbtrans&&this.idbtrans.abort(),lr(b)})})}(this),this.Version=function(u){return Jh(nV.prototype,function(d){this.db=u,this._cfg={version:d,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(u){return Jh(r4.prototype,function(d,m,y){this.db=u,this._ctx={table:d,index:m===":id"?null:m,or:y};const _=u._deps.indexedDB;if(!_)throw new Ye.MissingAPI;this._cmp=this._ascending=_.cmp.bind(_),this._descending=(E,b)=>_.cmp(b,E),this._max=(E,b)=>_.cmp(E,b)>0?E:b,this._min=(E,b)=>_.cmp(E,b)<0?E:b,this._IDBKeyRange=u._deps.IDBKeyRange})}(this),this.on("versionchange",u=>{u.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",u=>{!u.newVersion||u.newVersion<u.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${u.oldVersion/10}`)}),this._maxKey=Ef(n.IDBKeyRange),this._createTransaction=(u,d,m,y)=>new this.Transaction(u,d,m,this._options.chromeTransactionDurability,y),this._fireOnBlocked=u=>{this.on("blocked").fire(u),Pd.filter(d=>d.name===this.name&&d!==this&&!d._state.vcFired).map(d=>d.on("versionchange").fire(u))},this.use(oV),this.use(aV),this.use(uV),this.use(lV),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach(u=>u(this))}version(e){if(isNaN(e)||e<.1)throw new Ye.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new Ye.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const n=this._versions;var r=n.filter(s=>s._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort(eV),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||We.letThrough||this._vip)?e():new De((n,r)=>{if(this._state.openComplete)return r(new Ye.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new Ye.DatabaseClosed);this.open().catch($t)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:s}){s&&this.unuse({stack:e,name:s});const i=this._middlewares[e]||(this._middlewares[e]=[]);return i.push({stack:e,create:n,level:r??10,name:s}),i.sort((a,u)=>a.level-u.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(s=>r?s.create!==r:!!n&&s.name!==n)),this}open(){return sV(this)}_close(){const e=this._state,n=Pd.indexOf(this);if(n>=0&&Pd.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new De(r=>{e.dbReadyResolve=r}),e.openCanceller=new De((r,s)=>{e.cancelOpen=s})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new Ye.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,n=this._state;return new De((r,s)=>{const i=()=>{this.close();var a=this._deps.indexedDB.deleteDatabase(this.name);a.onsuccess=un(()=>{(function({indexedDB:u,IDBKeyRange:d},m){!Gv(u)&&m!==Wp&&zv(u,d).delete(m).catch($t)})(this._deps,this.name),r()}),a.onerror=Pi(s),a.onblocked=this._fireOnBlocked};if(e)throw new Ye.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(i):i()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Zn(this._allTables).map(e=>this._allTables[e])}transaction(){const e=iV.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let s=We.trans;s&&s.db===this&&e.indexOf("!")===-1||(s=null);const i=e.indexOf("?")!==-1;let a,u;e=e.replace("!","").replace("?","");try{if(u=n.map(m=>{var y=m instanceof this.Table?m.name:m;if(typeof y!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return y}),e=="r"||e===$1)a=$1;else{if(e!="rw"&&e!=H1)throw new Ye.InvalidArgument("Invalid transaction mode: "+e);a=H1}if(s){if(s.mode===$1&&a===H1){if(!i)throw new Ye.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&u.forEach(m=>{if(s&&s.storeNames.indexOf(m)===-1){if(!i)throw new Ye.SubTransaction("Table "+m+" not included in parent transaction.");s=null}}),i&&s&&!s.active&&(s=null)}}catch(m){return s?s._promise(null,(y,_)=>{_(m)}):lr(m)}const d=a4.bind(null,this,a,u,s,r);return s?s._promise(a,d,"lock"):We.trans?_h(We.transless,()=>this._whenReady(d)):this._whenReady(d)}table(e){if(!Ds(this._allTables,e))throw new Ye.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const hV=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class dV{constructor(e){this._subscribe=e}subscribe(e,n,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:r})}[hV](){return this}}function c4(t,e){return Zn(e).forEach(n=>{Bg(t[n]||(t[n]=new fo),e[n])}),t}function fV(t){let e,n=!1;const r=new dV(s=>{const i=Mv(t);let a=!1,u={},d={};const m={get closed(){return a},unsubscribe:()=>{a=!0,Qa.storagemutated.unsubscribe(b)}};s.start&&s.start(m);let y=!1,_=!1;function E(){return Zn(d).some(S=>u[S]&&cV(u[S],d[S]))}const b=S=>{c4(u,S),E()&&k()},k=()=>{if(y||a)return;u={};const S={},O=function(T){i&&wh();const C=()=>Ha(t,{subscr:T,trans:null}),R=We.trans?_h(We.transless,C):C();return i&&R.then(Lo,Lo),R}(S);_||(Qa(vf,b),_=!0),y=!0,Promise.resolve(O).then(T=>{n=!0,e=T,y=!1,a||(E()?k():(u={},d=S,s.next&&s.next(T)))},T=>{y=!1,n=!1,s.error&&s.error(T),m.unsubscribe()})};return k(),m});return r.hasValue=()=>n,r.getValue=()=>e,r}let ow;try{ow={indexedDB:sn.indexedDB||sn.mozIndexedDB||sn.webkitIndexedDB||sn.msIndexedDB,IDBKeyRange:sn.IDBKeyRange||sn.webkitIDBKeyRange}}catch{ow={indexedDB:null,IDBKeyRange:null}}const El=ql;function jm(t){let e=vo;try{vo=!0,Qa.storagemutated.fire(t)}finally{vo=e}}Qu(El,{...Pm,delete:t=>new El(t,{addons:[]}).delete(),exists:t=>new El(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:n}){return Gv(e)?Promise.resolve(e.databases()).then(r=>r.map(s=>s.name).filter(s=>s!==Wp)):zv(e,n).toCollection().primaryKeys()}(El.dependencies).then(t)}catch{return lr(new Ye.MissingAPI)}},defineClass:()=>function(t){es(this,t)},ignoreTransaction:t=>We.trans?_h(We.transless,t):t(),vip:rw,async:function(t){return function(){try{var e=sw(t.apply(this,arguments));return e&&typeof e.then=="function"?e:De.resolve(e)}catch(n){return lr(n)}}},spawn:function(t,e,n){try{var r=sw(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:De.resolve(r)}catch(s){return lr(s)}},currentTransaction:{get:()=>We.trans||null},waitFor:function(t,e){const n=De.resolve(typeof t=="function"?El.ignoreTransaction(t):t).timeout(e||6e4);return We.trans?We.trans.waitFor(n):n},Promise:De,debug:{get:()=>Qi,set:t=>{V3(t,t==="dexie"?()=>!0:e4)}},derive:Eu,extend:es,props:Qu,override:O3,Events:kd,on:Qa,liveQuery:fV,extendObservabilitySet:c4,getByKeyPath:bo,setByKeyPath:gi,delByKeyPath:function(t,e){typeof e=="string"?gi(t,e,void 0):"length"in e&&[].map.call(e,function(n){gi(t,n,void 0)})},shallowClone:j3,deepClone:n0,getObjectDiff:qv,cmp:Yr,asap:M3,minKey:Qx,addons:[],connections:Pd,errnames:jv,dependencies:ow,semVer:Pb,version:Pb.split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,2*n))}),El.maxKey=Ef(El.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Qa(vf,t=>{if(!vo){let e;qp?(e=document.createEvent("CustomEvent"),e.initCustomEvent(ga,!0,!0,t)):e=new CustomEvent(ga,{detail:t}),vo=!0,dispatchEvent(e),vo=!1}}),addEventListener(ga,({detail:t})=>{vo||jm(t)}));let vo=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel(ga);typeof t.unref=="function"&&t.unref(),Qa(vf,e=>{vo||t.postMessage(e)}),t.onmessage=e=>{e.data&&jm(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Qa(vf,e=>{try{vo||(typeof localStorage<"u"&&localStorage.setItem(ga,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:ga,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===ga){const n=JSON.parse(e.newValue);n&&jm(n.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type===ga&&jm(e.changedParts)})}De.rejectionMapper=function(t,e){if(!t||t instanceof Au||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Tb[t.name])return t;var n=new Tb[t.name](e||t.message,t);return"stack"in t&&Ao(n,"stack",{get:function(){return this.inner.stack}}),n},V3(Qi,e4);class mV extends ql{constructor(){super("ArtifactScannerDB");Qo(this,"artifacts");Qo(this,"photos");Qo(this,"pendingChanges");Qo(this,"syncLogs");Qo(this,"metadata");this.version(2).stores({artifacts:"id, name, artifactType, discoverySite, createdBy, createdAt, _synced",photos:"id, artifactId, _synced",pendingChanges:"++id, entityType, entityId, action, timestamp",syncLogs:"id, entityType, entityId, action, localTimestamp",metadata:"key"})}}const Yn=new mV;let Z1=!1;const Ls=async()=>{if(!Yn.isOpen())try{await Yn.open()}catch(t){if(console.warn(" Database error detected:",t.name),Z1)throw t;Z1=!0,console.warn(" Attempting to recreate database...");try{await Yn.delete(),console.log(" Old database deleted"),await new Promise(e=>setTimeout(e,100)),await Yn.open(),console.log(" Database recreated successfully")}catch(e){throw console.error(" Failed to recreate database:",e),Z1=!1,e}}},Xa=async(t,e=!1)=>{var n;try{await Ls();const r={...t,createdAt:t.createdAt.toString(),updatedAt:((n=t.updatedAt)==null?void 0:n.toString())||t.createdAt.toString(),_synced:e};await Yn.artifacts.put(r),console.log(` Artifact ${t.id} saved to offline storage`)}catch(r){throw console.error(" Error saving artifact offline:",r),r}},$v=async t=>{try{return await Ls(),await Yn.artifacts.get(t)||null}catch(e){throw console.error(" Error getting artifact offline:",e),e}},gV=async()=>{try{await Ls();const t=await Yn.artifacts.toArray();return t.sort((e,n)=>new Date(n.createdAt).getTime()-new Date(e.createdAt).getTime()),t}catch(t){throw console.error(" Error getting all artifacts offline:",t),t}},pV=async t=>{try{await Ls(),await Yn.artifacts.delete(t),console.log(` Artifact ${t} deleted from offline storage`)}catch(e){throw console.error(" Error deleting artifact offline:",e),e}},Hv=async t=>{try{await Ls();const e=await Yn.pendingChanges.add({...t,timestamp:Date.now(),retries:0});return console.log(` Pending change added: ${t.action} ${t.entityType} ${t.entityId}`),e}catch(e){throw console.error(" Error adding pending change:",e),e}},yV=async()=>{try{await Ls();const t=await Yn.pendingChanges.toArray();return t.sort((e,n)=>e.timestamp-n.timestamp),t}catch(t){throw console.error(" Error getting pending changes:",t),t}},xV=async t=>{try{await Ls(),await Yn.pendingChanges.delete(t),console.log(` Pending change ${t} removed`)}catch(e){throw console.error(" Error removing pending change:",e),e}},wV=async(t,e)=>{try{await Ls();const n=await Yn.pendingChanges.get(t);n&&await Yn.pendingChanges.update(t,{retries:n.retries+1,error:e})}catch(n){throw console.error(" Error updating pending change retry:",n),n}},_V=async()=>{try{await Ls();const e=(await Yn.pendingChanges.toArray()).filter(n=>n.retries>=3);for(const n of e)n.id&&await Yn.pendingChanges.update(n.id,{retries:0,error:void 0});return console.log(` Reset ${e.length} failed pending changes`),e.length}catch(t){throw console.error(" Error resetting failed pending changes:",t),t}},aw=async()=>{try{return await Ls(),await Yn.pendingChanges.count()}catch(t){return t.name==="NotFoundError"||t.name==="DatabaseClosedError"||console.error(" Error getting pending changes count:",t),0}},vV=async t=>{try{await Ls(),await Yn.syncLogs.put(t),console.log(` Sync log added: ${t.action} ${t.entityType} ${t.entityId}`)}catch(e){throw console.error(" Error adding sync log:",e),e}},Bb=async()=>{try{await Ls(),await Yn.metadata.put({key:"lastSyncAt",value:new Date().toISOString(),updatedAt:Date.now()}),console.log(" Last sync timestamp updated")}catch(t){throw console.error(" Error updating last sync:",t),t}},J1=async()=>{try{await Ls();const t=await Yn.metadata.get("lastSyncAt");return(t==null?void 0:t.value)||null}catch(t){return console.error(" Error getting last sync:",t),null}},u4=t=>new Promise((e,n)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=n,r.readAsDataURL(t)});var uc={},EV=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},h4={},js={};let Kv;const AV=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];js.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};js.getSymbolTotalCodewords=function(e){return AV[e]};js.getBCHDigit=function(t){let e=0;for(;t!==0;)e++,t>>>=1;return e};js.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');Kv=e};js.isKanjiModeEnabled=function(){return typeof Kv<"u"};js.toSJIS=function(e){return Kv(e)};var $p={};(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+n)}}t.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},t.from=function(r,s){if(t.isValid(r))return r;try{return e(r)}catch{return s}}})($p);function d4(){this.buffer=[],this.length=0}d4.prototype={get:function(t){const e=Math.floor(t/8);return(this.buffer[e]>>>7-t%8&1)===1},put:function(t,e){for(let n=0;n<e;n++)this.putBit((t>>>e-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(t){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var bV=d4;function i0(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new Uint8Array(t*t),this.reservedBit=new Uint8Array(t*t)}i0.prototype.set=function(t,e,n,r){const s=t*this.size+e;this.data[s]=n,r&&(this.reservedBit[s]=!0)};i0.prototype.get=function(t,e){return this.data[t*this.size+e]};i0.prototype.xor=function(t,e,n){this.data[t*this.size+e]^=n};i0.prototype.isReserved=function(t,e){return this.reservedBit[t*this.size+e]};var IV=i0,f4={};(function(t){const e=js.getSymbolSize;t.getRowColCoords=function(r){if(r===1)return[];const s=Math.floor(r/7)+2,i=e(r),a=i===145?26:Math.ceil((i-13)/(2*s-2))*2,u=[i-7];for(let d=1;d<s-1;d++)u[d]=u[d-1]-a;return u.push(6),u.reverse()},t.getPositions=function(r){const s=[],i=t.getRowColCoords(r),a=i.length;for(let u=0;u<a;u++)for(let d=0;d<a;d++)u===0&&d===0||u===0&&d===a-1||u===a-1&&d===0||s.push([i[u],i[d]]);return s}})(f4);var m4={};const CV=js.getSymbolSize,Vb=7;m4.getPositions=function(e){const n=CV(e);return[[0,0],[n-Vb,0],[0,n-Vb]]};var g4={};(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(s){return s!=null&&s!==""&&!isNaN(s)&&s>=0&&s<=7},t.from=function(s){return t.isValid(s)?parseInt(s,10):void 0},t.getPenaltyN1=function(s){const i=s.size;let a=0,u=0,d=0,m=null,y=null;for(let _=0;_<i;_++){u=d=0,m=y=null;for(let E=0;E<i;E++){let b=s.get(_,E);b===m?u++:(u>=5&&(a+=e.N1+(u-5)),m=b,u=1),b=s.get(E,_),b===y?d++:(d>=5&&(a+=e.N1+(d-5)),y=b,d=1)}u>=5&&(a+=e.N1+(u-5)),d>=5&&(a+=e.N1+(d-5))}return a},t.getPenaltyN2=function(s){const i=s.size;let a=0;for(let u=0;u<i-1;u++)for(let d=0;d<i-1;d++){const m=s.get(u,d)+s.get(u,d+1)+s.get(u+1,d)+s.get(u+1,d+1);(m===4||m===0)&&a++}return a*e.N2},t.getPenaltyN3=function(s){const i=s.size;let a=0,u=0,d=0;for(let m=0;m<i;m++){u=d=0;for(let y=0;y<i;y++)u=u<<1&2047|s.get(m,y),y>=10&&(u===1488||u===93)&&a++,d=d<<1&2047|s.get(y,m),y>=10&&(d===1488||d===93)&&a++}return a*e.N3},t.getPenaltyN4=function(s){let i=0;const a=s.data.length;for(let d=0;d<a;d++)i+=s.data[d];return Math.abs(Math.ceil(i*100/a/5)-10)*e.N4};function n(r,s,i){switch(r){case t.Patterns.PATTERN000:return(s+i)%2===0;case t.Patterns.PATTERN001:return s%2===0;case t.Patterns.PATTERN010:return i%3===0;case t.Patterns.PATTERN011:return(s+i)%3===0;case t.Patterns.PATTERN100:return(Math.floor(s/2)+Math.floor(i/3))%2===0;case t.Patterns.PATTERN101:return s*i%2+s*i%3===0;case t.Patterns.PATTERN110:return(s*i%2+s*i%3)%2===0;case t.Patterns.PATTERN111:return(s*i%3+(s+i)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}t.applyMask=function(s,i){const a=i.size;for(let u=0;u<a;u++)for(let d=0;d<a;d++)i.isReserved(d,u)||i.xor(d,u,n(s,d,u))},t.getBestMask=function(s,i){const a=Object.keys(t.Patterns).length;let u=0,d=1/0;for(let m=0;m<a;m++){i(m),t.applyMask(m,s);const y=t.getPenaltyN1(s)+t.getPenaltyN2(s)+t.getPenaltyN3(s)+t.getPenaltyN4(s);t.applyMask(m,s),y<d&&(d=y,u=m)}return u}})(g4);var Hp={};const va=$p,rm=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],sm=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Hp.getBlocksCount=function(e,n){switch(n){case va.L:return rm[(e-1)*4+0];case va.M:return rm[(e-1)*4+1];case va.Q:return rm[(e-1)*4+2];case va.H:return rm[(e-1)*4+3];default:return}};Hp.getTotalCodewordsCount=function(e,n){switch(n){case va.L:return sm[(e-1)*4+0];case va.M:return sm[(e-1)*4+1];case va.Q:return sm[(e-1)*4+2];case va.H:return sm[(e-1)*4+3];default:return}};var p4={},Kp={};const Od=new Uint8Array(512),Vg=new Uint8Array(256);(function(){let e=1;for(let n=0;n<255;n++)Od[n]=e,Vg[e]=n,e<<=1,e&256&&(e^=285);for(let n=255;n<512;n++)Od[n]=Od[n-255]})();Kp.log=function(e){if(e<1)throw new Error("log("+e+")");return Vg[e]};Kp.exp=function(e){return Od[e]};Kp.mul=function(e,n){return e===0||n===0?0:Od[Vg[e]+Vg[n]]};(function(t){const e=Kp;t.mul=function(r,s){const i=new Uint8Array(r.length+s.length-1);for(let a=0;a<r.length;a++)for(let u=0;u<s.length;u++)i[a+u]^=e.mul(r[a],s[u]);return i},t.mod=function(r,s){let i=new Uint8Array(r);for(;i.length-s.length>=0;){const a=i[0];for(let d=0;d<s.length;d++)i[d]^=e.mul(s[d],a);let u=0;for(;u<i.length&&i[u]===0;)u++;i=i.slice(u)}return i},t.generateECPolynomial=function(r){let s=new Uint8Array([1]);for(let i=0;i<r;i++)s=t.mul(s,new Uint8Array([1,e.exp(i)]));return s}})(p4);const y4=p4;function Qv(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}Qv.prototype.initialize=function(e){this.degree=e,this.genPoly=y4.generateECPolynomial(this.degree)};Qv.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const n=new Uint8Array(e.length+this.degree);n.set(e);const r=y4.mod(n,this.genPoly),s=this.degree-r.length;if(s>0){const i=new Uint8Array(this.degree);return i.set(r,s),i}return r};var TV=Qv,x4={},ul={},Xv={};Xv.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40};var Xi={};const w4="[0-9]+",SV="[A-Z $%*+\\-./:]+";let bf="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";bf=bf.replace(/u/g,"\\u");const NV="(?:(?![A-Z0-9 $%*+\\-./:]|"+bf+`)(?:.|[\r
]))+`;Xi.KANJI=new RegExp(bf,"g");Xi.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");Xi.BYTE=new RegExp(NV,"g");Xi.NUMERIC=new RegExp(w4,"g");Xi.ALPHANUMERIC=new RegExp(SV,"g");const RV=new RegExp("^"+bf+"$"),PV=new RegExp("^"+w4+"$"),kV=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");Xi.testKanji=function(e){return RV.test(e)};Xi.testNumeric=function(e){return PV.test(e)};Xi.testAlphanumeric=function(e){return kV.test(e)};(function(t){const e=Xv,n=Xi;t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(i,a){if(!i.ccBits)throw new Error("Invalid mode: "+i);if(!e.isValid(a))throw new Error("Invalid version: "+a);return a>=1&&a<10?i.ccBits[0]:a<27?i.ccBits[1]:i.ccBits[2]},t.getBestModeForData=function(i){return n.testNumeric(i)?t.NUMERIC:n.testAlphanumeric(i)?t.ALPHANUMERIC:n.testKanji(i)?t.KANJI:t.BYTE},t.toString=function(i){if(i&&i.id)return i.id;throw new Error("Invalid mode")},t.isValid=function(i){return i&&i.bit&&i.ccBits};function r(s){if(typeof s!="string")throw new Error("Param is not a string");switch(s.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+s)}}t.from=function(i,a){if(t.isValid(i))return i;try{return r(i)}catch{return a}}})(ul);(function(t){const e=js,n=Hp,r=$p,s=ul,i=Xv,a=7973,u=e.getBCHDigit(a);function d(E,b,k){for(let S=1;S<=40;S++)if(b<=t.getCapacity(S,k,E))return S}function m(E,b){return s.getCharCountIndicator(E,b)+4}function y(E,b){let k=0;return E.forEach(function(S){const O=m(S.mode,b);k+=O+S.getBitsLength()}),k}function _(E,b){for(let k=1;k<=40;k++)if(y(E,k)<=t.getCapacity(k,b,s.MIXED))return k}t.from=function(b,k){return i.isValid(b)?parseInt(b,10):k},t.getCapacity=function(b,k,S){if(!i.isValid(b))throw new Error("Invalid QR Code version");typeof S>"u"&&(S=s.BYTE);const O=e.getSymbolTotalCodewords(b),T=n.getTotalCodewordsCount(b,k),C=(O-T)*8;if(S===s.MIXED)return C;const R=C-m(S,b);switch(S){case s.NUMERIC:return Math.floor(R/10*3);case s.ALPHANUMERIC:return Math.floor(R/11*2);case s.KANJI:return Math.floor(R/13);case s.BYTE:default:return Math.floor(R/8)}},t.getBestVersionForData=function(b,k){let S;const O=r.from(k,r.M);if(Array.isArray(b)){if(b.length>1)return _(b,O);if(b.length===0)return 1;S=b[0]}else S=b;return d(S.mode,S.getLength(),O)},t.getEncodedBits=function(b){if(!i.isValid(b)||b<7)throw new Error("Invalid QR Code version");let k=b<<12;for(;e.getBCHDigit(k)-u>=0;)k^=a<<e.getBCHDigit(k)-u;return b<<12|k}})(x4);var _4={};const lw=js,v4=1335,DV=21522,Ub=lw.getBCHDigit(v4);_4.getEncodedBits=function(e,n){const r=e.bit<<3|n;let s=r<<10;for(;lw.getBCHDigit(s)-Ub>=0;)s^=v4<<lw.getBCHDigit(s)-Ub;return(r<<10|s)^DV};var E4={};const OV=ul;function Xu(t){this.mode=OV.NUMERIC,this.data=t.toString()}Xu.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};Xu.prototype.getLength=function(){return this.data.length};Xu.prototype.getBitsLength=function(){return Xu.getBitsLength(this.data.length)};Xu.prototype.write=function(e){let n,r,s;for(n=0;n+3<=this.data.length;n+=3)r=this.data.substr(n,3),s=parseInt(r,10),e.put(s,10);const i=this.data.length-n;i>0&&(r=this.data.substr(n),s=parseInt(r,10),e.put(s,i*3+1))};var MV=Xu;const LV=ul,ey=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Yu(t){this.mode=LV.ALPHANUMERIC,this.data=t}Yu.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};Yu.prototype.getLength=function(){return this.data.length};Yu.prototype.getBitsLength=function(){return Yu.getBitsLength(this.data.length)};Yu.prototype.write=function(e){let n;for(n=0;n+2<=this.data.length;n+=2){let r=ey.indexOf(this.data[n])*45;r+=ey.indexOf(this.data[n+1]),e.put(r,11)}this.data.length%2&&e.put(ey.indexOf(this.data[n]),6)};var jV=Yu;const FV=ul;function Zu(t){this.mode=FV.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}Zu.getBitsLength=function(e){return e*8};Zu.prototype.getLength=function(){return this.data.length};Zu.prototype.getBitsLength=function(){return Zu.getBitsLength(this.data.length)};Zu.prototype.write=function(t){for(let e=0,n=this.data.length;e<n;e++)t.put(this.data[e],8)};var BV=Zu;const VV=ul,UV=js;function Ju(t){this.mode=VV.KANJI,this.data=t}Ju.getBitsLength=function(e){return e*13};Ju.prototype.getLength=function(){return this.data.length};Ju.prototype.getBitsLength=function(){return Ju.getBitsLength(this.data.length)};Ju.prototype.write=function(t){let e;for(e=0;e<this.data.length;e++){let n=UV.toSJIS(this.data[e]);if(n>=33088&&n<=40956)n-=33088;else if(n>=57408&&n<=60351)n-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);n=(n>>>8&255)*192+(n&255),t.put(n,13)}};var zV=Ju,A4={exports:{}};(function(t){var e={single_source_shortest_paths:function(n,r,s){var i={},a={};a[r]=0;var u=e.PriorityQueue.make();u.push(r,0);for(var d,m,y,_,E,b,k,S,O;!u.empty();){d=u.pop(),m=d.value,_=d.cost,E=n[m]||{};for(y in E)E.hasOwnProperty(y)&&(b=E[y],k=_+b,S=a[y],O=typeof a[y]>"u",(O||S>k)&&(a[y]=k,u.push(y,k),i[y]=m))}if(typeof s<"u"&&typeof a[s]>"u"){var T=["Could not find a path from ",r," to ",s,"."].join("");throw new Error(T)}return i},extract_shortest_path_from_predecessor_list:function(n,r){for(var s=[],i=r;i;)s.push(i),n[i],i=n[i];return s.reverse(),s},find_path:function(n,r,s){var i=e.single_source_shortest_paths(n,r,s);return e.extract_shortest_path_from_predecessor_list(i,s)},PriorityQueue:{make:function(n){var r=e.PriorityQueue,s={},i;n=n||{};for(i in r)r.hasOwnProperty(i)&&(s[i]=r[i]);return s.queue=[],s.sorter=n.sorter||r.default_sorter,s},default_sorter:function(n,r){return n.cost-r.cost},push:function(n,r){var s={value:n,cost:r};this.queue.push(s),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e})(A4);var GV=A4.exports;(function(t){const e=ul,n=MV,r=jV,s=BV,i=zV,a=Xi,u=js,d=GV;function m(T){return unescape(encodeURIComponent(T)).length}function y(T,C,R){const j=[];let K;for(;(K=T.exec(R))!==null;)j.push({data:K[0],index:K.index,mode:C,length:K[0].length});return j}function _(T){const C=y(a.NUMERIC,e.NUMERIC,T),R=y(a.ALPHANUMERIC,e.ALPHANUMERIC,T);let j,K;return u.isKanjiModeEnabled()?(j=y(a.BYTE,e.BYTE,T),K=y(a.KANJI,e.KANJI,T)):(j=y(a.BYTE_KANJI,e.BYTE,T),K=[]),C.concat(R,j,K).sort(function(D,B){return D.index-B.index}).map(function(D){return{data:D.data,mode:D.mode,length:D.length}})}function E(T,C){switch(C){case e.NUMERIC:return n.getBitsLength(T);case e.ALPHANUMERIC:return r.getBitsLength(T);case e.KANJI:return i.getBitsLength(T);case e.BYTE:return s.getBitsLength(T)}}function b(T){return T.reduce(function(C,R){const j=C.length-1>=0?C[C.length-1]:null;return j&&j.mode===R.mode?(C[C.length-1].data+=R.data,C):(C.push(R),C)},[])}function k(T){const C=[];for(let R=0;R<T.length;R++){const j=T[R];switch(j.mode){case e.NUMERIC:C.push([j,{data:j.data,mode:e.ALPHANUMERIC,length:j.length},{data:j.data,mode:e.BYTE,length:j.length}]);break;case e.ALPHANUMERIC:C.push([j,{data:j.data,mode:e.BYTE,length:j.length}]);break;case e.KANJI:C.push([j,{data:j.data,mode:e.BYTE,length:m(j.data)}]);break;case e.BYTE:C.push([{data:j.data,mode:e.BYTE,length:m(j.data)}])}}return C}function S(T,C){const R={},j={start:{}};let K=["start"];for(let Q=0;Q<T.length;Q++){const D=T[Q],B=[];for(let F=0;F<D.length;F++){const W=D[F],X=""+Q+F;B.push(X),R[X]={node:W,lastCount:0},j[X]={};for(let $=0;$<K.length;$++){const z=K[$];R[z]&&R[z].node.mode===W.mode?(j[z][X]=E(R[z].lastCount+W.length,W.mode)-E(R[z].lastCount,W.mode),R[z].lastCount+=W.length):(R[z]&&(R[z].lastCount=W.length),j[z][X]=E(W.length,W.mode)+4+e.getCharCountIndicator(W.mode,C))}}K=B}for(let Q=0;Q<K.length;Q++)j[K[Q]].end=0;return{map:j,table:R}}function O(T,C){let R;const j=e.getBestModeForData(T);if(R=e.from(C,j),R!==e.BYTE&&R.bit<j.bit)throw new Error('"'+T+'" cannot be encoded with mode '+e.toString(R)+`.
 Suggested mode is: `+e.toString(j));switch(R===e.KANJI&&!u.isKanjiModeEnabled()&&(R=e.BYTE),R){case e.NUMERIC:return new n(T);case e.ALPHANUMERIC:return new r(T);case e.KANJI:return new i(T);case e.BYTE:return new s(T)}}t.fromArray=function(C){return C.reduce(function(R,j){return typeof j=="string"?R.push(O(j,null)):j.data&&R.push(O(j.data,j.mode)),R},[])},t.fromString=function(C,R){const j=_(C,u.isKanjiModeEnabled()),K=k(j),Q=S(K,R),D=d.find_path(Q.map,"start","end"),B=[];for(let F=1;F<D.length-1;F++)B.push(Q.table[D[F]].node);return t.fromArray(b(B))},t.rawSplit=function(C){return t.fromArray(_(C,u.isKanjiModeEnabled()))}})(E4);const Qp=js,ty=$p,qV=bV,WV=IV,$V=f4,HV=m4,cw=g4,uw=Hp,KV=TV,Ug=x4,QV=_4,XV=ul,ny=E4;function YV(t,e){const n=t.size,r=HV.getPositions(e);for(let s=0;s<r.length;s++){const i=r[s][0],a=r[s][1];for(let u=-1;u<=7;u++)if(!(i+u<=-1||n<=i+u))for(let d=-1;d<=7;d++)a+d<=-1||n<=a+d||(u>=0&&u<=6&&(d===0||d===6)||d>=0&&d<=6&&(u===0||u===6)||u>=2&&u<=4&&d>=2&&d<=4?t.set(i+u,a+d,!0,!0):t.set(i+u,a+d,!1,!0))}}function ZV(t){const e=t.size;for(let n=8;n<e-8;n++){const r=n%2===0;t.set(n,6,r,!0),t.set(6,n,r,!0)}}function JV(t,e){const n=$V.getPositions(e);for(let r=0;r<n.length;r++){const s=n[r][0],i=n[r][1];for(let a=-2;a<=2;a++)for(let u=-2;u<=2;u++)a===-2||a===2||u===-2||u===2||a===0&&u===0?t.set(s+a,i+u,!0,!0):t.set(s+a,i+u,!1,!0)}}function eU(t,e){const n=t.size,r=Ug.getEncodedBits(e);let s,i,a;for(let u=0;u<18;u++)s=Math.floor(u/3),i=u%3+n-8-3,a=(r>>u&1)===1,t.set(s,i,a,!0),t.set(i,s,a,!0)}function ry(t,e,n){const r=t.size,s=QV.getEncodedBits(e,n);let i,a;for(i=0;i<15;i++)a=(s>>i&1)===1,i<6?t.set(i,8,a,!0):i<8?t.set(i+1,8,a,!0):t.set(r-15+i,8,a,!0),i<8?t.set(8,r-i-1,a,!0):i<9?t.set(8,15-i-1+1,a,!0):t.set(8,15-i-1,a,!0);t.set(r-8,8,1,!0)}function tU(t,e){const n=t.size;let r=-1,s=n-1,i=7,a=0;for(let u=n-1;u>0;u-=2)for(u===6&&u--;;){for(let d=0;d<2;d++)if(!t.isReserved(s,u-d)){let m=!1;a<e.length&&(m=(e[a]>>>i&1)===1),t.set(s,u-d,m),i--,i===-1&&(a++,i=7)}if(s+=r,s<0||n<=s){s-=r,r=-r;break}}}function nU(t,e,n){const r=new qV;n.forEach(function(d){r.put(d.mode.bit,4),r.put(d.getLength(),XV.getCharCountIndicator(d.mode,t)),d.write(r)});const s=Qp.getSymbolTotalCodewords(t),i=uw.getTotalCodewordsCount(t,e),a=(s-i)*8;for(r.getLengthInBits()+4<=a&&r.put(0,4);r.getLengthInBits()%8!==0;)r.putBit(0);const u=(a-r.getLengthInBits())/8;for(let d=0;d<u;d++)r.put(d%2?17:236,8);return rU(r,t,e)}function rU(t,e,n){const r=Qp.getSymbolTotalCodewords(e),s=uw.getTotalCodewordsCount(e,n),i=r-s,a=uw.getBlocksCount(e,n),u=r%a,d=a-u,m=Math.floor(r/a),y=Math.floor(i/a),_=y+1,E=m-y,b=new KV(E);let k=0;const S=new Array(a),O=new Array(a);let T=0;const C=new Uint8Array(t.buffer);for(let D=0;D<a;D++){const B=D<d?y:_;S[D]=C.slice(k,k+B),O[D]=b.encode(S[D]),k+=B,T=Math.max(T,B)}const R=new Uint8Array(r);let j=0,K,Q;for(K=0;K<T;K++)for(Q=0;Q<a;Q++)K<S[Q].length&&(R[j++]=S[Q][K]);for(K=0;K<E;K++)for(Q=0;Q<a;Q++)R[j++]=O[Q][K];return R}function sU(t,e,n,r){let s;if(Array.isArray(t))s=ny.fromArray(t);else if(typeof t=="string"){let m=e;if(!m){const y=ny.rawSplit(t);m=Ug.getBestVersionForData(y,n)}s=ny.fromString(t,m||40)}else throw new Error("Invalid data");const i=Ug.getBestVersionForData(s,n);if(!i)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=i;else if(e<i)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+i+`.
`);const a=nU(e,n,s),u=Qp.getSymbolSize(e),d=new WV(u);return YV(d,e),ZV(d),JV(d,e),ry(d,n,0),e>=7&&eU(d,e),tU(d,a),isNaN(r)&&(r=cw.getBestMask(d,ry.bind(null,d,n))),cw.applyMask(r,d),ry(d,n,r),{modules:d,version:e,errorCorrectionLevel:n,maskPattern:r,segments:s}}h4.create=function(e,n){if(typeof e>"u"||e==="")throw new Error("No input text");let r=ty.M,s,i;return typeof n<"u"&&(r=ty.from(n.errorCorrectionLevel,ty.M),s=Ug.from(n.version),i=cw.from(n.maskPattern),n.toSJISFunc&&Qp.setToSJISFunction(n.toSJISFunc)),sU(e,s,r,i)};var b4={},Yv={};(function(t){function e(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let r=n.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+n);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(i){return[i,i]}))),r.length===6&&r.push("F","F");const s=parseInt(r.join(""),16);return{r:s>>24&255,g:s>>16&255,b:s>>8&255,a:s&255,hex:"#"+r.slice(0,6).join("")}}t.getOptions=function(r){r||(r={}),r.color||(r.color={});const s=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,i=r.width&&r.width>=21?r.width:void 0,a=r.scale||4;return{width:i,scale:i?4:a,margin:s,color:{dark:e(r.color.dark||"#000000ff"),light:e(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},t.getScale=function(r,s){return s.width&&s.width>=r+s.margin*2?s.width/(r+s.margin*2):s.scale},t.getImageWidth=function(r,s){const i=t.getScale(r,s);return Math.floor((r+s.margin*2)*i)},t.qrToImageData=function(r,s,i){const a=s.modules.size,u=s.modules.data,d=t.getScale(a,i),m=Math.floor((a+i.margin*2)*d),y=i.margin*d,_=[i.color.light,i.color.dark];for(let E=0;E<m;E++)for(let b=0;b<m;b++){let k=(E*m+b)*4,S=i.color.light;if(E>=y&&b>=y&&E<m-y&&b<m-y){const O=Math.floor((E-y)/d),T=Math.floor((b-y)/d);S=_[u[O*a+T]?1:0]}r[k++]=S.r,r[k++]=S.g,r[k++]=S.b,r[k]=S.a}}})(Yv);(function(t){const e=Yv;function n(s,i,a){s.clearRect(0,0,i.width,i.height),i.style||(i.style={}),i.height=a,i.width=a,i.style.height=a+"px",i.style.width=a+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(i,a,u){let d=u,m=a;typeof d>"u"&&(!a||!a.getContext)&&(d=a,a=void 0),a||(m=r()),d=e.getOptions(d);const y=e.getImageWidth(i.modules.size,d),_=m.getContext("2d"),E=_.createImageData(y,y);return e.qrToImageData(E.data,i,d),n(_,m,y),_.putImageData(E,0,0),m},t.renderToDataURL=function(i,a,u){let d=u;typeof d>"u"&&(!a||!a.getContext)&&(d=a,a=void 0),d||(d={});const m=t.render(i,a,d),y=d.type||"image/png",_=d.rendererOpts||{};return m.toDataURL(y,_.quality)}})(b4);var I4={};const iU=Yv;function zb(t,e){const n=t.a/255,r=e+'="'+t.hex+'"';return n<1?r+" "+e+'-opacity="'+n.toFixed(2).slice(1)+'"':r}function sy(t,e,n){let r=t+e;return typeof n<"u"&&(r+=" "+n),r}function oU(t,e,n){let r="",s=0,i=!1,a=0;for(let u=0;u<t.length;u++){const d=Math.floor(u%e),m=Math.floor(u/e);!d&&!i&&(i=!0),t[u]?(a++,u>0&&d>0&&t[u-1]||(r+=i?sy("M",d+n,.5+m+n):sy("m",s,0),s=0,i=!1),d+1<e&&t[u+1]||(r+=sy("h",a),a=0)):s++}return r}I4.render=function(e,n,r){const s=iU.getOptions(n),i=e.modules.size,a=e.modules.data,u=i+s.margin*2,d=s.color.light.a?"<path "+zb(s.color.light,"fill")+' d="M0 0h'+u+"v"+u+'H0z"/>':"",m="<path "+zb(s.color.dark,"stroke")+' d="'+oU(a,i,s.margin)+'"/>',y='viewBox="0 0 '+u+" "+u+'"',E='<svg xmlns="http://www.w3.org/2000/svg" '+(s.width?'width="'+s.width+'" height="'+s.width+'" ':"")+y+' shape-rendering="crispEdges">'+d+m+`</svg>
`;return typeof r=="function"&&r(null,E),E};const aU=EV,hw=h4,C4=b4,lU=I4;function Zv(t,e,n,r,s){const i=[].slice.call(arguments,1),a=i.length,u=typeof i[a-1]=="function";if(!u&&!aU())throw new Error("Callback required as last argument");if(u){if(a<2)throw new Error("Too few arguments provided");a===2?(s=n,n=e,e=r=void 0):a===3&&(e.getContext&&typeof s>"u"?(s=r,r=void 0):(s=r,r=n,n=e,e=void 0))}else{if(a<1)throw new Error("Too few arguments provided");return a===1?(n=e,e=r=void 0):a===2&&!e.getContext&&(r=n,n=e,e=void 0),new Promise(function(d,m){try{const y=hw.create(n,r);d(t(y,e,r))}catch(y){m(y)}})}try{const d=hw.create(n,r);s(null,t(d,e,r))}catch(d){s(d)}}uc.create=hw.create;uc.toCanvas=Zv.bind(null,C4.render);uc.toDataURL=Zv.bind(null,C4.renderToDataURL);uc.toString=Zv.bind(null,function(t,e,n){return lU.render(t,n)});const Oa="artifacts",cU=async t=>{try{const e=`${window.location.origin}/artifacts/${t}`;return await uc.toDataURL(e,{width:512,margin:2,color:{dark:"#1e293b",light:"#ffffff"}})}catch(e){return console.error("Error generating QR code:",e),""}},T4=async(t,e,n)=>{try{const r=Date.now(),s=e.name.split(".").pop(),i=`${t}_${r}.${s}`,a=sB(R3,`artifacts/${t}/photos/${i}`),u=await nB(a,e,{contentType:e.type}),d=await rB(u.ref),m=new Image;m.src=URL.createObjectURL(e),await new Promise(_=>{m.onload=_});const y={id:`${t}_${r}`,artifactId:t,url:d,filename:e.name,size:e.size,mimeType:e.type,width:m.width,height:m.height,takenAt:new Date().toISOString(),uploadedBy:n,uploadedAt:new Date().toISOString(),isThumbnail:!1};return URL.revokeObjectURL(m.src),y}catch(r){throw console.error("Error uploading photo:",r),r}},S4=async t=>{try{const e=ot.currentUser;if(!e)throw new Error("User must be authenticated to create artifacts");if(!t.photos||t.photos.length===0)throw new Error("At least one photo is required");const{photos:n,...r}=t,s={...r,createdBy:e.uid,createdAt:Pn(),updatedAt:Pn(),isDeleted:!1,version:1,qrCodeUrl:null,photos:[],groupId:t.groupId||null},i=await Ku(an($e,Oa),s);console.log(" Artifact created successfully with ID:",i.id);try{console.log(` Uploading ${n.length} photo(s)...`);const a=[];for(const u of n)try{const d=await T4(i.id,u,e.uid);a.push(d),console.log(` Photo uploaded: ${d.filename}`)}catch(d){console.error(` Failed to upload photo: ${u.name}`,d)}a.length>0?(await Wr(Vt($e,Oa,i.id),{photos:a}),console.log(` ${a.length} photo(s) uploaded successfully`)):console.warn(" No photos were uploaded successfully")}catch(a){throw console.error(" Error uploading photos:",a),new Error("Artifact created but photo upload failed. Please try adding photos later.")}try{const a=await cU(i.id);a&&(await Wr(Vt($e,Oa,i.id),{qrCodeUrl:a}),console.log(" QR code generated and stored"))}catch(a){console.warn(" QR code generation failed, but artifact was created:",a)}return i.id}catch(e){throw console.error(" Error creating artifact:",e),e}},Jv=async t=>{var e,n,r,s;try{const i=Vt($e,Oa,t),a=await ll(i);if(!a.exists())return null;const u=a.data();return{id:a.id,...u,createdAt:((n=(e=u.createdAt)==null?void 0:e.toDate)==null?void 0:n.call(e))||new Date,updatedAt:((s=(r=u.updatedAt)==null?void 0:r.toDate)==null?void 0:s.call(r))||new Date}}catch(i){throw console.error(" Error getting artifact:",i),i}},e2=async()=>{try{const t=ur(an($e,Oa),Zt("isDeleted","==",!1)),e=await hr(t),n=[];return e.forEach(r=>{var i,a,u,d;const s=r.data();n.push({id:r.id,...s,createdAt:((a=(i=s.createdAt)==null?void 0:i.toDate)==null?void 0:a.call(i))||new Date,updatedAt:((d=(u=s.updatedAt)==null?void 0:u.toDate)==null?void 0:d.call(u))||new Date})}),n.sort((r,s)=>s.createdAt.getTime()-r.createdAt.getTime()),n}catch(t){throw console.error(" Error getting artifacts:",t),t}},N4=async(t,e)=>{try{const n=ot.currentUser;if(!n)throw new Error("User must be authenticated to update artifacts");const r=Vt($e,Oa,t),s=await ll(r);if(!s.exists())throw new Error("Artifact not found");const i=s.data().version||1,a=s.data().photos||[],{photos:u,photosToKeep:d,...m}=e;let y=a;if(d!==void 0&&(y=a.filter(E=>d.includes(E.id)),console.log(` Keeping ${y.length} of ${a.length} existing photos`)),u&&u.length>0){console.log(` Uploading ${u.length} new photo(s)...`);const E=[];for(const b of u)try{const k=await T4(t,b,n.uid);E.push(k),console.log(` Photo uploaded: ${k.filename}`)}catch(k){console.error(` Failed to upload photo: ${b.name}`,k)}y=[...y,...E],console.log(` ${E.length} new photo(s) uploaded successfully`)}const _=Object.fromEntries(Object.entries(m).filter(([E,b])=>b!==void 0));await Wr(r,{..._,photos:y,updatedAt:Pn(),updatedBy:n.uid,version:i+1}),console.log(" Artifact updated successfully:",t)}catch(n){throw console.error(" Error updating artifact:",n),n}},R4=async t=>{try{const e=ot.currentUser;if(!e)throw new Error("User must be authenticated to delete artifacts");const n=Vt($e,Oa,t);await Wr(n,{isDeleted:!0,deletedAt:Pn(),deletedBy:e.uid,updatedAt:Pn()}),console.log(" Artifact deleted successfully:",t)}catch(e){throw console.error(" Error deleting artifact:",e),e}},P4=async t=>{try{const e=ur(an($e,Oa),Zt("isDeleted","==",!1),Zt("groupId","==",t)),n=await hr(e),r=[];return n.forEach(s=>{var a,u,d,m;const i=s.data();r.push({id:s.id,...i,createdAt:((u=(a=i.createdAt)==null?void 0:a.toDate)==null?void 0:u.call(a))||new Date,updatedAt:((m=(d=i.updatedAt)==null?void 0:d.toDate)==null?void 0:m.call(d))||new Date})}),r.sort((s,i)=>i.createdAt.getTime()-s.createdAt.getTime()),r}catch(e){throw console.error(" Error getting artifacts by group:",e),e}},uU=3,hU=3e4,dU=()=>{const t=xh(),[e,n]=H.useState({isOnline:t,isSyncing:!1,lastSyncAt:void 0,pendingChanges:0,conflicts:0,errors:[]}),r=(y,_)=>{var T;const E=y.split(","),b=((T=E[0].match(/:(.*?);/))==null?void 0:T[1])||"image/jpeg",k=atob(E[1]);let S=k.length;const O=new Uint8Array(S);for(;S--;)O[S]=k.charCodeAt(S);return new File([O],_,{type:b})},s=async y=>{var _;try{if(console.log(` Processing pending change: ${y.action} ${y.entityType} ${y.entityId}`),y.entityType==="artifact")switch(y.action){case"create":{const E={...y.data};E.photoDataUrls&&Array.isArray(E.photoDataUrls)&&(console.log(` Converting ${E.photoDataUrls.length} photo data URLs to files...`),E.photos=E.photoDataUrls.map((b,k)=>r(b,`offline-photo-${k}.jpg`)),delete E.photoDataUrls,delete E.tempId),await S4(E);break}case"update":{const E={...y.data};E.photoDataUrls&&Array.isArray(E.photoDataUrls)&&(console.log(` Converting ${E.photoDataUrls.length} photo data URLs to files...`),E.photos=E.photoDataUrls.map((b,k)=>r(b,`offline-photo-${k}.jpg`)),delete E.photoDataUrls),await N4(y.entityId,E);break}case"delete":{if(y.entityId.startsWith("temp-"))return console.log(` Skipping delete for offline-only artifact: ${y.entityId}`),!0;await R4(y.entityId);break}}return await vV({id:`${y.entityType}-${y.entityId}-${Date.now()}`,userId:((_=y.data)==null?void 0:_.createdBy)||"unknown",entityType:y.entityType,entityId:y.entityId,action:y.action,localTimestamp:new Date(y.timestamp).toISOString(),serverTimestamp:new Date().toISOString(),conflictResolved:!1}),console.log(` Successfully synced: ${y.action} ${y.entityType} ${y.entityId}`),!0}catch(E){return console.error(" Error processing pending change:",E),y.id&&await wV(y.id,E.message),!1}},i=H.useCallback(async()=>{if(!t){console.log(" Cannot sync while offline");return}if(!ot.currentUser){console.log(" Sync skipped: User not authenticated yet");return}n(y=>({...y,isSyncing:!0}));try{const y=await yV();console.log(` Syncing ${y.length} pending changes...`);let _=0,E=0;for(const S of y){if(S.retries>=uU){console.warn(` Max retries reached for change ${S.id}`),E++;continue}await s(S)&&S.id?(await xV(S.id),_++):E++}await Bb();const b=await J1(),k=await aw();n(S=>({...S,isSyncing:!1,lastSyncAt:b||void 0,pendingChanges:k})),console.log(` Sync completed: ${_} succeeded, ${E} failed`)}catch(y){console.error(" Error syncing pending changes:",y),n(_=>({..._,isSyncing:!1}))}},[t]),a=H.useCallback(async()=>{if(!t){console.log(" Cannot sync from server while offline");return}if(!ot.currentUser){console.log(" Sync from server skipped: User not authenticated yet");return}try{console.log(" Syncing data from server...");const y=await e2();for(const E of y)await Xa(E,!0);await Bb();const _=await J1();n(E=>({...E,lastSyncAt:_||void 0})),console.log(` Synced ${y.length} artifacts from server`)}catch(y){console.error(" Error syncing from server:",y)}},[t]),u=H.useCallback(async()=>{if(!t){console.log(" Cannot sync while offline");return}console.log(" Starting full sync..."),await i(),await a(),console.log(" Full sync completed")},[t,i,a]),d=H.useCallback(async()=>{const y=await aw();n(_=>({..._,pendingChanges:y}))},[]);H.useEffect(()=>{n(y=>({...y,isOnline:t})),t&&(console.log(" Back online, starting sync..."),u())},[t,u]),H.useEffect(()=>{(async()=>{const _=await J1();n(E=>({...E,lastSyncAt:_||void 0}))})()},[]),H.useEffect(()=>{d();const y=setInterval(d,5e3);return()=>clearInterval(y)},[d]),H.useEffect(()=>{if(!t)return;const y=setInterval(()=>{console.log(" Auto-sync triggered"),u()},hU);return()=>clearInterval(y)},[t,u]);const m=H.useCallback(async()=>{try{const y=await _V();y>0?(console.log(` Retrying ${y} failed changes...`),await d(),await u()):console.log(" No failed changes to retry")}catch(y){console.error(" Error retrying failed changes:",y)}},[u,d]);return{syncStatus:e,syncPendingChanges:i,syncFromServer:a,fullSync:u,updatePendingCount:d,retryFailedChanges:m}},k4=H.createContext(void 0);function fU({children:t}){const e=dU();return p.jsx(k4.Provider,{value:e,children:t})}function D4(){const t=H.useContext(k4);if(t===void 0)throw new Error("useOfflineSyncContext must be used within OfflineSyncProvider");return t}const hc=t=>{switch(t){case"group_admin":return{canCreateArtifacts:!0,canEditArtifacts:!0,canDeleteArtifacts:!0,canViewArtifacts:!0,canManageMembers:!0};case"member":return{canCreateArtifacts:!0,canEditArtifacts:!0,canDeleteArtifacts:!1,canViewArtifacts:!0,canManageMembers:!1};default:return{canCreateArtifacts:!1,canEditArtifacts:!1,canDeleteArtifacts:!1,canViewArtifacts:!0,canManageMembers:!1}}},mU=()=>({privacy:"private",defaultMemberPermissions:hc("member"),allowMemberInvites:!1}),gU=(t,e)=>t?t.permissions[e]===!0:!1,Gb=t=>t?t.role==="group_admin":!1,vh="groups",O4="groupMembers",pU=async t=>{try{const e=ot.currentUser;if(!e)throw new Error("User must be authenticated to create groups");const n={name:t.name,description:t.description||"",createdBy:e.uid,createdAt:Pn(),updatedAt:Pn(),isDeleted:!1,settings:{...mU(),...t.settings}},r=await Ku(an($e,vh),n);console.log(" Group created successfully with ID:",r.id);const s={userId:e.uid,groupId:r.id,role:"group_admin",permissions:hc("group_admin"),joinedAt:Pn()};return await Ku(an($e,O4),s),console.log(" Creator added as group admin"),r.id}catch(e){throw console.error(" Error creating group:",e),e}},yU=async t=>{var e,n,r,s,i,a;try{const u=Vt($e,vh,t),d=await ll(u);if(!d.exists())return null;const m=d.data();return{id:d.id,...m,createdAt:((r=(n=(e=m.createdAt)==null?void 0:e.toDate)==null?void 0:n.call(e))==null?void 0:r.toISOString())||new Date().toISOString(),updatedAt:((a=(i=(s=m.updatedAt)==null?void 0:s.toDate)==null?void 0:i.call(s))==null?void 0:a.toISOString())||new Date().toISOString()}}catch(u){throw console.error(" Error getting group:",u),u}},t2=async t=>{try{const e=ur(an($e,O4),Zt("userId","==",t)),r=(await hr(e)).docs.map(u=>u.data().groupId);if(r.length===0)return[];const s=ur(an($e,vh),Zt("isDeleted","==",!1)),i=await hr(s),a=[];return i.forEach(u=>{var d,m,y,_,E,b;if(r.includes(u.id)){const k=u.data();a.push({id:u.id,...k,createdAt:((y=(m=(d=k.createdAt)==null?void 0:d.toDate)==null?void 0:m.call(d))==null?void 0:y.toISOString())||new Date().toISOString(),updatedAt:((b=(E=(_=k.updatedAt)==null?void 0:_.toDate)==null?void 0:E.call(_))==null?void 0:b.toISOString())||new Date().toISOString()})}}),a}catch(e){throw console.error(" Error getting user groups:",e),e}},xU=async()=>{try{const t=ur(an($e,vh),Zt("isDeleted","==",!1)),e=await hr(t),n=[];return e.forEach(r=>{var i,a,u,d,m,y;const s=r.data();n.push({id:r.id,...s,createdAt:((u=(a=(i=s.createdAt)==null?void 0:i.toDate)==null?void 0:a.call(i))==null?void 0:u.toISOString())||new Date().toISOString(),updatedAt:((y=(m=(d=s.updatedAt)==null?void 0:d.toDate)==null?void 0:m.call(d))==null?void 0:y.toISOString())||new Date().toISOString()})}),n}catch(t){throw console.error(" Error getting all groups:",t),t}},wU=async(t,e)=>{try{if(!ot.currentUser)throw new Error("User must be authenticated to update groups");const r=Vt($e,vh,t),s=Object.fromEntries(Object.entries(e).filter(([i,a])=>a!==void 0));await Wr(r,{...s,updatedAt:Pn()}),console.log(" Group updated successfully:",t)}catch(n){throw console.error(" Error updating group:",n),n}},_U=async t=>{try{const e=ot.currentUser;if(!e)throw new Error("User must be authenticated to delete groups");const n=Vt($e,vh,t);await Wr(n,{isDeleted:!0,deletedAt:Pn(),deletedBy:e.uid,updatedAt:Pn()}),console.log(" Group deleted successfully:",t)}catch(e){throw console.error(" Error deleting group:",e),e}},vU=H.createContext(void 0),EU=({children:t})=>{const{user:e}=bn(),[n,r]=H.useState(null),[s,i]=H.useState([]),[a,u]=H.useState(!0),d=async()=>{if(!e){i([]),r(null),u(!1);return}try{u(!0);const y=await t2(e.id);i(y),n&&!y.find(_=>_.id===n.id)&&r(null)}catch(y){console.error("Error loading groups:",y),i([])}finally{u(!1)}};H.useEffect(()=>{d()},[e]);const m={currentGroup:n,userGroups:s,loading:a,setCurrentGroup:r,reloadGroups:d};return p.jsx(vU.Provider,{value:m,children:t})};var o0=t=>t.type==="checkbox",Ll=t=>t instanceof Date,Xr=t=>t==null;const M4=t=>typeof t=="object";var Jn=t=>!Xr(t)&&!Array.isArray(t)&&M4(t)&&!Ll(t),AU=t=>Jn(t)&&t.target?o0(t.target)?t.target.checked:t.target.value:t,bU=t=>t.substring(0,t.search(/\.\d+(\.|$)/))||t,IU=(t,e)=>t.has(bU(e)),CU=t=>{const e=t.constructor&&t.constructor.prototype;return Jn(e)&&e.hasOwnProperty("isPrototypeOf")},n2=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function mr(t){let e;const n=Array.isArray(t),r=typeof FileList<"u"?t instanceof FileList:!1;if(t instanceof Date)e=new Date(t);else if(!(n2&&(t instanceof Blob||r))&&(n||Jn(t)))if(e=n?[]:Object.create(Object.getPrototypeOf(t)),!n&&!CU(t))e=t;else for(const s in t)t.hasOwnProperty(s)&&(e[s]=mr(t[s]));else return t;return e}var Xp=t=>/^\w*$/.test(t),Qn=t=>t===void 0,r2=t=>Array.isArray(t)?t.filter(Boolean):[],s2=t=>r2(t.replace(/["|']|\]/g,"").split(/\.|\[/)),Be=(t,e,n)=>{if(!e||!Jn(t))return n;const r=(Xp(e)?[e]:s2(e)).reduce((s,i)=>Xr(s)?s:s[i],t);return Qn(r)||r===t?Qn(t[e])?n:t[e]:r},ki=t=>typeof t=="boolean",cn=(t,e,n)=>{let r=-1;const s=Xp(e)?[e]:s2(e),i=s.length,a=i-1;for(;++r<i;){const u=s[r];let d=n;if(r!==a){const m=t[u];d=Jn(m)||Array.isArray(m)?m:isNaN(+s[r+1])?{}:[]}if(u==="__proto__"||u==="constructor"||u==="prototype")return;t[u]=d,t=t[u]}};const qb={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},ui={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ao={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},TU=jr.createContext(null);TU.displayName="HookFormContext";var SU=(t,e,n,r=!0)=>{const s={defaultValues:e._defaultValues};for(const i in t)Object.defineProperty(s,i,{get:()=>{const a=i;return e._proxyFormState[a]!==ui.all&&(e._proxyFormState[a]=!r||ui.all),n&&(n[a]=!0),t[a]}});return s};const NU=typeof window<"u"?jr.useLayoutEffect:jr.useEffect;var Ts=t=>typeof t=="string",RU=(t,e,n,r,s)=>Ts(t)?(r&&e.watch.add(t),Be(n,t,s)):Array.isArray(t)?t.map(i=>(r&&e.watch.add(i),Be(n,i))):(r&&(e.watchAll=!0),n),dw=t=>Xr(t)||!M4(t);function pa(t,e,n=new WeakSet){if(dw(t)||dw(e))return t===e;if(Ll(t)&&Ll(e))return t.getTime()===e.getTime();const r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;if(n.has(t)||n.has(e))return!0;n.add(t),n.add(e);for(const i of r){const a=t[i];if(!s.includes(i))return!1;if(i!=="ref"){const u=e[i];if(Ll(a)&&Ll(u)||Jn(a)&&Jn(u)||Array.isArray(a)&&Array.isArray(u)?!pa(a,u,n):a!==u)return!1}}return!0}var PU=(t,e,n,r,s)=>e?{...n[t],types:{...n[t]&&n[t].types?n[t].types:{},[r]:s||!0}}:{},Md=t=>Array.isArray(t)?t:[t],Wb=()=>{let t=[];return{get observers(){return t},next:s=>{for(const i of t)i.next&&i.next(s)},subscribe:s=>(t.push(s),{unsubscribe:()=>{t=t.filter(i=>i!==s)}}),unsubscribe:()=>{t=[]}}};function L4(t,e){const n={};for(const r in t)if(t.hasOwnProperty(r)){const s=t[r],i=e[r];if(s&&Jn(s)&&i){const a=L4(s,i);Jn(a)&&(n[r]=a)}else t[r]&&(n[r]=i)}return n}var us=t=>Jn(t)&&!Object.keys(t).length,i2=t=>t.type==="file",hi=t=>typeof t=="function",zg=t=>{if(!n2)return!1;const e=t?t.ownerDocument:0;return t instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},j4=t=>t.type==="select-multiple",o2=t=>t.type==="radio",kU=t=>o2(t)||o0(t),iy=t=>zg(t)&&t.isConnected;function DU(t,e){const n=e.slice(0,-1).length;let r=0;for(;r<n;)t=Qn(t)?r++:t[e[r++]];return t}function OU(t){for(const e in t)if(t.hasOwnProperty(e)&&!Qn(t[e]))return!1;return!0}function Hn(t,e){const n=Array.isArray(e)?e:Xp(e)?[e]:s2(e),r=n.length===1?t:DU(t,n),s=n.length-1,i=n[s];return r&&delete r[i],s!==0&&(Jn(r)&&us(r)||Array.isArray(r)&&OU(r))&&Hn(t,n.slice(0,-1)),t}var MU=t=>{for(const e in t)if(hi(t[e]))return!0;return!1};function F4(t){return Array.isArray(t)||Jn(t)&&!MU(t)}function fw(t,e={}){for(const n in t)F4(t[n])?(e[n]=Array.isArray(t[n])?[]:{},fw(t[n],e[n])):Xr(t[n])||(e[n]=!0);return e}function Xc(t,e,n){n||(n=fw(e));for(const r in t)F4(t[r])?Qn(e)||dw(n[r])?n[r]=fw(t[r],Array.isArray(t[r])?[]:{}):Xc(t[r],Xr(e)?{}:e[r],n[r]):n[r]=!pa(t[r],e[r]);return n}const $b={value:!1,isValid:!1},Hb={value:!0,isValid:!0};var B4=t=>{if(Array.isArray(t)){if(t.length>1){const e=t.filter(n=>n&&n.checked&&!n.disabled).map(n=>n.value);return{value:e,isValid:!!e.length}}return t[0].checked&&!t[0].disabled?t[0].attributes&&!Qn(t[0].attributes.value)?Qn(t[0].value)||t[0].value===""?Hb:{value:t[0].value,isValid:!0}:Hb:$b}return $b},V4=(t,{valueAsNumber:e,valueAsDate:n,setValueAs:r})=>Qn(t)?t:e?t===""?NaN:t&&+t:n&&Ts(t)?new Date(t):r?r(t):t;const Kb={isValid:!1,value:null};var U4=t=>Array.isArray(t)?t.reduce((e,n)=>n&&n.checked&&!n.disabled?{isValid:!0,value:n.value}:e,Kb):Kb;function Qb(t){const e=t.ref;return i2(e)?e.files:o2(e)?U4(t.refs).value:j4(e)?[...e.selectedOptions].map(({value:n})=>n):o0(e)?B4(t.refs).value:V4(Qn(e.value)?t.ref.value:e.value,t)}var LU=(t,e,n,r)=>{const s={};for(const i of t){const a=Be(e,i);a&&cn(s,i,a._f)}return{criteriaMode:n,names:[...t],fields:s,shouldUseNativeValidation:r}},Gg=t=>t instanceof RegExp,ed=t=>Qn(t)?t:Gg(t)?t.source:Jn(t)?Gg(t.value)?t.value.source:t.value:t,Xb=t=>({isOnSubmit:!t||t===ui.onSubmit,isOnBlur:t===ui.onBlur,isOnChange:t===ui.onChange,isOnAll:t===ui.all,isOnTouch:t===ui.onTouched});const Yb="AsyncFunction";var jU=t=>!!t&&!!t.validate&&!!(hi(t.validate)&&t.validate.constructor.name===Yb||Jn(t.validate)&&Object.values(t.validate).find(e=>e.constructor.name===Yb)),FU=t=>t.mount&&(t.required||t.min||t.max||t.maxLength||t.minLength||t.pattern||t.validate),Zb=(t,e,n)=>!n&&(e.watchAll||e.watch.has(t)||[...e.watch].some(r=>t.startsWith(r)&&/^\.\w+/.test(t.slice(r.length))));const Ld=(t,e,n,r)=>{for(const s of n||Object.keys(t)){const i=Be(t,s);if(i){const{_f:a,...u}=i;if(a){if(a.refs&&a.refs[0]&&e(a.refs[0],s)&&!r)return!0;if(a.ref&&e(a.ref,a.name)&&!r)return!0;if(Ld(u,e))break}else if(Jn(u)&&Ld(u,e))break}}};function Jb(t,e,n){const r=Be(t,n);if(r||Xp(n))return{error:r,name:n};const s=n.split(".");for(;s.length;){const i=s.join("."),a=Be(e,i),u=Be(t,i);if(a&&!Array.isArray(a)&&n!==i)return{name:n};if(u&&u.type)return{name:i,error:u};if(u&&u.root&&u.root.type)return{name:`${i}.root`,error:u.root};s.pop()}return{name:n}}var BU=(t,e,n,r)=>{n(t);const{name:s,...i}=t;return us(i)||Object.keys(i).length>=Object.keys(e).length||Object.keys(i).find(a=>e[a]===(!r||ui.all))},VU=(t,e,n)=>!t||!e||t===e||Md(t).some(r=>r&&(n?r===e:r.startsWith(e)||e.startsWith(r))),UU=(t,e,n,r,s)=>s.isOnAll?!1:!n&&s.isOnTouch?!(e||t):(n?r.isOnBlur:s.isOnBlur)?!t:(n?r.isOnChange:s.isOnChange)?t:!0,zU=(t,e)=>!r2(Be(t,e)).length&&Hn(t,e),GU=(t,e,n)=>{const r=Md(Be(t,n));return cn(r,"root",e[n]),cn(t,n,r),t};function eI(t,e,n="validate"){if(Ts(t)||Array.isArray(t)&&t.every(Ts)||ki(t)&&!t)return{type:n,message:Ts(t)?t:"",ref:e}}var qc=t=>Jn(t)&&!Gg(t)?t:{value:t,message:""},tI=async(t,e,n,r,s,i)=>{const{ref:a,refs:u,required:d,maxLength:m,minLength:y,min:_,max:E,pattern:b,validate:k,name:S,valueAsNumber:O,mount:T}=t._f,C=Be(n,S);if(!T||e.has(S))return{};const R=u?u[0]:a,j=$=>{s&&R.reportValidity&&(R.setCustomValidity(ki($)?"":$||""),R.reportValidity())},K={},Q=o2(a),D=o0(a),B=Q||D,F=(O||i2(a))&&Qn(a.value)&&Qn(C)||zg(a)&&a.value===""||C===""||Array.isArray(C)&&!C.length,W=PU.bind(null,S,r,K),X=($,z,Te,ie=ao.maxLength,Xe=ao.minLength)=>{const de=$?z:Te;K[S]={type:$?ie:Xe,message:de,ref:a,...W($?ie:Xe,de)}};if(i?!Array.isArray(C)||!C.length:d&&(!B&&(F||Xr(C))||ki(C)&&!C||D&&!B4(u).isValid||Q&&!U4(u).isValid)){const{value:$,message:z}=Ts(d)?{value:!!d,message:d}:qc(d);if($&&(K[S]={type:ao.required,message:z,ref:R,...W(ao.required,z)},!r))return j(z),K}if(!F&&(!Xr(_)||!Xr(E))){let $,z;const Te=qc(E),ie=qc(_);if(!Xr(C)&&!isNaN(C)){const Xe=a.valueAsNumber||C&&+C;Xr(Te.value)||($=Xe>Te.value),Xr(ie.value)||(z=Xe<ie.value)}else{const Xe=a.valueAsDate||new Date(C),de=Me=>new Date(new Date().toDateString()+" "+Me),he=a.type=="time",Ce=a.type=="week";Ts(Te.value)&&C&&($=he?de(C)>de(Te.value):Ce?C>Te.value:Xe>new Date(Te.value)),Ts(ie.value)&&C&&(z=he?de(C)<de(ie.value):Ce?C<ie.value:Xe<new Date(ie.value))}if(($||z)&&(X(!!$,Te.message,ie.message,ao.max,ao.min),!r))return j(K[S].message),K}if((m||y)&&!F&&(Ts(C)||i&&Array.isArray(C))){const $=qc(m),z=qc(y),Te=!Xr($.value)&&C.length>+$.value,ie=!Xr(z.value)&&C.length<+z.value;if((Te||ie)&&(X(Te,$.message,z.message),!r))return j(K[S].message),K}if(b&&!F&&Ts(C)){const{value:$,message:z}=qc(b);if(Gg($)&&!C.match($)&&(K[S]={type:ao.pattern,message:z,ref:a,...W(ao.pattern,z)},!r))return j(z),K}if(k){if(hi(k)){const $=await k(C,n),z=eI($,R);if(z&&(K[S]={...z,...W(ao.validate,z.message)},!r))return j(z.message),K}else if(Jn(k)){let $={};for(const z in k){if(!us($)&&!r)break;const Te=eI(await k[z](C,n),R,z);Te&&($={...Te,...W(z,Te.message)},j(Te.message),r&&(K[S]=$))}if(!us($)&&(K[S]={ref:R,...$},!r))return K}}return j(!0),K};const qU={mode:ui.onSubmit,reValidateMode:ui.onChange,shouldFocusError:!0};function WU(t={}){let e={...qU,...t},n={submitCount:0,isDirty:!1,isReady:!1,isLoading:hi(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},r={},s=Jn(e.defaultValues)||Jn(e.values)?mr(e.defaultValues||e.values)||{}:{},i=e.shouldUnregister?{}:mr(s),a={action:!1,mount:!1,watch:!1},u={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},d,m=0;const y={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let _={...y};const E={array:Wb(),state:Wb()},b=e.criteriaMode===ui.all,k=Y=>Z=>{clearTimeout(m),m=setTimeout(Y,Z)},S=async Y=>{if(!e.disabled&&(y.isValid||_.isValid||Y)){const Z=e.resolver?us((await D()).errors):await F(r,!0);Z!==n.isValid&&E.state.next({isValid:Z})}},O=(Y,Z)=>{!e.disabled&&(y.isValidating||y.validatingFields||_.isValidating||_.validatingFields)&&((Y||Array.from(u.mount)).forEach(ue=>{ue&&(Z?cn(n.validatingFields,ue,Z):Hn(n.validatingFields,ue))}),E.state.next({validatingFields:n.validatingFields,isValidating:!us(n.validatingFields)}))},T=(Y,Z=[],ue,Ne,_e=!0,xe=!0)=>{if(Ne&&ue&&!e.disabled){if(a.action=!0,xe&&Array.isArray(Be(r,Y))){const Pe=ue(Be(r,Y),Ne.argA,Ne.argB);_e&&cn(r,Y,Pe)}if(xe&&Array.isArray(Be(n.errors,Y))){const Pe=ue(Be(n.errors,Y),Ne.argA,Ne.argB);_e&&cn(n.errors,Y,Pe),zU(n.errors,Y)}if((y.touchedFields||_.touchedFields)&&xe&&Array.isArray(Be(n.touchedFields,Y))){const Pe=ue(Be(n.touchedFields,Y),Ne.argA,Ne.argB);_e&&cn(n.touchedFields,Y,Pe)}(y.dirtyFields||_.dirtyFields)&&(n.dirtyFields=Xc(s,i)),E.state.next({name:Y,isDirty:X(Y,Z),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else cn(i,Y,Z)},C=(Y,Z)=>{cn(n.errors,Y,Z),E.state.next({errors:n.errors})},R=Y=>{n.errors=Y,E.state.next({errors:n.errors,isValid:!1})},j=(Y,Z,ue,Ne)=>{const _e=Be(r,Y);if(_e){const xe=Be(i,Y,Qn(ue)?Be(s,Y):ue);Qn(xe)||Ne&&Ne.defaultChecked||Z?cn(i,Y,Z?xe:Qb(_e._f)):Te(Y,xe),a.mount&&S()}},K=(Y,Z,ue,Ne,_e)=>{let xe=!1,Pe=!1;const Qe={name:Y};if(!e.disabled){if(!ue||Ne){(y.isDirty||_.isDirty)&&(Pe=n.isDirty,n.isDirty=Qe.isDirty=X(),xe=Pe!==Qe.isDirty);const He=pa(Be(s,Y),Z);Pe=!!Be(n.dirtyFields,Y),He?Hn(n.dirtyFields,Y):cn(n.dirtyFields,Y,!0),Qe.dirtyFields=n.dirtyFields,xe=xe||(y.dirtyFields||_.dirtyFields)&&Pe!==!He}if(ue){const He=Be(n.touchedFields,Y);He||(cn(n.touchedFields,Y,ue),Qe.touchedFields=n.touchedFields,xe=xe||(y.touchedFields||_.touchedFields)&&He!==ue)}xe&&_e&&E.state.next(Qe)}return xe?Qe:{}},Q=(Y,Z,ue,Ne)=>{const _e=Be(n.errors,Y),xe=(y.isValid||_.isValid)&&ki(Z)&&n.isValid!==Z;if(e.delayError&&ue?(d=k(()=>C(Y,ue)),d(e.delayError)):(clearTimeout(m),d=null,ue?cn(n.errors,Y,ue):Hn(n.errors,Y)),(ue?!pa(_e,ue):_e)||!us(Ne)||xe){const Pe={...Ne,...xe&&ki(Z)?{isValid:Z}:{},errors:n.errors,name:Y};n={...n,...Pe},E.state.next(Pe)}},D=async Y=>{O(Y,!0);const Z=await e.resolver(i,e.context,LU(Y||u.mount,r,e.criteriaMode,e.shouldUseNativeValidation));return O(Y),Z},B=async Y=>{const{errors:Z}=await D(Y);if(Y)for(const ue of Y){const Ne=Be(Z,ue);Ne?cn(n.errors,ue,Ne):Hn(n.errors,ue)}else n.errors=Z;return Z},F=async(Y,Z,ue={valid:!0})=>{for(const Ne in Y){const _e=Y[Ne];if(_e){const{_f:xe,...Pe}=_e;if(xe){const Qe=u.array.has(xe.name),He=_e._f&&jU(_e._f);He&&y.validatingFields&&O([xe.name],!0);const Ct=await tI(_e,u.disabled,i,b,e.shouldUseNativeValidation&&!Z,Qe);if(He&&y.validatingFields&&O([xe.name]),Ct[xe.name]&&(ue.valid=!1,Z))break;!Z&&(Be(Ct,xe.name)?Qe?GU(n.errors,Ct,xe.name):cn(n.errors,xe.name,Ct[xe.name]):Hn(n.errors,xe.name))}!us(Pe)&&await F(Pe,Z,ue)}}return ue.valid},W=()=>{for(const Y of u.unMount){const Z=Be(r,Y);Z&&(Z._f.refs?Z._f.refs.every(ue=>!iy(ue)):!iy(Z._f.ref))&&fr(Y)}u.unMount=new Set},X=(Y,Z)=>!e.disabled&&(Y&&Z&&cn(i,Y,Z),!pa(Me(),s)),$=(Y,Z,ue)=>RU(Y,u,{...a.mount?i:Qn(Z)?s:Ts(Y)?{[Y]:Z}:Z},ue,Z),z=Y=>r2(Be(a.mount?i:s,Y,e.shouldUnregister?Be(s,Y,[]):[])),Te=(Y,Z,ue={})=>{const Ne=Be(r,Y);let _e=Z;if(Ne){const xe=Ne._f;xe&&(!xe.disabled&&cn(i,Y,V4(Z,xe)),_e=zg(xe.ref)&&Xr(Z)?"":Z,j4(xe.ref)?[...xe.ref.options].forEach(Pe=>Pe.selected=_e.includes(Pe.value)):xe.refs?o0(xe.ref)?xe.refs.forEach(Pe=>{(!Pe.defaultChecked||!Pe.disabled)&&(Array.isArray(_e)?Pe.checked=!!_e.find(Qe=>Qe===Pe.value):Pe.checked=_e===Pe.value||!!_e)}):xe.refs.forEach(Pe=>Pe.checked=Pe.value===_e):i2(xe.ref)?xe.ref.value="":(xe.ref.value=_e,xe.ref.type||E.state.next({name:Y,values:mr(i)})))}(ue.shouldDirty||ue.shouldTouch)&&K(Y,_e,ue.shouldTouch,ue.shouldDirty,!0),ue.shouldValidate&&Ce(Y)},ie=(Y,Z,ue)=>{for(const Ne in Z){if(!Z.hasOwnProperty(Ne))return;const _e=Z[Ne],xe=Y+"."+Ne,Pe=Be(r,xe);(u.array.has(Y)||Jn(_e)||Pe&&!Pe._f)&&!Ll(_e)?ie(xe,_e,ue):Te(xe,_e,ue)}},Xe=(Y,Z,ue={})=>{const Ne=Be(r,Y),_e=u.array.has(Y),xe=mr(Z);cn(i,Y,xe),_e?(E.array.next({name:Y,values:mr(i)}),(y.isDirty||y.dirtyFields||_.isDirty||_.dirtyFields)&&ue.shouldDirty&&E.state.next({name:Y,dirtyFields:Xc(s,i),isDirty:X(Y,xe)})):Ne&&!Ne._f&&!Xr(xe)?ie(Y,xe,ue):Te(Y,xe,ue),Zb(Y,u)&&E.state.next({...n,name:Y}),E.state.next({name:a.mount?Y:void 0,values:mr(i)})},de=async Y=>{a.mount=!0;const Z=Y.target;let ue=Z.name,Ne=!0;const _e=Be(r,ue),xe=He=>{Ne=Number.isNaN(He)||Ll(He)&&isNaN(He.getTime())||pa(He,Be(i,ue,He))},Pe=Xb(e.mode),Qe=Xb(e.reValidateMode);if(_e){let He,Ct;const wi=Z.type?Qb(_e._f):AU(Y),kr=Y.type===qb.BLUR||Y.type===qb.FOCUS_OUT,Ah=!FU(_e._f)&&!e.resolver&&!Be(n.errors,ue)&&!_e._f.deps||UU(kr,Be(n.touchedFields,ue),n.isSubmitted,Qe,Pe),kt=Zb(ue,u,kr);cn(i,ue,wi),kr?(!Z||!Z.readOnly)&&(_e._f.onBlur&&_e._f.onBlur(Y),d&&d(0)):_e._f.onChange&&_e._f.onChange(Y);const Ae=K(ue,wi,kr),ln=!us(Ae)||kt;if(!kr&&E.state.next({name:ue,type:Y.type,values:mr(i)}),Ah)return(y.isValid||_.isValid)&&(e.mode==="onBlur"?kr&&S():kr||S()),ln&&E.state.next({name:ue,...kt?{}:Ae});if(!kr&&kt&&E.state.next({...n}),e.resolver){const{errors:vt}=await D([ue]);if(xe(wi),Ne){const Kt=Jb(n.errors,r,ue),_i=Jb(vt,r,Kt.name||ue);He=_i.error,ue=_i.name,Ct=us(vt)}}else O([ue],!0),He=(await tI(_e,u.disabled,i,b,e.shouldUseNativeValidation))[ue],O([ue]),xe(wi),Ne&&(He?Ct=!1:(y.isValid||_.isValid)&&(Ct=await F(r,!0)));Ne&&(_e._f.deps&&(!Array.isArray(_e._f.deps)||_e._f.deps.length>0)&&Ce(_e._f.deps),Q(ue,Ct,He,Ae))}},he=(Y,Z)=>{if(Be(n.errors,Z)&&Y.focus)return Y.focus(),1},Ce=async(Y,Z={})=>{let ue,Ne;const _e=Md(Y);if(e.resolver){const xe=await B(Qn(Y)?Y:_e);ue=us(xe),Ne=Y?!_e.some(Pe=>Be(xe,Pe)):ue}else Y?(Ne=(await Promise.all(_e.map(async xe=>{const Pe=Be(r,xe);return await F(Pe&&Pe._f?{[xe]:Pe}:Pe)}))).every(Boolean),!(!Ne&&!n.isValid)&&S()):Ne=ue=await F(r);return E.state.next({...!Ts(Y)||(y.isValid||_.isValid)&&ue!==n.isValid?{}:{name:Y},...e.resolver||!Y?{isValid:ue}:{},errors:n.errors}),Z.shouldFocus&&!Ne&&Ld(r,he,Y?_e:u.mount),Ne},Me=(Y,Z)=>{let ue={...a.mount?i:s};return Z&&(ue=L4(Z.dirtyFields?n.dirtyFields:n.touchedFields,ue)),Qn(Y)?ue:Ts(Y)?Be(ue,Y):Y.map(Ne=>Be(ue,Ne))},ht=(Y,Z)=>({invalid:!!Be((Z||n).errors,Y),isDirty:!!Be((Z||n).dirtyFields,Y),error:Be((Z||n).errors,Y),isValidating:!!Be(n.validatingFields,Y),isTouched:!!Be((Z||n).touchedFields,Y)}),Ge=Y=>{Y&&Md(Y).forEach(Z=>Hn(n.errors,Z)),E.state.next({errors:Y?n.errors:{}})},_t=(Y,Z,ue)=>{const Ne=(Be(r,Y,{_f:{}})._f||{}).ref,_e=Be(n.errors,Y)||{},{ref:xe,message:Pe,type:Qe,...He}=_e;cn(n.errors,Y,{...He,...Z,ref:Ne}),E.state.next({name:Y,errors:n.errors,isValid:!1}),ue&&ue.shouldFocus&&Ne&&Ne.focus&&Ne.focus()},zt=(Y,Z)=>hi(Y)?E.state.subscribe({next:ue=>"values"in ue&&Y($(void 0,Z),ue)}):$(Y,Z,!0),Pr=Y=>E.state.subscribe({next:Z=>{VU(Y.name,Z.name,Y.exact)&&BU(Z,Y.formState||y,In,Y.reRenderRoot)&&Y.callback({values:{...i},...n,...Z,defaultValues:s})}}).unsubscribe,Fe=Y=>(a.mount=!0,_={..._,...Y.formState},Pr({...Y,formState:_})),fr=(Y,Z={})=>{for(const ue of Y?Md(Y):u.mount)u.mount.delete(ue),u.array.delete(ue),Z.keepValue||(Hn(r,ue),Hn(i,ue)),!Z.keepError&&Hn(n.errors,ue),!Z.keepDirty&&Hn(n.dirtyFields,ue),!Z.keepTouched&&Hn(n.touchedFields,ue),!Z.keepIsValidating&&Hn(n.validatingFields,ue),!e.shouldUnregister&&!Z.keepDefaultValue&&Hn(s,ue);E.state.next({values:mr(i)}),E.state.next({...n,...Z.keepDirty?{isDirty:X()}:{}}),!Z.keepIsValid&&S()},pn=({disabled:Y,name:Z})=>{(ki(Y)&&a.mount||Y||u.disabled.has(Z))&&(Y?u.disabled.add(Z):u.disabled.delete(Z))},Xs=(Y,Z={})=>{let ue=Be(r,Y);const Ne=ki(Z.disabled)||ki(e.disabled);return cn(r,Y,{...ue||{},_f:{...ue&&ue._f?ue._f:{ref:{name:Y}},name:Y,mount:!0,...Z}}),u.mount.add(Y),ue?pn({disabled:ki(Z.disabled)?Z.disabled:e.disabled,name:Y}):j(Y,!0,Z.value),{...Ne?{disabled:Z.disabled||e.disabled}:{},...e.progressive?{required:!!Z.required,min:ed(Z.min),max:ed(Z.max),minLength:ed(Z.minLength),maxLength:ed(Z.maxLength),pattern:ed(Z.pattern)}:{},name:Y,onChange:de,onBlur:de,ref:_e=>{if(_e){Xs(Y,Z),ue=Be(r,Y);const xe=Qn(_e.value)&&_e.querySelectorAll&&_e.querySelectorAll("input,select,textarea")[0]||_e,Pe=kU(xe),Qe=ue._f.refs||[];if(Pe?Qe.find(He=>He===xe):xe===ue._f.ref)return;cn(r,Y,{_f:{...ue._f,...Pe?{refs:[...Qe.filter(iy),xe,...Array.isArray(Be(s,Y))?[{}]:[]],ref:{type:xe.type,name:Y}}:{ref:xe}}}),j(Y,!1,void 0,xe)}else ue=Be(r,Y,{}),ue._f&&(ue._f.mount=!1),(e.shouldUnregister||Z.shouldUnregister)&&!(IU(u.array,Y)&&a.action)&&u.unMount.add(Y)}}},rs=()=>e.shouldFocusError&&Ld(r,he,u.mount),Mn=Y=>{ki(Y)&&(E.state.next({disabled:Y}),Ld(r,(Z,ue)=>{const Ne=Be(r,ue);Ne&&(Z.disabled=Ne._f.disabled||Y,Array.isArray(Ne._f.refs)&&Ne._f.refs.forEach(_e=>{_e.disabled=Ne._f.disabled||Y}))},0,!1))},Ys=(Y,Z)=>async ue=>{let Ne;ue&&(ue.preventDefault&&ue.preventDefault(),ue.persist&&ue.persist());let _e=mr(i);if(E.state.next({isSubmitting:!0}),e.resolver){const{errors:xe,values:Pe}=await D();n.errors=xe,_e=mr(Pe)}else await F(r);if(u.disabled.size)for(const xe of u.disabled)Hn(_e,xe);if(Hn(n.errors,"root"),us(n.errors)){E.state.next({errors:{}});try{await Y(_e,ue)}catch(xe){Ne=xe}}else Z&&await Z({...n.errors},ue),rs(),setTimeout(rs);if(E.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:us(n.errors)&&!Ne,submitCount:n.submitCount+1,errors:n.errors}),Ne)throw Ne},dt=(Y,Z={})=>{Be(r,Y)&&(Qn(Z.defaultValue)?Xe(Y,mr(Be(s,Y))):(Xe(Y,Z.defaultValue),cn(s,Y,mr(Z.defaultValue))),Z.keepTouched||Hn(n.touchedFields,Y),Z.keepDirty||(Hn(n.dirtyFields,Y),n.isDirty=Z.defaultValue?X(Y,mr(Be(s,Y))):X()),Z.keepError||(Hn(n.errors,Y),y.isValid&&S()),E.state.next({...n}))},ws=(Y,Z={})=>{const ue=Y?mr(Y):s,Ne=mr(ue),_e=us(Y),xe=_e?s:Ne;if(Z.keepDefaultValues||(s=ue),!Z.keepValues){if(Z.keepDirtyValues){const Pe=new Set([...u.mount,...Object.keys(Xc(s,i))]);for(const Qe of Array.from(Pe))Be(n.dirtyFields,Qe)?cn(xe,Qe,Be(i,Qe)):Xe(Qe,Be(xe,Qe))}else{if(n2&&Qn(Y))for(const Pe of u.mount){const Qe=Be(r,Pe);if(Qe&&Qe._f){const He=Array.isArray(Qe._f.refs)?Qe._f.refs[0]:Qe._f.ref;if(zg(He)){const Ct=He.closest("form");if(Ct){Ct.reset();break}}}}if(Z.keepFieldsRef)for(const Pe of u.mount)Xe(Pe,Be(xe,Pe));else r={}}i=e.shouldUnregister?Z.keepDefaultValues?mr(s):{}:mr(xe),E.array.next({values:{...xe}}),E.state.next({values:{...xe}})}u={mount:Z.keepDirtyValues?u.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},a.mount=!y.isValid||!!Z.keepIsValid||!!Z.keepDirtyValues,a.watch=!!e.shouldUnregister,E.state.next({submitCount:Z.keepSubmitCount?n.submitCount:0,isDirty:_e?!1:Z.keepDirty?n.isDirty:!!(Z.keepDefaultValues&&!pa(Y,s)),isSubmitted:Z.keepIsSubmitted?n.isSubmitted:!1,dirtyFields:_e?{}:Z.keepDirtyValues?Z.keepDefaultValues&&i?Xc(s,i):n.dirtyFields:Z.keepDefaultValues&&Y?Xc(s,Y):Z.keepDirty?n.dirtyFields:{},touchedFields:Z.keepTouched?n.touchedFields:{},errors:Z.keepErrors?n.errors:{},isSubmitSuccessful:Z.keepIsSubmitSuccessful?n.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:s})},_r=(Y,Z)=>ws(hi(Y)?Y(i):Y,Z),xi=(Y,Z={})=>{const ue=Be(r,Y),Ne=ue&&ue._f;if(Ne){const _e=Ne.refs?Ne.refs[0]:Ne.ref;_e.focus&&(_e.focus(),Z.shouldSelect&&hi(_e.select)&&_e.select())}},In=Y=>{n={...n,...Y}},lt={control:{register:Xs,unregister:fr,getFieldState:ht,handleSubmit:Ys,setError:_t,_subscribe:Pr,_runSchema:D,_focusError:rs,_getWatch:$,_getDirty:X,_setValid:S,_setFieldArray:T,_setDisabledField:pn,_setErrors:R,_getFieldArray:z,_reset:ws,_resetDefaultValues:()=>hi(e.defaultValues)&&e.defaultValues().then(Y=>{_r(Y,e.resetOptions),E.state.next({isLoading:!1})}),_removeUnmounted:W,_disableForm:Mn,_subjects:E,_proxyFormState:y,get _fields(){return r},get _formValues(){return i},get _state(){return a},set _state(Y){a=Y},get _defaultValues(){return s},get _names(){return u},set _names(Y){u=Y},get _formState(){return n},get _options(){return e},set _options(Y){e={...e,...Y}}},subscribe:Fe,trigger:Ce,register:Xs,handleSubmit:Ys,watch:zt,setValue:Xe,getValues:Me,reset:_r,resetField:dt,clearErrors:Ge,unregister:fr,setError:_t,setFocus:xi,getFieldState:ht};return{...lt,formControl:lt}}function a0(t={}){const e=jr.useRef(void 0),n=jr.useRef(void 0),[r,s]=jr.useState({isDirty:!1,isValidating:!1,isLoading:hi(t.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1,isReady:!1,defaultValues:hi(t.defaultValues)?void 0:t.defaultValues});if(!e.current)if(t.formControl)e.current={...t.formControl,formState:r},t.defaultValues&&!hi(t.defaultValues)&&t.formControl.reset(t.defaultValues,t.resetOptions);else{const{formControl:a,...u}=WU(t);e.current={...u,formState:r}}const i=e.current.control;return i._options=t,NU(()=>{const a=i._subscribe({formState:i._proxyFormState,callback:()=>s({...i._formState}),reRenderRoot:!0});return s(u=>({...u,isReady:!0})),i._formState.isReady=!0,a},[i]),jr.useEffect(()=>i._disableForm(t.disabled),[i,t.disabled]),jr.useEffect(()=>{t.mode&&(i._options.mode=t.mode),t.reValidateMode&&(i._options.reValidateMode=t.reValidateMode)},[i,t.mode,t.reValidateMode]),jr.useEffect(()=>{t.errors&&(i._setErrors(t.errors),i._focusError())},[i,t.errors]),jr.useEffect(()=>{t.shouldUnregister&&i._subjects.state.next({values:i._getWatch()})},[i,t.shouldUnregister]),jr.useEffect(()=>{if(i._proxyFormState.isDirty){const a=i._getDirty();a!==r.isDirty&&i._subjects.state.next({isDirty:a})}},[i,r.isDirty]),jr.useEffect(()=>{t.values&&!pa(t.values,n.current)?(i._reset(t.values,{keepFieldsRef:!0,...i._options.resetOptions}),n.current=t.values,s(a=>({...a}))):i._resetDefaultValues()},[i,t.values]),jr.useEffect(()=>{i._state.mount||(i._setValid(),i._state.mount=!0),i._state.watch&&(i._state.watch=!1,i._subjects.state.next({...i._formState})),i._removeUnmounted()}),e.current.formState=SU(r,i),e.current}const $U=({onSuccess:t,onSwitchToRegister:e})=>{const{login:n,loading:r,error:s,clearError:i}=bn(),a=gn(),[u,d]=H.useState(!1),{register:m,handleSubmit:y,formState:{errors:_},watch:E}=a0(),b=async k=>{try{d(!0),i(),await n(k),ye.success("Login successful!"),a("/dashboard",{replace:!0}),t==null||t()}catch(S){ye.error(S.message||"Login failed")}finally{d(!1)}};return p.jsx("div",{className:"w-full max-w-md mx-auto",children:p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"card-header",children:[p.jsx("h2",{className:"text-2xl font-bold text-center",children:"Sign In"}),p.jsx("p",{className:"text-center text-secondary-600 mt-2",children:"Sign in to your archaeological artifacts account"})]}),p.jsxs("form",{onSubmit:y(b),className:"card-content space-y-4",children:[s&&p.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:p.jsx("p",{className:"text-red-800 text-sm",children:s.message})}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-secondary-700 mb-1",children:"Email Address"}),p.jsx("input",{...m("email",{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email format"}}),type:"email",id:"email",className:"input",placeholder:"archaeologist@university.edu"}),_.email&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:_.email.message})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-secondary-700 mb-1",children:"Password"}),p.jsx("input",{...m("password",{required:"Password is required",minLength:{value:6,message:"Password must be at least 6 characters"}}),type:"password",id:"password",className:"input",placeholder:"Enter your password"}),_.password&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:_.password.message})]}),p.jsx("button",{type:"submit",disabled:u||r,className:"btn btn-primary btn-md w-full",children:u?"Signing In...":"Sign In"})]}),p.jsx("div",{className:"card-footer",children:p.jsxs("p",{className:"text-center text-sm text-secondary-600",children:["Don't have an account?"," ",p.jsx("button",{type:"button",onClick:e,className:"text-primary-600 hover:text-primary-700 font-medium",children:"Register here"})]})})]})})},HU=({onSuccess:t,onSwitchToLogin:e})=>{const{register:n,loading:r,error:s,clearError:i}=bn(),a=gn(),[u,d]=H.useState(!1),{register:m,handleSubmit:y,formState:{errors:_},watch:E}=a0(),b=E("password"),k=async S=>{try{d(!0),i();const{confirmPassword:O,...T}=S;await n(T);const C=T.role==="archaeologist"?"Archaeologist":"Researcher";ye.success(`Registration successful! Your account has been created with ${C} access.`),setTimeout(()=>{a("/dashboard",{replace:!0})},100),t==null||t()}catch(O){ye.error(O.message||"Registration failed")}finally{d(!1)}};return p.jsx("div",{className:"w-full max-w-md mx-auto",children:p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"card-header",children:[p.jsx("h2",{className:"text-2xl font-bold text-center",children:"Create Account"}),p.jsx("p",{className:"text-center text-secondary-600 mt-2",children:"Join the archaeological artifacts management system"})]}),p.jsxs("form",{onSubmit:y(k),className:"card-content space-y-4",children:[s&&p.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:p.jsx("p",{className:"text-red-800 text-sm",children:s.message})}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-secondary-700 mb-1",children:"Email Address"}),p.jsx("input",{...m("email",{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email format"}}),type:"email",id:"email",className:"input",placeholder:"archaeologist@university.edu"}),_.email&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:_.email.message})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-secondary-700 mb-1",children:"Username"}),p.jsx("input",{...m("username",{required:"Username is required",minLength:{value:3,message:"Username must be at least 3 characters"},maxLength:{value:50,message:"Username must be less than 50 characters"},pattern:{value:/^[a-zA-Z0-9_]+$/,message:"Username can only contain letters, numbers, and underscores"}}),type:"text",id:"username",className:"input",placeholder:"archaeologist_jane"}),_.username&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:_.username.message})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"displayName",className:"block text-sm font-medium text-secondary-700 mb-1",children:"Display Name (Optional)"}),p.jsx("input",{...m("displayName",{maxLength:{value:100,message:"Display name must be less than 100 characters"}}),type:"text",id:"displayName",className:"input",placeholder:"Dr. Jane Smith"}),_.displayName&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:_.displayName.message})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-secondary-700 mb-1",children:"Account Type *"}),p.jsxs("select",{...m("role",{required:"Please select an account type"}),id:"role",className:"input",defaultValue:"archaeologist",children:[p.jsx("option",{value:"archaeologist",children:"Archaeologist (Full Access)"}),p.jsx("option",{value:"researcher",children:"Researcher (Read-Only)"})]}),_.role&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:_.role.message}),p.jsxs("div",{className:"mt-2 space-y-2",children:[p.jsxs("div",{className:"p-2 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800",children:[p.jsx("strong",{children:"Archaeologist:"})," Create, edit, delete, and manage your own artifacts with photo uploads."]}),p.jsxs("div",{className:"p-2 bg-gray-50 border border-gray-200 rounded text-sm text-gray-700",children:[p.jsx("strong",{children:"Researcher:"})," View and browse artifacts (read-only access)."]})]}),p.jsx("p",{className:"text-sm text-gray-500 mt-2",children:" You can change between Archaeologist and Researcher roles anytime in your profile settings. Contact an administrator to request Admin access."})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-secondary-700 mb-1",children:"Password"}),p.jsx("input",{...m("password",{required:"Password is required",minLength:{value:6,message:"Password must be at least 6 characters"}}),type:"password",id:"password",className:"input",placeholder:"Enter your password"}),_.password&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:_.password.message})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-secondary-700 mb-1",children:"Confirm Password"}),p.jsx("input",{...m("confirmPassword",{required:"Please confirm your password",validate:S=>S===b||"Passwords do not match"}),type:"password",id:"confirmPassword",className:"input",placeholder:"Confirm your password"}),_.confirmPassword&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:_.confirmPassword.message})]}),p.jsx("button",{type:"submit",disabled:u||r,className:"btn btn-primary btn-md w-full",children:u?"Creating Account...":"Create Account"})]}),p.jsx("div",{className:"card-footer",children:p.jsxs("p",{className:"text-center text-sm text-secondary-600",children:["Already have an account?"," ",p.jsx("button",{type:"button",onClick:e,className:"text-primary-600 hover:text-primary-700 font-medium",children:"Sign in here"})]})})]})})};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var KU={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QU=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),at=(t,e)=>{const n=H.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:u="",children:d,...m},y)=>H.createElement("svg",{ref:y,...KU,width:s,height:s,stroke:r,strokeWidth:a?Number(i)*24/Number(s):i,className:["lucide",`lucide-${QU(t)}`,u].join(" "),...m},[...e.map(([_,E])=>H.createElement(_,E)),...Array.isArray(d)?d:[d]]));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a2=at("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XU=at("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=at("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z4=at("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const If=at("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cf=at("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l2=at("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YU=at("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eh=at("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZU=at("CloudOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JU=at("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ez=at("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qg=at("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tz=at("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jd=at("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nz=at("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c2=at("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nI=at("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=at("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rz=at("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sz=at("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wg=at("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iz=at("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oz=at("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mw=at("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rI=at("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G4=at("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dc=at("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yp=at("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const az=at("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=at("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l0=at("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lz=at("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $g=at("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cz=at("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const th=at("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=at("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uz=at("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hz=at("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gw=at("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fc=at("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),dz=()=>{const{isAuthenticated:t}=bn(),e=gn(),[n,r]=H.useState(!0),[s,i]=H.useState(!1),a=async()=>{var u,d;i(!0);try{await uo.loginAsGuest(),ye.success("Welcome, Guest! Browse artifacts without an account.",{icon:"",duration:4e3}),e("/dashboard")}catch(m){console.error("Guest login error:",m),(u=m.message)!=null&&u.includes("auth/operation-not-allowed")||(d=m.message)!=null&&d.includes("auth/admin-restricted-operation")?ye.error("Guest mode is not enabled in Firebase. Please enable Anonymous Authentication in the Firebase Console.",{duration:6e3}):ye.error(m.message||"Failed to continue as guest. Please try again.")}finally{i(!1)}};return t?p.jsx(Wn,{to:"/dashboard",replace:!0}):p.jsx("div",{className:"min-h-screen bg-main-gradient flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:p.jsxs("div",{className:"max-w-md w-full space-y-8",children:[p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-archaeological-lightBrown",children:p.jsx("svg",{className:"h-8 w-8 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),p.jsx("h1",{className:"mt-6 text-3xl font-extrabold text-archaeological-charcoal",children:"Archaeological Artifacts Scanner"}),p.jsx("p",{className:"mt-2 text-sm text-archaeological-charcoal",children:"Manage and scan archaeological artifacts with QR codes"})]}),n?p.jsx($U,{onSwitchToRegister:()=>r(!1)}):p.jsx(HU,{onSwitchToLogin:()=>r(!0)}),p.jsxs("div",{className:"mt-6",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"absolute inset-0 flex items-center",children:p.jsx("div",{className:"w-full border-t border-archaeological-lightBrown"})}),p.jsx("div",{className:"relative flex justify-center text-sm",children:p.jsx("span",{className:"px-2 bg-main-gradient text-archaeological-olive",children:"Or"})})]}),p.jsxs("button",{onClick:a,disabled:s,className:"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 border border-archaeological-lightBrown rounded-lg shadow-archaeological-sm text-sm font-medium text-archaeological-charcoal bg-white hover:bg-archaeological-warmGray focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[p.jsx(cz,{className:"w-5 h-5"}),s?"Signing in as Guest...":"Continue as Guest"]}),p.jsx("p",{className:"mt-2 text-xs text-center text-archaeological-olive",children:"Browse artifacts without creating an account (read-only access)"})]}),p.jsx("div",{className:"mt-8 text-center",children:p.jsxs("div",{className:"text-xs text-archaeological-olive",children:[p.jsx("p",{children:"Demo Credentials:"}),p.jsxs("p",{className:"mt-1",children:[p.jsx("strong",{children:"Admin:"})," admin@university.edu / admin123"]}),p.jsxs("p",{children:[p.jsx("strong",{children:"Archaeologist:"})," archaeologist@university.edu / archaeologist123"]}),p.jsxs("p",{children:[p.jsx("strong",{children:"Researcher:"})," researcher@university.edu / researcher123"]})]})})]})})},Rr=({size:t="md",className:e="",text:n})=>{const r={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"};return p.jsxs("div",{className:`flex flex-col items-center justify-center ${e}`,children:[p.jsx("div",{className:`animate-spin rounded-full border-2 border-archaeological-lightBrown border-t-primary-600 ${r[t]}`}),n&&p.jsx("p",{className:"mt-2 text-sm text-archaeological-charcoal",children:n})]})},fz=()=>{const{user:t,loading:e}=bn(),n=gn(),r=t?Ac(t.role):null,[s,i]=H.useState({totalArtifacts:0,recentDiscoveries:0,totalPhotos:0}),[a,u]=H.useState(!0);return H.useEffect(()=>{t&&(async()=>{try{u(!0);const m=await e2(),y=new Date,_=new Date(y.getFullYear(),y.getMonth(),1),E=m.length,b=m.filter(S=>new Date(S.createdAt)>=_).length,k=m.reduce((S,O)=>{var T;return S+(((T=O.photos)==null?void 0:T.length)||0)},0);i({totalArtifacts:E,recentDiscoveries:b,totalPhotos:k})}catch(m){console.error("Error fetching dashboard stats:",m)}finally{u(!1)}})()},[t]),e?p.jsx(Rr,{text:"Loading dashboard..."}):p.jsx("div",{className:"min-h-screen ",children:p.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("div",{className:"mb-8",children:[p.jsxs("h1",{className:"text-3xl font-bold text-archaeological-charcoal",children:["Welcome back, ",(t==null?void 0:t.displayName)||(t==null?void 0:t.username),"!"]}),p.jsx("p",{className:"mt-2 text-archaeological-charcoal",children:"Manage your archaeological artifacts and discoveries"})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsx("h3",{className:"text-lg font-semibold text-archaeological-charcoal mb-2",children:"Total Artifacts"}),a?p.jsx("div",{className:"text-3xl font-bold text-archaeological-sage",children:"..."}):p.jsx("p",{className:"text-3xl font-bold text-primary-600",children:s.totalArtifacts}),p.jsx("p",{className:"text-sm text-archaeological-olive mt-1",children:"Artifacts in your collection"})]})}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsx("h3",{className:"text-lg font-semibold text-archaeological-charcoal mb-2",children:"Recent Discoveries"}),a?p.jsx("div",{className:"text-3xl font-bold text-archaeological-sage",children:"..."}):p.jsx("p",{className:"text-3xl font-bold text-archaeological-olive",children:s.recentDiscoveries}),p.jsx("p",{className:"text-sm text-archaeological-olive mt-1",children:"This month"})]})}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsx("h3",{className:"text-lg font-semibold text-archaeological-charcoal mb-2",children:"Photos Uploaded"}),a?p.jsx("div",{className:"text-3xl font-bold text-archaeological-sage",children:"..."}):p.jsx("p",{className:"text-3xl font-bold text-blue-600",children:s.totalPhotos}),p.jsx("p",{className:"text-sm text-archaeological-olive mt-1",children:"Total photos"})]})})]}),p.jsxs("div",{className:"mt-8",children:[p.jsx("h2",{className:"text-xl font-semibold text-archaeological-charcoal mb-4",children:"Quick Actions"}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(r==null?void 0:r.canCreateArtifacts)&&p.jsx("button",{onClick:()=>n("/artifacts/new"),className:"btn btn-primary btn-lg",children:"Add New Artifact"}),p.jsx("button",{onClick:()=>n("/scanner"),className:"btn btn-outline btn-lg",children:"Scan QR Code"}),p.jsx("button",{onClick:()=>n("/artifacts"),className:"btn btn-outline btn-lg",children:"View All Artifacts"})]})]})]})})},q4=t=>({...t,createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt)}),mz=async t=>{const e=navigator.onLine;try{if(e){const n=await S4(t),r=await Jv(n);return r&&await Xa(r,!0),n}else{const n=`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r=[],s=[];for(let a=0;a<t.photos.length;a++){const u=t.photos[a],d=await u4(u);r.push(d),s.push({id:`temp-photo-${n}-${a}`,artifactId:n,downloadUrl:d,storagePath:"",uploadedBy:"current-user",uploadedAt:new Date().toISOString(),caption:u.name})}const i={id:n,qrCode:"",name:t.name,description:t.description,artifactType:t.artifactType,discoveryDate:t.discoveryDate,discoverySite:t.discoverySite,location:t.location,photos:s,metadata:t.metadata,createdBy:"current-user",createdAt:new Date().toISOString(),lastModifiedBy:"current-user",lastModifiedAt:new Date().toISOString(),version:1,isDeleted:!1,_localOnly:!0,_synced:!1};return await Xa(i,!1),await Hv({entityType:"artifact",entityId:n,action:"create",data:{...t,tempId:n,photoDataUrls:r}}),console.log(" Artifact created offline, will sync when online"),n}}catch(n){throw console.error(" Error creating artifact:",n),n}},W4=async t=>{const e=navigator.onLine;try{if(e)try{const r=await Jv(t);if(r)return await Xa(r,!0),r}catch{console.warn("Failed to fetch online, falling back to cache")}const n=await $v(t);return n?q4(n):null}catch(n){throw console.error(" Error getting artifact:",n),n}},gz=async()=>{const t=navigator.onLine;try{if(t)try{const n=await e2();for(const r of n)await Xa(r,!0);return n}catch{console.warn("Failed to fetch online, falling back to cache")}return(await gV()).map(q4)}catch(e){throw console.error(" Error getting artifacts:",e),e}},pz=async(t,e)=>{const n=navigator.onLine;try{if(n){await N4(t,e);const r=await Jv(t);r&&await Xa(r,!0)}else{const r=await $v(t);if(!r)throw new Error("Artifact not found in offline cache");let s,i=[];if(e.photos&&e.photos.length>0){s=[];for(let u=0;u<e.photos.length;u++){const d=e.photos[u],m=await u4(d);s.push(m),i.push({id:`temp-photo-${t}-${Date.now()}-${u}`,artifactId:t,downloadUrl:m,storagePath:"",uploadedBy:"current-user",uploadedAt:new Date().toISOString(),caption:d.name})}}const a={...r,...e.name&&{name:e.name},...e.description&&{description:e.description},...e.artifactType&&{artifactType:e.artifactType},...e.discoveryDate&&{discoveryDate:e.discoveryDate},...e.discoverySite&&{discoverySite:e.discoverySite},...e.location&&{location:e.location},...e.metadata&&{metadata:e.metadata},...i.length>0&&{photos:[...r.photos,...i]},lastModifiedAt:new Date().toISOString(),version:r.version+1,_synced:!1};await Xa(a,!1),await Hv({entityType:"artifact",entityId:t,action:"update",data:{...e,photoDataUrls:s}}),console.log(" Artifact updated offline, will sync when online")}}catch(r){throw console.error(" Error updating artifact:",r),r}},yz=async t=>{const e=navigator.onLine;try{if(e)await R4(t),await pV(t);else{const n=await $v(t);if(n){const r={...n,isDeleted:!0,lastModifiedAt:new Date().toISOString(),_synced:!1};await Xa(r,!1)}await Hv({entityType:"artifact",entityId:t,action:"delete",data:{}}),console.log(" Artifact deleted offline, will sync when online")}}catch(n){throw console.error(" Error deleting artifact:",n),n}},xz=()=>{const t=gn(),{user:e}=bn();xh();const n=e?Ac(e.role):null,[r,s]=H.useState([]),[i,a]=H.useState(!0),[u,d]=H.useState("");H.useEffect(()=>{m()},[]);const m=async()=>{var _;try{a(!0);const E=await gz();s(E),console.log(" Loaded artifacts:",E.length),console.log(" First artifact photos:",(_=E[0])==null?void 0:_.photos),E.forEach((b,k)=>{var S;console.log(`Artifact ${k}: ${b.name} - Photos: ${((S=b.photos)==null?void 0:S.length)||0}`)})}catch(E){console.error("Error loading artifacts:",E),ye.error("Failed to load artifacts")}finally{a(!1)}},y=r.filter(_=>_.name.toLowerCase().includes(u.toLowerCase())||_.artifactType.toLowerCase().includes(u.toLowerCase())||_.discoverySite.toLowerCase().includes(u.toLowerCase()));return i?p.jsx("div",{className:"min-h-screen flex items-center justify-center",children:p.jsx(Rr,{text:"Loading artifacts..."})}):p.jsx("div",{className:"min-h-screen",children:p.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("div",{className:"mb-8 flex justify-between items-start",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-3xl font-bold text-archaeological-charcoal",children:"Artifacts"}),p.jsx("p",{className:"mt-2 text-archaeological-charcoal",children:"Browse and manage your archaeological artifacts"})]}),(n==null?void 0:n.canCreateArtifacts)&&p.jsxs("button",{onClick:()=>t("/artifacts/new"),className:"btn btn-primary flex items-center gap-2",children:[p.jsx(Wg,{className:"w-4 h-4"}),"Add New Artifact"]})]}),p.jsx("div",{className:"mb-6",children:p.jsxs("div",{className:"relative",children:[p.jsx(dc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-archaeological-sage w-5 h-5"}),p.jsx("input",{type:"text",placeholder:"Search artifacts by name, type, or site...",value:u,onChange:_=>d(_.target.value),className:"input pl-10 w-full"})]})}),y.length===0?p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content text-center py-12",children:[p.jsx(Ea,{className:"w-16 h-16 text-archaeological-sage mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-semibold text-archaeological-charcoal mb-2",children:u?"No artifacts found":"No artifacts yet"}),p.jsx("p",{className:"text-archaeological-charcoal mb-6",children:u?"Try adjusting your search criteria":n!=null&&n.canCreateArtifacts?"Get started by adding your first artifact":"No artifacts available yet"}),!u&&(n==null?void 0:n.canCreateArtifacts)&&p.jsxs("button",{onClick:()=>t("/artifacts/new"),className:"btn btn-primary",children:[p.jsx(Wg,{className:"w-4 h-4 mr-2"}),"Add New Artifact"]})]})}):p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(_=>p.jsxs("div",{onClick:()=>t(`/artifacts/${_.id}`),className:"card hover:shadow-lg transition-shadow cursor-pointer overflow-hidden",children:[_.photos&&Array.isArray(_.photos)&&_.photos.length>0?p.jsxs("div",{className:"w-full h-48 overflow-hidden relative",children:[p.jsx("img",{src:_.photos[0].url,alt:_.name,className:"w-full h-full object-cover",onError:E=>{console.error("Failed to load thumbnail:",_.photos[0].url),E.currentTarget.style.display="none",E.currentTarget.parentElement.innerHTML='<div class="w-full h-48 bg-archaeological-warmGray flex items-center justify-center"><svg class="w-12 h-12 text-archaeological-sage" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>'}}),_.photos.length>1&&p.jsxs("div",{className:"absolute top-2 right-2 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded",children:["+",_.photos.length-1," more"]})]}):p.jsxs("div",{className:"w-full h-48 bg-archaeological-warmGray flex items-center justify-center",children:[p.jsx(tz,{className:"w-12 h-12 text-archaeological-sage"}),p.jsx("span",{className:"absolute text-xs text-archaeological-olive mt-20",children:"No photos"})]}),p.jsxs("div",{className:"card-content",children:[p.jsx("div",{className:"flex justify-between items-start mb-3",children:p.jsx("h3",{className:"text-lg font-semibold text-archaeological-charcoal line-clamp-2",children:_.name})}),p.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-archaeological-lightBrown text-primary-800 mb-3",children:_.artifactType}),_.description&&p.jsx("p",{className:"text-sm text-archaeological-charcoal mb-3 line-clamp-2",children:_.description}),p.jsxs("div",{className:"space-y-1 text-sm text-archaeological-olive",children:[p.jsxs("p",{children:[p.jsx("span",{className:"font-medium",children:"Site:"})," ",_.discoverySite]}),p.jsxs("p",{children:[p.jsx("span",{className:"font-medium",children:"Date:"})," ",_.discoveryDate]}),p.jsxs("p",{children:[p.jsx("span",{className:"font-medium",children:"Location:"})," ",_.location]})]}),p.jsxs("div",{className:"mt-4 pt-4 border-t border-archaeological-lightBrown text-xs text-archaeological-olive",children:["Added ",new Date(_.createdAt).toLocaleDateString()]})]})]},_.id))}),y.length>0&&p.jsxs("div",{className:"mt-6 text-center text-sm text-archaeological-olive",children:["Showing ",y.length," of ",r.length," artifact",r.length!==1?"s":""]})]})})},wz=[{id:"pottery",name:"Pottery",description:"Ceramic vessels and containers",icon:"",color:"#8B4513"},{id:"tool",name:"Tool",description:"Stone, metal, or bone tools",icon:"",color:"#696969"},{id:"jewelry",name:"Jewelry",description:"Personal ornaments and adornments",icon:"",color:"#FFD700"},{id:"weapon",name:"Weapon",description:"Swords, spears, arrows, and other weapons",icon:"",color:"#B22222"},{id:"coin",name:"Coin",description:"Ancient coins and currency",icon:"",color:"#CD7F32"},{id:"sculpture",name:"Sculpture",description:"Carved or molded figures",icon:"",color:"#D2B48C"},{id:"textile",name:"Textile",description:"Fabric, clothing, and woven materials",icon:"",color:"#DEB887"},{id:"custom",name:"Custom Type",description:"Specify your own artifact type",icon:"",color:"#808080"}],sI=["image/jpeg","image/jpg","image/png","image/webp"],iI=10*1024*1024,_z=({isOpen:t,onClose:e,onCapture:n})=>{const r=H.useRef(null),s=H.useRef(null),[i,a]=H.useState(null),[u,d]=H.useState(null),[m,y]=H.useState(""),[_,E]=H.useState("environment");H.useEffect(()=>(t?b():(k(),d(null),y("")),()=>{k()}),[t,_]);const b=async()=>{try{y("");const R=await navigator.mediaDevices.getUserMedia({video:{facingMode:_,width:{ideal:1920},height:{ideal:1080}},audio:!1});a(R),r.current&&(r.current.srcObject=R,r.current.play())}catch(R){console.error("Error accessing camera:",R),y(`Camera access denied: ${R.message}`)}},k=()=>{i&&(i.getTracks().forEach(R=>R.stop()),a(null))},S=()=>{if(!r.current||!s.current)return;const R=r.current,j=s.current;j.width=R.videoWidth,j.height=R.videoHeight;const K=j.getContext("2d");if(K){K.drawImage(R,0,0,j.width,j.height);const Q=j.toDataURL("image/jpeg",.9);d(Q)}},O=()=>{d(null)},T=()=>{u&&fetch(u).then(R=>R.blob()).then(R=>{const j=new File([R],`camera_${Date.now()}.jpg`,{type:"image/jpeg"});n(j),e(),d(null)}).catch(R=>{console.error("Error converting image:",R),y("Failed to process image")})},C=()=>{E(R=>R==="user"?"environment":"user"),d(null)};return t?p.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90",children:p.jsxs("div",{className:"relative w-full h-full max-w-4xl max-h-screen flex flex-col",children:[p.jsxs("div",{className:"flex justify-between items-center p-4 bg-gray-900 text-white",children:[p.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[p.jsx(If,{className:"w-5 h-5"}),"Take Photo"]}),p.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-800 rounded-lg transition-colors",title:"Close",children:p.jsx(fc,{className:"w-6 h-6"})})]}),p.jsx("div",{className:"flex-1 relative bg-black flex items-center justify-center overflow-hidden",children:m?p.jsxs("div",{className:"text-center p-8",children:[p.jsx("p",{className:"text-red-400 mb-4",children:m}),p.jsx("p",{className:"text-gray-400 text-sm",children:"Please ensure you have granted camera permissions and try again."})]}):u?p.jsx("img",{src:u,alt:"Captured",className:"max-w-full max-h-full object-contain"}):p.jsxs(p.Fragment,{children:[p.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"max-w-full max-h-full object-contain"}),p.jsx("canvas",{ref:s,className:"hidden"})]})}),p.jsx("div",{className:"p-4 bg-gray-900 flex justify-center items-center gap-4",children:u?p.jsxs(p.Fragment,{children:[p.jsxs("button",{onClick:O,className:"px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors flex items-center gap-2",children:[p.jsx(rI,{className:"w-5 h-5"}),"Retake"]}),p.jsxs("button",{onClick:T,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[p.jsx(l2,{className:"w-5 h-5"}),"Use Photo"]})]}):p.jsxs(p.Fragment,{children:[p.jsxs("button",{onClick:C,className:"px-4 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors flex items-center gap-2",title:"Switch camera",children:[p.jsx(rI,{className:"w-5 h-5"}),p.jsx("span",{className:"hidden sm:inline",children:"Switch"})]}),p.jsx("button",{onClick:S,disabled:!i||!!m,className:"w-16 h-16 bg-white rounded-full hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",title:"Take photo",children:p.jsx("div",{className:"w-14 h-14 border-4 border-gray-900 rounded-full"})}),p.jsx("div",{className:"w-16"})," "]})})]})}):null},vz=({groups:t,selectedGroupId:e,onChange:n,label:r="Group",required:s=!1,placeholder:i="Select a group",showUncategorized:a=!0})=>p.jsxs("div",{className:"form-group",children:[p.jsxs("label",{className:"label",children:[p.jsx(Jr,{className:"w-4 h-4"}),r,s&&p.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),p.jsxs("select",{value:e||"",onChange:u=>n(u.target.value||void 0),className:"input",required:s,children:[p.jsx("option",{value:"",children:i}),a&&p.jsx("option",{value:"uncategorized",children:"Uncategorized (No Group)"}),t.map(u=>p.jsx("option",{value:u.id,children:u.name},u.id))]})]}),$4=({onSubmit:t,loading:e=!1,initialData:n,existingPhotos:r=[],isEditMode:s=!1})=>{const{user:i}=bn(),{register:a,handleSubmit:u,formState:{errors:d},setValue:m}=a0({defaultValues:n}),[y,_]=H.useState([]),[E,b]=H.useState([]),[k,S]=H.useState(""),[O,T]=H.useState(!1),[C,R]=H.useState(r.map(de=>de.id)),[j,K]=H.useState([]),[Q,D]=H.useState(n==null?void 0:n.groupId),[B,F]=H.useState((n==null?void 0:n.artifactType)||""),[W,X]=H.useState("");H.useRef(null),H.useEffect(()=>{(async()=>{if(i)try{const he=await t2(i.id);K(he)}catch(he){console.error("Error loading user groups:",he)}})()},[i]);const $=de=>{const he=de.target.files;if(!he||he.length===0)return;S("");const Ce=[],Me=[];let ht=!1;if(Array.from(he).forEach(Ge=>{if(!sI.includes(Ge.type)){S(`${Ge.name} is not a supported image format. Please use JPEG, PNG, or WebP.`),ht=!0;return}if(Ge.size>iI){S(`${Ge.name} exceeds the 10MB file size limit.`),ht=!0;return}Ce.push(Ge),Me.push(URL.createObjectURL(Ge))}),!ht){const Ge=[...y,...Ce],_t=[...E,...Me];_(Ge),b(_t),m("photos",Ge)}},z=de=>{const he=y.filter((Me,ht)=>ht!==de),Ce=E.filter((Me,ht)=>ht!==de);URL.revokeObjectURL(E[de]),_(he),b(Ce),m("photos",he)},Te=de=>{const he=C.filter(Ce=>Ce!==de);R(he),S("")},ie=de=>{if(de.size>iI){S("Photo exceeds the 10MB file size limit.");return}const he=[...y,de],Ce=URL.createObjectURL(de),Me=[...E,Ce];_(he),b(Me),m("photos",he),S("")},Xe=de=>{const he=B==="custom"?W.trim():B;if(B==="custom"&&!W.trim()){S("Please specify a custom artifact type");return}t({...de,artifactType:he,photos:y,groupId:Q==="uncategorized"?void 0:Q,...s&&{photosToKeep:C}})};return p.jsxs(p.Fragment,{children:[p.jsx(_z,{isOpen:O,onClose:()=>T(!1),onCapture:ie}),p.jsxs("form",{onSubmit:u(Xe),className:"space-y-6",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Artifact Name *"}),p.jsx("input",{...a("name",{required:"Artifact name is required",maxLength:{value:200,message:"Name must be less than 200 characters"}}),type:"text",id:"name",className:"input",placeholder:"Enter artifact name"}),d.name&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.name.message})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),p.jsx("textarea",{...a("description",{maxLength:{value:2e3,message:"Description must be less than 2000 characters"}}),id:"description",rows:4,className:"input",placeholder:"Enter artifact description"}),d.description&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.description.message})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"artifactType",className:"block text-sm font-medium text-gray-700 mb-1",children:"Artifact Type"}),p.jsxs("select",{value:B,onChange:de=>{F(de.target.value),m("artifactType",de.target.value)},id:"artifactType",className:"input",children:[p.jsx("option",{value:"",children:"Select artifact type"}),wz.map(de=>p.jsxs("option",{value:de.id,children:[de.icon," ",de.name]},de.id))]}),d.artifactType&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.artifactType.message}),B==="custom"&&p.jsxs("div",{className:"mt-3",children:[p.jsx("label",{htmlFor:"customType",className:"block text-sm font-medium text-gray-700 mb-1",children:"Specify Artifact Type *"}),p.jsx("input",{type:"text",id:"customType",value:W,onChange:de=>X(de.target.value),placeholder:"e.g., Manuscript, Bone Fragment, Papyrus...",className:"input",maxLength:50}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the specific type of artifact (max 50 characters)"})]})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"discoveryDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Discovery Date"}),p.jsx("input",{...a("discoveryDate"),type:"date",id:"discoveryDate",className:"input"}),d.discoveryDate&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.discoveryDate.message})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"discoverySite",className:"block text-sm font-medium text-gray-700 mb-1",children:"Discovery Site"}),p.jsx("input",{...a("discoverySite",{maxLength:{value:200,message:"Discovery site must be less than 200 characters"}}),type:"text",id:"discoverySite",className:"input",placeholder:"Enter discovery site"}),d.discoverySite&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.discoverySite.message})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Location"}),p.jsx("input",{...a("location",{maxLength:{value:200,message:"Location must be less than 200 characters"}}),type:"text",id:"location",className:"input",placeholder:"Enter current location"}),d.location&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.location.message})]}),p.jsx(vz,{groups:j,selectedGroupId:Q,onChange:D,label:"Group (Optional)",placeholder:"Select a group or leave uncategorized",showUncategorized:!0}),p.jsxs("div",{children:[p.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Photos ",p.jsx("span",{className:"text-gray-500 font-normal",children:"(Optional)"})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[p.jsxs("div",{className:"flex gap-3",children:[p.jsxs("label",{htmlFor:"photo-upload",className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer transition-colors",children:[p.jsx(lz,{className:"w-4 h-4"}),E.length>0?"Add More Photos":"Choose Photos"]}),p.jsx("input",{id:"photo-upload",type:"file",accept:sI.join(","),multiple:!0,onChange:$,className:"hidden"}),p.jsxs("button",{type:"button",onClick:()=>T(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[p.jsx(If,{className:"w-4 h-4"}),"Take Photo"]})]}),p.jsxs("div",{className:"flex flex-col text-sm text-gray-500",children:[p.jsx("span",{children:"JPEG, PNG, or WebP (max 10MB each)"}),E.length>0&&p.jsxs("span",{className:"text-blue-600 font-medium",children:[E.length," photo",E.length!==1?"s":""," selected"]})]})]}),k&&p.jsx("p",{className:"text-red-600 text-sm",children:k}),s&&r.length>0&&p.jsxs("div",{className:"space-y-2",children:[p.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:["Current Photos (",C.length," of ",r.length,")"]}),p.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:r.map(de=>{const he=C.includes(de.id);return p.jsxs("div",{className:`relative group ${he?"":"opacity-40"}`,children:[p.jsx("img",{src:de.url,alt:de.filename,className:"w-full h-32 object-cover rounded-lg border-2 border-gray-200"}),he?p.jsx("button",{type:"button",onClick:()=>Te(de.id),className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 opacity-0 group-hover:opacity-100 transition-opacity",title:"Remove photo",children:p.jsx(fc,{className:"w-4 h-4"})}):p.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-lg",children:p.jsx("span",{className:"text-white text-sm font-medium",children:"Removed"})}),p.jsx("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-black bg-opacity-60 text-white text-xs rounded max-w-[90%] truncate",children:de.filename})]},de.id)})})]}),E.length>0&&p.jsxs("div",{className:"space-y-2",children:[s&&p.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:["New Photos (",E.length,")"]}),p.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:E.map((de,he)=>{var Ce;return p.jsxs("div",{className:"relative group",children:[p.jsx("img",{src:de,alt:`Preview ${he+1}`,className:"w-full h-32 object-cover rounded-lg border-2 border-blue-300"}),p.jsx("button",{type:"button",onClick:()=>z(he),className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 opacity-0 group-hover:opacity-100 transition-opacity",title:"Remove photo",children:p.jsx(fc,{className:"w-4 h-4"})}),p.jsx("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-blue-600 bg-opacity-90 text-white text-xs rounded max-w-[90%] truncate",children:(Ce=y[he])==null?void 0:Ce.name}),p.jsx("div",{className:"absolute top-2 left-2 px-2 py-1 bg-green-600 text-white text-xs rounded",children:"NEW"})]},he)})})]}),E.length===0&&(!s||r.length===0)&&p.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[p.jsx(If,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),p.jsx("p",{className:"text-gray-500",children:s?"No new photos selected":"No photos added yet"}),p.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Photos are optional. You can add multiple photos - just select multiple files or add one at a time"})]})]})]}),p.jsxs("div",{className:"flex justify-end space-x-4",children:[p.jsx("button",{type:"button",className:"btn btn-secondary btn-md",children:"Cancel"}),p.jsx("button",{type:"submit",disabled:e,className:"btn btn-primary btn-md",children:e?"Saving...":"Save Artifact"})]})]})]})},Ez=()=>{const t=gn(),{user:e}=bn(),n=xh(),[r,s]=jr.useState(!1);H.useEffect(()=>{e&&(Ac(e.role).canCreateArtifacts||(ye.error("You do not have permission to create artifacts"),t("/artifacts")))},[e,t]);const i=async a=>{s(!0);try{console.log("Creating artifact:",a);const u=await mz(a);n?ye.success("Artifact created and synced!",{duration:3e3,icon:""}):ye.success("Artifact saved offline. Will sync when online.",{duration:5e3,icon:""}),t(`/artifacts/${u}`)}catch(u){console.error("Error creating artifact:",u),ye.error(u.message||"Failed to create artifact. Please try again.",{duration:4e3,icon:""})}finally{s(!1)}};return p.jsx("div",{className:"min-h-screen",children:p.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("button",{onClick:()=>t("/dashboard"),className:"btn btn-ghost mb-6 flex items-center gap-2",children:[p.jsx(Qs,{className:"w-4 h-4"}),"Back to Dashboard"]}),p.jsxs("div",{className:"mb-8",children:[p.jsx("h1",{className:"text-3xl font-bold text-archaeological-charcoal",children:"Add New Artifact"}),p.jsx("p",{className:"mt-2 text-archaeological-charcoal",children:"Record a new archaeological artifact in your collection"})]}),p.jsx("div",{className:"card",children:p.jsx("div",{className:"card-content",children:p.jsx($4,{onSubmit:i,loading:r})})})]})})},$i="groupMembers",Az="users",H4=async(t,e)=>{try{const n=ot.currentUser;if(!n)throw new Error("User must be authenticated to add members");let r;if(e.email){const d=ur(an($e,Az),Zt("email","==",e.email)),m=await hr(d);if(m.empty)throw new Error("User not found with this email");r=m.docs[0].id}else if(e.userId)r=e.userId;else throw new Error("Either email or userId must be provided");if(await h2(t,r))throw new Error("User is already a member of this group");const i=e.permissions?{...hc(e.role),...e.permissions}:hc(e.role),a={userId:r,groupId:t,role:e.role,permissions:i,joinedAt:Pn(),invitedBy:n.uid},u=await Ku(an($e,$i),a);return console.log(" Member added successfully:",r),u.id}catch(n){throw console.error(" Error adding member:",n),n}},bz=async(t,e)=>{try{if(!ot.currentUser)throw new Error("User must be authenticated to remove members");const r=ur(an($e,$i),Zt("groupId","==",t),Zt("userId","==",e)),s=await hr(r);if(s.empty)throw new Error("Member not found in this group");const i=s.docs[0];await Oj(Vt($e,$i,i.id)),console.log(" Member removed successfully:",e)}catch(n){throw console.error(" Error removing member:",n),n}},Iz=async(t,e,n)=>{try{if(!ot.currentUser)throw new Error("User must be authenticated to update permissions");const s=ur(an($e,$i),Zt("groupId","==",t),Zt("userId","==",e)),i=await hr(s);if(i.empty)throw new Error("Member not found in this group");const a=i.docs[0],u=a.data().permissions;await Wr(Vt($e,$i,a.id),{permissions:{...u,...n}}),console.log(" Member permissions updated:",e)}catch(r){throw console.error(" Error updating member permissions:",r),r}},Cz=async(t,e,n)=>{try{if(!ot.currentUser)throw new Error("User must be authenticated to update roles");const s=ur(an($e,$i),Zt("groupId","==",t),Zt("userId","==",e)),i=await hr(s);if(i.empty)throw new Error("Member not found in this group");const a=i.docs[0];await Wr(Vt($e,$i,a.id),{role:n,permissions:hc(n)}),console.log(" Member role updated:",e,"to",n)}catch(r){throw console.error(" Error updating member role:",r),r}},u2=async t=>{try{const e=ur(an($e,$i),Zt("groupId","==",t)),n=await hr(e),r=[];return n.forEach(s=>{var a,u,d;const i=s.data();r.push({id:s.id,...i,joinedAt:((d=(u=(a=i.joinedAt)==null?void 0:a.toDate)==null?void 0:u.call(a))==null?void 0:d.toISOString())||new Date().toISOString()})}),r}catch(e){throw console.error(" Error getting group members:",e),e}},h2=async(t,e)=>{var n,r,s;try{const i=ur(an($e,$i),Zt("groupId","==",t),Zt("userId","==",e)),a=await hr(i);if(a.empty)return null;const u=a.docs[0],d=u.data();return{id:u.id,...d,joinedAt:((s=(r=(n=d.joinedAt)==null?void 0:n.toDate)==null?void 0:r.call(n))==null?void 0:s.toISOString())||new Date().toISOString()}}catch(i){throw console.error(" Error getting user group membership:",i),i}},Tz=async t=>{try{const e=ur(an($e,$i),Zt("userId","==",t)),n=await hr(e),r=[];return n.forEach(s=>{var a,u,d;const i=s.data();r.push({id:s.id,...i,joinedAt:((d=(u=(a=i.joinedAt)==null?void 0:a.toDate)==null?void 0:u.call(a))==null?void 0:d.toISOString())||new Date().toISOString()})}),r}catch(e){throw console.error(" Error getting user memberships:",e),e}},Sz=()=>{const{id:t}=p_(),e=gn(),{user:n}=bn();xh();const[r,s]=H.useState(!0),[i,a]=H.useState(!1),[u,d]=H.useState(),[m,y]=H.useState([]),[_,E]=H.useState(null);H.useEffect(()=>{(async()=>{if(!t){e("/artifacts");return}try{s(!0);const S=await W4(t);if(!S){ye.error("Artifact not found"),e("/artifacts");return}if(E(S),n){let O=!1;if(S.groupId){const T=await h2(n.id,S.groupId);T&&(O=P3(n.role,{canCreateArtifacts:T.permissions.canCreateArtifacts,canEditArtifacts:T.permissions.canEditArtifacts,canDeleteArtifacts:T.permissions.canDeleteArtifacts,canViewArtifacts:T.permissions.canViewArtifacts}).canEditArtifacts)}else O=Ac(n.role).canEditArtifacts;if(!O){ye.error("You do not have permission to edit this artifact"),e("/artifacts");return}}d({name:S.name,description:S.description||"",artifactType:S.artifactType,discoveryDate:S.discoveryDate,discoverySite:S.discoverySite,location:S.location,gpsCoordinates:S.gpsCoordinates,dimensions:S.dimensions,material:S.material,condition:S.condition,notes:S.notes||""}),y(S.photos||[])}catch(S){console.error("Error loading artifact:",S),ye.error("Failed to load artifact"),e("/artifacts")}finally{s(!1)}})()},[t,e,n]);const b=async k=>{if(t){a(!0);try{console.log("Updating artifact:",t,k),await pz(t,k),ye.success("Artifact updated successfully!",{duration:3e3,icon:""}),e("/artifacts/"+t)}catch(S){console.error("Error updating artifact:",S),ye.error(S.message||"Failed to update artifact. Please try again.",{duration:4e3,icon:""})}finally{a(!1)}}};return r?p.jsx("div",{className:"min-h-screen flex items-center justify-center",children:p.jsx(Rr,{text:"Loading artifact..."})}):u?p.jsx("div",{className:"min-h-screen",children:p.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("button",{onClick:()=>e("/artifacts/"+t),className:"btn btn-ghost mb-6 flex items-center gap-2",children:[p.jsx(Qs,{className:"w-4 h-4"}),"Back to Artifact"]}),p.jsxs("div",{className:"mb-8",children:[p.jsx("h1",{className:"text-3xl font-bold text-archaeological-charcoal",children:"Edit Artifact"}),p.jsx("p",{className:"mt-2 text-archaeological-charcoal",children:"Update the details of your archaeological artifact"})]}),p.jsx("div",{className:"card",children:p.jsx("div",{className:"card-content",children:p.jsx($4,{onSubmit:b,loading:i,initialData:u,existingPhotos:m,isEditMode:!0})})})]})}):p.jsx("div",{className:"min-h-screen",children:p.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:p.jsx("p",{className:"text-archaeological-charcoal",children:"Artifact not found"})})})},Nz=({artifactId:t,artifactName:e,size:n=256})=>{const r=H.useRef(null),[s,i]=H.useState("");H.useEffect(()=>{a()},[t]);const a=async()=>{if(r.current)try{const y=`${window.location.origin}/artifacts/${t}`;await uc.toCanvas(r.current,y,{width:n,margin:2,color:{dark:"#1e293b",light:"#ffffff"}});const _=await uc.toDataURL(y,{width:n,margin:2});i(_)}catch(y){console.error("Error generating QR code:",y),ye.error("Failed to generate QR code")}},u=()=>{if(!s)return;const y=document.createElement("a");y.download=`${e.replace(/[^a-z0-9]/gi,"-").toLowerCase()}-qr-code.png`,y.href=s,document.body.appendChild(y),y.click(),document.body.removeChild(y),ye.success("QR code downloaded!")},d=()=>{if(!s)return;const y=window.open("","_blank");if(!y){ye.error("Please allow pop-ups to print");return}y.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Print QR Code - ${e}</title>
          <style>
            body {
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              min-height: 100vh;
              margin: 0;
              padding: 20px;
              font-family: Arial, sans-serif;
            }
            .qr-container {
              text-align: center;
              page-break-inside: avoid;
            }
            h1 {
              font-size: 24px;
              margin-bottom: 10px;
            }
            p {
              color: #666;
              margin-bottom: 20px;
            }
            img {
              border: 2px solid #ccc;
              padding: 10px;
              background: white;
            }
            .footer {
              margin-top: 20px;
              font-size: 12px;
              color: #999;
            }
            @media print {
              body {
                padding: 0;
              }
            }
          </style>
        </head>
        <body>
          <div class="qr-container">
            <h1>${e}</h1>
            <p>Scan to view artifact details</p>
            <img src="${s}" alt="QR Code" />
            <div class="footer">
              <p>Archaeological Artifacts Scanner</p>
              <p>Artifact ID: ${t}</p>
            </div>
          </div>
          <script>
            window.onload = function() {
              window.print();
              setTimeout(function() { window.close(); }, 100);
            }
          <\/script>
        </body>
      </html>
    `),y.document.close()},m=async()=>{const y=`${window.location.origin}/artifacts/${t}`;if(navigator.share)try{await navigator.share({title:e,text:`Check out this artifact: ${e}`,url:y}),ye.success("Shared successfully!")}catch{}else try{await navigator.clipboard.writeText(y),ye.success("Link copied to clipboard!")}catch{ye.error("Failed to copy link")}};return p.jsxs("div",{className:"space-y-4",children:[p.jsx("div",{className:"flex justify-center",children:p.jsx("div",{className:"bg-white p-4 rounded-lg border-2 border-gray-200 inline-block",children:p.jsx("canvas",{ref:r})})}),p.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[p.jsxs("button",{onClick:u,className:"btn btn-outline btn-sm flex items-center gap-2",title:"Download QR Code",children:[p.jsx(ez,{className:"w-4 h-4"}),"Download"]}),p.jsxs("button",{onClick:d,className:"btn btn-outline btn-sm flex items-center gap-2",title:"Print QR Code",children:[p.jsx(iz,{className:"w-4 h-4"}),"Print"]}),p.jsxs("button",{onClick:m,className:"btn btn-outline btn-sm flex items-center gap-2",title:"Share Link",children:[p.jsx(az,{className:"w-4 h-4"}),"Share"]})]}),p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"text-xs text-gray-500",children:"Scan this QR code to view artifact details"}),p.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["ID: ",t]})]})]})},K4=t=>{const{user:e}=bn(),[n,r]=H.useState(null),[s,i]=H.useState(!0),a=async()=>{if(!e||!t){r(null),i(!1);return}try{i(!0);const y=await h2(t,e.id);r(y)}catch(y){console.error("Error loading group membership:",y),r(null)}finally{i(!1)}};H.useEffect(()=>{a()},[e,t]);const u=y=>(e==null?void 0:e.role)==="admin"?!0:gU(n,y),d=()=>(e==null?void 0:e.role)==="admin"?!0:Gb(n),m=()=>(e==null?void 0:e.role)==="admin"?!0:Gb(n);return{membership:n,loading:s,isGroupAdmin:d(),hasPermission:u,canManageGroup:m(),reload:a}},Rz=()=>{const{id:t}=p_(),e=gn(),{user:n}=bn();xh();const[r,s]=H.useState(null),[i,a]=H.useState(!0),[u,d]=H.useState(!1),[m,y]=H.useState(!1),{membership:_,loading:E}=K4((r==null?void 0:r.groupId)||void 0),b=n?r&&r.groupId&&_?P3(n.role,{canCreateArtifacts:_.permissions.canCreateArtifacts,canEditArtifacts:_.permissions.canEditArtifacts,canDeleteArtifacts:_.permissions.canDeleteArtifacts,canViewArtifacts:_.permissions.canViewArtifacts}):Ac(n.role):null;H.useEffect(()=>{(async()=>{var O;if(t)try{a(!0);const T=await W4(t);T?(console.log(" Loaded artifact data:",T),console.log(" Photos array:",T.photos),console.log(" Photos count:",((O=T.photos)==null?void 0:O.length)||0),s(T)):(ye.error("Artifact not found"),e("/artifacts"))}catch(T){console.error("Error loading artifact:",T),ye.error("Failed to load artifact")}finally{a(!1)}})()},[t,e]);const k=async()=>{if(!(!t||!r||!window.confirm(`Are you sure you want to delete "${r.name}"? This action cannot be undone.`)))try{d(!0),await yz(t),ye.success("Artifact deleted successfully"),e("/artifacts")}catch(O){console.error("Error deleting artifact:",O),ye.error(O.message||"Failed to delete artifact")}finally{d(!1)}};return i||E?p.jsx("div",{className:"min-h-screen flex items-center justify-center",children:p.jsx(Rr,{text:"Loading artifact..."})}):r?p.jsx("div",{className:"min-h-screen",children:p.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("button",{onClick:()=>e("/artifacts"),className:"btn btn-ghost mb-6 flex items-center gap-2",children:[p.jsx(Qs,{className:"w-4 h-4"}),"Back to Artifacts"]}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsxs("div",{className:"flex justify-between items-start mb-6",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-3xl font-bold text-archaeological-charcoal mb-2",children:r.name}),p.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-archaeological-lightBrown text-primary-800",children:r.artifactType})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx("button",{onClick:()=>y(!m),className:"btn btn-outline btn-sm",title:"Show QR Code",children:p.jsx(oz,{className:"w-4 h-4"})}),n&&(b==null?void 0:b.canEditArtifacts)&&p.jsx(p.Fragment,{children:p.jsx("button",{onClick:()=>e(`/artifacts/${t}/edit`),className:"btn btn-outline btn-sm",title:"Edit artifact",children:p.jsx(rz,{className:"w-4 h-4"})})}),n&&(b==null?void 0:b.canDeleteArtifacts)&&p.jsx("button",{onClick:k,disabled:u,className:"btn btn-danger btn-sm",title:"Delete artifact",children:u?p.jsx("span",{className:"animate-spin",children:""}):p.jsx(l0,{className:"w-4 h-4"})})]})]}),m&&p.jsxs("div",{className:"mb-6 p-6 bg-archaeological-warmGray rounded-lg border border-archaeological-lightBrown",children:[p.jsx("h2",{className:"text-lg font-semibold text-archaeological-charcoal mb-4 text-center",children:"QR Code"}),p.jsx(Nz,{artifactId:t,artifactName:r.name})]}),r.photos&&Array.isArray(r.photos)&&r.photos.length>0?p.jsxs("div",{className:"mb-6",children:[p.jsxs("h2",{className:"text-lg font-semibold text-archaeological-charcoal mb-4",children:["Photos (",r.photos.length,")"]}),p.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:r.photos.map((S,O)=>p.jsxs("div",{className:"relative group",children:[p.jsx("img",{src:S.url,alt:S.caption||`Artifact photo ${O+1}`,className:"w-full h-40 object-cover rounded-lg border-2 border-archaeological-lightBrown hover:border-primary-500 transition-colors cursor-pointer",onClick:()=>window.open(S.url,"_blank"),onError:T=>{console.error("Failed to load image:",S.url),T.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI0Y1RjFFRCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM3QTlCNzYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZSBub3QgZm91bmQ8L3RleHQ+PC9zdmc+"}}),S.caption&&p.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs p-2 rounded-b-lg",children:S.caption})]},S.id||O))})]}):p.jsxs("div",{className:"mb-6 p-6 bg-archaeological-warmGray rounded-lg border border-archaeological-lightBrown",children:[p.jsx("p",{className:"text-archaeological-olive text-center",children:"No photos available for this artifact"}),p.jsx("p",{className:"text-archaeological-sage text-sm text-center mt-1",children:"This artifact may have been created before photo upload was available"})]}),r.description&&p.jsxs("div",{className:"mb-6",children:[p.jsx("h2",{className:"text-lg font-semibold text-archaeological-charcoal mb-2",children:"Description"}),p.jsx("p",{className:"text-archaeological-charcoal whitespace-pre-wrap",children:r.description})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx(z4,{className:"w-5 h-5 text-archaeological-sage mt-1"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-archaeological-olive",children:"Discovery Date"}),p.jsx("p",{className:"text-archaeological-charcoal",children:r.discoveryDate})]})]}),p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx(nI,{className:"w-5 h-5 text-archaeological-sage mt-1"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-archaeological-olive",children:"Discovery Site"}),p.jsx("p",{className:"text-archaeological-charcoal",children:r.discoverySite})]})]}),p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx(Ea,{className:"w-5 h-5 text-archaeological-sage mt-1"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-archaeological-olive",children:"Current Location"}),p.jsx("p",{className:"text-archaeological-charcoal",children:r.location})]})]}),r.gpsCoordinates&&p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx(nI,{className:"w-5 h-5 text-archaeological-sage mt-1"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-archaeological-olive",children:"GPS Coordinates"}),p.jsxs("p",{className:"text-archaeological-charcoal",children:[r.gpsCoordinates.latitude,", ",r.gpsCoordinates.longitude]})]})]})]}),r.notes&&p.jsxs("div",{className:"mt-6 pt-6 border-t border-archaeological-lightBrown",children:[p.jsx("h2",{className:"text-lg font-semibold text-archaeological-charcoal mb-2",children:"Notes"}),p.jsx("p",{className:"text-archaeological-charcoal whitespace-pre-wrap",children:r.notes})]}),p.jsxs("div",{className:"mt-6 pt-6 border-t border-archaeological-lightBrown text-sm text-archaeological-olive",children:[p.jsxs("p",{children:["Created: ",new Date(r.createdAt).toLocaleString()]}),p.jsxs("p",{children:["Last updated: ",new Date(r.updatedAt).toLocaleString()]})]})]})})]})}):p.jsx("div",{className:"min-h-screen",children:p.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:p.jsx("p",{className:"text-archaeological-charcoal",children:"Artifact not found"})})})};var Oe;(function(t){t[t.QR_CODE=0]="QR_CODE",t[t.AZTEC=1]="AZTEC",t[t.CODABAR=2]="CODABAR",t[t.CODE_39=3]="CODE_39",t[t.CODE_93=4]="CODE_93",t[t.CODE_128=5]="CODE_128",t[t.DATA_MATRIX=6]="DATA_MATRIX",t[t.MAXICODE=7]="MAXICODE",t[t.ITF=8]="ITF",t[t.EAN_13=9]="EAN_13",t[t.EAN_8=10]="EAN_8",t[t.PDF_417=11]="PDF_417",t[t.RSS_14=12]="RSS_14",t[t.RSS_EXPANDED=13]="RSS_EXPANDED",t[t.UPC_A=14]="UPC_A",t[t.UPC_E=15]="UPC_E",t[t.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(Oe||(Oe={}));var oI=new Map([[Oe.QR_CODE,"QR_CODE"],[Oe.AZTEC,"AZTEC"],[Oe.CODABAR,"CODABAR"],[Oe.CODE_39,"CODE_39"],[Oe.CODE_93,"CODE_93"],[Oe.CODE_128,"CODE_128"],[Oe.DATA_MATRIX,"DATA_MATRIX"],[Oe.MAXICODE,"MAXICODE"],[Oe.ITF,"ITF"],[Oe.EAN_13,"EAN_13"],[Oe.EAN_8,"EAN_8"],[Oe.PDF_417,"PDF_417"],[Oe.RSS_14,"RSS_14"],[Oe.RSS_EXPANDED,"RSS_EXPANDED"],[Oe.UPC_A,"UPC_A"],[Oe.UPC_E,"UPC_E"],[Oe.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),aI;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.URL=1]="URL"})(aI||(aI={}));function Pz(t){return Object.values(Oe).includes(t)}var Hg;(function(t){t[t.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",t[t.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(Hg||(Hg={}));var kz=function(){function t(){}return t.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",t.SCAN_DEFAULT_FPS=2,t.DEFAULT_DISABLE_FLIP=!1,t.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,t.DEFAULT_SUPPORTED_SCAN_TYPE=[Hg.SCAN_TYPE_CAMERA,Hg.SCAN_TYPE_FILE],t}(),Q4=function(){function t(e,n){this.format=e,this.formatName=n}return t.prototype.toString=function(){return this.formatName},t.create=function(e){if(!oI.has(e))throw"".concat(e," not in html5QrcodeSupportedFormatsTextMap");return new t(e,oI.get(e))},t}(),lI=function(){function t(){}return t.createFromText=function(e){var n={text:e};return{decodedText:e,result:n}},t.createFromQrcodeResult=function(e){return{decodedText:e.text,result:e}},t}(),pw;(function(t){t[t.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",t[t.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",t[t.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(pw||(pw={}));var Dz=function(){function t(){}return t.createFrom=function(e){return{errorMessage:e,type:pw.UNKWOWN_ERROR}},t}(),Oz=function(){function t(e){this.verbose=e}return t.prototype.log=function(e){this.verbose&&console.log(e)},t.prototype.warn=function(e){this.verbose&&console.warn(e)},t.prototype.logError=function(e,n){(this.verbose||n===!0)&&console.error(e)},t.prototype.logErrors=function(e){if(e.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(e)},t}();function lo(t){return typeof t>"u"||t===null}var uu=function(){function t(){}return t.codeParseError=function(e){return"QR code parse error, error = ".concat(e)},t.errorGettingUserMedia=function(e){return"Error getting userMedia, error = ".concat(e)},t.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},t.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},t.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},t.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},t.scannerPaused=function(){return"Scanner paused"},t}(),X4=function(){function t(){}return t.isMediaStreamConstraintsValid=function(e,n){if(typeof e!="object"){var r=typeof e;return n.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(r,"."),!0),!1}for(var s=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],i=new Set(s),a=Object.keys(e),u=0,d=a;u<d.length;u++){var m=d[u];if(i.has(m))return n.logError("".concat(m," is not supported videoConstaints."),!0),!1}return!0},t}(),yw={exports:{}};(function(t,e){(function(n,r){r(e)})(jh,function(n){function r(M){return M==null}var s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,o){M.__proto__=o}||function(M,o){for(var l in o)o.hasOwnProperty(l)&&(M[l]=o[l])};function i(M,o){s(M,o);function l(){this.constructor=M}M.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}function a(M,o){var l=Object.setPrototypeOf;l?l(M,o):M.__proto__=o}function u(M,o){o===void 0&&(o=M.constructor);var l=Error.captureStackTrace;l&&l(M,o)}var d=function(M){i(o,M);function o(l){var c=this.constructor,h=M.call(this,l)||this;return Object.defineProperty(h,"name",{value:c.name,enumerable:!1}),a(h,c.prototype),u(h),h}return o}(Error);class m extends d{constructor(o=void 0){super(o),this.message=o}getKind(){return this.constructor.kind}}m.kind="Exception";class y extends m{}y.kind="ArgumentException";class _ extends m{}_.kind="IllegalArgumentException";class E{constructor(o){if(this.binarizer=o,o===null)throw new _("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(o,l){return this.binarizer.getBlackRow(o,l)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(o,l,c,h){const f=this.binarizer.getLuminanceSource().crop(o,l,c,h);return new E(this.binarizer.createBinarizer(f))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const o=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new E(this.binarizer.createBinarizer(o))}rotateCounterClockwise45(){const o=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new E(this.binarizer.createBinarizer(o))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class b extends m{static getChecksumInstance(){return new b}}b.kind="ChecksumException";class k{constructor(o){this.source=o}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class S{static arraycopy(o,l,c,h,f){for(;f--;)c[h++]=o[l++]}static currentTimeMillis(){return Date.now()}}class O extends m{}O.kind="IndexOutOfBoundsException";class T extends O{constructor(o=void 0,l=void 0){super(l),this.index=o,this.message=l}}T.kind="ArrayIndexOutOfBoundsException";class C{static fill(o,l){for(let c=0,h=o.length;c<h;c++)o[c]=l}static fillWithin(o,l,c,h){C.rangeCheck(o.length,l,c);for(let f=l;f<c;f++)o[f]=h}static rangeCheck(o,l,c){if(l>c)throw new _("fromIndex("+l+") > toIndex("+c+")");if(l<0)throw new T(l);if(c>o)throw new T(c)}static asList(...o){return o}static create(o,l,c){return Array.from({length:o}).map(f=>Array.from({length:l}).fill(c))}static createInt32Array(o,l,c){return Array.from({length:o}).map(f=>Int32Array.from({length:l}).fill(c))}static equals(o,l){if(!o||!l||!o.length||!l.length||o.length!==l.length)return!1;for(let c=0,h=o.length;c<h;c++)if(o[c]!==l[c])return!1;return!0}static hashCode(o){if(o===null)return 0;let l=1;for(const c of o)l=31*l+c;return l}static fillUint8Array(o,l){for(let c=0;c!==o.length;c++)o[c]=l}static copyOf(o,l){return o.slice(0,l)}static copyOfUint8Array(o,l){if(o.length<=l){const c=new Uint8Array(l);return c.set(o),c}return o.slice(0,l)}static copyOfRange(o,l,c){const h=c-l,f=new Int32Array(h);return S.arraycopy(o,l,f,0,h),f}static binarySearch(o,l,c){c===void 0&&(c=C.numberComparator);let h=0,f=o.length-1;for(;h<=f;){const g=f+h>>1,w=c(l,o[g]);if(w>0)h=g+1;else if(w<0)f=g-1;else return g}return-h-1}static numberComparator(o,l){return o-l}}class R{static numberOfTrailingZeros(o){let l;if(o===0)return 32;let c=31;return l=o<<16,l!==0&&(c-=16,o=l),l=o<<8,l!==0&&(c-=8,o=l),l=o<<4,l!==0&&(c-=4,o=l),l=o<<2,l!==0&&(c-=2,o=l),c-(o<<1>>>31)}static numberOfLeadingZeros(o){if(o===0)return 32;let l=1;return o>>>16||(l+=16,o<<=16),o>>>24||(l+=8,o<<=8),o>>>28||(l+=4,o<<=4),o>>>30||(l+=2,o<<=2),l-=o>>>31,l}static toHexString(o){return o.toString(16)}static toBinaryString(o){return String(parseInt(String(o),2))}static bitCount(o){return o=o-(o>>>1&1431655765),o=(o&858993459)+(o>>>2&858993459),o=o+(o>>>4)&252645135,o=o+(o>>>8),o=o+(o>>>16),o&63}static truncDivision(o,l){return Math.trunc(o/l)}static parseInt(o,l=void 0){return parseInt(o,l)}}R.MIN_VALUE_32_BITS=-2147483648,R.MAX_VALUE=Number.MAX_SAFE_INTEGER;class j{constructor(o,l){o===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=o,l==null?this.bits=j.makeArray(o):this.bits=l)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(o){if(o>this.bits.length*32){const l=j.makeArray(o);S.arraycopy(this.bits,0,l,0,this.bits.length),this.bits=l}}get(o){return(this.bits[Math.floor(o/32)]&1<<(o&31))!==0}set(o){this.bits[Math.floor(o/32)]|=1<<(o&31)}flip(o){this.bits[Math.floor(o/32)]^=1<<(o&31)}getNextSet(o){const l=this.size;if(o>=l)return l;const c=this.bits;let h=Math.floor(o/32),f=c[h];f&=~((1<<(o&31))-1);const g=c.length;for(;f===0;){if(++h===g)return l;f=c[h]}const w=h*32+R.numberOfTrailingZeros(f);return w>l?l:w}getNextUnset(o){const l=this.size;if(o>=l)return l;const c=this.bits;let h=Math.floor(o/32),f=~c[h];f&=~((1<<(o&31))-1);const g=c.length;for(;f===0;){if(++h===g)return l;f=~c[h]}const w=h*32+R.numberOfTrailingZeros(f);return w>l?l:w}setBulk(o,l){this.bits[Math.floor(o/32)]=l}setRange(o,l){if(l<o||o<0||l>this.size)throw new _;if(l===o)return;l--;const c=Math.floor(o/32),h=Math.floor(l/32),f=this.bits;for(let g=c;g<=h;g++){const w=g>c?0:o&31,A=(2<<(g<h?31:l&31))-(1<<w);f[g]|=A}}clear(){const o=this.bits.length,l=this.bits;for(let c=0;c<o;c++)l[c]=0}isRange(o,l,c){if(l<o||o<0||l>this.size)throw new _;if(l===o)return!0;l--;const h=Math.floor(o/32),f=Math.floor(l/32),g=this.bits;for(let w=h;w<=f;w++){const v=w>h?0:o&31,N=(2<<(w<f?31:l&31))-(1<<v)&4294967295;if((g[w]&N)!==(c?N:0))return!1}return!0}appendBit(o){this.ensureCapacity(this.size+1),o&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(o,l){if(l<0||l>32)throw new _("Num bits must be between 0 and 32");this.ensureCapacity(this.size+l);for(let c=l;c>0;c--)this.appendBit((o>>c-1&1)===1)}appendBitArray(o){const l=o.size;this.ensureCapacity(this.size+l);for(let c=0;c<l;c++)this.appendBit(o.get(c))}xor(o){if(this.size!==o.size)throw new _("Sizes don't match");const l=this.bits;for(let c=0,h=l.length;c<h;c++)l[c]^=o.bits[c]}toBytes(o,l,c,h){for(let f=0;f<h;f++){let g=0;for(let w=0;w<8;w++)this.get(o)&&(g|=1<<7-w),o++;l[c+f]=g}}getBitArray(){return this.bits}reverse(){const o=new Int32Array(this.bits.length),l=Math.floor((this.size-1)/32),c=l+1,h=this.bits;for(let f=0;f<c;f++){let g=h[f];g=g>>1&1431655765|(g&1431655765)<<1,g=g>>2&858993459|(g&858993459)<<2,g=g>>4&252645135|(g&252645135)<<4,g=g>>8&16711935|(g&16711935)<<8,g=g>>16&65535|(g&65535)<<16,o[l-f]=g}if(this.size!==c*32){const f=c*32-this.size;let g=o[0]>>>f;for(let w=1;w<c;w++){const v=o[w];g|=v<<32-f,o[w-1]=g,g=v>>>f}o[c-1]=g}this.bits=o}static makeArray(o){return new Int32Array(Math.floor((o+31)/32))}equals(o){if(!(o instanceof j))return!1;const l=o;return this.size===l.size&&C.equals(this.bits,l.bits)}hashCode(){return 31*this.size+C.hashCode(this.bits)}toString(){let o="";for(let l=0,c=this.size;l<c;l++)l&7||(o+=" "),o+=this.get(l)?"X":".";return o}clone(){return new j(this.size,this.bits.slice())}}var K;(function(M){M[M.OTHER=0]="OTHER",M[M.PURE_BARCODE=1]="PURE_BARCODE",M[M.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",M[M.TRY_HARDER=3]="TRY_HARDER",M[M.CHARACTER_SET=4]="CHARACTER_SET",M[M.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",M[M.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",M[M.ASSUME_GS1=7]="ASSUME_GS1",M[M.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",M[M.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",M[M.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(K||(K={}));var Q=K;class D extends m{static getFormatInstance(){return new D}}D.kind="FormatException";var B;(function(M){M[M.Cp437=0]="Cp437",M[M.ISO8859_1=1]="ISO8859_1",M[M.ISO8859_2=2]="ISO8859_2",M[M.ISO8859_3=3]="ISO8859_3",M[M.ISO8859_4=4]="ISO8859_4",M[M.ISO8859_5=5]="ISO8859_5",M[M.ISO8859_6=6]="ISO8859_6",M[M.ISO8859_7=7]="ISO8859_7",M[M.ISO8859_8=8]="ISO8859_8",M[M.ISO8859_9=9]="ISO8859_9",M[M.ISO8859_10=10]="ISO8859_10",M[M.ISO8859_11=11]="ISO8859_11",M[M.ISO8859_13=12]="ISO8859_13",M[M.ISO8859_14=13]="ISO8859_14",M[M.ISO8859_15=14]="ISO8859_15",M[M.ISO8859_16=15]="ISO8859_16",M[M.SJIS=16]="SJIS",M[M.Cp1250=17]="Cp1250",M[M.Cp1251=18]="Cp1251",M[M.Cp1252=19]="Cp1252",M[M.Cp1256=20]="Cp1256",M[M.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",M[M.UTF8=22]="UTF8",M[M.ASCII=23]="ASCII",M[M.Big5=24]="Big5",M[M.GB18030=25]="GB18030",M[M.EUC_KR=26]="EUC_KR"})(B||(B={}));class F{constructor(o,l,c,...h){this.valueIdentifier=o,this.name=c,typeof l=="number"?this.values=Int32Array.from([l]):this.values=l,this.otherEncodingNames=h,F.VALUE_IDENTIFIER_TO_ECI.set(o,this),F.NAME_TO_ECI.set(c,this);const f=this.values;for(let g=0,w=f.length;g!==w;g++){const v=f[g];F.VALUES_TO_ECI.set(v,this)}for(const g of h)F.NAME_TO_ECI.set(g,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(o){if(o<0||o>=900)throw new D("incorect value");const l=F.VALUES_TO_ECI.get(o);if(l===void 0)throw new D("incorect value");return l}static getCharacterSetECIByName(o){const l=F.NAME_TO_ECI.get(o);if(l===void 0)throw new D("incorect value");return l}equals(o){if(!(o instanceof F))return!1;const l=o;return this.getName()===l.getName()}}F.VALUE_IDENTIFIER_TO_ECI=new Map,F.VALUES_TO_ECI=new Map,F.NAME_TO_ECI=new Map,F.Cp437=new F(B.Cp437,Int32Array.from([0,2]),"Cp437"),F.ISO8859_1=new F(B.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),F.ISO8859_2=new F(B.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),F.ISO8859_3=new F(B.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),F.ISO8859_4=new F(B.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),F.ISO8859_5=new F(B.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),F.ISO8859_6=new F(B.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),F.ISO8859_7=new F(B.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),F.ISO8859_8=new F(B.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),F.ISO8859_9=new F(B.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),F.ISO8859_10=new F(B.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),F.ISO8859_11=new F(B.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),F.ISO8859_13=new F(B.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),F.ISO8859_14=new F(B.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),F.ISO8859_15=new F(B.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),F.ISO8859_16=new F(B.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),F.SJIS=new F(B.SJIS,20,"SJIS","Shift_JIS"),F.Cp1250=new F(B.Cp1250,21,"Cp1250","windows-1250"),F.Cp1251=new F(B.Cp1251,22,"Cp1251","windows-1251"),F.Cp1252=new F(B.Cp1252,23,"Cp1252","windows-1252"),F.Cp1256=new F(B.Cp1256,24,"Cp1256","windows-1256"),F.UnicodeBigUnmarked=new F(B.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),F.UTF8=new F(B.UTF8,26,"UTF8","UTF-8"),F.ASCII=new F(B.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),F.Big5=new F(B.Big5,28,"Big5"),F.GB18030=new F(B.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),F.EUC_KR=new F(B.EUC_KR,30,"EUC_KR","EUC-KR");class W extends m{}W.kind="UnsupportedOperationException";class X{static decode(o,l){const c=this.encodingName(l);return this.customDecoder?this.customDecoder(o,c):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(c)?this.decodeFallback(o,c):new TextDecoder(c).decode(o)}static shouldDecodeOnFallback(o){return!X.isBrowser()&&o==="ISO-8859-1"}static encode(o,l){const c=this.encodingName(l);return this.customEncoder?this.customEncoder(o,c):typeof TextEncoder>"u"?this.encodeFallback(o):new TextEncoder().encode(o)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(o){return typeof o=="string"?o:o.getName()}static encodingCharacterSet(o){return o instanceof F?o:F.getCharacterSetECIByName(o)}static decodeFallback(o,l){const c=this.encodingCharacterSet(l);if(X.isDecodeFallbackSupported(c)){let h="";for(let f=0,g=o.length;f<g;f++){let w=o[f].toString(16);w.length<2&&(w="0"+w),h+="%"+w}return decodeURIComponent(h)}if(c.equals(F.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(o.buffer));throw new W(`Encoding ${this.encodingName(l)} not supported by fallback.`)}static isDecodeFallbackSupported(o){return o.equals(F.UTF8)||o.equals(F.ISO8859_1)||o.equals(F.ASCII)}static encodeFallback(o){const c=btoa(unescape(encodeURIComponent(o))).split(""),h=[];for(let f=0;f<c.length;f++)h.push(c[f].charCodeAt(0));return new Uint8Array(h)}}class ${static castAsNonUtf8Char(o,l=null){const c=l?l.getName():this.ISO88591;return X.decode(new Uint8Array([o]),c)}static guessEncoding(o,l){if(l!=null&&l.get(Q.CHARACTER_SET)!==void 0)return l.get(Q.CHARACTER_SET).toString();const c=o.length;let h=!0,f=!0,g=!0,w=0,v=0,A=0,N=0,L=0,V=0,q=0,J=0,ee=0,se=0,ce=0;const ve=o.length>3&&o[0]===239&&o[1]===187&&o[2]===191;for(let Ee=0;Ee<c&&(h||f||g);Ee++){const pe=o[Ee]&255;g&&(w>0?pe&128?w--:g=!1:pe&128&&(pe&64?(w++,pe&32?(w++,pe&16?(w++,pe&8?g=!1:N++):A++):v++):g=!1)),h&&(pe>127&&pe<160?h=!1:pe>159&&(pe<192||pe===215||pe===247)&&ce++),f&&(L>0?pe<64||pe===127||pe>252?f=!1:L--:pe===128||pe===160||pe>239?f=!1:pe>160&&pe<224?(V++,J=0,q++,q>ee&&(ee=q)):pe>127?(L++,q=0,J++,J>se&&(se=J)):(q=0,J=0))}return g&&w>0&&(g=!1),f&&L>0&&(f=!1),g&&(ve||v+A+N>0)?$.UTF8:f&&($.ASSUME_SHIFT_JIS||ee>=3||se>=3)?$.SHIFT_JIS:h&&f?ee===2&&V===2||ce*10>=c?$.SHIFT_JIS:$.ISO88591:h?$.ISO88591:f?$.SHIFT_JIS:g?$.UTF8:$.PLATFORM_DEFAULT_ENCODING}static format(o,...l){let c=-1;function h(g,w,v,A,N,L){if(g==="%%")return"%";if(l[++c]===void 0)return;g=A?parseInt(A.substr(1)):void 0;let V=N?parseInt(N.substr(1)):void 0,q;switch(L){case"s":q=l[c];break;case"c":q=l[c][0];break;case"f":q=parseFloat(l[c]).toFixed(g);break;case"p":q=parseFloat(l[c]).toPrecision(g);break;case"e":q=parseFloat(l[c]).toExponential(g);break;case"x":q=parseInt(l[c]).toString(V||16);break;case"d":q=parseFloat(parseInt(l[c],V||10).toPrecision(g)).toFixed(0);break}q=typeof q=="object"?JSON.stringify(q):(+q).toString(V);let J=parseInt(v),ee=v&&v[0]+""=="0"?"0":" ";for(;q.length<J;)q=w!==void 0?q+ee:ee+q;return q}let f=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return o.replace(f,h)}static getBytes(o,l){return X.encode(o,l)}static getCharCode(o,l=0){return o.charCodeAt(l)}static getCharAt(o){return String.fromCharCode(o)}}$.SHIFT_JIS=F.SJIS.getName(),$.GB2312="GB2312",$.ISO88591=F.ISO8859_1.getName(),$.EUC_JP="EUC_JP",$.UTF8=F.UTF8.getName(),$.PLATFORM_DEFAULT_ENCODING=$.UTF8,$.ASSUME_SHIFT_JIS=!1;class z{constructor(o=""){this.value=o}enableDecoding(o){return this.encoding=o,this}append(o){return typeof o=="string"?this.value+=o.toString():this.encoding?this.value+=$.castAsNonUtf8Char(o,this.encoding):this.value+=String.fromCharCode(o),this}appendChars(o,l,c){for(let h=l;l<l+c;h++)this.append(o[h]);return this}length(){return this.value.length}charAt(o){return this.value.charAt(o)}deleteCharAt(o){this.value=this.value.substr(0,o)+this.value.substring(o+1)}setCharAt(o,l){this.value=this.value.substr(0,o)+l+this.value.substr(o+1)}substring(o,l){return this.value.substring(o,l)}setLengthToZero(){this.value=""}toString(){return this.value}insert(o,l){this.value=this.value.substr(0,o)+l+this.value.substr(o+l.length)}}class Te{constructor(o,l,c,h){if(this.width=o,this.height=l,this.rowSize=c,this.bits=h,l==null&&(l=o),this.height=l,o<1||l<1)throw new _("Both dimensions must be greater than 0");c==null&&(c=Math.floor((o+31)/32)),this.rowSize=c,h==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(o){const l=o.length,c=o[0].length,h=new Te(c,l);for(let f=0;f<l;f++){const g=o[f];for(let w=0;w<c;w++)g[w]&&h.set(w,f)}return h}static parseFromString(o,l,c){if(o===null)throw new _("stringRepresentation cannot be null");const h=new Array(o.length);let f=0,g=0,w=-1,v=0,A=0;for(;A<o.length;)if(o.charAt(A)===`
`||o.charAt(A)==="\r"){if(f>g){if(w===-1)w=f-g;else if(f-g!==w)throw new _("row lengths do not match");g=f,v++}A++}else if(o.substring(A,A+l.length)===l)A+=l.length,h[f]=!0,f++;else if(o.substring(A,A+c.length)===c)A+=c.length,h[f]=!1,f++;else throw new _("illegal character encountered: "+o.substring(A));if(f>g){if(w===-1)w=f-g;else if(f-g!==w)throw new _("row lengths do not match");v++}const N=new Te(w,v);for(let L=0;L<f;L++)h[L]&&N.set(Math.floor(L%w),Math.floor(L/w));return N}get(o,l){const c=l*this.rowSize+Math.floor(o/32);return(this.bits[c]>>>(o&31)&1)!==0}set(o,l){const c=l*this.rowSize+Math.floor(o/32);this.bits[c]|=1<<(o&31)&4294967295}unset(o,l){const c=l*this.rowSize+Math.floor(o/32);this.bits[c]&=~(1<<(o&31)&4294967295)}flip(o,l){const c=l*this.rowSize+Math.floor(o/32);this.bits[c]^=1<<(o&31)&4294967295}xor(o){if(this.width!==o.getWidth()||this.height!==o.getHeight()||this.rowSize!==o.getRowSize())throw new _("input matrix dimensions do not match");const l=new j(Math.floor(this.width/32)+1),c=this.rowSize,h=this.bits;for(let f=0,g=this.height;f<g;f++){const w=f*c,v=o.getRow(f,l).getBitArray();for(let A=0;A<c;A++)h[w+A]^=v[A]}}clear(){const o=this.bits,l=o.length;for(let c=0;c<l;c++)o[c]=0}setRegion(o,l,c,h){if(l<0||o<0)throw new _("Left and top must be nonnegative");if(h<1||c<1)throw new _("Height and width must be at least 1");const f=o+c,g=l+h;if(g>this.height||f>this.width)throw new _("The region must fit inside the matrix");const w=this.rowSize,v=this.bits;for(let A=l;A<g;A++){const N=A*w;for(let L=o;L<f;L++)v[N+Math.floor(L/32)]|=1<<(L&31)&4294967295}}getRow(o,l){l==null||l.getSize()<this.width?l=new j(this.width):l.clear();const c=this.rowSize,h=this.bits,f=o*c;for(let g=0;g<c;g++)l.setBulk(g*32,h[f+g]);return l}setRow(o,l){S.arraycopy(l.getBitArray(),0,this.bits,o*this.rowSize,this.rowSize)}rotate180(){const o=this.getWidth(),l=this.getHeight();let c=new j(o),h=new j(o);for(let f=0,g=Math.floor((l+1)/2);f<g;f++)c=this.getRow(f,c),h=this.getRow(l-1-f,h),c.reverse(),h.reverse(),this.setRow(f,h),this.setRow(l-1-f,c)}getEnclosingRectangle(){const o=this.width,l=this.height,c=this.rowSize,h=this.bits;let f=o,g=l,w=-1,v=-1;for(let A=0;A<l;A++)for(let N=0;N<c;N++){const L=h[A*c+N];if(L!==0){if(A<g&&(g=A),A>v&&(v=A),N*32<f){let V=0;for(;!(L<<31-V&4294967295);)V++;N*32+V<f&&(f=N*32+V)}if(N*32+31>w){let V=31;for(;!(L>>>V);)V--;N*32+V>w&&(w=N*32+V)}}}return w<f||v<g?null:Int32Array.from([f,g,w-f+1,v-g+1])}getTopLeftOnBit(){const o=this.rowSize,l=this.bits;let c=0;for(;c<l.length&&l[c]===0;)c++;if(c===l.length)return null;const h=c/o;let f=c%o*32;const g=l[c];let w=0;for(;!(g<<31-w&4294967295);)w++;return f+=w,Int32Array.from([f,h])}getBottomRightOnBit(){const o=this.rowSize,l=this.bits;let c=l.length-1;for(;c>=0&&l[c]===0;)c--;if(c<0)return null;const h=Math.floor(c/o);let f=Math.floor(c%o)*32;const g=l[c];let w=31;for(;!(g>>>w);)w--;return f+=w,Int32Array.from([f,h])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(o){if(!(o instanceof Te))return!1;const l=o;return this.width===l.width&&this.height===l.height&&this.rowSize===l.rowSize&&C.equals(this.bits,l.bits)}hashCode(){let o=this.width;return o=31*o+this.width,o=31*o+this.height,o=31*o+this.rowSize,o=31*o+C.hashCode(this.bits),o}toString(o="X ",l="  ",c=`
`){return this.buildToString(o,l,c)}buildToString(o,l,c){let h=new z;for(let f=0,g=this.height;f<g;f++){for(let w=0,v=this.width;w<v;w++)h.append(this.get(w,f)?o:l);h.append(c)}return h.toString()}clone(){return new Te(this.width,this.height,this.rowSize,this.bits.slice())}}class ie extends m{static getNotFoundInstance(){return new ie}}ie.kind="NotFoundException";class Xe extends k{constructor(o){super(o),this.luminances=Xe.EMPTY,this.buckets=new Int32Array(Xe.LUMINANCE_BUCKETS)}getBlackRow(o,l){const c=this.getLuminanceSource(),h=c.getWidth();l==null||l.getSize()<h?l=new j(h):l.clear(),this.initArrays(h);const f=c.getRow(o,this.luminances),g=this.buckets;for(let v=0;v<h;v++)g[(f[v]&255)>>Xe.LUMINANCE_SHIFT]++;const w=Xe.estimateBlackPoint(g);if(h<3)for(let v=0;v<h;v++)(f[v]&255)<w&&l.set(v);else{let v=f[0]&255,A=f[1]&255;for(let N=1;N<h-1;N++){const L=f[N+1]&255;(A*4-v-L)/2<w&&l.set(N),v=A,A=L}}return l}getBlackMatrix(){const o=this.getLuminanceSource(),l=o.getWidth(),c=o.getHeight(),h=new Te(l,c);this.initArrays(l);const f=this.buckets;for(let v=1;v<5;v++){const A=Math.floor(c*v/5),N=o.getRow(A,this.luminances),L=Math.floor(l*4/5);for(let V=Math.floor(l/5);V<L;V++){const q=N[V]&255;f[q>>Xe.LUMINANCE_SHIFT]++}}const g=Xe.estimateBlackPoint(f),w=o.getMatrix();for(let v=0;v<c;v++){const A=v*l;for(let N=0;N<l;N++)(w[A+N]&255)<g&&h.set(N,v)}return h}createBinarizer(o){return new Xe(o)}initArrays(o){this.luminances.length<o&&(this.luminances=new Uint8ClampedArray(o));const l=this.buckets;for(let c=0;c<Xe.LUMINANCE_BUCKETS;c++)l[c]=0}static estimateBlackPoint(o){const l=o.length;let c=0,h=0,f=0;for(let N=0;N<l;N++)o[N]>f&&(h=N,f=o[N]),o[N]>c&&(c=o[N]);let g=0,w=0;for(let N=0;N<l;N++){const L=N-h,V=o[N]*L*L;V>w&&(g=N,w=V)}if(h>g){const N=h;h=g,g=N}if(g-h<=l/16)throw new ie;let v=g-1,A=-1;for(let N=g-1;N>h;N--){const L=N-h,V=L*L*(g-N)*(c-o[N]);V>A&&(v=N,A=V)}return v<<Xe.LUMINANCE_SHIFT}}Xe.LUMINANCE_BITS=5,Xe.LUMINANCE_SHIFT=8-Xe.LUMINANCE_BITS,Xe.LUMINANCE_BUCKETS=1<<Xe.LUMINANCE_BITS,Xe.EMPTY=Uint8ClampedArray.from([0]);class de extends Xe{constructor(o){super(o),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const o=this.getLuminanceSource(),l=o.getWidth(),c=o.getHeight();if(l>=de.MINIMUM_DIMENSION&&c>=de.MINIMUM_DIMENSION){const h=o.getMatrix();let f=l>>de.BLOCK_SIZE_POWER;l&de.BLOCK_SIZE_MASK&&f++;let g=c>>de.BLOCK_SIZE_POWER;c&de.BLOCK_SIZE_MASK&&g++;const w=de.calculateBlackPoints(h,f,g,l,c),v=new Te(l,c);de.calculateThresholdForBlock(h,f,g,l,c,w,v),this.matrix=v}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(o){return new de(o)}static calculateThresholdForBlock(o,l,c,h,f,g,w){const v=f-de.BLOCK_SIZE,A=h-de.BLOCK_SIZE;for(let N=0;N<c;N++){let L=N<<de.BLOCK_SIZE_POWER;L>v&&(L=v);const V=de.cap(N,2,c-3);for(let q=0;q<l;q++){let J=q<<de.BLOCK_SIZE_POWER;J>A&&(J=A);const ee=de.cap(q,2,l-3);let se=0;for(let ve=-2;ve<=2;ve++){const Ee=g[V+ve];se+=Ee[ee-2]+Ee[ee-1]+Ee[ee]+Ee[ee+1]+Ee[ee+2]}const ce=se/25;de.thresholdBlock(o,J,L,ce,h,w)}}}static cap(o,l,c){return o<l?l:o>c?c:o}static thresholdBlock(o,l,c,h,f,g){for(let w=0,v=c*f+l;w<de.BLOCK_SIZE;w++,v+=f)for(let A=0;A<de.BLOCK_SIZE;A++)(o[v+A]&255)<=h&&g.set(l+A,c+w)}static calculateBlackPoints(o,l,c,h,f){const g=f-de.BLOCK_SIZE,w=h-de.BLOCK_SIZE,v=new Array(c);for(let A=0;A<c;A++){v[A]=new Int32Array(l);let N=A<<de.BLOCK_SIZE_POWER;N>g&&(N=g);for(let L=0;L<l;L++){let V=L<<de.BLOCK_SIZE_POWER;V>w&&(V=w);let q=0,J=255,ee=0;for(let ce=0,ve=N*h+V;ce<de.BLOCK_SIZE;ce++,ve+=h){for(let Ee=0;Ee<de.BLOCK_SIZE;Ee++){const pe=o[ve+Ee]&255;q+=pe,pe<J&&(J=pe),pe>ee&&(ee=pe)}if(ee-J>de.MIN_DYNAMIC_RANGE)for(ce++,ve+=h;ce<de.BLOCK_SIZE;ce++,ve+=h)for(let Ee=0;Ee<de.BLOCK_SIZE;Ee++)q+=o[ve+Ee]&255}let se=q>>de.BLOCK_SIZE_POWER*2;if(ee-J<=de.MIN_DYNAMIC_RANGE&&(se=J/2,A>0&&L>0)){const ce=(v[A-1][L]+2*v[A][L-1]+v[A-1][L-1])/4;J<ce&&(se=ce)}v[A][L]=se}}return v}}de.BLOCK_SIZE_POWER=3,de.BLOCK_SIZE=1<<de.BLOCK_SIZE_POWER,de.BLOCK_SIZE_MASK=de.BLOCK_SIZE-1,de.MINIMUM_DIMENSION=de.BLOCK_SIZE*5,de.MIN_DYNAMIC_RANGE=24;class he{constructor(o,l){this.width=o,this.height=l}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(o,l,c,h){throw new W("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new W("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new W("This luminance source does not support rotation by 45 degrees.")}toString(){const o=new Uint8ClampedArray(this.width);let l=new z;for(let c=0;c<this.height;c++){const h=this.getRow(c,o);for(let f=0;f<this.width;f++){const g=h[f]&255;let w;g<64?w="#":g<128?w="+":g<192?w=".":w=" ",l.append(w)}l.append(`
`)}return l.toString()}}class Ce extends he{constructor(o){super(o.getWidth(),o.getHeight()),this.delegate=o}getRow(o,l){const c=this.delegate.getRow(o,l),h=this.getWidth();for(let f=0;f<h;f++)c[f]=255-(c[f]&255);return c}getMatrix(){const o=this.delegate.getMatrix(),l=this.getWidth()*this.getHeight(),c=new Uint8ClampedArray(l);for(let h=0;h<l;h++)c[h]=255-(o[h]&255);return c}isCropSupported(){return this.delegate.isCropSupported()}crop(o,l,c,h){return new Ce(this.delegate.crop(o,l,c,h))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new Ce(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new Ce(this.delegate.rotateCounterClockwise45())}}class Me extends he{constructor(o){super(o.width,o.height),this.canvas=o,this.tempCanvasElement=null,this.buffer=Me.makeBufferFromCanvasImageData(o)}static makeBufferFromCanvasImageData(o){const l=o.getContext("2d").getImageData(0,0,o.width,o.height);return Me.toGrayscaleBuffer(l.data,o.width,o.height)}static toGrayscaleBuffer(o,l,c){const h=new Uint8ClampedArray(l*c);for(let f=0,g=0,w=o.length;f<w;f+=4,g++){let v;if(o[f+3]===0)v=255;else{const N=o[f],L=o[f+1],V=o[f+2];v=306*N+601*L+117*V+512>>10}h[g]=v}return h}getRow(o,l){if(o<0||o>=this.getHeight())throw new _("Requested row is outside the image: "+o);const c=this.getWidth(),h=o*c;return l===null?l=this.buffer.slice(h,h+c):(l.length<c&&(l=new Uint8ClampedArray(c)),l.set(this.buffer.slice(h,h+c))),l}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(o,l,c,h){return super.crop(o,l,c,h),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const o=this.canvas.ownerDocument.createElement("canvas");o.width=this.canvas.width,o.height=this.canvas.height,this.tempCanvasElement=o}return this.tempCanvasElement}rotate(o){const l=this.getTempCanvasElement(),c=l.getContext("2d"),h=o*Me.DEGREE_TO_RADIANS,f=this.canvas.width,g=this.canvas.height,w=Math.ceil(Math.abs(Math.cos(h))*f+Math.abs(Math.sin(h))*g),v=Math.ceil(Math.abs(Math.sin(h))*f+Math.abs(Math.cos(h))*g);return l.width=w,l.height=v,c.translate(w/2,v/2),c.rotate(h),c.drawImage(this.canvas,f/-2,g/-2),this.buffer=Me.makeBufferFromCanvasImageData(l),this}invert(){return new Ce(this)}}Me.DEGREE_TO_RADIANS=Math.PI/180;class ht{constructor(o,l,c){this.deviceId=o,this.label=l,this.kind="videoinput",this.groupId=c||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var Ge=(globalThis||jh||self||window||void 0)&&(globalThis||jh||self||window||void 0).__awaiter||function(M,o,l,c){function h(f){return f instanceof l?f:new l(function(g){g(f)})}return new(l||(l=Promise))(function(f,g){function w(N){try{A(c.next(N))}catch(L){g(L)}}function v(N){try{A(c.throw(N))}catch(L){g(L)}}function A(N){N.done?f(N.value):h(N.value).then(w,v)}A((c=c.apply(M,o||[])).next())})};class _t{constructor(o,l=500,c){this.reader=o,this.timeBetweenScansMillis=l,this._hints=c,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(o){this._timeBetweenDecodingAttempts=o<0?0:o}set hints(o){this._hints=o||null}get hints(){return this._hints}listVideoInputDevices(){return Ge(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const o=yield navigator.mediaDevices.enumerateDevices(),l=[];for(const c of o){const h=c.kind==="video"?"videoinput":c.kind;if(h!=="videoinput")continue;const f=c.deviceId||c.id,g=c.label||`Video device ${l.length+1}`,w=c.groupId,v={deviceId:f,label:g,kind:h,groupId:w};l.push(v)}return l})}getVideoInputDevices(){return Ge(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(l=>new ht(l.deviceId,l.label))})}findDeviceById(o){return Ge(this,void 0,void 0,function*(){const l=yield this.listVideoInputDevices();return l?l.find(c=>c.deviceId===o):null})}decodeFromInputVideoDevice(o,l){return Ge(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(o,l)})}decodeOnceFromVideoDevice(o,l){return Ge(this,void 0,void 0,function*(){this.reset();let c;o?c={deviceId:{exact:o}}:c={facingMode:"environment"};const h={video:c};return yield this.decodeOnceFromConstraints(h,l)})}decodeOnceFromConstraints(o,l){return Ge(this,void 0,void 0,function*(){const c=yield navigator.mediaDevices.getUserMedia(o);return yield this.decodeOnceFromStream(c,l)})}decodeOnceFromStream(o,l){return Ge(this,void 0,void 0,function*(){this.reset();const c=yield this.attachStreamToVideo(o,l);return yield this.decodeOnce(c)})}decodeFromInputVideoDeviceContinuously(o,l,c){return Ge(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(o,l,c)})}decodeFromVideoDevice(o,l,c){return Ge(this,void 0,void 0,function*(){let h;o?h={deviceId:{exact:o}}:h={facingMode:"environment"};const f={video:h};return yield this.decodeFromConstraints(f,l,c)})}decodeFromConstraints(o,l,c){return Ge(this,void 0,void 0,function*(){const h=yield navigator.mediaDevices.getUserMedia(o);return yield this.decodeFromStream(h,l,c)})}decodeFromStream(o,l,c){return Ge(this,void 0,void 0,function*(){this.reset();const h=yield this.attachStreamToVideo(o,l);return yield this.decodeContinuously(h,c)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(o,l){return Ge(this,void 0,void 0,function*(){const c=this.prepareVideoElement(l);return this.addVideoSource(c,o),this.videoElement=c,this.stream=o,yield this.playVideoOnLoadAsync(c),c})}playVideoOnLoadAsync(o){return new Promise((l,c)=>this.playVideoOnLoad(o,()=>l()))}playVideoOnLoad(o,l){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(o),o.addEventListener("ended",this.videoEndedListener),o.addEventListener("canplay",this.videoCanPlayListener),o.addEventListener("playing",l),this.tryPlayVideo(o)}isVideoPlaying(o){return o.currentTime>0&&!o.paused&&!o.ended&&o.readyState>2}tryPlayVideo(o){return Ge(this,void 0,void 0,function*(){if(this.isVideoPlaying(o)){console.warn("Trying to play video that is already playing.");return}try{yield o.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(o,l){const c=document.getElementById(o);if(!c)throw new y(`element with id '${o}' not found`);if(c.nodeName.toLowerCase()!==l.toLowerCase())throw new y(`element with id '${o}' must be an ${l} element`);return c}decodeFromImage(o,l){if(!o&&!l)throw new y("either imageElement with a src set or an url must be provided");return l&&!o?this.decodeFromImageUrl(l):this.decodeFromImageElement(o)}decodeFromVideo(o,l){if(!o&&!l)throw new y("Either an element with a src set or an URL must be provided");return l&&!o?this.decodeFromVideoUrl(l):this.decodeFromVideoElement(o)}decodeFromVideoContinuously(o,l,c){if(o===void 0&&l===void 0)throw new y("Either an element with a src set or an URL must be provided");return l&&!o?this.decodeFromVideoUrlContinuously(l,c):this.decodeFromVideoElementContinuously(o,c)}decodeFromImageElement(o){if(!o)throw new y("An image element must be provided.");this.reset();const l=this.prepareImageElement(o);this.imageElement=l;let c;return this.isImageLoaded(l)?c=this.decodeOnce(l,!1,!0):c=this._decodeOnLoadImage(l),c}decodeFromVideoElement(o){const l=this._decodeFromVideoElementSetup(o);return this._decodeOnLoadVideo(l)}decodeFromVideoElementContinuously(o,l){const c=this._decodeFromVideoElementSetup(o);return this._decodeOnLoadVideoContinuously(c,l)}_decodeFromVideoElementSetup(o){if(!o)throw new y("A video element must be provided.");this.reset();const l=this.prepareVideoElement(o);return this.videoElement=l,l}decodeFromImageUrl(o){if(!o)throw new y("An URL must be provided.");this.reset();const l=this.prepareImageElement();this.imageElement=l;const c=this._decodeOnLoadImage(l);return l.src=o,c}decodeFromVideoUrl(o){if(!o)throw new y("An URL must be provided.");this.reset();const l=this.prepareVideoElement(),c=this.decodeFromVideoElement(l);return l.src=o,c}decodeFromVideoUrlContinuously(o,l){if(!o)throw new y("An URL must be provided.");this.reset();const c=this.prepareVideoElement(),h=this.decodeFromVideoElementContinuously(c,l);return c.src=o,h}_decodeOnLoadImage(o){return new Promise((l,c)=>{this.imageLoadedListener=()=>this.decodeOnce(o,!1,!0).then(l,c),o.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(o){return Ge(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(o),yield this.decodeOnce(o)})}_decodeOnLoadVideoContinuously(o,l){return Ge(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(o),this.decodeContinuously(o,l)})}isImageLoaded(o){return!(!o.complete||o.naturalWidth===0)}prepareImageElement(o){let l;return typeof o>"u"&&(l=document.createElement("img"),l.width=200,l.height=200),typeof o=="string"&&(l=this.getMediaElement(o,"img")),o instanceof HTMLImageElement&&(l=o),l}prepareVideoElement(o){let l;return!o&&typeof document<"u"&&(l=document.createElement("video"),l.width=200,l.height=200),typeof o=="string"&&(l=this.getMediaElement(o,"video")),o instanceof HTMLVideoElement&&(l=o),l.setAttribute("autoplay","true"),l.setAttribute("muted","true"),l.setAttribute("playsinline","true"),l}decodeOnce(o,l=!0,c=!0){this._stopAsyncDecode=!1;const h=(f,g)=>{if(this._stopAsyncDecode){g(new ie("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const w=this.decode(o);f(w)}catch(w){const v=l&&w instanceof ie,N=(w instanceof b||w instanceof D)&&c;if(v||N)return setTimeout(h,this._timeBetweenDecodingAttempts,f,g);g(w)}};return new Promise((f,g)=>h(f,g))}decodeContinuously(o,l){this._stopContinuousDecode=!1;const c=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const h=this.decode(o);l(h,null),setTimeout(c,this.timeBetweenScansMillis)}catch(h){l(null,h);const f=h instanceof b||h instanceof D,g=h instanceof ie;(f||g)&&setTimeout(c,this._timeBetweenDecodingAttempts)}};c()}decode(o){const l=this.createBinaryBitmap(o);return this.decodeBitmap(l)}_isHTMLVideoElement(o){return o.videoWidth!==0}drawFrameOnCanvas(o,l,c){l||(l={sx:0,sy:0,sWidth:o.videoWidth,sHeight:o.videoHeight,dx:0,dy:0,dWidth:o.videoWidth,dHeight:o.videoHeight}),c||(c=this.captureCanvasContext),c.drawImage(o,l.sx,l.sy,l.sWidth,l.sHeight,l.dx,l.dy,l.dWidth,l.dHeight)}drawImageOnCanvas(o,l,c=this.captureCanvasContext){l||(l={sx:0,sy:0,sWidth:o.naturalWidth,sHeight:o.naturalHeight,dx:0,dy:0,dWidth:o.naturalWidth,dHeight:o.naturalHeight}),c||(c=this.captureCanvasContext),c.drawImage(o,l.sx,l.sy,l.sWidth,l.sHeight,l.dx,l.dy,l.dWidth,l.dHeight)}createBinaryBitmap(o){this.getCaptureCanvasContext(o),this._isHTMLVideoElement(o)?this.drawFrameOnCanvas(o):this.drawImageOnCanvas(o);const l=this.getCaptureCanvas(o),c=new Me(l),h=new de(c);return new E(h)}getCaptureCanvasContext(o){if(!this.captureCanvasContext){const c=this.getCaptureCanvas(o).getContext("2d");this.captureCanvasContext=c}return this.captureCanvasContext}getCaptureCanvas(o){if(!this.captureCanvas){const l=this.createCaptureCanvas(o);this.captureCanvas=l}return this.captureCanvas}decodeBitmap(o){return this.reader.decode(o,this._hints)}createCaptureCanvas(o){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const l=document.createElement("canvas");let c,h;return typeof o<"u"&&(o instanceof HTMLVideoElement?(c=o.videoWidth,h=o.videoHeight):o instanceof HTMLImageElement&&(c=o.naturalWidth||o.width,h=o.naturalHeight||o.height)),l.style.width=c+"px",l.style.height=h+"px",l.width=c,l.height=h,l}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(o=>o.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(o,l){try{o.srcObject=l}catch{o.src=URL.createObjectURL(l)}}cleanVideoSource(o){try{o.srcObject=null}catch{o.src=""}this.videoElement.removeAttribute("src")}}class zt{constructor(o,l,c=l==null?0:8*l.length,h,f,g=S.currentTimeMillis()){this.text=o,this.rawBytes=l,this.numBits=c,this.resultPoints=h,this.format=f,this.timestamp=g,this.text=o,this.rawBytes=l,c==null?this.numBits=l==null?0:8*l.length:this.numBits=c,this.resultPoints=h,this.format=f,this.resultMetadata=null,g==null?this.timestamp=S.currentTimeMillis():this.timestamp=g}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(o,l){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(o,l)}putAllMetadata(o){o!==null&&(this.resultMetadata===null?this.resultMetadata=o:this.resultMetadata=new Map(o))}addResultPoints(o){const l=this.resultPoints;if(l===null)this.resultPoints=o;else if(o!==null&&o.length>0){const c=new Array(l.length+o.length);S.arraycopy(l,0,c,0,l.length),S.arraycopy(o,0,c,l.length,o.length),this.resultPoints=c}}getTimestamp(){return this.timestamp}toString(){return this.text}}var Pr;(function(M){M[M.AZTEC=0]="AZTEC",M[M.CODABAR=1]="CODABAR",M[M.CODE_39=2]="CODE_39",M[M.CODE_93=3]="CODE_93",M[M.CODE_128=4]="CODE_128",M[M.DATA_MATRIX=5]="DATA_MATRIX",M[M.EAN_8=6]="EAN_8",M[M.EAN_13=7]="EAN_13",M[M.ITF=8]="ITF",M[M.MAXICODE=9]="MAXICODE",M[M.PDF_417=10]="PDF_417",M[M.QR_CODE=11]="QR_CODE",M[M.RSS_14=12]="RSS_14",M[M.RSS_EXPANDED=13]="RSS_EXPANDED",M[M.UPC_A=14]="UPC_A",M[M.UPC_E=15]="UPC_E",M[M.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(Pr||(Pr={}));var Fe=Pr,fr;(function(M){M[M.OTHER=0]="OTHER",M[M.ORIENTATION=1]="ORIENTATION",M[M.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",M[M.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",M[M.ISSUE_NUMBER=4]="ISSUE_NUMBER",M[M.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",M[M.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",M[M.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",M[M.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",M[M.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",M[M.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(fr||(fr={}));var pn=fr;class Xs{constructor(o,l,c,h,f=-1,g=-1){this.rawBytes=o,this.text=l,this.byteSegments=c,this.ecLevel=h,this.structuredAppendSequenceNumber=f,this.structuredAppendParity=g,this.numBits=o==null?0:8*o.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(o){this.numBits=o}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(o){this.errorsCorrected=o}getErasures(){return this.erasures}setErasures(o){this.erasures=o}getOther(){return this.other}setOther(o){this.other=o}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class rs{exp(o){return this.expTable[o]}log(o){if(o===0)throw new _;return this.logTable[o]}static addOrSubtract(o,l){return o^l}}class Mn{constructor(o,l){if(l.length===0)throw new _;this.field=o;const c=l.length;if(c>1&&l[0]===0){let h=1;for(;h<c&&l[h]===0;)h++;h===c?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(c-h),S.arraycopy(l,h,this.coefficients,0,this.coefficients.length))}else this.coefficients=l}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(o){return this.coefficients[this.coefficients.length-1-o]}evaluateAt(o){if(o===0)return this.getCoefficient(0);const l=this.coefficients;let c;if(o===1){c=0;for(let g=0,w=l.length;g!==w;g++){const v=l[g];c=rs.addOrSubtract(c,v)}return c}c=l[0];const h=l.length,f=this.field;for(let g=1;g<h;g++)c=rs.addOrSubtract(f.multiply(o,c),l[g]);return c}addOrSubtract(o){if(!this.field.equals(o.field))throw new _("GenericGFPolys do not have same GenericGF field");if(this.isZero())return o;if(o.isZero())return this;let l=this.coefficients,c=o.coefficients;if(l.length>c.length){const g=l;l=c,c=g}let h=new Int32Array(c.length);const f=c.length-l.length;S.arraycopy(c,0,h,0,f);for(let g=f;g<c.length;g++)h[g]=rs.addOrSubtract(l[g-f],c[g]);return new Mn(this.field,h)}multiply(o){if(!this.field.equals(o.field))throw new _("GenericGFPolys do not have same GenericGF field");if(this.isZero()||o.isZero())return this.field.getZero();const l=this.coefficients,c=l.length,h=o.coefficients,f=h.length,g=new Int32Array(c+f-1),w=this.field;for(let v=0;v<c;v++){const A=l[v];for(let N=0;N<f;N++)g[v+N]=rs.addOrSubtract(g[v+N],w.multiply(A,h[N]))}return new Mn(w,g)}multiplyScalar(o){if(o===0)return this.field.getZero();if(o===1)return this;const l=this.coefficients.length,c=this.field,h=new Int32Array(l),f=this.coefficients;for(let g=0;g<l;g++)h[g]=c.multiply(f[g],o);return new Mn(c,h)}multiplyByMonomial(o,l){if(o<0)throw new _;if(l===0)return this.field.getZero();const c=this.coefficients,h=c.length,f=new Int32Array(h+o),g=this.field;for(let w=0;w<h;w++)f[w]=g.multiply(c[w],l);return new Mn(g,f)}divide(o){if(!this.field.equals(o.field))throw new _("GenericGFPolys do not have same GenericGF field");if(o.isZero())throw new _("Divide by 0");const l=this.field;let c=l.getZero(),h=this;const f=o.getCoefficient(o.getDegree()),g=l.inverse(f);for(;h.getDegree()>=o.getDegree()&&!h.isZero();){const w=h.getDegree()-o.getDegree(),v=l.multiply(h.getCoefficient(h.getDegree()),g),A=o.multiplyByMonomial(w,v),N=l.buildMonomial(w,v);c=c.addOrSubtract(N),h=h.addOrSubtract(A)}return[c,h]}toString(){let o="";for(let l=this.getDegree();l>=0;l--){let c=this.getCoefficient(l);if(c!==0){if(c<0?(o+=" - ",c=-c):o.length>0&&(o+=" + "),l===0||c!==1){const h=this.field.log(c);h===0?o+="1":h===1?o+="a":(o+="a^",o+=h)}l!==0&&(l===1?o+="x":(o+="x^",o+=l))}}return o}}class Ys extends m{}Ys.kind="ArithmeticException";class dt extends rs{constructor(o,l,c){super(),this.primitive=o,this.size=l,this.generatorBase=c;const h=new Int32Array(l);let f=1;for(let w=0;w<l;w++)h[w]=f,f*=2,f>=l&&(f^=o,f&=l-1);this.expTable=h;const g=new Int32Array(l);for(let w=0;w<l-1;w++)g[h[w]]=w;this.logTable=g,this.zero=new Mn(this,Int32Array.from([0])),this.one=new Mn(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(o,l){if(o<0)throw new _;if(l===0)return this.zero;const c=new Int32Array(o+1);return c[0]=l,new Mn(this,c)}inverse(o){if(o===0)throw new Ys;return this.expTable[this.size-this.logTable[o]-1]}multiply(o,l){return o===0||l===0?0:this.expTable[(this.logTable[o]+this.logTable[l])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+R.toHexString(this.primitive)+","+this.size+")"}equals(o){return o===this}}dt.AZTEC_DATA_12=new dt(4201,4096,1),dt.AZTEC_DATA_10=new dt(1033,1024,1),dt.AZTEC_DATA_6=new dt(67,64,1),dt.AZTEC_PARAM=new dt(19,16,1),dt.QR_CODE_FIELD_256=new dt(285,256,0),dt.DATA_MATRIX_FIELD_256=new dt(301,256,1),dt.AZTEC_DATA_8=dt.DATA_MATRIX_FIELD_256,dt.MAXICODE_FIELD_64=dt.AZTEC_DATA_6;class ws extends m{}ws.kind="ReedSolomonException";class _r extends m{}_r.kind="IllegalStateException";class xi{constructor(o){this.field=o}decode(o,l){const c=this.field,h=new Mn(c,o),f=new Int32Array(l);let g=!0;for(let q=0;q<l;q++){const J=h.evaluateAt(c.exp(q+c.getGeneratorBase()));f[f.length-1-q]=J,J!==0&&(g=!1)}if(g)return;const w=new Mn(c,f),v=this.runEuclideanAlgorithm(c.buildMonomial(l,1),w,l),A=v[0],N=v[1],L=this.findErrorLocations(A),V=this.findErrorMagnitudes(N,L);for(let q=0;q<L.length;q++){const J=o.length-1-c.log(L[q]);if(J<0)throw new ws("Bad error location");o[J]=dt.addOrSubtract(o[J],V[q])}}runEuclideanAlgorithm(o,l,c){if(o.getDegree()<l.getDegree()){const q=o;o=l,l=q}const h=this.field;let f=o,g=l,w=h.getZero(),v=h.getOne();for(;g.getDegree()>=(c/2|0);){let q=f,J=w;if(f=g,w=v,f.isZero())throw new ws("r_{i-1} was zero");g=q;let ee=h.getZero();const se=f.getCoefficient(f.getDegree()),ce=h.inverse(se);for(;g.getDegree()>=f.getDegree()&&!g.isZero();){const ve=g.getDegree()-f.getDegree(),Ee=h.multiply(g.getCoefficient(g.getDegree()),ce);ee=ee.addOrSubtract(h.buildMonomial(ve,Ee)),g=g.addOrSubtract(f.multiplyByMonomial(ve,Ee))}if(v=ee.multiply(w).addOrSubtract(J),g.getDegree()>=f.getDegree())throw new _r("Division algorithm failed to reduce polynomial?")}const A=v.getCoefficient(0);if(A===0)throw new ws("sigmaTilde(0) was zero");const N=h.inverse(A),L=v.multiplyScalar(N),V=g.multiplyScalar(N);return[L,V]}findErrorLocations(o){const l=o.getDegree();if(l===1)return Int32Array.from([o.getCoefficient(1)]);const c=new Int32Array(l);let h=0;const f=this.field;for(let g=1;g<f.getSize()&&h<l;g++)o.evaluateAt(g)===0&&(c[h]=f.inverse(g),h++);if(h!==l)throw new ws("Error locator degree does not match number of roots");return c}findErrorMagnitudes(o,l){const c=l.length,h=new Int32Array(c),f=this.field;for(let g=0;g<c;g++){const w=f.inverse(l[g]);let v=1;for(let A=0;A<c;A++)if(g!==A){const N=f.multiply(l[A],w),L=N&1?N&-2:N|1;v=f.multiply(v,L)}h[g]=f.multiply(o.evaluateAt(w),f.inverse(v)),f.getGeneratorBase()!==0&&(h[g]=f.multiply(h[g],w))}return h}}var In;(function(M){M[M.UPPER=0]="UPPER",M[M.LOWER=1]="LOWER",M[M.MIXED=2]="MIXED",M[M.DIGIT=3]="DIGIT",M[M.PUNCT=4]="PUNCT",M[M.BINARY=5]="BINARY"})(In||(In={}));class Dt{decode(o){this.ddata=o;let l=o.getBits(),c=this.extractBits(l),h=this.correctBits(c),f=Dt.convertBoolArrayToByteArray(h),g=Dt.getEncodedData(h),w=new Xs(f,g,null,null);return w.setNumBits(h.length),w}static highLevelDecode(o){return this.getEncodedData(o)}static getEncodedData(o){let l=o.length,c=In.UPPER,h=In.UPPER,f="",g=0;for(;g<l;)if(h===In.BINARY){if(l-g<5)break;let w=Dt.readCode(o,g,5);if(g+=5,w===0){if(l-g<11)break;w=Dt.readCode(o,g,11)+31,g+=11}for(let v=0;v<w;v++){if(l-g<8){g=l;break}const A=Dt.readCode(o,g,8);f+=$.castAsNonUtf8Char(A),g+=8}h=c}else{let w=h===In.DIGIT?4:5;if(l-g<w)break;let v=Dt.readCode(o,g,w);g+=w;let A=Dt.getCharacter(h,v);A.startsWith("CTRL_")?(c=h,h=Dt.getTable(A.charAt(5)),A.charAt(6)==="L"&&(c=h)):(f+=A,h=c)}return f}static getTable(o){switch(o){case"L":return In.LOWER;case"P":return In.PUNCT;case"M":return In.MIXED;case"D":return In.DIGIT;case"B":return In.BINARY;case"U":default:return In.UPPER}}static getCharacter(o,l){switch(o){case In.UPPER:return Dt.UPPER_TABLE[l];case In.LOWER:return Dt.LOWER_TABLE[l];case In.MIXED:return Dt.MIXED_TABLE[l];case In.PUNCT:return Dt.PUNCT_TABLE[l];case In.DIGIT:return Dt.DIGIT_TABLE[l];default:throw new _r("Bad table")}}correctBits(o){let l,c;this.ddata.getNbLayers()<=2?(c=6,l=dt.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(c=8,l=dt.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(c=10,l=dt.AZTEC_DATA_10):(c=12,l=dt.AZTEC_DATA_12);let h=this.ddata.getNbDatablocks(),f=o.length/c;if(f<h)throw new D;let g=o.length%c,w=new Int32Array(f);for(let V=0;V<f;V++,g+=c)w[V]=Dt.readCode(o,g,c);try{new xi(l).decode(w,f-h)}catch(V){throw new D(V)}let v=(1<<c)-1,A=0;for(let V=0;V<h;V++){let q=w[V];if(q===0||q===v)throw new D;(q===1||q===v-1)&&A++}let N=new Array(h*c-A),L=0;for(let V=0;V<h;V++){let q=w[V];if(q===1||q===v-1)N.fill(q>1,L,L+c-1),L+=c-1;else for(let J=c-1;J>=0;--J)N[L++]=(q&1<<J)!==0}return N}extractBits(o){let l=this.ddata.isCompact(),c=this.ddata.getNbLayers(),h=(l?11:14)+c*4,f=new Int32Array(h),g=new Array(this.totalBitsInLayer(c,l));if(l)for(let w=0;w<f.length;w++)f[w]=w;else{let w=h+1+2*R.truncDivision(R.truncDivision(h,2)-1,15),v=h/2,A=R.truncDivision(w,2);for(let N=0;N<v;N++){let L=N+R.truncDivision(N,15);f[v-N-1]=A-L-1,f[v+N]=A+L+1}}for(let w=0,v=0;w<c;w++){let A=(c-w)*4+(l?9:12),N=w*2,L=h-1-N;for(let V=0;V<A;V++){let q=V*2;for(let J=0;J<2;J++)g[v+q+J]=o.get(f[N+J],f[N+V]),g[v+2*A+q+J]=o.get(f[N+V],f[L-J]),g[v+4*A+q+J]=o.get(f[L-J],f[L-V]),g[v+6*A+q+J]=o.get(f[L-V],f[N+J])}v+=A*8}return g}static readCode(o,l,c){let h=0;for(let f=l;f<l+c;f++)h<<=1,o[f]&&(h|=1);return h}static readByte(o,l){let c=o.length-l;return c>=8?Dt.readCode(o,l,8):Dt.readCode(o,l,c)<<8-c}static convertBoolArrayToByteArray(o){let l=new Uint8Array((o.length+7)/8);for(let c=0;c<l.length;c++)l[c]=Dt.readByte(o,8*c);return l}totalBitsInLayer(o,l){return((l?88:112)+16*o)*o}}Dt.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],Dt.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],Dt.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],Dt.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],Dt.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class lt{constructor(){}static round(o){return o===NaN?0:o<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:o>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:o+(o<0?-.5:.5)|0}static distance(o,l,c,h){const f=o-c,g=l-h;return Math.sqrt(f*f+g*g)}static sum(o){let l=0;for(let c=0,h=o.length;c!==h;c++){const f=o[c];l+=f}return l}}class Y{static floatToIntBits(o){return o}}Y.MAX_VALUE=Number.MAX_SAFE_INTEGER;class Z{constructor(o,l){this.x=o,this.y=l}getX(){return this.x}getY(){return this.y}equals(o){if(o instanceof Z){const l=o;return this.x===l.x&&this.y===l.y}return!1}hashCode(){return 31*Y.floatToIntBits(this.x)+Y.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(o){const l=this.distance(o[0],o[1]),c=this.distance(o[1],o[2]),h=this.distance(o[0],o[2]);let f,g,w;if(c>=l&&c>=h?(g=o[0],f=o[1],w=o[2]):h>=c&&h>=l?(g=o[1],f=o[0],w=o[2]):(g=o[2],f=o[0],w=o[1]),this.crossProductZ(f,g,w)<0){const v=f;f=w,w=v}o[0]=f,o[1]=g,o[2]=w}static distance(o,l){return lt.distance(o.x,o.y,l.x,l.y)}static crossProductZ(o,l,c){const h=l.x,f=l.y;return(c.x-h)*(o.y-f)-(c.y-f)*(o.x-h)}}class ue{constructor(o,l){this.bits=o,this.points=l}getBits(){return this.bits}getPoints(){return this.points}}class Ne extends ue{constructor(o,l,c,h,f){super(o,l),this.compact=c,this.nbDatablocks=h,this.nbLayers=f}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class _e{constructor(o,l,c,h){this.image=o,this.height=o.getHeight(),this.width=o.getWidth(),l==null&&(l=_e.INIT_SIZE),c==null&&(c=o.getWidth()/2|0),h==null&&(h=o.getHeight()/2|0);const f=l/2|0;if(this.leftInit=c-f,this.rightInit=c+f,this.upInit=h-f,this.downInit=h+f,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new ie}detect(){let o=this.leftInit,l=this.rightInit,c=this.upInit,h=this.downInit,f=!1,g=!0,w=!1,v=!1,A=!1,N=!1,L=!1;const V=this.width,q=this.height;for(;g;){g=!1;let J=!0;for(;(J||!v)&&l<V;)J=this.containsBlackPoint(c,h,l,!1),J?(l++,g=!0,v=!0):v||l++;if(l>=V){f=!0;break}let ee=!0;for(;(ee||!A)&&h<q;)ee=this.containsBlackPoint(o,l,h,!0),ee?(h++,g=!0,A=!0):A||h++;if(h>=q){f=!0;break}let se=!0;for(;(se||!N)&&o>=0;)se=this.containsBlackPoint(c,h,o,!1),se?(o--,g=!0,N=!0):N||o--;if(o<0){f=!0;break}let ce=!0;for(;(ce||!L)&&c>=0;)ce=this.containsBlackPoint(o,l,c,!0),ce?(c--,g=!0,L=!0):L||c--;if(c<0){f=!0;break}g&&(w=!0)}if(!f&&w){const J=l-o;let ee=null;for(let Ee=1;ee===null&&Ee<J;Ee++)ee=this.getBlackPointOnSegment(o,h-Ee,o+Ee,h);if(ee==null)throw new ie;let se=null;for(let Ee=1;se===null&&Ee<J;Ee++)se=this.getBlackPointOnSegment(o,c+Ee,o+Ee,c);if(se==null)throw new ie;let ce=null;for(let Ee=1;ce===null&&Ee<J;Ee++)ce=this.getBlackPointOnSegment(l,c+Ee,l-Ee,c);if(ce==null)throw new ie;let ve=null;for(let Ee=1;ve===null&&Ee<J;Ee++)ve=this.getBlackPointOnSegment(l,h-Ee,l-Ee,h);if(ve==null)throw new ie;return this.centerEdges(ve,ee,ce,se)}else throw new ie}getBlackPointOnSegment(o,l,c,h){const f=lt.round(lt.distance(o,l,c,h)),g=(c-o)/f,w=(h-l)/f,v=this.image;for(let A=0;A<f;A++){const N=lt.round(o+A*g),L=lt.round(l+A*w);if(v.get(N,L))return new Z(N,L)}return null}centerEdges(o,l,c,h){const f=o.getX(),g=o.getY(),w=l.getX(),v=l.getY(),A=c.getX(),N=c.getY(),L=h.getX(),V=h.getY(),q=_e.CORR;return f<this.width/2?[new Z(L-q,V+q),new Z(w+q,v+q),new Z(A-q,N-q),new Z(f+q,g-q)]:[new Z(L+q,V+q),new Z(w+q,v-q),new Z(A-q,N+q),new Z(f-q,g-q)]}containsBlackPoint(o,l,c,h){const f=this.image;if(h){for(let g=o;g<=l;g++)if(f.get(g,c))return!0}else for(let g=o;g<=l;g++)if(f.get(c,g))return!0;return!1}}_e.INIT_SIZE=10,_e.CORR=1;class xe{static checkAndNudgePoints(o,l){const c=o.getWidth(),h=o.getHeight();let f=!0;for(let g=0;g<l.length&&f;g+=2){const w=Math.floor(l[g]),v=Math.floor(l[g+1]);if(w<-1||w>c||v<-1||v>h)throw new ie;f=!1,w===-1?(l[g]=0,f=!0):w===c&&(l[g]=c-1,f=!0),v===-1?(l[g+1]=0,f=!0):v===h&&(l[g+1]=h-1,f=!0)}f=!0;for(let g=l.length-2;g>=0&&f;g-=2){const w=Math.floor(l[g]),v=Math.floor(l[g+1]);if(w<-1||w>c||v<-1||v>h)throw new ie;f=!1,w===-1?(l[g]=0,f=!0):w===c&&(l[g]=c-1,f=!0),v===-1?(l[g+1]=0,f=!0):v===h&&(l[g+1]=h-1,f=!0)}}}class Pe{constructor(o,l,c,h,f,g,w,v,A){this.a11=o,this.a21=l,this.a31=c,this.a12=h,this.a22=f,this.a32=g,this.a13=w,this.a23=v,this.a33=A}static quadrilateralToQuadrilateral(o,l,c,h,f,g,w,v,A,N,L,V,q,J,ee,se){const ce=Pe.quadrilateralToSquare(o,l,c,h,f,g,w,v);return Pe.squareToQuadrilateral(A,N,L,V,q,J,ee,se).times(ce)}transformPoints(o){const l=o.length,c=this.a11,h=this.a12,f=this.a13,g=this.a21,w=this.a22,v=this.a23,A=this.a31,N=this.a32,L=this.a33;for(let V=0;V<l;V+=2){const q=o[V],J=o[V+1],ee=f*q+v*J+L;o[V]=(c*q+g*J+A)/ee,o[V+1]=(h*q+w*J+N)/ee}}transformPointsWithValues(o,l){const c=this.a11,h=this.a12,f=this.a13,g=this.a21,w=this.a22,v=this.a23,A=this.a31,N=this.a32,L=this.a33,V=o.length;for(let q=0;q<V;q++){const J=o[q],ee=l[q],se=f*J+v*ee+L;o[q]=(c*J+g*ee+A)/se,l[q]=(h*J+w*ee+N)/se}}static squareToQuadrilateral(o,l,c,h,f,g,w,v){const A=o-c+f-w,N=l-h+g-v;if(A===0&&N===0)return new Pe(c-o,f-c,o,h-l,g-h,l,0,0,1);{const L=c-f,V=w-f,q=h-g,J=v-g,ee=L*J-V*q,se=(A*J-V*N)/ee,ce=(L*N-A*q)/ee;return new Pe(c-o+se*c,w-o+ce*w,o,h-l+se*h,v-l+ce*v,l,se,ce,1)}}static quadrilateralToSquare(o,l,c,h,f,g,w,v){return Pe.squareToQuadrilateral(o,l,c,h,f,g,w,v).buildAdjoint()}buildAdjoint(){return new Pe(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(o){return new Pe(this.a11*o.a11+this.a21*o.a12+this.a31*o.a13,this.a11*o.a21+this.a21*o.a22+this.a31*o.a23,this.a11*o.a31+this.a21*o.a32+this.a31*o.a33,this.a12*o.a11+this.a22*o.a12+this.a32*o.a13,this.a12*o.a21+this.a22*o.a22+this.a32*o.a23,this.a12*o.a31+this.a22*o.a32+this.a32*o.a33,this.a13*o.a11+this.a23*o.a12+this.a33*o.a13,this.a13*o.a21+this.a23*o.a22+this.a33*o.a23,this.a13*o.a31+this.a23*o.a32+this.a33*o.a33)}}class Qe extends xe{sampleGrid(o,l,c,h,f,g,w,v,A,N,L,V,q,J,ee,se,ce,ve,Ee){const pe=Pe.quadrilateralToQuadrilateral(h,f,g,w,v,A,N,L,V,q,J,ee,se,ce,ve,Ee);return this.sampleGridWithTransform(o,l,c,pe)}sampleGridWithTransform(o,l,c,h){if(l<=0||c<=0)throw new ie;const f=new Te(l,c),g=new Float32Array(2*l);for(let w=0;w<c;w++){const v=g.length,A=w+.5;for(let N=0;N<v;N+=2)g[N]=N/2+.5,g[N+1]=A;h.transformPoints(g),xe.checkAndNudgePoints(o,g);try{for(let N=0;N<v;N+=2)o.get(Math.floor(g[N]),Math.floor(g[N+1]))&&f.set(N/2,w)}catch{throw new ie}}return f}}class He{static setGridSampler(o){He.gridSampler=o}static getInstance(){return He.gridSampler}}He.gridSampler=new Qe;class Ct{constructor(o,l){this.x=o,this.y=l}toResultPoint(){return new Z(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class wi{constructor(o){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=o}detect(){return this.detectMirror(!1)}detectMirror(o){let l=this.getMatrixCenter(),c=this.getBullsEyeCorners(l);if(o){let g=c[0];c[0]=c[2],c[2]=g}this.extractParameters(c);let h=this.sampleGrid(this.image,c[this.shift%4],c[(this.shift+1)%4],c[(this.shift+2)%4],c[(this.shift+3)%4]),f=this.getMatrixCornerPoints(c);return new Ne(h,f,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(o){if(!this.isValidPoint(o[0])||!this.isValidPoint(o[1])||!this.isValidPoint(o[2])||!this.isValidPoint(o[3]))throw new ie;let l=2*this.nbCenterLayers,c=new Int32Array([this.sampleLine(o[0],o[1],l),this.sampleLine(o[1],o[2],l),this.sampleLine(o[2],o[3],l),this.sampleLine(o[3],o[0],l)]);this.shift=this.getRotation(c,l);let h=0;for(let g=0;g<4;g++){let w=c[(this.shift+g)%4];this.compact?(h<<=7,h+=w>>1&127):(h<<=10,h+=(w>>2&992)+(w>>1&31))}let f=this.getCorrectedParameterData(h,this.compact);this.compact?(this.nbLayers=(f>>6)+1,this.nbDataBlocks=(f&63)+1):(this.nbLayers=(f>>11)+1,this.nbDataBlocks=(f&2047)+1)}getRotation(o,l){let c=0;o.forEach((h,f,g)=>{let w=(h>>l-2<<1)+(h&1);c=(c<<3)+w}),c=((c&1)<<11)+(c>>1);for(let h=0;h<4;h++)if(R.bitCount(c^this.EXPECTED_CORNER_BITS[h])<=2)return h;throw new ie}getCorrectedParameterData(o,l){let c,h;l?(c=7,h=2):(c=10,h=4);let f=c-h,g=new Int32Array(c);for(let v=c-1;v>=0;--v)g[v]=o&15,o>>=4;try{new xi(dt.AZTEC_PARAM).decode(g,f)}catch{throw new ie}let w=0;for(let v=0;v<h;v++)w=(w<<4)+g[v];return w}getBullsEyeCorners(o){let l=o,c=o,h=o,f=o,g=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let L=this.getFirstDifferent(l,g,1,-1),V=this.getFirstDifferent(c,g,1,1),q=this.getFirstDifferent(h,g,-1,1),J=this.getFirstDifferent(f,g,-1,-1);if(this.nbCenterLayers>2){let ee=this.distancePoint(J,L)*this.nbCenterLayers/(this.distancePoint(f,l)*(this.nbCenterLayers+2));if(ee<.75||ee>1.25||!this.isWhiteOrBlackRectangle(L,V,q,J))break}l=L,c=V,h=q,f=J,g=!g}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new ie;this.compact=this.nbCenterLayers===5;let w=new Z(l.getX()+.5,l.getY()-.5),v=new Z(c.getX()+.5,c.getY()+.5),A=new Z(h.getX()-.5,h.getY()+.5),N=new Z(f.getX()-.5,f.getY()-.5);return this.expandSquare([w,v,A,N],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let o,l,c,h;try{let w=new _e(this.image).detect();o=w[0],l=w[1],c=w[2],h=w[3]}catch{let v=this.image.getWidth()/2,A=this.image.getHeight()/2;o=this.getFirstDifferent(new Ct(v+7,A-7),!1,1,-1).toResultPoint(),l=this.getFirstDifferent(new Ct(v+7,A+7),!1,1,1).toResultPoint(),c=this.getFirstDifferent(new Ct(v-7,A+7),!1,-1,1).toResultPoint(),h=this.getFirstDifferent(new Ct(v-7,A-7),!1,-1,-1).toResultPoint()}let f=lt.round((o.getX()+h.getX()+l.getX()+c.getX())/4),g=lt.round((o.getY()+h.getY()+l.getY()+c.getY())/4);try{let w=new _e(this.image,15,f,g).detect();o=w[0],l=w[1],c=w[2],h=w[3]}catch{o=this.getFirstDifferent(new Ct(f+7,g-7),!1,1,-1).toResultPoint(),l=this.getFirstDifferent(new Ct(f+7,g+7),!1,1,1).toResultPoint(),c=this.getFirstDifferent(new Ct(f-7,g+7),!1,-1,1).toResultPoint(),h=this.getFirstDifferent(new Ct(f-7,g-7),!1,-1,-1).toResultPoint()}return f=lt.round((o.getX()+h.getX()+l.getX()+c.getX())/4),g=lt.round((o.getY()+h.getY()+l.getY()+c.getY())/4),new Ct(f,g)}getMatrixCornerPoints(o){return this.expandSquare(o,2*this.nbCenterLayers,this.getDimension())}sampleGrid(o,l,c,h,f){let g=He.getInstance(),w=this.getDimension(),v=w/2-this.nbCenterLayers,A=w/2+this.nbCenterLayers;return g.sampleGrid(o,w,w,v,v,A,v,A,A,v,A,l.getX(),l.getY(),c.getX(),c.getY(),h.getX(),h.getY(),f.getX(),f.getY())}sampleLine(o,l,c){let h=0,f=this.distanceResultPoint(o,l),g=f/c,w=o.getX(),v=o.getY(),A=g*(l.getX()-o.getX())/f,N=g*(l.getY()-o.getY())/f;for(let L=0;L<c;L++)this.image.get(lt.round(w+L*A),lt.round(v+L*N))&&(h|=1<<c-L-1);return h}isWhiteOrBlackRectangle(o,l,c,h){let f=3;o=new Ct(o.getX()-f,o.getY()+f),l=new Ct(l.getX()-f,l.getY()-f),c=new Ct(c.getX()+f,c.getY()-f),h=new Ct(h.getX()+f,h.getY()+f);let g=this.getColor(h,o);if(g===0)return!1;let w=this.getColor(o,l);return w!==g||(w=this.getColor(l,c),w!==g)?!1:(w=this.getColor(c,h),w===g)}getColor(o,l){let c=this.distancePoint(o,l),h=(l.getX()-o.getX())/c,f=(l.getY()-o.getY())/c,g=0,w=o.getX(),v=o.getY(),A=this.image.get(o.getX(),o.getY()),N=Math.ceil(c);for(let V=0;V<N;V++)w+=h,v+=f,this.image.get(lt.round(w),lt.round(v))!==A&&g++;let L=g/c;return L>.1&&L<.9?0:L<=.1===A?1:-1}getFirstDifferent(o,l,c,h){let f=o.getX()+c,g=o.getY()+h;for(;this.isValid(f,g)&&this.image.get(f,g)===l;)f+=c,g+=h;for(f-=c,g-=h;this.isValid(f,g)&&this.image.get(f,g)===l;)f+=c;for(f-=c;this.isValid(f,g)&&this.image.get(f,g)===l;)g+=h;return g-=h,new Ct(f,g)}expandSquare(o,l,c){let h=c/(2*l),f=o[0].getX()-o[2].getX(),g=o[0].getY()-o[2].getY(),w=(o[0].getX()+o[2].getX())/2,v=(o[0].getY()+o[2].getY())/2,A=new Z(w+h*f,v+h*g),N=new Z(w-h*f,v-h*g);f=o[1].getX()-o[3].getX(),g=o[1].getY()-o[3].getY(),w=(o[1].getX()+o[3].getX())/2,v=(o[1].getY()+o[3].getY())/2;let L=new Z(w+h*f,v+h*g),V=new Z(w-h*f,v-h*g);return[A,L,N,V]}isValid(o,l){return o>=0&&o<this.image.getWidth()&&l>0&&l<this.image.getHeight()}isValidPoint(o){let l=lt.round(o.getX()),c=lt.round(o.getY());return this.isValid(l,c)}distancePoint(o,l){return lt.distance(o.getX(),o.getY(),l.getX(),l.getY())}distanceResultPoint(o,l){return lt.distance(o.getX(),o.getY(),l.getX(),l.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(R.truncDivision(this.nbLayers-4,8)+1)+15}}class kr{decode(o,l=null){let c=null,h=new wi(o.getBlackMatrix()),f=null,g=null;try{let N=h.detectMirror(!1);f=N.getPoints(),this.reportFoundResultPoints(l,f),g=new Dt().decode(N)}catch(N){c=N}if(g==null)try{let N=h.detectMirror(!0);f=N.getPoints(),this.reportFoundResultPoints(l,f),g=new Dt().decode(N)}catch(N){throw c??N}let w=new zt(g.getText(),g.getRawBytes(),g.getNumBits(),f,Fe.AZTEC,S.currentTimeMillis()),v=g.getByteSegments();v!=null&&w.putMetadata(pn.BYTE_SEGMENTS,v);let A=g.getECLevel();return A!=null&&w.putMetadata(pn.ERROR_CORRECTION_LEVEL,A),w}reportFoundResultPoints(o,l){if(o!=null){let c=o.get(Q.NEED_RESULT_POINT_CALLBACK);c!=null&&l.forEach((h,f,g)=>{c.foundPossibleResultPoint(h)})}}reset(){}}class Ah extends _t{constructor(o=500){super(new kr,o)}}class kt{decode(o,l){try{return this.doDecode(o,l)}catch{if(l&&l.get(Q.TRY_HARDER)===!0&&o.isRotateSupported()){const f=o.rotateCounterClockwise(),g=this.doDecode(f,l),w=g.getResultMetadata();let v=270;w!==null&&w.get(pn.ORIENTATION)===!0&&(v=v+w.get(pn.ORIENTATION)%360),g.putMetadata(pn.ORIENTATION,v);const A=g.getResultPoints();if(A!==null){const N=f.getHeight();for(let L=0;L<A.length;L++)A[L]=new Z(N-A[L].getY()-1,A[L].getX())}return g}else throw new ie}}reset(){}doDecode(o,l){const c=o.getWidth(),h=o.getHeight();let f=new j(c);const g=l&&l.get(Q.TRY_HARDER)===!0,w=Math.max(1,h>>(g?8:5));let v;g?v=h:v=15;const A=Math.trunc(h/2);for(let N=0;N<v;N++){const L=Math.trunc((N+1)/2),V=(N&1)===0,q=A+w*(V?L:-L);if(q<0||q>=h)break;try{f=o.getBlackRow(q,f)}catch{continue}for(let J=0;J<2;J++){if(J===1&&(f.reverse(),l&&l.get(Q.NEED_RESULT_POINT_CALLBACK)===!0)){const ee=new Map;l.forEach((se,ce)=>ee.set(ce,se)),ee.delete(Q.NEED_RESULT_POINT_CALLBACK),l=ee}try{const ee=this.decodeRow(q,f,l);if(J===1){ee.putMetadata(pn.ORIENTATION,180);const se=ee.getResultPoints();se!==null&&(se[0]=new Z(c-se[0].getX()-1,se[0].getY()),se[1]=new Z(c-se[1].getX()-1,se[1].getY()))}return ee}catch{}}}throw new ie}static recordPattern(o,l,c){const h=c.length;for(let A=0;A<h;A++)c[A]=0;const f=o.getSize();if(l>=f)throw new ie;let g=!o.get(l),w=0,v=l;for(;v<f;){if(o.get(v)!==g)c[w]++;else{if(++w===h)break;c[w]=1,g=!g}v++}if(!(w===h||w===h-1&&v===f))throw new ie}static recordPatternInReverse(o,l,c){let h=c.length,f=o.get(l);for(;l>0&&h>=0;)o.get(--l)!==f&&(h--,f=!f);if(h>=0)throw new ie;kt.recordPattern(o,l+1,c)}static patternMatchVariance(o,l,c){const h=o.length;let f=0,g=0;for(let A=0;A<h;A++)f+=o[A],g+=l[A];if(f<g)return Number.POSITIVE_INFINITY;const w=f/g;c*=w;let v=0;for(let A=0;A<h;A++){const N=o[A],L=l[A]*w,V=N>L?N-L:L-N;if(V>c)return Number.POSITIVE_INFINITY;v+=V}return v/f}}class Ae extends kt{static findStartPattern(o){const l=o.getSize(),c=o.getNextSet(0);let h=0,f=Int32Array.from([0,0,0,0,0,0]),g=c,w=!1;const v=6;for(let A=c;A<l;A++)if(o.get(A)!==w)f[h]++;else{if(h===v-1){let N=Ae.MAX_AVG_VARIANCE,L=-1;for(let V=Ae.CODE_START_A;V<=Ae.CODE_START_C;V++){const q=kt.patternMatchVariance(f,Ae.CODE_PATTERNS[V],Ae.MAX_INDIVIDUAL_VARIANCE);q<N&&(N=q,L=V)}if(L>=0&&o.isRange(Math.max(0,g-(A-g)/2),g,!1))return Int32Array.from([g,A,L]);g+=f[0]+f[1],f=f.slice(2,f.length-1),f[h-1]=0,f[h]=0,h--}else h++;f[h]=1,w=!w}throw new ie}static decodeCode(o,l,c){kt.recordPattern(o,c,l);let h=Ae.MAX_AVG_VARIANCE,f=-1;for(let g=0;g<Ae.CODE_PATTERNS.length;g++){const w=Ae.CODE_PATTERNS[g],v=this.patternMatchVariance(l,w,Ae.MAX_INDIVIDUAL_VARIANCE);v<h&&(h=v,f=g)}if(f>=0)return f;throw new ie}decodeRow(o,l,c){const h=c&&c.get(Q.ASSUME_GS1)===!0,f=Ae.findStartPattern(l),g=f[2];let w=0;const v=new Uint8Array(20);v[w++]=g;let A;switch(g){case Ae.CODE_START_A:A=Ae.CODE_CODE_A;break;case Ae.CODE_START_B:A=Ae.CODE_CODE_B;break;case Ae.CODE_START_C:A=Ae.CODE_CODE_C;break;default:throw new D}let N=!1,L=!1,V="",q=f[0],J=f[1];const ee=Int32Array.from([0,0,0,0,0,0]);let se=0,ce=0,ve=g,Ee=0,pe=!0,gt=!1,rt=!1;for(;!N;){const Lc=L;switch(L=!1,se=ce,ce=Ae.decodeCode(l,ee,J),v[w++]=ce,ce!==Ae.CODE_STOP&&(pe=!0),ce!==Ae.CODE_STOP&&(Ee++,ve+=Ee*ce),q=J,J+=ee.reduce((nP,rP)=>nP+rP,0),ce){case Ae.CODE_START_A:case Ae.CODE_START_B:case Ae.CODE_START_C:throw new D}switch(A){case Ae.CODE_CODE_A:if(ce<64)rt===gt?V+=String.fromCharCode(" ".charCodeAt(0)+ce):V+=String.fromCharCode(" ".charCodeAt(0)+ce+128),rt=!1;else if(ce<96)rt===gt?V+=String.fromCharCode(ce-64):V+=String.fromCharCode(ce+64),rt=!1;else switch(ce!==Ae.CODE_STOP&&(pe=!1),ce){case Ae.CODE_FNC_1:h&&(V.length===0?V+="]C1":V+=String.fromCharCode(29));break;case Ae.CODE_FNC_2:case Ae.CODE_FNC_3:break;case Ae.CODE_FNC_4_A:!gt&&rt?(gt=!0,rt=!1):gt&&rt?(gt=!1,rt=!1):rt=!0;break;case Ae.CODE_SHIFT:L=!0,A=Ae.CODE_CODE_B;break;case Ae.CODE_CODE_B:A=Ae.CODE_CODE_B;break;case Ae.CODE_CODE_C:A=Ae.CODE_CODE_C;break;case Ae.CODE_STOP:N=!0;break}break;case Ae.CODE_CODE_B:if(ce<96)rt===gt?V+=String.fromCharCode(" ".charCodeAt(0)+ce):V+=String.fromCharCode(" ".charCodeAt(0)+ce+128),rt=!1;else switch(ce!==Ae.CODE_STOP&&(pe=!1),ce){case Ae.CODE_FNC_1:h&&(V.length===0?V+="]C1":V+=String.fromCharCode(29));break;case Ae.CODE_FNC_2:case Ae.CODE_FNC_3:break;case Ae.CODE_FNC_4_B:!gt&&rt?(gt=!0,rt=!1):gt&&rt?(gt=!1,rt=!1):rt=!0;break;case Ae.CODE_SHIFT:L=!0,A=Ae.CODE_CODE_A;break;case Ae.CODE_CODE_A:A=Ae.CODE_CODE_A;break;case Ae.CODE_CODE_C:A=Ae.CODE_CODE_C;break;case Ae.CODE_STOP:N=!0;break}break;case Ae.CODE_CODE_C:if(ce<100)ce<10&&(V+="0"),V+=ce;else switch(ce!==Ae.CODE_STOP&&(pe=!1),ce){case Ae.CODE_FNC_1:h&&(V.length===0?V+="]C1":V+=String.fromCharCode(29));break;case Ae.CODE_CODE_A:A=Ae.CODE_CODE_A;break;case Ae.CODE_CODE_B:A=Ae.CODE_CODE_B;break;case Ae.CODE_STOP:N=!0;break}break}Lc&&(A=A===Ae.CODE_CODE_A?Ae.CODE_CODE_B:Ae.CODE_CODE_A)}const ls=J-q;if(J=l.getNextUnset(J),!l.isRange(J,Math.min(l.getSize(),J+(J-q)/2),!1))throw new ie;if(ve-=Ee*se,ve%103!==se)throw new b;const ii=V.length;if(ii===0)throw new ie;ii>0&&pe&&(A===Ae.CODE_CODE_C?V=V.substring(0,ii-2):V=V.substring(0,ii-1));const cs=(f[1]+f[0])/2,Wt=q+ls/2,Ar=v.length,As=new Uint8Array(Ar);for(let Lc=0;Lc<Ar;Lc++)As[Lc]=v[Lc];const Mc=[new Z(cs,o),new Z(Wt,o)];return new zt(V,As,0,Mc,Fe.CODE_128,new Date().getTime())}}Ae.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],Ae.MAX_AVG_VARIANCE=.25,Ae.MAX_INDIVIDUAL_VARIANCE=.7,Ae.CODE_SHIFT=98,Ae.CODE_CODE_C=99,Ae.CODE_CODE_B=100,Ae.CODE_CODE_A=101,Ae.CODE_FNC_1=102,Ae.CODE_FNC_2=97,Ae.CODE_FNC_3=96,Ae.CODE_FNC_4_A=101,Ae.CODE_FNC_4_B=100,Ae.CODE_START_A=103,Ae.CODE_START_B=104,Ae.CODE_START_C=105,Ae.CODE_STOP=106;class ln extends kt{constructor(o=!1,l=!1){super(),this.usingCheckDigit=o,this.extendedMode=l,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(o,l,c){let h=this.counters;h.fill(0),this.decodeRowResult="";let f=ln.findAsteriskPattern(l,h),g=l.getNextSet(f[1]),w=l.getSize(),v,A;do{ln.recordPattern(l,g,h);let ee=ln.toNarrowWidePattern(h);if(ee<0)throw new ie;v=ln.patternToChar(ee),this.decodeRowResult+=v,A=g;for(let se of h)g+=se;g=l.getNextSet(g)}while(v!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let N=0;for(let ee of h)N+=ee;let L=g-A-N;if(g!==w&&L*2<N)throw new ie;if(this.usingCheckDigit){let ee=this.decodeRowResult.length-1,se=0;for(let ce=0;ce<ee;ce++)se+=ln.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(ce));if(this.decodeRowResult.charAt(ee)!==ln.ALPHABET_STRING.charAt(se%43))throw new b;this.decodeRowResult=this.decodeRowResult.substring(0,ee)}if(this.decodeRowResult.length===0)throw new ie;let V;this.extendedMode?V=ln.decodeExtended(this.decodeRowResult):V=this.decodeRowResult;let q=(f[1]+f[0])/2,J=A+N/2;return new zt(V,null,0,[new Z(q,o),new Z(J,o)],Fe.CODE_39,new Date().getTime())}static findAsteriskPattern(o,l){let c=o.getSize(),h=o.getNextSet(0),f=0,g=h,w=!1,v=l.length;for(let A=h;A<c;A++)if(o.get(A)!==w)l[f]++;else{if(f===v-1){if(this.toNarrowWidePattern(l)===ln.ASTERISK_ENCODING&&o.isRange(Math.max(0,g-Math.floor((A-g)/2)),g,!1))return[g,A];g+=l[0]+l[1],l.copyWithin(0,2,2+f-1),l[f-1]=0,l[f]=0,f--}else f++;l[f]=1,w=!w}throw new ie}static toNarrowWidePattern(o){let l=o.length,c=0,h;do{let f=2147483647;for(let v of o)v<f&&v>c&&(f=v);c=f,h=0;let g=0,w=0;for(let v=0;v<l;v++){let A=o[v];A>c&&(w|=1<<l-1-v,h++,g+=A)}if(h===3){for(let v=0;v<l&&h>0;v++){let A=o[v];if(A>c&&(h--,A*2>=g))return-1}return w}}while(h>3);return-1}static patternToChar(o){for(let l=0;l<ln.CHARACTER_ENCODINGS.length;l++)if(ln.CHARACTER_ENCODINGS[l]===o)return ln.ALPHABET_STRING.charAt(l);if(o===ln.ASTERISK_ENCODING)return"*";throw new ie}static decodeExtended(o){let l=o.length,c="";for(let h=0;h<l;h++){let f=o.charAt(h);if(f==="+"||f==="$"||f==="%"||f==="/"){let g=o.charAt(h+1),w="\0";switch(f){case"+":if(g>="A"&&g<="Z")w=String.fromCharCode(g.charCodeAt(0)+32);else throw new D;break;case"$":if(g>="A"&&g<="Z")w=String.fromCharCode(g.charCodeAt(0)-64);else throw new D;break;case"%":if(g>="A"&&g<="E")w=String.fromCharCode(g.charCodeAt(0)-38);else if(g>="F"&&g<="J")w=String.fromCharCode(g.charCodeAt(0)-11);else if(g>="K"&&g<="O")w=String.fromCharCode(g.charCodeAt(0)+16);else if(g>="P"&&g<="T")w=String.fromCharCode(g.charCodeAt(0)+43);else if(g==="U")w="\0";else if(g==="V")w="@";else if(g==="W")w="`";else if(g==="X"||g==="Y"||g==="Z")w="";else throw new D;break;case"/":if(g>="A"&&g<="O")w=String.fromCharCode(g.charCodeAt(0)-32);else if(g==="Z")w=":";else throw new D;break}c+=w,h++}else c+=f}return c}}ln.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",ln.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],ln.ASTERISK_ENCODING=148;class vt extends kt{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(o,l,c){let h=this.decodeStart(l),f=this.decodeEnd(l),g=new z;vt.decodeMiddle(l,h[1],f[0],g);let w=g.toString(),v=null;c!=null&&(v=c.get(Q.ALLOWED_LENGTHS)),v==null&&(v=vt.DEFAULT_ALLOWED_LENGTHS);let A=w.length,N=!1,L=0;for(let J of v){if(A===J){N=!0;break}J>L&&(L=J)}if(!N&&A>L&&(N=!0),!N)throw new D;const V=[new Z(h[1],o),new Z(f[0],o)];return new zt(w,null,0,V,Fe.ITF,new Date().getTime())}static decodeMiddle(o,l,c,h){let f=new Int32Array(10),g=new Int32Array(5),w=new Int32Array(5);for(f.fill(0),g.fill(0),w.fill(0);l<c;){kt.recordPattern(o,l,f);for(let A=0;A<5;A++){let N=2*A;g[A]=f[N],w[A]=f[N+1]}let v=vt.decodeDigit(g);h.append(v.toString()),v=this.decodeDigit(w),h.append(v.toString()),f.forEach(function(A){l+=A})}}decodeStart(o){let l=vt.skipWhiteSpace(o),c=vt.findGuardPattern(o,l,vt.START_PATTERN);return this.narrowLineWidth=(c[1]-c[0])/4,this.validateQuietZone(o,c[0]),c}validateQuietZone(o,l){let c=this.narrowLineWidth*10;c=c<l?c:l;for(let h=l-1;c>0&&h>=0&&!o.get(h);h--)c--;if(c!==0)throw new ie}static skipWhiteSpace(o){const l=o.getSize(),c=o.getNextSet(0);if(c===l)throw new ie;return c}decodeEnd(o){o.reverse();try{let l=vt.skipWhiteSpace(o),c;try{c=vt.findGuardPattern(o,l,vt.END_PATTERN_REVERSED[0])}catch(f){f instanceof ie&&(c=vt.findGuardPattern(o,l,vt.END_PATTERN_REVERSED[1]))}this.validateQuietZone(o,c[0]);let h=c[0];return c[0]=o.getSize()-c[1],c[1]=o.getSize()-h,c}finally{o.reverse()}}static findGuardPattern(o,l,c){let h=c.length,f=new Int32Array(h),g=o.getSize(),w=!1,v=0,A=l;f.fill(0);for(let N=l;N<g;N++)if(o.get(N)!==w)f[v]++;else{if(v===h-1){if(kt.patternMatchVariance(f,c,vt.MAX_INDIVIDUAL_VARIANCE)<vt.MAX_AVG_VARIANCE)return[A,N];A+=f[0]+f[1],S.arraycopy(f,2,f,0,v-1),f[v-1]=0,f[v]=0,v--}else v++;f[v]=1,w=!w}throw new ie}static decodeDigit(o){let l=vt.MAX_AVG_VARIANCE,c=-1,h=vt.PATTERNS.length;for(let f=0;f<h;f++){let g=vt.PATTERNS[f],w=kt.patternMatchVariance(o,g,vt.MAX_INDIVIDUAL_VARIANCE);w<l?(l=w,c=f):w===l&&(c=-1)}if(c>=0)return c%10;throw new ie}}vt.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],vt.MAX_AVG_VARIANCE=.38,vt.MAX_INDIVIDUAL_VARIANCE=.5,vt.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],vt.START_PATTERN=Int32Array.from([1,1,1,1]),vt.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Kt extends kt{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(o){let l=!1,c,h=0,f=Int32Array.from([0,0,0]);for(;!l;){f=Int32Array.from([0,0,0]),c=Kt.findGuardPattern(o,h,!1,this.START_END_PATTERN,f);let g=c[0];h=c[1];let w=g-(h-g);w>=0&&(l=o.isRange(w,g,!1))}return c}static checkChecksum(o){return Kt.checkStandardUPCEANChecksum(o)}static checkStandardUPCEANChecksum(o){let l=o.length;if(l===0)return!1;let c=parseInt(o.charAt(l-1),10);return Kt.getStandardUPCEANChecksum(o.substring(0,l-1))===c}static getStandardUPCEANChecksum(o){let l=o.length,c=0;for(let h=l-1;h>=0;h-=2){let f=o.charAt(h).charCodeAt(0)-"0".charCodeAt(0);if(f<0||f>9)throw new D;c+=f}c*=3;for(let h=l-2;h>=0;h-=2){let f=o.charAt(h).charCodeAt(0)-"0".charCodeAt(0);if(f<0||f>9)throw new D;c+=f}return(1e3-c)%10}static decodeEnd(o,l){return Kt.findGuardPattern(o,l,!1,Kt.START_END_PATTERN,new Int32Array(Kt.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(o,l,c,h){return this.findGuardPattern(o,l,c,h,new Int32Array(h.length))}static findGuardPattern(o,l,c,h,f){let g=o.getSize();l=c?o.getNextUnset(l):o.getNextSet(l);let w=0,v=l,A=h.length,N=c;for(let L=l;L<g;L++)if(o.get(L)!==N)f[w]++;else{if(w===A-1){if(kt.patternMatchVariance(f,h,Kt.MAX_INDIVIDUAL_VARIANCE)<Kt.MAX_AVG_VARIANCE)return Int32Array.from([v,L]);v+=f[0]+f[1];let V=f.slice(2,f.length-1);for(let q=0;q<w-1;q++)f[q]=V[q];f[w-1]=0,f[w]=0,w--}else w++;f[w]=1,N=!N}throw new ie}static decodeDigit(o,l,c,h){this.recordPattern(o,c,l);let f=this.MAX_AVG_VARIANCE,g=-1,w=h.length;for(let v=0;v<w;v++){let A=h[v],N=kt.patternMatchVariance(l,A,Kt.MAX_INDIVIDUAL_VARIANCE);N<f&&(f=N,g=v)}if(g>=0)return g;throw new ie}}Kt.MAX_AVG_VARIANCE=.48,Kt.MAX_INDIVIDUAL_VARIANCE=.7,Kt.START_END_PATTERN=Int32Array.from([1,1,1]),Kt.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Kt.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Kt.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class _i{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(o,l,c){let h=this.decodeRowStringBuffer,f=this.decodeMiddle(l,c,h),g=h.toString(),w=_i.parseExtensionString(g),v=[new Z((c[0]+c[1])/2,o),new Z(f,o)],A=new zt(g,null,0,v,Fe.UPC_EAN_EXTENSION,new Date().getTime());return w!=null&&A.putAllMetadata(w),A}decodeMiddle(o,l,c){let h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let f=o.getSize(),g=l[1],w=0;for(let A=0;A<5&&g<f;A++){let N=Kt.decodeDigit(o,h,g,Kt.L_AND_G_PATTERNS);c+=String.fromCharCode("0".charCodeAt(0)+N%10);for(let L of h)g+=L;N>=10&&(w|=1<<4-A),A!==4&&(g=o.getNextSet(g),g=o.getNextUnset(g))}if(c.length!==5)throw new ie;let v=this.determineCheckDigit(w);if(_i.extensionChecksum(c.toString())!==v)throw new ie;return g}static extensionChecksum(o){let l=o.length,c=0;for(let h=l-2;h>=0;h-=2)c+=o.charAt(h).charCodeAt(0)-"0".charCodeAt(0);c*=3;for(let h=l-1;h>=0;h-=2)c+=o.charAt(h).charCodeAt(0)-"0".charCodeAt(0);return c*=3,c%10}determineCheckDigit(o){for(let l=0;l<10;l++)if(o===this.CHECK_DIGIT_ENCODINGS[l])return l;throw new ie}static parseExtensionString(o){if(o.length!==5)return null;let l=_i.parseExtension5String(o);return l==null?null:new Map([[pn.SUGGESTED_PRICE,l]])}static parseExtension5String(o){let l;switch(o.charAt(0)){case"0":l="";break;case"5":l="$";break;case"9":switch(o){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}l="";break;default:l="";break}let c=parseInt(o.substring(1)),h=(c/100).toString(),f=c%100,g=f<10?"0"+f:f.toString();return l+h+"."+g}}class hl{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(o,l,c){let h=this.decodeRowStringBuffer,f=this.decodeMiddle(l,c,h),g=h.toString(),w=hl.parseExtensionString(g),v=[new Z((c[0]+c[1])/2,o),new Z(f,o)],A=new zt(g,null,0,v,Fe.UPC_EAN_EXTENSION,new Date().getTime());return w!=null&&A.putAllMetadata(w),A}decodeMiddle(o,l,c){let h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let f=o.getSize(),g=l[1],w=0;for(let v=0;v<2&&g<f;v++){let A=Kt.decodeDigit(o,h,g,Kt.L_AND_G_PATTERNS);c+=String.fromCharCode("0".charCodeAt(0)+A%10);for(let N of h)g+=N;A>=10&&(w|=1<<1-v),v!==1&&(g=o.getNextSet(g),g=o.getNextUnset(g))}if(c.length!==2)throw new ie;if(parseInt(c.toString())%4!==w)throw new ie;return g}static parseExtensionString(o){return o.length!==2?null:new Map([[pn.ISSUE_NUMBER,parseInt(o)]])}}class bh{static decodeRow(o,l,c){let h=Kt.findGuardPattern(l,c,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new _i().decodeRow(o,l,h)}catch{return new hl().decodeRow(o,l,h)}}}bh.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Et extends Kt{constructor(){super(),this.decodeRowStringBuffer="",Et.L_AND_G_PATTERNS=Et.L_PATTERNS.map(o=>Int32Array.from(o));for(let o=10;o<20;o++){let l=Et.L_PATTERNS[o-10],c=new Int32Array(l.length);for(let h=0;h<l.length;h++)c[h]=l[l.length-h-1];Et.L_AND_G_PATTERNS[o]=c}}decodeRow(o,l,c){let h=Et.findStartGuardPattern(l),f=c==null?null:c.get(Q.NEED_RESULT_POINT_CALLBACK);if(f!=null){const pe=new Z((h[0]+h[1])/2,o);f.foundPossibleResultPoint(pe)}let g=this.decodeMiddle(l,h,this.decodeRowStringBuffer),w=g.rowOffset,v=g.resultString;if(f!=null){const pe=new Z(w,o);f.foundPossibleResultPoint(pe)}let A=this.decodeEnd(l,w);if(f!=null){const pe=new Z((A[0]+A[1])/2,o);f.foundPossibleResultPoint(pe)}let N=A[1],L=N+(N-A[0]);if(L>=l.getSize()||!l.isRange(N,L,!1))throw new ie;let V=v.toString();if(V.length<8)throw new D;if(!Et.checkChecksum(V))throw new b;let q=(h[1]+h[0])/2,J=(A[1]+A[0])/2,ee=this.getBarcodeFormat(),se=[new Z(q,o),new Z(J,o)],ce=new zt(V,null,0,se,ee,new Date().getTime()),ve=0;try{let pe=bh.decodeRow(o,l,A[1]);ce.putMetadata(pn.UPC_EAN_EXTENSION,pe.getText()),ce.putAllMetadata(pe.getResultMetadata()),ce.addResultPoints(pe.getResultPoints()),ve=pe.getText().length}catch{}let Ee=c==null?null:c.get(Q.ALLOWED_EAN_EXTENSIONS);if(Ee!=null){let pe=!1;for(let gt in Ee)if(ve.toString()===gt){pe=!0;break}if(!pe)throw new ie}return ce}decodeEnd(o,l){return Et.findGuardPattern(o,l,!1,Et.START_END_PATTERN,new Int32Array(Et.START_END_PATTERN.length).fill(0))}static checkChecksum(o){return Et.checkStandardUPCEANChecksum(o)}static checkStandardUPCEANChecksum(o){let l=o.length;if(l===0)return!1;let c=parseInt(o.charAt(l-1),10);return Et.getStandardUPCEANChecksum(o.substring(0,l-1))===c}static getStandardUPCEANChecksum(o){let l=o.length,c=0;for(let h=l-1;h>=0;h-=2){let f=o.charAt(h).charCodeAt(0)-"0".charCodeAt(0);if(f<0||f>9)throw new D;c+=f}c*=3;for(let h=l-2;h>=0;h-=2){let f=o.charAt(h).charCodeAt(0)-"0".charCodeAt(0);if(f<0||f>9)throw new D;c+=f}return(1e3-c)%10}}class _s extends Et{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(o,l,c){let h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let f=o.getSize(),g=l[1],w=0;for(let A=0;A<6&&g<f;A++){let N=Et.decodeDigit(o,h,g,Et.L_AND_G_PATTERNS);c+=String.fromCharCode("0".charCodeAt(0)+N%10);for(let L of h)g+=L;N>=10&&(w|=1<<5-A)}c=_s.determineFirstDigit(c,w),g=Et.findGuardPattern(o,g,!0,Et.MIDDLE_PATTERN,new Int32Array(Et.MIDDLE_PATTERN.length).fill(0))[1];for(let A=0;A<6&&g<f;A++){let N=Et.decodeDigit(o,h,g,Et.L_PATTERNS);c+=String.fromCharCode("0".charCodeAt(0)+N);for(let L of h)g+=L}return{rowOffset:g,resultString:c}}getBarcodeFormat(){return Fe.EAN_13}static determineFirstDigit(o,l){for(let c=0;c<10;c++)if(l===this.FIRST_DIGIT_ENCODINGS[c])return o=String.fromCharCode("0".charCodeAt(0)+c)+o,o;throw new ie}}_s.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class Ic extends Et{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(o,l,c){const h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let f=o.getSize(),g=l[1];for(let v=0;v<4&&g<f;v++){let A=Et.decodeDigit(o,h,g,Et.L_PATTERNS);c+=String.fromCharCode("0".charCodeAt(0)+A);for(let N of h)g+=N}g=Et.findGuardPattern(o,g,!0,Et.MIDDLE_PATTERN,new Int32Array(Et.MIDDLE_PATTERN.length).fill(0))[1];for(let v=0;v<4&&g<f;v++){let A=Et.decodeDigit(o,h,g,Et.L_PATTERNS);c+=String.fromCharCode("0".charCodeAt(0)+A);for(let N of h)g+=N}return{rowOffset:g,resultString:c}}getBarcodeFormat(){return Fe.EAN_8}}class Cc extends Et{constructor(){super(...arguments),this.ean13Reader=new _s}getBarcodeFormat(){return Fe.UPC_A}decode(o,l){return this.maybeReturnResult(this.ean13Reader.decode(o))}decodeRow(o,l,c){return this.maybeReturnResult(this.ean13Reader.decodeRow(o,l,c))}decodeMiddle(o,l,c){return this.ean13Reader.decodeMiddle(o,l,c)}maybeReturnResult(o){let l=o.getText();if(l.charAt(0)==="0"){let c=new zt(l.substring(1),null,null,o.getResultPoints(),Fe.UPC_A);return o.getResultMetadata()!=null&&c.putAllMetadata(o.getResultMetadata()),c}else throw new ie}reset(){this.ean13Reader.reset()}}class er extends Et{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(o,l,c){const h=this.decodeMiddleCounters.map(A=>A);h[0]=0,h[1]=0,h[2]=0,h[3]=0;const f=o.getSize();let g=l[1],w=0;for(let A=0;A<6&&g<f;A++){const N=er.decodeDigit(o,h,g,er.L_AND_G_PATTERNS);c+=String.fromCharCode("0".charCodeAt(0)+N%10);for(let L of h)g+=L;N>=10&&(w|=1<<5-A)}let v=er.determineNumSysAndCheckDigit(c,w);return{rowOffset:g,resultString:v}}decodeEnd(o,l){return er.findGuardPatternWithoutCounters(o,l,!0,er.MIDDLE_END_PATTERN)}checkChecksum(o){return Et.checkChecksum(er.convertUPCEtoUPCA(o))}static determineNumSysAndCheckDigit(o,l){for(let c=0;c<=1;c++)for(let h=0;h<10;h++)if(l===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[c][h]){let f=String.fromCharCode("0".charCodeAt(0)+c),g=String.fromCharCode("0".charCodeAt(0)+h);return f+o+g}throw ie.getNotFoundInstance()}getBarcodeFormat(){return Fe.UPC_E}static convertUPCEtoUPCA(o){const l=o.slice(1,7).split("").map(f=>f.charCodeAt(0)),c=new z;c.append(o.charAt(0));let h=l[5];switch(h){case 0:case 1:case 2:c.appendChars(l,0,2),c.append(h),c.append("0000"),c.appendChars(l,2,3);break;case 3:c.appendChars(l,0,3),c.append("00000"),c.appendChars(l,3,2);break;case 4:c.appendChars(l,0,4),c.append("00000"),c.append(l[4]);break;default:c.appendChars(l,0,5),c.append("0000"),c.append(h);break}return o.length>=8&&c.append(o.charAt(7)),c.toString()}}er.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),er.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class Tc extends kt{constructor(o){super();let l=o==null?null:o.get(Q.POSSIBLE_FORMATS),c=[];r(l)?(c.push(new _s),c.push(new Cc),c.push(new Ic),c.push(new er)):(l.indexOf(Fe.EAN_13)>-1&&c.push(new _s),l.indexOf(Fe.UPC_A)>-1&&c.push(new Cc),l.indexOf(Fe.EAN_8)>-1&&c.push(new Ic),l.indexOf(Fe.UPC_E)>-1&&c.push(new er)),this.readers=c}decodeRow(o,l,c){for(let h of this.readers)try{const f=h.decodeRow(o,l,c),g=f.getBarcodeFormat()===Fe.EAN_13&&f.getText().charAt(0)==="0",w=c==null?null:c.get(Q.POSSIBLE_FORMATS),v=w==null||w.includes(Fe.UPC_A);if(g&&v){const A=f.getRawBytes(),N=new zt(f.getText().substring(1),A,A?A.length:null,f.getResultPoints(),Fe.UPC_A);return N.putAllMetadata(f.getResultMetadata()),N}return f}catch{}throw new ie}reset(){for(let o of this.readers)o.reset()}}class Ln extends kt{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(o,l){for(let c=0;c<l.length;c++)if(kt.patternMatchVariance(o,l[c],Ln.MAX_INDIVIDUAL_VARIANCE)<Ln.MAX_AVG_VARIANCE)return c;throw new ie}static count(o){return lt.sum(new Int32Array(o))}static increment(o,l){let c=0,h=l[0];for(let f=1;f<o.length;f++)l[f]>h&&(h=l[f],c=f);o[c]++}static decrement(o,l){let c=0,h=l[0];for(let f=1;f<o.length;f++)l[f]<h&&(h=l[f],c=f);o[c]--}static isFinderPattern(o){let l=o[0]+o[1],c=l+o[2]+o[3],h=l/c;if(h>=Ln.MIN_FINDER_PATTERN_RATIO&&h<=Ln.MAX_FINDER_PATTERN_RATIO){let f=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER;for(let w of o)w>g&&(g=w),w<f&&(f=w);return g<10*f}return!1}}Ln.MAX_AVG_VARIANCE=.2,Ln.MAX_INDIVIDUAL_VARIANCE=.45,Ln.MIN_FINDER_PATTERN_RATIO=9.5/12,Ln.MAX_FINDER_PATTERN_RATIO=12.5/14;class Yi{constructor(o,l){this.value=o,this.checksumPortion=l}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(o){if(!(o instanceof Yi))return!1;const l=o;return this.value===l.value&&this.checksumPortion===l.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class vi{constructor(o,l,c,h,f){this.value=o,this.startEnd=l,this.value=o,this.startEnd=l,this.resultPoints=new Array,this.resultPoints.push(new Z(c,f)),this.resultPoints.push(new Z(h,f))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(o){if(!(o instanceof vi))return!1;const l=o;return this.value===l.value}hashCode(){return this.value}}class vs{constructor(){}static getRSSvalue(o,l,c){let h=0;for(let v of o)h+=v;let f=0,g=0,w=o.length;for(let v=0;v<w-1;v++){let A;for(A=1,g|=1<<v;A<o[v];A++,g&=~(1<<v)){let N=vs.combins(h-A-1,w-v-2);if(c&&g===0&&h-A-(w-v-1)>=w-v-1&&(N-=vs.combins(h-A-(w-v),w-v-2)),w-v-1>1){let L=0;for(let V=h-A-(w-v-2);V>l;V--)L+=vs.combins(h-A-V-1,w-v-3);N-=L*(w-1-v)}else h-A>l&&N--;f+=N}h-=A}return f}static combins(o,l){let c,h;o-l>l?(h=l,c=o-l):(h=o-l,c=l);let f=1,g=1;for(let w=o;w>c;w--)f*=w,g<=h&&(f/=g,g++);for(;g<=h;)f/=g,g++;return f}}class vr{static buildBitArray(o){let l=o.length*2-1;o[o.length-1].getRightChar()==null&&(l-=1);let c=12*l,h=new j(c),f=0,w=o[0].getRightChar().getValue();for(let v=11;v>=0;--v)w&1<<v&&h.set(f),f++;for(let v=1;v<o.length;++v){let A=o[v],N=A.getLeftChar().getValue();for(let L=11;L>=0;--L)N&1<<L&&h.set(f),f++;if(A.getRightChar()!=null){let L=A.getRightChar().getValue();for(let V=11;V>=0;--V)L&1<<V&&h.set(f),f++}}return h}}class Ei{constructor(o,l){l?this.decodedInformation=null:(this.finished=o,this.decodedInformation=l)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Zi{constructor(o){this.newPosition=o}getNewPosition(){return this.newPosition}}class qn extends Zi{constructor(o,l){super(o),this.value=l}getValue(){return this.value}isFNC1(){return this.value===qn.FNC1}}qn.FNC1="$";class Ji extends Zi{constructor(o,l,c){super(o),c?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=l}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class ss extends Zi{constructor(o,l,c){if(super(o),l<0||l>10||c<0||c>10)throw new D;this.firstDigit=l,this.secondDigit=c}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===ss.FNC1}isSecondDigitFNC1(){return this.secondDigit===ss.FNC1}isAnyFNC1(){return this.firstDigit===ss.FNC1||this.secondDigit===ss.FNC1}}ss.FNC1=10;class Re{constructor(){}static parseFieldsInGeneralPurpose(o){if(!o)return null;if(o.length<2)throw new ie;let l=o.substring(0,2);for(let f of Re.TWO_DIGIT_DATA_LENGTH)if(f[0]===l)return f[1]===Re.VARIABLE_LENGTH?Re.processVariableAI(2,f[2],o):Re.processFixedAI(2,f[1],o);if(o.length<3)throw new ie;let c=o.substring(0,3);for(let f of Re.THREE_DIGIT_DATA_LENGTH)if(f[0]===c)return f[1]===Re.VARIABLE_LENGTH?Re.processVariableAI(3,f[2],o):Re.processFixedAI(3,f[1],o);for(let f of Re.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(f[0]===c)return f[1]===Re.VARIABLE_LENGTH?Re.processVariableAI(4,f[2],o):Re.processFixedAI(4,f[1],o);if(o.length<4)throw new ie;let h=o.substring(0,4);for(let f of Re.FOUR_DIGIT_DATA_LENGTH)if(f[0]===h)return f[1]===Re.VARIABLE_LENGTH?Re.processVariableAI(4,f[2],o):Re.processFixedAI(4,f[1],o);throw new ie}static processFixedAI(o,l,c){if(c.length<o)throw new ie;let h=c.substring(0,o);if(c.length<o+l)throw new ie;let f=c.substring(o,o+l),g=c.substring(o+l),w="("+h+")"+f,v=Re.parseFieldsInGeneralPurpose(g);return v==null?w:w+v}static processVariableAI(o,l,c){let h=c.substring(0,o),f;c.length<o+l?f=c.length:f=o+l;let g=c.substring(o,f),w=c.substring(f),v="("+h+")"+g,A=Re.parseFieldsInGeneralPurpose(w);return A==null?v:v+A}}Re.VARIABLE_LENGTH=[],Re.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",Re.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",Re.VARIABLE_LENGTH,20],["22",Re.VARIABLE_LENGTH,29],["30",Re.VARIABLE_LENGTH,8],["37",Re.VARIABLE_LENGTH,8],["90",Re.VARIABLE_LENGTH,30],["91",Re.VARIABLE_LENGTH,30],["92",Re.VARIABLE_LENGTH,30],["93",Re.VARIABLE_LENGTH,30],["94",Re.VARIABLE_LENGTH,30],["95",Re.VARIABLE_LENGTH,30],["96",Re.VARIABLE_LENGTH,30],["97",Re.VARIABLE_LENGTH,3],["98",Re.VARIABLE_LENGTH,30],["99",Re.VARIABLE_LENGTH,30]],Re.THREE_DIGIT_DATA_LENGTH=[["240",Re.VARIABLE_LENGTH,30],["241",Re.VARIABLE_LENGTH,30],["242",Re.VARIABLE_LENGTH,6],["250",Re.VARIABLE_LENGTH,30],["251",Re.VARIABLE_LENGTH,30],["253",Re.VARIABLE_LENGTH,17],["254",Re.VARIABLE_LENGTH,20],["400",Re.VARIABLE_LENGTH,30],["401",Re.VARIABLE_LENGTH,30],["402",17],["403",Re.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",Re.VARIABLE_LENGTH,20],["421",Re.VARIABLE_LENGTH,15],["422",3],["423",Re.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],Re.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",Re.VARIABLE_LENGTH,15],["391",Re.VARIABLE_LENGTH,18],["392",Re.VARIABLE_LENGTH,15],["393",Re.VARIABLE_LENGTH,18],["703",Re.VARIABLE_LENGTH,30]],Re.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",Re.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",Re.VARIABLE_LENGTH,20],["8003",Re.VARIABLE_LENGTH,30],["8004",Re.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",Re.VARIABLE_LENGTH,30],["8008",Re.VARIABLE_LENGTH,12],["8018",18],["8020",Re.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",Re.VARIABLE_LENGTH,70],["8200",Re.VARIABLE_LENGTH,70]];class Go{constructor(o){this.buffer=new z,this.information=o}decodeAllCodes(o,l){let c=l,h=null;do{let f=this.decodeGeneralPurposeField(c,h),g=Re.parseFieldsInGeneralPurpose(f.getNewString());if(g!=null&&o.append(g),f.isRemaining()?h=""+f.getRemainingValue():h=null,c===f.getNewPosition())break;c=f.getNewPosition()}while(!0);return o.toString()}isStillNumeric(o){if(o+7>this.information.getSize())return o+4<=this.information.getSize();for(let l=o;l<o+3;++l)if(this.information.get(l))return!0;return this.information.get(o+3)}decodeNumeric(o){if(o+7>this.information.getSize()){let f=this.extractNumericValueFromBitArray(o,4);return f===0?new ss(this.information.getSize(),ss.FNC1,ss.FNC1):new ss(this.information.getSize(),f-1,ss.FNC1)}let l=this.extractNumericValueFromBitArray(o,7),c=(l-8)/11,h=(l-8)%11;return new ss(o+7,c,h)}extractNumericValueFromBitArray(o,l){return Go.extractNumericValueFromBitArray(this.information,o,l)}static extractNumericValueFromBitArray(o,l,c){let h=0;for(let f=0;f<c;++f)o.get(l+f)&&(h|=1<<c-f-1);return h}decodeGeneralPurposeField(o,l){this.buffer.setLengthToZero(),l!=null&&this.buffer.append(l),this.current.setPosition(o);let c=this.parseBlocks();return c!=null&&c.isRemaining()?new Ji(this.current.getPosition(),this.buffer.toString(),c.getRemainingValue()):new Ji(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let o,l;do{let c=this.current.getPosition();if(this.current.isAlpha()?(l=this.parseAlphaBlock(),o=l.isFinished()):this.current.isIsoIec646()?(l=this.parseIsoIec646Block(),o=l.isFinished()):(l=this.parseNumericBlock(),o=l.isFinished()),!(c!==this.current.getPosition())&&!o)break}while(!o);return l.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let o=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(o.getNewPosition()),o.isFirstDigitFNC1()){let l;return o.isSecondDigitFNC1()?l=new Ji(this.current.getPosition(),this.buffer.toString()):l=new Ji(this.current.getPosition(),this.buffer.toString(),o.getSecondDigit()),new Ei(!0,l)}if(this.buffer.append(o.getFirstDigit()),o.isSecondDigitFNC1()){let l=new Ji(this.current.getPosition(),this.buffer.toString());return new Ei(!0,l)}this.buffer.append(o.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Ei(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let o=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(o.getNewPosition()),o.isFNC1()){let l=new Ji(this.current.getPosition(),this.buffer.toString());return new Ei(!0,l)}this.buffer.append(o.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Ei(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let o=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(o.getNewPosition()),o.isFNC1()){let l=new Ji(this.current.getPosition(),this.buffer.toString());return new Ei(!0,l)}this.buffer.append(o.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Ei(!1)}isStillIsoIec646(o){if(o+5>this.information.getSize())return!1;let l=this.extractNumericValueFromBitArray(o,5);if(l>=5&&l<16)return!0;if(o+7>this.information.getSize())return!1;let c=this.extractNumericValueFromBitArray(o,7);if(c>=64&&c<116)return!0;if(o+8>this.information.getSize())return!1;let h=this.extractNumericValueFromBitArray(o,8);return h>=232&&h<253}decodeIsoIec646(o){let l=this.extractNumericValueFromBitArray(o,5);if(l===15)return new qn(o+5,qn.FNC1);if(l>=5&&l<15)return new qn(o+5,"0"+(l-5));let c=this.extractNumericValueFromBitArray(o,7);if(c>=64&&c<90)return new qn(o+7,""+(c+1));if(c>=90&&c<116)return new qn(o+7,""+(c+7));let h=this.extractNumericValueFromBitArray(o,8),f;switch(h){case 232:f="!";break;case 233:f='"';break;case 234:f="%";break;case 235:f="&";break;case 236:f="'";break;case 237:f="(";break;case 238:f=")";break;case 239:f="*";break;case 240:f="+";break;case 241:f=",";break;case 242:f="-";break;case 243:f=".";break;case 244:f="/";break;case 245:f=":";break;case 246:f=";";break;case 247:f="<";break;case 248:f="=";break;case 249:f=">";break;case 250:f="?";break;case 251:f="_";break;case 252:f=" ";break;default:throw new D}return new qn(o+8,f)}isStillAlpha(o){if(o+5>this.information.getSize())return!1;let l=this.extractNumericValueFromBitArray(o,5);if(l>=5&&l<16)return!0;if(o+6>this.information.getSize())return!1;let c=this.extractNumericValueFromBitArray(o,6);return c>=16&&c<63}decodeAlphanumeric(o){let l=this.extractNumericValueFromBitArray(o,5);if(l===15)return new qn(o+5,qn.FNC1);if(l>=5&&l<15)return new qn(o+5,"0"+(l-5));let c=this.extractNumericValueFromBitArray(o,6);if(c>=32&&c<58)return new qn(o+6,""+(c+33));let h;switch(c){case 58:h="*";break;case 59:h=",";break;case 60:h="-";break;case 61:h=".";break;case 62:h="/";break;default:throw new _r("Decoding invalid alphanumeric value: "+c)}return new qn(o+6,h)}isAlphaTo646ToAlphaLatch(o){if(o+1>this.information.getSize())return!1;for(let l=0;l<5&&l+o<this.information.getSize();++l)if(l===2){if(!this.information.get(o+2))return!1}else if(this.information.get(o+l))return!1;return!0}isAlphaOr646ToNumericLatch(o){if(o+3>this.information.getSize())return!1;for(let l=o;l<o+3;++l)if(this.information.get(l))return!1;return!0}isNumericToAlphaNumericLatch(o){if(o+1>this.information.getSize())return!1;for(let l=0;l<4&&l+o<this.information.getSize();++l)if(this.information.get(o+l))return!1;return!0}}class Ih{constructor(o){this.information=o,this.generalDecoder=new Go(o)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class tr extends Ih{constructor(o){super(o)}encodeCompressedGtin(o,l){o.append("(01)");let c=o.length();o.append("9"),this.encodeCompressedGtinWithoutAI(o,l,c)}encodeCompressedGtinWithoutAI(o,l,c){for(let h=0;h<4;++h){let f=this.getGeneralDecoder().extractNumericValueFromBitArray(l+10*h,10);f/100===0&&o.append("0"),f/10===0&&o.append("0"),o.append(f)}tr.appendCheckDigit(o,c)}static appendCheckDigit(o,l){let c=0;for(let h=0;h<13;h++){let f=o.charAt(h+l).charCodeAt(0)-"0".charCodeAt(0);c+=h&1?f:3*f}c=10-c%10,c===10&&(c=0),o.append(c)}}tr.GTIN_SIZE=40;class eo extends tr{constructor(o){super(o)}parseInformation(){let o=new z;o.append("(01)");let l=o.length(),c=this.getGeneralDecoder().extractNumericValueFromBitArray(eo.HEADER_SIZE,4);return o.append(c),this.encodeCompressedGtinWithoutAI(o,eo.HEADER_SIZE+4,l),this.getGeneralDecoder().decodeAllCodes(o,eo.HEADER_SIZE+44)}}eo.HEADER_SIZE=1+1+2;class qo extends Ih{constructor(o){super(o)}parseInformation(){let o=new z;return this.getGeneralDecoder().decodeAllCodes(o,qo.HEADER_SIZE)}}qo.HEADER_SIZE=2+1+2;class to extends tr{constructor(o){super(o)}encodeCompressedWeight(o,l,c){let h=this.getGeneralDecoder().extractNumericValueFromBitArray(l,c);this.addWeightCode(o,h);let f=this.checkWeight(h),g=1e5;for(let w=0;w<5;++w)f/g===0&&o.append("0"),g/=10;o.append(f)}}class nr extends to{constructor(o){super(o)}parseInformation(){if(this.getInformation().getSize()!=nr.HEADER_SIZE+to.GTIN_SIZE+nr.WEIGHT_SIZE)throw new ie;let o=new z;return this.encodeCompressedGtin(o,nr.HEADER_SIZE),this.encodeCompressedWeight(o,nr.HEADER_SIZE+to.GTIN_SIZE,nr.WEIGHT_SIZE),o.toString()}}nr.HEADER_SIZE=4+1,nr.WEIGHT_SIZE=15;class c0 extends nr{constructor(o){super(o)}addWeightCode(o,l){o.append("(3103)")}checkWeight(o){return o}}class u0 extends nr{constructor(o){super(o)}addWeightCode(o,l){l<1e4?o.append("(3202)"):o.append("(3203)")}checkWeight(o){return o<1e4?o:o-1e4}}class is extends tr{constructor(o){super(o)}parseInformation(){if(this.getInformation().getSize()<is.HEADER_SIZE+tr.GTIN_SIZE)throw new ie;let o=new z;this.encodeCompressedGtin(o,is.HEADER_SIZE);let l=this.getGeneralDecoder().extractNumericValueFromBitArray(is.HEADER_SIZE+tr.GTIN_SIZE,is.LAST_DIGIT_SIZE);o.append("(392"),o.append(l),o.append(")");let c=this.getGeneralDecoder().decodeGeneralPurposeField(is.HEADER_SIZE+tr.GTIN_SIZE+is.LAST_DIGIT_SIZE,null);return o.append(c.getNewString()),o.toString()}}is.HEADER_SIZE=5+1+2,is.LAST_DIGIT_SIZE=2;class rr extends tr{constructor(o){super(o)}parseInformation(){if(this.getInformation().getSize()<rr.HEADER_SIZE+tr.GTIN_SIZE)throw new ie;let o=new z;this.encodeCompressedGtin(o,rr.HEADER_SIZE);let l=this.getGeneralDecoder().extractNumericValueFromBitArray(rr.HEADER_SIZE+tr.GTIN_SIZE,rr.LAST_DIGIT_SIZE);o.append("(393"),o.append(l),o.append(")");let c=this.getGeneralDecoder().extractNumericValueFromBitArray(rr.HEADER_SIZE+tr.GTIN_SIZE+rr.LAST_DIGIT_SIZE,rr.FIRST_THREE_DIGITS_SIZE);c/100==0&&o.append("0"),c/10==0&&o.append("0"),o.append(c);let h=this.getGeneralDecoder().decodeGeneralPurposeField(rr.HEADER_SIZE+tr.GTIN_SIZE+rr.LAST_DIGIT_SIZE+rr.FIRST_THREE_DIGITS_SIZE,null);return o.append(h.getNewString()),o.toString()}}rr.HEADER_SIZE=5+1+2,rr.LAST_DIGIT_SIZE=2,rr.FIRST_THREE_DIGITS_SIZE=10;class Gt extends to{constructor(o,l,c){super(o),this.dateCode=c,this.firstAIdigits=l}parseInformation(){if(this.getInformation().getSize()!=Gt.HEADER_SIZE+Gt.GTIN_SIZE+Gt.WEIGHT_SIZE+Gt.DATE_SIZE)throw new ie;let o=new z;return this.encodeCompressedGtin(o,Gt.HEADER_SIZE),this.encodeCompressedWeight(o,Gt.HEADER_SIZE+Gt.GTIN_SIZE,Gt.WEIGHT_SIZE),this.encodeCompressedDate(o,Gt.HEADER_SIZE+Gt.GTIN_SIZE+Gt.WEIGHT_SIZE),o.toString()}encodeCompressedDate(o,l){let c=this.getGeneralDecoder().extractNumericValueFromBitArray(l,Gt.DATE_SIZE);if(c==38400)return;o.append("("),o.append(this.dateCode),o.append(")");let h=c%32;c/=32;let f=c%12+1;c/=12;let g=c;g/10==0&&o.append("0"),o.append(g),f/10==0&&o.append("0"),o.append(f),h/10==0&&o.append("0"),o.append(h)}addWeightCode(o,l){o.append("("),o.append(this.firstAIdigits),o.append(l/1e5),o.append(")")}checkWeight(o){return o%1e5}}Gt.HEADER_SIZE=7+1,Gt.WEIGHT_SIZE=20,Gt.DATE_SIZE=16;function Ch(M){try{if(M.get(1))return new eo(M);if(!M.get(2))return new qo(M);switch(Go.extractNumericValueFromBitArray(M,1,4)){case 4:return new c0(M);case 5:return new u0(M)}switch(Go.extractNumericValueFromBitArray(M,1,5)){case 12:return new is(M);case 13:return new rr(M)}switch(Go.extractNumericValueFromBitArray(M,1,7)){case 56:return new Gt(M,"310","11");case 57:return new Gt(M,"320","11");case 58:return new Gt(M,"310","13");case 59:return new Gt(M,"320","13");case 60:return new Gt(M,"310","15");case 61:return new Gt(M,"320","15");case 62:return new Gt(M,"310","17");case 63:return new Gt(M,"320","17")}}catch(o){throw console.log(o),new _r("unknown decoder: "+M)}}class Ai{constructor(o,l,c,h){this.leftchar=o,this.rightchar=l,this.finderpattern=c,this.maybeLast=h}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(o,l){return o instanceof Ai?Ai.equalsOrNull(o.leftchar,l.leftchar)&&Ai.equalsOrNull(o.rightchar,l.rightchar)&&Ai.equalsOrNull(o.finderpattern,l.finderpattern):!1}static equalsOrNull(o,l){return o===null?l===null:Ai.equals(o,l)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class Wo{constructor(o,l,c){this.pairs=o,this.rowNumber=l,this.wasReversed=c}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(o){return this.checkEqualitity(this,o)}toString(){return"{ "+this.pairs+" }"}equals(o,l){return o instanceof Wo?this.checkEqualitity(o,l)&&o.wasReversed===l.wasReversed:!1}checkEqualitity(o,l){if(!o||!l)return;let c;return o.forEach((h,f)=>{l.forEach(g=>{h.getLeftChar().getValue()===g.getLeftChar().getValue()&&h.getRightChar().getValue()===g.getRightChar().getValue()&&h.getFinderPatter().getValue()===g.getFinderPatter().getValue()&&(c=!0)})}),c}}class fe extends Ln{constructor(o){super(...arguments),this.pairs=new Array(fe.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=o===!0}decodeRow(o,l,c){this.pairs.length=0,this.startFromEven=!1;try{return fe.constructResult(this.decodeRow2pairs(o,l))}catch(h){this.verbose&&console.log(h)}return this.pairs.length=0,this.startFromEven=!0,fe.constructResult(this.decodeRow2pairs(o,l))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(o,l){let c=!1;for(;!c;)try{this.pairs.push(this.retrieveNextPair(l,this.pairs,o))}catch(f){if(f instanceof ie){if(!this.pairs.length)throw new ie;c=!0}}if(this.checkChecksum())return this.pairs;let h;if(this.rows.length?h=!0:h=!1,this.storeRow(o,!1),h){let f=this.checkRowsBoolean(!1);if(f!=null||(f=this.checkRowsBoolean(!0),f!=null))return f}throw new ie}checkRowsBoolean(o){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,o&&(this.rows=this.rows.reverse());let l=null;try{l=this.checkRows(new Array,0)}catch(c){this.verbose&&console.log(c)}return o&&(this.rows=this.rows.reverse()),l}checkRows(o,l){for(let c=l;c<this.rows.length;c++){let h=this.rows[c];this.pairs.length=0;for(let g of o)this.pairs.push(g.getPairs());if(this.pairs.push(h.getPairs()),!fe.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let f=new Array(o);f.push(h);try{return this.checkRows(f,c+1)}catch(g){this.verbose&&console.log(g)}}throw new ie}static isValidSequence(o){for(let l of fe.FINDER_PATTERN_SEQUENCES){if(o.length>l.length)continue;let c=!0;for(let h=0;h<o.length;h++)if(o[h].getFinderPattern().getValue()!=l[h]){c=!1;break}if(c)return!0}return!1}storeRow(o,l){let c=0,h=!1,f=!1;for(;c<this.rows.length;){let g=this.rows[c];if(g.getRowNumber()>o){f=g.isEquivalent(this.pairs);break}h=g.isEquivalent(this.pairs),c++}f||h||fe.isPartialRow(this.pairs,this.rows)||(this.rows.push(c,new Wo(this.pairs,o,l)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(o,l){for(let c of l)if(c.getPairs().length!==o.length){for(let h of c.getPairs())for(let f of o)if(Ai.equals(h,f))break}}static isPartialRow(o,l){for(let c of l){let h=!0;for(let f of o){let g=!1;for(let w of c.getPairs())if(f.equals(w)){g=!0;break}if(!g){h=!1;break}}if(h)return!0}return!1}getRows(){return this.rows}static constructResult(o){let l=vr.buildBitArray(o),h=Ch(l).parseInformation(),f=o[0].getFinderPattern().getResultPoints(),g=o[o.length-1].getFinderPattern().getResultPoints(),w=[f[0],f[1],g[0],g[1]];return new zt(h,null,null,w,Fe.RSS_EXPANDED,null)}checkChecksum(){let o=this.pairs.get(0),l=o.getLeftChar(),c=o.getRightChar();if(c==null)return!1;let h=c.getChecksumPortion(),f=2;for(let w=1;w<this.pairs.size();++w){let v=this.pairs.get(w);h+=v.getLeftChar().getChecksumPortion(),f++;let A=v.getRightChar();A!=null&&(h+=A.getChecksumPortion(),f++)}return h%=211,211*(f-4)+h==l.getValue()}static getNextSecondBar(o,l){let c;return o.get(l)?(c=o.getNextUnset(l),c=o.getNextSet(c)):(c=o.getNextSet(l),c=o.getNextUnset(c)),c}retrieveNextPair(o,l,c){let h=l.length%2==0;this.startFromEven&&(h=!h);let f,g=!0,w=-1;do this.findNextPair(o,l,w),f=this.parseFoundFinderPattern(o,c,h),f==null?w=fe.getNextSecondBar(o,this.startEnd[0]):g=!1;while(g);let v=this.decodeDataCharacter(o,f,h,!0);if(!this.isEmptyPair(l)&&l[l.length-1].mustBeLast())throw new ie;let A;try{A=this.decodeDataCharacter(o,f,h,!1)}catch(N){A=null,this.verbose&&console.log(N)}return new Ai(v,A,f,!0)}isEmptyPair(o){return o.length===0}findNextPair(o,l,c){let h=this.getDecodeFinderCounters();h[0]=0,h[1]=0,h[2]=0,h[3]=0;let f=o.getSize(),g;c>=0?g=c:this.isEmptyPair(l)?g=0:g=l[l.length-1].getFinderPattern().getStartEnd()[1];let w=l.length%2!=0;this.startFromEven&&(w=!w);let v=!1;for(;g<f&&(v=!o.get(g),!!v);)g++;let A=0,N=g;for(let L=g;L<f;L++)if(o.get(L)!=v)h[A]++;else{if(A==3){if(w&&fe.reverseCounters(h),fe.isFinderPattern(h)){this.startEnd[0]=N,this.startEnd[1]=L;return}w&&fe.reverseCounters(h),N+=h[0]+h[1],h[0]=h[2],h[1]=h[3],h[2]=0,h[3]=0,A--}else A++;h[A]=1,v=!v}throw new ie}static reverseCounters(o){let l=o.length;for(let c=0;c<l/2;++c){let h=o[c];o[c]=o[l-c-1],o[l-c-1]=h}}parseFoundFinderPattern(o,l,c){let h,f,g;if(c){let A=this.startEnd[0]-1;for(;A>=0&&!o.get(A);)A--;A++,h=this.startEnd[0]-A,f=A,g=this.startEnd[1]}else f=this.startEnd[0],g=o.getNextUnset(this.startEnd[1]+1),h=g-this.startEnd[1];let w=this.getDecodeFinderCounters();S.arraycopy(w,0,w,1,w.length-1),w[0]=h;let v;try{v=this.parseFinderValue(w,fe.FINDER_PATTERNS)}catch{return null}return new vi(v,[f,g],f,g,l)}decodeDataCharacter(o,l,c,h){let f=this.getDataCharacterCounters();for(let Wt=0;Wt<f.length;Wt++)f[Wt]=0;if(h)fe.recordPatternInReverse(o,l.getStartEnd()[0],f);else{fe.recordPattern(o,l.getStartEnd()[1],f);for(let Wt=0,Ar=f.length-1;Wt<Ar;Wt++,Ar--){let As=f[Wt];f[Wt]=f[Ar],f[Ar]=As}}let g=17,w=lt.sum(new Int32Array(f))/g,v=(l.getStartEnd()[1]-l.getStartEnd()[0])/15;if(Math.abs(w-v)/v>.3)throw new ie;let A=this.getOddCounts(),N=this.getEvenCounts(),L=this.getOddRoundingErrors(),V=this.getEvenRoundingErrors();for(let Wt=0;Wt<f.length;Wt++){let Ar=1*f[Wt]/w,As=Ar+.5;if(As<1){if(Ar<.3)throw new ie;As=1}else if(As>8){if(Ar>8.7)throw new ie;As=8}let Mc=Wt/2;Wt&1?(N[Mc]=As,V[Mc]=Ar-As):(A[Mc]=As,L[Mc]=Ar-As)}this.adjustOddEvenCounts(g);let q=4*l.getValue()+(c?0:2)+(h?0:1)-1,J=0,ee=0;for(let Wt=A.length-1;Wt>=0;Wt--){if(fe.isNotA1left(l,c,h)){let Ar=fe.WEIGHTS[q][2*Wt];ee+=A[Wt]*Ar}J+=A[Wt]}let se=0;for(let Wt=N.length-1;Wt>=0;Wt--)if(fe.isNotA1left(l,c,h)){let Ar=fe.WEIGHTS[q][2*Wt+1];se+=N[Wt]*Ar}let ce=ee+se;if(J&1||J>13||J<4)throw new ie;let ve=(13-J)/2,Ee=fe.SYMBOL_WIDEST[ve],pe=9-Ee,gt=vs.getRSSvalue(A,Ee,!0),rt=vs.getRSSvalue(N,pe,!1),ls=fe.EVEN_TOTAL_SUBSET[ve],ii=fe.GSUM[ve],cs=gt*ls+rt+ii;return new Yi(cs,ce)}static isNotA1left(o,l,c){return!(o.getValue()==0&&l&&c)}adjustOddEvenCounts(o){let l=lt.sum(new Int32Array(this.getOddCounts())),c=lt.sum(new Int32Array(this.getEvenCounts())),h=!1,f=!1;l>13?f=!0:l<4&&(h=!0);let g=!1,w=!1;c>13?w=!0:c<4&&(g=!0);let v=l+c-o,A=(l&1)==1,N=(c&1)==0;if(v==1)if(A){if(N)throw new ie;f=!0}else{if(!N)throw new ie;w=!0}else if(v==-1)if(A){if(N)throw new ie;h=!0}else{if(!N)throw new ie;g=!0}else if(v==0){if(A){if(!N)throw new ie;l<c?(h=!0,w=!0):(f=!0,g=!0)}else if(N)throw new ie}else throw new ie;if(h){if(f)throw new ie;fe.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(f&&fe.decrement(this.getOddCounts(),this.getOddRoundingErrors()),g){if(w)throw new ie;fe.increment(this.getEvenCounts(),this.getOddRoundingErrors())}w&&fe.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}fe.SYMBOL_WIDEST=[7,5,4,3,1],fe.EVEN_TOTAL_SUBSET=[4,20,52,104,204],fe.GSUM=[0,348,1388,2948,3988],fe.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],fe.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],fe.FINDER_PAT_A=0,fe.FINDER_PAT_B=1,fe.FINDER_PAT_C=2,fe.FINDER_PAT_D=3,fe.FINDER_PAT_E=4,fe.FINDER_PAT_F=5,fe.FINDER_PATTERN_SEQUENCES=[[fe.FINDER_PAT_A,fe.FINDER_PAT_A],[fe.FINDER_PAT_A,fe.FINDER_PAT_B,fe.FINDER_PAT_B],[fe.FINDER_PAT_A,fe.FINDER_PAT_C,fe.FINDER_PAT_B,fe.FINDER_PAT_D],[fe.FINDER_PAT_A,fe.FINDER_PAT_E,fe.FINDER_PAT_B,fe.FINDER_PAT_D,fe.FINDER_PAT_C],[fe.FINDER_PAT_A,fe.FINDER_PAT_E,fe.FINDER_PAT_B,fe.FINDER_PAT_D,fe.FINDER_PAT_D,fe.FINDER_PAT_F],[fe.FINDER_PAT_A,fe.FINDER_PAT_E,fe.FINDER_PAT_B,fe.FINDER_PAT_D,fe.FINDER_PAT_E,fe.FINDER_PAT_F,fe.FINDER_PAT_F],[fe.FINDER_PAT_A,fe.FINDER_PAT_A,fe.FINDER_PAT_B,fe.FINDER_PAT_B,fe.FINDER_PAT_C,fe.FINDER_PAT_C,fe.FINDER_PAT_D,fe.FINDER_PAT_D],[fe.FINDER_PAT_A,fe.FINDER_PAT_A,fe.FINDER_PAT_B,fe.FINDER_PAT_B,fe.FINDER_PAT_C,fe.FINDER_PAT_C,fe.FINDER_PAT_D,fe.FINDER_PAT_E,fe.FINDER_PAT_E],[fe.FINDER_PAT_A,fe.FINDER_PAT_A,fe.FINDER_PAT_B,fe.FINDER_PAT_B,fe.FINDER_PAT_C,fe.FINDER_PAT_C,fe.FINDER_PAT_D,fe.FINDER_PAT_E,fe.FINDER_PAT_F,fe.FINDER_PAT_F],[fe.FINDER_PAT_A,fe.FINDER_PAT_A,fe.FINDER_PAT_B,fe.FINDER_PAT_B,fe.FINDER_PAT_C,fe.FINDER_PAT_D,fe.FINDER_PAT_D,fe.FINDER_PAT_E,fe.FINDER_PAT_E,fe.FINDER_PAT_F,fe.FINDER_PAT_F]],fe.MAX_PAIRS=11;class Th extends Yi{constructor(o,l,c){super(o,l),this.count=0,this.finderPattern=c}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class jt extends Ln{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(o,l,c){const h=this.decodePair(l,!1,o,c);jt.addOrTally(this.possibleLeftPairs,h),l.reverse();let f=this.decodePair(l,!0,o,c);jt.addOrTally(this.possibleRightPairs,f),l.reverse();for(let g of this.possibleLeftPairs)if(g.getCount()>1){for(let w of this.possibleRightPairs)if(w.getCount()>1&&jt.checkChecksum(g,w))return jt.constructResult(g,w)}throw new ie}static addOrTally(o,l){if(l==null)return;let c=!1;for(let h of o)if(h.getValue()===l.getValue()){h.incrementCount(),c=!0;break}c||o.push(l)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(o,l){let c=4537077*o.getValue()+l.getValue(),h=new String(c).toString(),f=new z;for(let A=13-h.length;A>0;A--)f.append("0");f.append(h);let g=0;for(let A=0;A<13;A++){let N=f.charAt(A).charCodeAt(0)-"0".charCodeAt(0);g+=A&1?N:3*N}g=10-g%10,g===10&&(g=0),f.append(g.toString());let w=o.getFinderPattern().getResultPoints(),v=l.getFinderPattern().getResultPoints();return new zt(f.toString(),null,0,[w[0],w[1],v[0],v[1]],Fe.RSS_14,new Date().getTime())}static checkChecksum(o,l){let c=(o.getChecksumPortion()+16*l.getChecksumPortion())%79,h=9*o.getFinderPattern().getValue()+l.getFinderPattern().getValue();return h>72&&h--,h>8&&h--,c===h}decodePair(o,l,c,h){try{let f=this.findFinderPattern(o,l),g=this.parseFoundFinderPattern(o,c,l,f),w=h==null?null:h.get(Q.NEED_RESULT_POINT_CALLBACK);if(w!=null){let N=(f[0]+f[1])/2;l&&(N=o.getSize()-1-N),w.foundPossibleResultPoint(new Z(N,c))}let v=this.decodeDataCharacter(o,g,!0),A=this.decodeDataCharacter(o,g,!1);return new Th(1597*v.getValue()+A.getValue(),v.getChecksumPortion()+4*A.getChecksumPortion(),g)}catch{return null}}decodeDataCharacter(o,l,c){let h=this.getDataCharacterCounters();for(let se=0;se<h.length;se++)h[se]=0;if(c)kt.recordPatternInReverse(o,l.getStartEnd()[0],h);else{kt.recordPattern(o,l.getStartEnd()[1]+1,h);for(let se=0,ce=h.length-1;se<ce;se++,ce--){let ve=h[se];h[se]=h[ce],h[ce]=ve}}let f=c?16:15,g=lt.sum(new Int32Array(h))/f,w=this.getOddCounts(),v=this.getEvenCounts(),A=this.getOddRoundingErrors(),N=this.getEvenRoundingErrors();for(let se=0;se<h.length;se++){let ce=h[se]/g,ve=Math.floor(ce+.5);ve<1?ve=1:ve>8&&(ve=8);let Ee=Math.floor(se/2);se&1?(v[Ee]=ve,N[Ee]=ce-ve):(w[Ee]=ve,A[Ee]=ce-ve)}this.adjustOddEvenCounts(c,f);let L=0,V=0;for(let se=w.length-1;se>=0;se--)V*=9,V+=w[se],L+=w[se];let q=0,J=0;for(let se=v.length-1;se>=0;se--)q*=9,q+=v[se],J+=v[se];let ee=V+3*q;if(c){if(L&1||L>12||L<4)throw new ie;let se=(12-L)/2,ce=jt.OUTSIDE_ODD_WIDEST[se],ve=9-ce,Ee=vs.getRSSvalue(w,ce,!1),pe=vs.getRSSvalue(v,ve,!0),gt=jt.OUTSIDE_EVEN_TOTAL_SUBSET[se],rt=jt.OUTSIDE_GSUM[se];return new Yi(Ee*gt+pe+rt,ee)}else{if(J&1||J>10||J<4)throw new ie;let se=(10-J)/2,ce=jt.INSIDE_ODD_WIDEST[se],ve=9-ce,Ee=vs.getRSSvalue(w,ce,!0),pe=vs.getRSSvalue(v,ve,!1),gt=jt.INSIDE_ODD_TOTAL_SUBSET[se],rt=jt.INSIDE_GSUM[se];return new Yi(pe*gt+Ee+rt,ee)}}findFinderPattern(o,l){let c=this.getDecodeFinderCounters();c[0]=0,c[1]=0,c[2]=0,c[3]=0;let h=o.getSize(),f=!1,g=0;for(;g<h&&(f=!o.get(g),l!==f);)g++;let w=0,v=g;for(let A=g;A<h;A++)if(o.get(A)!==f)c[w]++;else{if(w===3){if(Ln.isFinderPattern(c))return[v,A];v+=c[0]+c[1],c[0]=c[2],c[1]=c[3],c[2]=0,c[3]=0,w--}else w++;c[w]=1,f=!f}throw new ie}parseFoundFinderPattern(o,l,c,h){let f=o.get(h[0]),g=h[0]-1;for(;g>=0&&f!==o.get(g);)g--;g++;const w=h[0]-g,v=this.getDecodeFinderCounters(),A=new Int32Array(v.length);S.arraycopy(v,0,A,1,v.length-1),A[0]=w;const N=this.parseFinderValue(A,jt.FINDER_PATTERNS);let L=g,V=h[1];return c&&(L=o.getSize()-1-L,V=o.getSize()-1-V),new vi(N,[g,h[1]],L,V,l)}adjustOddEvenCounts(o,l){let c=lt.sum(new Int32Array(this.getOddCounts())),h=lt.sum(new Int32Array(this.getEvenCounts())),f=!1,g=!1,w=!1,v=!1;o?(c>12?g=!0:c<4&&(f=!0),h>12?v=!0:h<4&&(w=!0)):(c>11?g=!0:c<5&&(f=!0),h>10?v=!0:h<4&&(w=!0));let A=c+h-l,N=(c&1)===(o?1:0),L=(h&1)===1;if(A===1)if(N){if(L)throw new ie;g=!0}else{if(!L)throw new ie;v=!0}else if(A===-1)if(N){if(L)throw new ie;f=!0}else{if(!L)throw new ie;w=!0}else if(A===0){if(N){if(!L)throw new ie;c<h?(f=!0,v=!0):(g=!0,w=!0)}else if(L)throw new ie}else throw new ie;if(f){if(g)throw new ie;Ln.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(g&&Ln.decrement(this.getOddCounts(),this.getOddRoundingErrors()),w){if(v)throw new ie;Ln.increment(this.getEvenCounts(),this.getOddRoundingErrors())}v&&Ln.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}jt.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],jt.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],jt.OUTSIDE_GSUM=[0,161,961,2015,2715],jt.INSIDE_GSUM=[0,336,1036,1516],jt.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],jt.INSIDE_ODD_WIDEST=[2,4,6,8],jt.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class os extends kt{constructor(o,l){super(),this.readers=[],this.verbose=l===!0;const c=o?o.get(Q.POSSIBLE_FORMATS):null,h=o&&o.get(Q.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;c?((c.includes(Fe.EAN_13)||c.includes(Fe.UPC_A)||c.includes(Fe.EAN_8)||c.includes(Fe.UPC_E))&&this.readers.push(new Tc(o)),c.includes(Fe.CODE_39)&&this.readers.push(new ln(h)),c.includes(Fe.CODE_128)&&this.readers.push(new Ae),c.includes(Fe.ITF)&&this.readers.push(new vt),c.includes(Fe.RSS_14)&&this.readers.push(new jt),c.includes(Fe.RSS_EXPANDED)&&this.readers.push(new fe(this.verbose))):(this.readers.push(new Tc(o)),this.readers.push(new ln),this.readers.push(new Tc(o)),this.readers.push(new Ae),this.readers.push(new vt),this.readers.push(new jt),this.readers.push(new fe(this.verbose)))}decodeRow(o,l,c){for(let h=0;h<this.readers.length;h++)try{return this.readers[h].decodeRow(o,l,c)}catch{}throw new ie}reset(){this.readers.forEach(o=>o.reset())}}class Sh extends _t{constructor(o=500,l){super(new os(l),o,l)}}class Rt{constructor(o,l,c){this.ecCodewords=o,this.ecBlocks=[l],c&&this.ecBlocks.push(c)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class At{constructor(o,l){this.count=o,this.dataCodewords=l}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class ct{constructor(o,l,c,h,f,g){this.versionNumber=o,this.symbolSizeRows=l,this.symbolSizeColumns=c,this.dataRegionSizeRows=h,this.dataRegionSizeColumns=f,this.ecBlocks=g;let w=0;const v=g.getECCodewords(),A=g.getECBlocks();for(let N of A)w+=N.getCount()*(N.getDataCodewords()+v);this.totalCodewords=w}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(o,l){if(o&1||l&1)throw new D;for(let c of ct.VERSIONS)if(c.symbolSizeRows===o&&c.symbolSizeColumns===l)return c;throw new D}toString(){return""+this.versionNumber}static buildVersions(){return[new ct(1,10,10,8,8,new Rt(5,new At(1,3))),new ct(2,12,12,10,10,new Rt(7,new At(1,5))),new ct(3,14,14,12,12,new Rt(10,new At(1,8))),new ct(4,16,16,14,14,new Rt(12,new At(1,12))),new ct(5,18,18,16,16,new Rt(14,new At(1,18))),new ct(6,20,20,18,18,new Rt(18,new At(1,22))),new ct(7,22,22,20,20,new Rt(20,new At(1,30))),new ct(8,24,24,22,22,new Rt(24,new At(1,36))),new ct(9,26,26,24,24,new Rt(28,new At(1,44))),new ct(10,32,32,14,14,new Rt(36,new At(1,62))),new ct(11,36,36,16,16,new Rt(42,new At(1,86))),new ct(12,40,40,18,18,new Rt(48,new At(1,114))),new ct(13,44,44,20,20,new Rt(56,new At(1,144))),new ct(14,48,48,22,22,new Rt(68,new At(1,174))),new ct(15,52,52,24,24,new Rt(42,new At(2,102))),new ct(16,64,64,14,14,new Rt(56,new At(2,140))),new ct(17,72,72,16,16,new Rt(36,new At(4,92))),new ct(18,80,80,18,18,new Rt(48,new At(4,114))),new ct(19,88,88,20,20,new Rt(56,new At(4,144))),new ct(20,96,96,22,22,new Rt(68,new At(4,174))),new ct(21,104,104,24,24,new Rt(56,new At(6,136))),new ct(22,120,120,18,18,new Rt(68,new At(6,175))),new ct(23,132,132,20,20,new Rt(62,new At(8,163))),new ct(24,144,144,22,22,new Rt(62,new At(8,156),new At(2,155))),new ct(25,8,18,6,16,new Rt(7,new At(1,5))),new ct(26,8,32,6,14,new Rt(11,new At(1,10))),new ct(27,12,26,10,24,new Rt(14,new At(1,16))),new ct(28,12,36,10,16,new Rt(18,new At(1,22))),new ct(29,16,36,14,16,new Rt(24,new At(1,32))),new ct(30,16,48,14,22,new Rt(28,new At(1,49)))]}}ct.VERSIONS=ct.buildVersions();class Sc{constructor(o){const l=o.getHeight();if(l<8||l>144||l&1)throw new D;this.version=Sc.readVersion(o),this.mappingBitMatrix=this.extractDataRegion(o),this.readMappingMatrix=new Te(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(o){const l=o.getHeight(),c=o.getWidth();return ct.getVersionForDimensions(l,c)}readCodewords(){const o=new Int8Array(this.version.getTotalCodewords());let l=0,c=4,h=0;const f=this.mappingBitMatrix.getHeight(),g=this.mappingBitMatrix.getWidth();let w=!1,v=!1,A=!1,N=!1;do if(c===f&&h===0&&!w)o[l++]=this.readCorner1(f,g)&255,c-=2,h+=2,w=!0;else if(c===f-2&&h===0&&g&3&&!v)o[l++]=this.readCorner2(f,g)&255,c-=2,h+=2,v=!0;else if(c===f+4&&h===2&&!(g&7)&&!A)o[l++]=this.readCorner3(f,g)&255,c-=2,h+=2,A=!0;else if(c===f-2&&h===0&&(g&7)===4&&!N)o[l++]=this.readCorner4(f,g)&255,c-=2,h+=2,N=!0;else{do c<f&&h>=0&&!this.readMappingMatrix.get(h,c)&&(o[l++]=this.readUtah(c,h,f,g)&255),c-=2,h+=2;while(c>=0&&h<g);c+=1,h+=3;do c>=0&&h<g&&!this.readMappingMatrix.get(h,c)&&(o[l++]=this.readUtah(c,h,f,g)&255),c+=2,h-=2;while(c<f&&h>=0);c+=3,h+=1}while(c<f||h<g);if(l!==this.version.getTotalCodewords())throw new D;return o}readModule(o,l,c,h){return o<0&&(o+=c,l+=4-(c+4&7)),l<0&&(l+=h,o+=4-(h+4&7)),this.readMappingMatrix.set(l,o),this.mappingBitMatrix.get(l,o)}readUtah(o,l,c,h){let f=0;return this.readModule(o-2,l-2,c,h)&&(f|=1),f<<=1,this.readModule(o-2,l-1,c,h)&&(f|=1),f<<=1,this.readModule(o-1,l-2,c,h)&&(f|=1),f<<=1,this.readModule(o-1,l-1,c,h)&&(f|=1),f<<=1,this.readModule(o-1,l,c,h)&&(f|=1),f<<=1,this.readModule(o,l-2,c,h)&&(f|=1),f<<=1,this.readModule(o,l-1,c,h)&&(f|=1),f<<=1,this.readModule(o,l,c,h)&&(f|=1),f}readCorner1(o,l){let c=0;return this.readModule(o-1,0,o,l)&&(c|=1),c<<=1,this.readModule(o-1,1,o,l)&&(c|=1),c<<=1,this.readModule(o-1,2,o,l)&&(c|=1),c<<=1,this.readModule(0,l-2,o,l)&&(c|=1),c<<=1,this.readModule(0,l-1,o,l)&&(c|=1),c<<=1,this.readModule(1,l-1,o,l)&&(c|=1),c<<=1,this.readModule(2,l-1,o,l)&&(c|=1),c<<=1,this.readModule(3,l-1,o,l)&&(c|=1),c}readCorner2(o,l){let c=0;return this.readModule(o-3,0,o,l)&&(c|=1),c<<=1,this.readModule(o-2,0,o,l)&&(c|=1),c<<=1,this.readModule(o-1,0,o,l)&&(c|=1),c<<=1,this.readModule(0,l-4,o,l)&&(c|=1),c<<=1,this.readModule(0,l-3,o,l)&&(c|=1),c<<=1,this.readModule(0,l-2,o,l)&&(c|=1),c<<=1,this.readModule(0,l-1,o,l)&&(c|=1),c<<=1,this.readModule(1,l-1,o,l)&&(c|=1),c}readCorner3(o,l){let c=0;return this.readModule(o-1,0,o,l)&&(c|=1),c<<=1,this.readModule(o-1,l-1,o,l)&&(c|=1),c<<=1,this.readModule(0,l-3,o,l)&&(c|=1),c<<=1,this.readModule(0,l-2,o,l)&&(c|=1),c<<=1,this.readModule(0,l-1,o,l)&&(c|=1),c<<=1,this.readModule(1,l-3,o,l)&&(c|=1),c<<=1,this.readModule(1,l-2,o,l)&&(c|=1),c<<=1,this.readModule(1,l-1,o,l)&&(c|=1),c}readCorner4(o,l){let c=0;return this.readModule(o-3,0,o,l)&&(c|=1),c<<=1,this.readModule(o-2,0,o,l)&&(c|=1),c<<=1,this.readModule(o-1,0,o,l)&&(c|=1),c<<=1,this.readModule(0,l-2,o,l)&&(c|=1),c<<=1,this.readModule(0,l-1,o,l)&&(c|=1),c<<=1,this.readModule(1,l-1,o,l)&&(c|=1),c<<=1,this.readModule(2,l-1,o,l)&&(c|=1),c<<=1,this.readModule(3,l-1,o,l)&&(c|=1),c}extractDataRegion(o){const l=this.version.getSymbolSizeRows(),c=this.version.getSymbolSizeColumns();if(o.getHeight()!==l)throw new _("Dimension of bitMatrix must match the version size");const h=this.version.getDataRegionSizeRows(),f=this.version.getDataRegionSizeColumns(),g=l/h|0,w=c/f|0,v=g*h,A=w*f,N=new Te(A,v);for(let L=0;L<g;++L){const V=L*h;for(let q=0;q<w;++q){const J=q*f;for(let ee=0;ee<h;++ee){const se=L*(h+2)+1+ee,ce=V+ee;for(let ve=0;ve<f;++ve){const Ee=q*(f+2)+1+ve;if(o.get(Ee,se)){const pe=J+ve;N.set(pe,ce)}}}}}return N}}class dl{constructor(o,l){this.numDataCodewords=o,this.codewords=l}static getDataBlocks(o,l){const c=l.getECBlocks();let h=0;const f=c.getECBlocks();for(let ee of f)h+=ee.getCount();const g=new Array(h);let w=0;for(let ee of f)for(let se=0;se<ee.getCount();se++){const ce=ee.getDataCodewords(),ve=c.getECCodewords()+ce;g[w++]=new dl(ce,new Uint8Array(ve))}const A=g[0].codewords.length-c.getECCodewords(),N=A-1;let L=0;for(let ee=0;ee<N;ee++)for(let se=0;se<w;se++)g[se].codewords[ee]=o[L++];const V=l.getVersionNumber()===24,q=V?8:w;for(let ee=0;ee<q;ee++)g[ee].codewords[A-1]=o[L++];const J=g[0].codewords.length;for(let ee=A;ee<J;ee++)for(let se=0;se<w;se++){const ce=V?(se+8)%w:se,ve=V&&ce>7?ee-1:ee;g[ce].codewords[ve]=o[L++]}if(L!==o.length)throw new _;return g}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class fl{constructor(o){this.bytes=o,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(o){if(o<1||o>32||o>this.available())throw new _(""+o);let l=0,c=this.bitOffset,h=this.byteOffset;const f=this.bytes;if(c>0){const g=8-c,w=o<g?o:g,v=g-w,A=255>>8-w<<v;l=(f[h]&A)>>v,o-=w,c+=w,c===8&&(c=0,h++)}if(o>0){for(;o>=8;)l=l<<8|f[h]&255,h++,o-=8;if(o>0){const g=8-o,w=255>>g<<g;l=l<<o|(f[h]&w)>>g,c+=o}}return this.bitOffset=c,this.byteOffset=h,l}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var Cn;(function(M){M[M.PAD_ENCODE=0]="PAD_ENCODE",M[M.ASCII_ENCODE=1]="ASCII_ENCODE",M[M.C40_ENCODE=2]="C40_ENCODE",M[M.TEXT_ENCODE=3]="TEXT_ENCODE",M[M.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",M[M.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",M[M.BASE256_ENCODE=6]="BASE256_ENCODE"})(Cn||(Cn={}));class Zs{static decode(o){const l=new fl(o),c=new z,h=new z,f=new Array;let g=Cn.ASCII_ENCODE;do if(g===Cn.ASCII_ENCODE)g=this.decodeAsciiSegment(l,c,h);else{switch(g){case Cn.C40_ENCODE:this.decodeC40Segment(l,c);break;case Cn.TEXT_ENCODE:this.decodeTextSegment(l,c);break;case Cn.ANSIX12_ENCODE:this.decodeAnsiX12Segment(l,c);break;case Cn.EDIFACT_ENCODE:this.decodeEdifactSegment(l,c);break;case Cn.BASE256_ENCODE:this.decodeBase256Segment(l,c,f);break;default:throw new D}g=Cn.ASCII_ENCODE}while(g!==Cn.PAD_ENCODE&&l.available()>0);return h.length()>0&&c.append(h.toString()),new Xs(o,c.toString(),f.length===0?null:f,null)}static decodeAsciiSegment(o,l,c){let h=!1;do{let f=o.readBits(8);if(f===0)throw new D;if(f<=128)return h&&(f+=128),l.append(String.fromCharCode(f-1)),Cn.ASCII_ENCODE;if(f===129)return Cn.PAD_ENCODE;if(f<=229){const g=f-130;g<10&&l.append("0"),l.append(""+g)}else switch(f){case 230:return Cn.C40_ENCODE;case 231:return Cn.BASE256_ENCODE;case 232:l.append(String.fromCharCode(29));break;case 233:case 234:break;case 235:h=!0;break;case 236:l.append("[)>05"),c.insert(0,"");break;case 237:l.append("[)>06"),c.insert(0,"");break;case 238:return Cn.ANSIX12_ENCODE;case 239:return Cn.TEXT_ENCODE;case 240:return Cn.EDIFACT_ENCODE;case 241:break;default:if(f!==254||o.available()!==0)throw new D;break}}while(o.available()>0);return Cn.ASCII_ENCODE}static decodeC40Segment(o,l){let c=!1;const h=[];let f=0;do{if(o.available()===8)return;const g=o.readBits(8);if(g===254)return;this.parseTwoBytes(g,o.readBits(8),h);for(let w=0;w<3;w++){const v=h[w];switch(f){case 0:if(v<3)f=v+1;else if(v<this.C40_BASIC_SET_CHARS.length){const A=this.C40_BASIC_SET_CHARS[v];c?(l.append(String.fromCharCode(A.charCodeAt(0)+128)),c=!1):l.append(A)}else throw new D;break;case 1:c?(l.append(String.fromCharCode(v+128)),c=!1):l.append(String.fromCharCode(v)),f=0;break;case 2:if(v<this.C40_SHIFT2_SET_CHARS.length){const A=this.C40_SHIFT2_SET_CHARS[v];c?(l.append(String.fromCharCode(A.charCodeAt(0)+128)),c=!1):l.append(A)}else switch(v){case 27:l.append(String.fromCharCode(29));break;case 30:c=!0;break;default:throw new D}f=0;break;case 3:c?(l.append(String.fromCharCode(v+224)),c=!1):l.append(String.fromCharCode(v+96)),f=0;break;default:throw new D}}}while(o.available()>0)}static decodeTextSegment(o,l){let c=!1,h=[],f=0;do{if(o.available()===8)return;const g=o.readBits(8);if(g===254)return;this.parseTwoBytes(g,o.readBits(8),h);for(let w=0;w<3;w++){const v=h[w];switch(f){case 0:if(v<3)f=v+1;else if(v<this.TEXT_BASIC_SET_CHARS.length){const A=this.TEXT_BASIC_SET_CHARS[v];c?(l.append(String.fromCharCode(A.charCodeAt(0)+128)),c=!1):l.append(A)}else throw new D;break;case 1:c?(l.append(String.fromCharCode(v+128)),c=!1):l.append(String.fromCharCode(v)),f=0;break;case 2:if(v<this.TEXT_SHIFT2_SET_CHARS.length){const A=this.TEXT_SHIFT2_SET_CHARS[v];c?(l.append(String.fromCharCode(A.charCodeAt(0)+128)),c=!1):l.append(A)}else switch(v){case 27:l.append(String.fromCharCode(29));break;case 30:c=!0;break;default:throw new D}f=0;break;case 3:if(v<this.TEXT_SHIFT3_SET_CHARS.length){const A=this.TEXT_SHIFT3_SET_CHARS[v];c?(l.append(String.fromCharCode(A.charCodeAt(0)+128)),c=!1):l.append(A),f=0}else throw new D;break;default:throw new D}}}while(o.available()>0)}static decodeAnsiX12Segment(o,l){const c=[];do{if(o.available()===8)return;const h=o.readBits(8);if(h===254)return;this.parseTwoBytes(h,o.readBits(8),c);for(let f=0;f<3;f++){const g=c[f];switch(g){case 0:l.append("\r");break;case 1:l.append("*");break;case 2:l.append(">");break;case 3:l.append(" ");break;default:if(g<14)l.append(String.fromCharCode(g+44));else if(g<40)l.append(String.fromCharCode(g+51));else throw new D;break}}}while(o.available()>0)}static parseTwoBytes(o,l,c){let h=(o<<8)+l-1,f=Math.floor(h/1600);c[0]=f,h-=f*1600,f=Math.floor(h/40),c[1]=f,c[2]=h-f*40}static decodeEdifactSegment(o,l){do{if(o.available()<=16)return;for(let c=0;c<4;c++){let h=o.readBits(6);if(h===31){const f=8-o.getBitOffset();f!==8&&o.readBits(f);return}h&32||(h|=64),l.append(String.fromCharCode(h))}}while(o.available()>0)}static decodeBase256Segment(o,l,c){let h=1+o.getByteOffset();const f=this.unrandomize255State(o.readBits(8),h++);let g;if(f===0?g=o.available()/8|0:f<250?g=f:g=250*(f-249)+this.unrandomize255State(o.readBits(8),h++),g<0)throw new D;const w=new Uint8Array(g);for(let v=0;v<g;v++){if(o.available()<8)throw new D;w[v]=this.unrandomize255State(o.readBits(8),h++)}c.push(w);try{l.append(X.decode(w,$.ISO88591))}catch(v){throw new _r("Platform does not support required encoding: "+v.message)}}static unrandomize255State(o,l){const c=149*l%255+1,h=o-c;return h>=0?h:h+256}}Zs.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Zs.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],Zs.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Zs.TEXT_SHIFT2_SET_CHARS=Zs.C40_SHIFT2_SET_CHARS,Zs.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)];class Zp{constructor(){this.rsDecoder=new xi(dt.DATA_MATRIX_FIELD_256)}decode(o){const l=new Sc(o),c=l.getVersion(),h=l.readCodewords(),f=dl.getDataBlocks(h,c);let g=0;for(let A of f)g+=A.getNumDataCodewords();const w=new Uint8Array(g),v=f.length;for(let A=0;A<v;A++){const N=f[A],L=N.getCodewords(),V=N.getNumDataCodewords();this.correctErrors(L,V);for(let q=0;q<V;q++)w[q*v+A]=L[q]}return Zs.decode(w)}correctErrors(o,l){const c=new Int32Array(o);try{this.rsDecoder.decode(c,o.length-l)}catch{throw new b}for(let h=0;h<l;h++)o[h]=c[h]}}class yn{constructor(o){this.image=o,this.rectangleDetector=new _e(this.image)}detect(){const o=this.rectangleDetector.detect();let l=this.detectSolid1(o);if(l=this.detectSolid2(l),l[3]=this.correctTopRight(l),!l[3])throw new ie;l=this.shiftToModuleCenter(l);const c=l[0],h=l[1],f=l[2],g=l[3];let w=this.transitionsBetween(c,g)+1,v=this.transitionsBetween(f,g)+1;(w&1)===1&&(w+=1),(v&1)===1&&(v+=1),4*w<7*v&&4*v<7*w&&(w=v=Math.max(w,v));let A=yn.sampleGrid(this.image,c,h,f,g,w,v);return new ue(A,[c,h,f,g])}static shiftPoint(o,l,c){let h=(l.getX()-o.getX())/(c+1),f=(l.getY()-o.getY())/(c+1);return new Z(o.getX()+h,o.getY()+f)}static moveAway(o,l,c){let h=o.getX(),f=o.getY();return h<l?h-=1:h+=1,f<c?f-=1:f+=1,new Z(h,f)}detectSolid1(o){let l=o[0],c=o[1],h=o[3],f=o[2],g=this.transitionsBetween(l,c),w=this.transitionsBetween(c,h),v=this.transitionsBetween(h,f),A=this.transitionsBetween(f,l),N=g,L=[f,l,c,h];return N>w&&(N=w,L[0]=l,L[1]=c,L[2]=h,L[3]=f),N>v&&(N=v,L[0]=c,L[1]=h,L[2]=f,L[3]=l),N>A&&(L[0]=h,L[1]=f,L[2]=l,L[3]=c),L}detectSolid2(o){let l=o[0],c=o[1],h=o[2],f=o[3],g=this.transitionsBetween(l,f),w=yn.shiftPoint(c,h,(g+1)*4),v=yn.shiftPoint(h,c,(g+1)*4),A=this.transitionsBetween(w,l),N=this.transitionsBetween(v,f);return A<N?(o[0]=l,o[1]=c,o[2]=h,o[3]=f):(o[0]=c,o[1]=h,o[2]=f,o[3]=l),o}correctTopRight(o){let l=o[0],c=o[1],h=o[2],f=o[3],g=this.transitionsBetween(l,f),w=this.transitionsBetween(c,f),v=yn.shiftPoint(l,c,(w+1)*4),A=yn.shiftPoint(h,c,(g+1)*4);g=this.transitionsBetween(v,f),w=this.transitionsBetween(A,f);let N=new Z(f.getX()+(h.getX()-c.getX())/(g+1),f.getY()+(h.getY()-c.getY())/(g+1)),L=new Z(f.getX()+(l.getX()-c.getX())/(w+1),f.getY()+(l.getY()-c.getY())/(w+1));if(!this.isValid(N))return this.isValid(L)?L:null;if(!this.isValid(L))return N;let V=this.transitionsBetween(v,N)+this.transitionsBetween(A,N),q=this.transitionsBetween(v,L)+this.transitionsBetween(A,L);return V>q?N:L}shiftToModuleCenter(o){let l=o[0],c=o[1],h=o[2],f=o[3],g=this.transitionsBetween(l,f)+1,w=this.transitionsBetween(h,f)+1,v=yn.shiftPoint(l,c,w*4),A=yn.shiftPoint(h,c,g*4);g=this.transitionsBetween(v,f)+1,w=this.transitionsBetween(A,f)+1,(g&1)===1&&(g+=1),(w&1)===1&&(w+=1);let N=(l.getX()+c.getX()+h.getX()+f.getX())/4,L=(l.getY()+c.getY()+h.getY()+f.getY())/4;l=yn.moveAway(l,N,L),c=yn.moveAway(c,N,L),h=yn.moveAway(h,N,L),f=yn.moveAway(f,N,L);let V,q;return v=yn.shiftPoint(l,c,w*4),v=yn.shiftPoint(v,f,g*4),V=yn.shiftPoint(c,l,w*4),V=yn.shiftPoint(V,h,g*4),A=yn.shiftPoint(h,f,w*4),A=yn.shiftPoint(A,c,g*4),q=yn.shiftPoint(f,h,w*4),q=yn.shiftPoint(q,l,g*4),[v,V,A,q]}isValid(o){return o.getX()>=0&&o.getX()<this.image.getWidth()&&o.getY()>0&&o.getY()<this.image.getHeight()}static sampleGrid(o,l,c,h,f,g,w){return He.getInstance().sampleGrid(o,g,w,.5,.5,g-.5,.5,g-.5,w-.5,.5,w-.5,l.getX(),l.getY(),f.getX(),f.getY(),h.getX(),h.getY(),c.getX(),c.getY())}transitionsBetween(o,l){let c=Math.trunc(o.getX()),h=Math.trunc(o.getY()),f=Math.trunc(l.getX()),g=Math.trunc(l.getY()),w=Math.abs(g-h)>Math.abs(f-c);if(w){let ee=c;c=h,h=ee,ee=f,f=g,g=ee}let v=Math.abs(f-c),A=Math.abs(g-h),N=-v/2,L=h<g?1:-1,V=c<f?1:-1,q=0,J=this.image.get(w?h:c,w?c:h);for(let ee=c,se=h;ee!==f;ee+=V){let ce=this.image.get(w?se:ee,w?ee:se);if(ce!==J&&(q++,J=ce),N+=A,N>0){if(se===g)break;se+=L,N-=v}}return q}}class Js{constructor(){this.decoder=new Zp}decode(o,l=null){let c,h;if(l!=null&&l.has(Q.PURE_BARCODE)){const A=Js.extractPureBits(o.getBlackMatrix());c=this.decoder.decode(A),h=Js.NO_POINTS}else{const A=new yn(o.getBlackMatrix()).detect();c=this.decoder.decode(A.getBits()),h=A.getPoints()}const f=c.getRawBytes(),g=new zt(c.getText(),f,8*f.length,h,Fe.DATA_MATRIX,S.currentTimeMillis()),w=c.getByteSegments();w!=null&&g.putMetadata(pn.BYTE_SEGMENTS,w);const v=c.getECLevel();return v!=null&&g.putMetadata(pn.ERROR_CORRECTION_LEVEL,v),g}reset(){}static extractPureBits(o){const l=o.getTopLeftOnBit(),c=o.getBottomRightOnBit();if(l==null||c==null)throw new ie;const h=this.moduleSize(l,o);let f=l[1];const g=c[1];let w=l[0];const A=(c[0]-w+1)/h,N=(g-f+1)/h;if(A<=0||N<=0)throw new ie;const L=h/2;f+=L,w+=L;const V=new Te(A,N);for(let q=0;q<N;q++){const J=f+q*h;for(let ee=0;ee<A;ee++)o.get(w+ee*h,J)&&V.set(ee,q)}return V}static moduleSize(o,l){const c=l.getWidth();let h=o[0];const f=o[1];for(;h<c&&l.get(h,f);)h++;if(h===c)throw new ie;const g=h-o[0];if(g===0)throw new ie;return g}}Js.NO_POINTS=[];class h0 extends _t{constructor(o=500){super(new Js,o)}}var $o;(function(M){M[M.L=0]="L",M[M.M=1]="M",M[M.Q=2]="Q",M[M.H=3]="H"})($o||($o={}));class bt{constructor(o,l,c){this.value=o,this.stringValue=l,this.bits=c,bt.FOR_BITS.set(c,this),bt.FOR_VALUE.set(o,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(o){switch(o){case"L":return bt.L;case"M":return bt.M;case"Q":return bt.Q;case"H":return bt.H;default:throw new y(o+"not available")}}toString(){return this.stringValue}equals(o){if(!(o instanceof bt))return!1;const l=o;return this.value===l.value}static forBits(o){if(o<0||o>=bt.FOR_BITS.size)throw new _;return bt.FOR_BITS.get(o)}}bt.FOR_BITS=new Map,bt.FOR_VALUE=new Map,bt.L=new bt($o.L,"L",1),bt.M=new bt($o.M,"M",0),bt.Q=new bt($o.Q,"Q",3),bt.H=new bt($o.H,"H",2);class Qt{constructor(o){this.errorCorrectionLevel=bt.forBits(o>>3&3),this.dataMask=o&7}static numBitsDiffering(o,l){return R.bitCount(o^l)}static decodeFormatInformation(o,l){const c=Qt.doDecodeFormatInformation(o,l);return c!==null?c:Qt.doDecodeFormatInformation(o^Qt.FORMAT_INFO_MASK_QR,l^Qt.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(o,l){let c=Number.MAX_SAFE_INTEGER,h=0;for(const f of Qt.FORMAT_INFO_DECODE_LOOKUP){const g=f[0];if(g===o||g===l)return new Qt(f[1]);let w=Qt.numBitsDiffering(o,g);w<c&&(h=f[1],c=w),o!==l&&(w=Qt.numBitsDiffering(l,g),w<c&&(h=f[1],c=w))}return c<=3?new Qt(h):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(o){if(!(o instanceof Qt))return!1;const l=o;return this.errorCorrectionLevel===l.errorCorrectionLevel&&this.dataMask===l.dataMask}}Qt.FORMAT_INFO_MASK_QR=21522,Qt.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class re{constructor(o,...l){this.ecCodewordsPerBlock=o,this.ecBlocks=l}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let o=0;const l=this.ecBlocks;for(const c of l)o+=c.getCount();return o}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class G{constructor(o,l){this.count=o,this.dataCodewords=l}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Ve{constructor(o,l,...c){this.versionNumber=o,this.alignmentPatternCenters=l,this.ecBlocks=c;let h=0;const f=c[0].getECCodewordsPerBlock(),g=c[0].getECBlocks();for(const w of g)h+=w.getCount()*(w.getDataCodewords()+f);this.totalCodewords=h}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(o){return this.ecBlocks[o.getValue()]}static getProvisionalVersionForDimension(o){if(o%4!==1)throw new D;try{return this.getVersionForNumber((o-17)/4)}catch{throw new D}}static getVersionForNumber(o){if(o<1||o>40)throw new _;return Ve.VERSIONS[o-1]}static decodeVersionInformation(o){let l=Number.MAX_SAFE_INTEGER,c=0;for(let h=0;h<Ve.VERSION_DECODE_INFO.length;h++){const f=Ve.VERSION_DECODE_INFO[h];if(f===o)return Ve.getVersionForNumber(h+7);const g=Qt.numBitsDiffering(o,f);g<l&&(c=h+7,l=g)}return l<=3?Ve.getVersionForNumber(c):null}buildFunctionPattern(){const o=this.getDimensionForVersion(),l=new Te(o);l.setRegion(0,0,9,9),l.setRegion(o-8,0,8,9),l.setRegion(0,o-8,9,8);const c=this.alignmentPatternCenters.length;for(let h=0;h<c;h++){const f=this.alignmentPatternCenters[h]-2;for(let g=0;g<c;g++)h===0&&(g===0||g===c-1)||h===c-1&&g===0||l.setRegion(this.alignmentPatternCenters[g]-2,f,5,5)}return l.setRegion(6,9,1,o-17),l.setRegion(9,6,o-17,1),this.versionNumber>6&&(l.setRegion(o-11,0,3,6),l.setRegion(0,o-11,6,3)),l}toString(){return""+this.versionNumber}}Ve.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),Ve.VERSIONS=[new Ve(1,new Int32Array(0),new re(7,new G(1,19)),new re(10,new G(1,16)),new re(13,new G(1,13)),new re(17,new G(1,9))),new Ve(2,Int32Array.from([6,18]),new re(10,new G(1,34)),new re(16,new G(1,28)),new re(22,new G(1,22)),new re(28,new G(1,16))),new Ve(3,Int32Array.from([6,22]),new re(15,new G(1,55)),new re(26,new G(1,44)),new re(18,new G(2,17)),new re(22,new G(2,13))),new Ve(4,Int32Array.from([6,26]),new re(20,new G(1,80)),new re(18,new G(2,32)),new re(26,new G(2,24)),new re(16,new G(4,9))),new Ve(5,Int32Array.from([6,30]),new re(26,new G(1,108)),new re(24,new G(2,43)),new re(18,new G(2,15),new G(2,16)),new re(22,new G(2,11),new G(2,12))),new Ve(6,Int32Array.from([6,34]),new re(18,new G(2,68)),new re(16,new G(4,27)),new re(24,new G(4,19)),new re(28,new G(4,15))),new Ve(7,Int32Array.from([6,22,38]),new re(20,new G(2,78)),new re(18,new G(4,31)),new re(18,new G(2,14),new G(4,15)),new re(26,new G(4,13),new G(1,14))),new Ve(8,Int32Array.from([6,24,42]),new re(24,new G(2,97)),new re(22,new G(2,38),new G(2,39)),new re(22,new G(4,18),new G(2,19)),new re(26,new G(4,14),new G(2,15))),new Ve(9,Int32Array.from([6,26,46]),new re(30,new G(2,116)),new re(22,new G(3,36),new G(2,37)),new re(20,new G(4,16),new G(4,17)),new re(24,new G(4,12),new G(4,13))),new Ve(10,Int32Array.from([6,28,50]),new re(18,new G(2,68),new G(2,69)),new re(26,new G(4,43),new G(1,44)),new re(24,new G(6,19),new G(2,20)),new re(28,new G(6,15),new G(2,16))),new Ve(11,Int32Array.from([6,30,54]),new re(20,new G(4,81)),new re(30,new G(1,50),new G(4,51)),new re(28,new G(4,22),new G(4,23)),new re(24,new G(3,12),new G(8,13))),new Ve(12,Int32Array.from([6,32,58]),new re(24,new G(2,92),new G(2,93)),new re(22,new G(6,36),new G(2,37)),new re(26,new G(4,20),new G(6,21)),new re(28,new G(7,14),new G(4,15))),new Ve(13,Int32Array.from([6,34,62]),new re(26,new G(4,107)),new re(22,new G(8,37),new G(1,38)),new re(24,new G(8,20),new G(4,21)),new re(22,new G(12,11),new G(4,12))),new Ve(14,Int32Array.from([6,26,46,66]),new re(30,new G(3,115),new G(1,116)),new re(24,new G(4,40),new G(5,41)),new re(20,new G(11,16),new G(5,17)),new re(24,new G(11,12),new G(5,13))),new Ve(15,Int32Array.from([6,26,48,70]),new re(22,new G(5,87),new G(1,88)),new re(24,new G(5,41),new G(5,42)),new re(30,new G(5,24),new G(7,25)),new re(24,new G(11,12),new G(7,13))),new Ve(16,Int32Array.from([6,26,50,74]),new re(24,new G(5,98),new G(1,99)),new re(28,new G(7,45),new G(3,46)),new re(24,new G(15,19),new G(2,20)),new re(30,new G(3,15),new G(13,16))),new Ve(17,Int32Array.from([6,30,54,78]),new re(28,new G(1,107),new G(5,108)),new re(28,new G(10,46),new G(1,47)),new re(28,new G(1,22),new G(15,23)),new re(28,new G(2,14),new G(17,15))),new Ve(18,Int32Array.from([6,30,56,82]),new re(30,new G(5,120),new G(1,121)),new re(26,new G(9,43),new G(4,44)),new re(28,new G(17,22),new G(1,23)),new re(28,new G(2,14),new G(19,15))),new Ve(19,Int32Array.from([6,30,58,86]),new re(28,new G(3,113),new G(4,114)),new re(26,new G(3,44),new G(11,45)),new re(26,new G(17,21),new G(4,22)),new re(26,new G(9,13),new G(16,14))),new Ve(20,Int32Array.from([6,34,62,90]),new re(28,new G(3,107),new G(5,108)),new re(26,new G(3,41),new G(13,42)),new re(30,new G(15,24),new G(5,25)),new re(28,new G(15,15),new G(10,16))),new Ve(21,Int32Array.from([6,28,50,72,94]),new re(28,new G(4,116),new G(4,117)),new re(26,new G(17,42)),new re(28,new G(17,22),new G(6,23)),new re(30,new G(19,16),new G(6,17))),new Ve(22,Int32Array.from([6,26,50,74,98]),new re(28,new G(2,111),new G(7,112)),new re(28,new G(17,46)),new re(30,new G(7,24),new G(16,25)),new re(24,new G(34,13))),new Ve(23,Int32Array.from([6,30,54,78,102]),new re(30,new G(4,121),new G(5,122)),new re(28,new G(4,47),new G(14,48)),new re(30,new G(11,24),new G(14,25)),new re(30,new G(16,15),new G(14,16))),new Ve(24,Int32Array.from([6,28,54,80,106]),new re(30,new G(6,117),new G(4,118)),new re(28,new G(6,45),new G(14,46)),new re(30,new G(11,24),new G(16,25)),new re(30,new G(30,16),new G(2,17))),new Ve(25,Int32Array.from([6,32,58,84,110]),new re(26,new G(8,106),new G(4,107)),new re(28,new G(8,47),new G(13,48)),new re(30,new G(7,24),new G(22,25)),new re(30,new G(22,15),new G(13,16))),new Ve(26,Int32Array.from([6,30,58,86,114]),new re(28,new G(10,114),new G(2,115)),new re(28,new G(19,46),new G(4,47)),new re(28,new G(28,22),new G(6,23)),new re(30,new G(33,16),new G(4,17))),new Ve(27,Int32Array.from([6,34,62,90,118]),new re(30,new G(8,122),new G(4,123)),new re(28,new G(22,45),new G(3,46)),new re(30,new G(8,23),new G(26,24)),new re(30,new G(12,15),new G(28,16))),new Ve(28,Int32Array.from([6,26,50,74,98,122]),new re(30,new G(3,117),new G(10,118)),new re(28,new G(3,45),new G(23,46)),new re(30,new G(4,24),new G(31,25)),new re(30,new G(11,15),new G(31,16))),new Ve(29,Int32Array.from([6,30,54,78,102,126]),new re(30,new G(7,116),new G(7,117)),new re(28,new G(21,45),new G(7,46)),new re(30,new G(1,23),new G(37,24)),new re(30,new G(19,15),new G(26,16))),new Ve(30,Int32Array.from([6,26,52,78,104,130]),new re(30,new G(5,115),new G(10,116)),new re(28,new G(19,47),new G(10,48)),new re(30,new G(15,24),new G(25,25)),new re(30,new G(23,15),new G(25,16))),new Ve(31,Int32Array.from([6,30,56,82,108,134]),new re(30,new G(13,115),new G(3,116)),new re(28,new G(2,46),new G(29,47)),new re(30,new G(42,24),new G(1,25)),new re(30,new G(23,15),new G(28,16))),new Ve(32,Int32Array.from([6,34,60,86,112,138]),new re(30,new G(17,115)),new re(28,new G(10,46),new G(23,47)),new re(30,new G(10,24),new G(35,25)),new re(30,new G(19,15),new G(35,16))),new Ve(33,Int32Array.from([6,30,58,86,114,142]),new re(30,new G(17,115),new G(1,116)),new re(28,new G(14,46),new G(21,47)),new re(30,new G(29,24),new G(19,25)),new re(30,new G(11,15),new G(46,16))),new Ve(34,Int32Array.from([6,34,62,90,118,146]),new re(30,new G(13,115),new G(6,116)),new re(28,new G(14,46),new G(23,47)),new re(30,new G(44,24),new G(7,25)),new re(30,new G(59,16),new G(1,17))),new Ve(35,Int32Array.from([6,30,54,78,102,126,150]),new re(30,new G(12,121),new G(7,122)),new re(28,new G(12,47),new G(26,48)),new re(30,new G(39,24),new G(14,25)),new re(30,new G(22,15),new G(41,16))),new Ve(36,Int32Array.from([6,24,50,76,102,128,154]),new re(30,new G(6,121),new G(14,122)),new re(28,new G(6,47),new G(34,48)),new re(30,new G(46,24),new G(10,25)),new re(30,new G(2,15),new G(64,16))),new Ve(37,Int32Array.from([6,28,54,80,106,132,158]),new re(30,new G(17,122),new G(4,123)),new re(28,new G(29,46),new G(14,47)),new re(30,new G(49,24),new G(10,25)),new re(30,new G(24,15),new G(46,16))),new Ve(38,Int32Array.from([6,32,58,84,110,136,162]),new re(30,new G(4,122),new G(18,123)),new re(28,new G(13,46),new G(32,47)),new re(30,new G(48,24),new G(14,25)),new re(30,new G(42,15),new G(32,16))),new Ve(39,Int32Array.from([6,26,54,82,110,138,166]),new re(30,new G(20,117),new G(4,118)),new re(28,new G(40,47),new G(7,48)),new re(30,new G(43,24),new G(22,25)),new re(30,new G(10,15),new G(67,16))),new Ve(40,Int32Array.from([6,30,58,86,114,142,170]),new re(30,new G(19,118),new G(6,119)),new re(28,new G(18,47),new G(31,48)),new re(30,new G(34,24),new G(34,25)),new re(30,new G(20,15),new G(61,16)))];var et;(function(M){M[M.DATA_MASK_000=0]="DATA_MASK_000",M[M.DATA_MASK_001=1]="DATA_MASK_001",M[M.DATA_MASK_010=2]="DATA_MASK_010",M[M.DATA_MASK_011=3]="DATA_MASK_011",M[M.DATA_MASK_100=4]="DATA_MASK_100",M[M.DATA_MASK_101=5]="DATA_MASK_101",M[M.DATA_MASK_110=6]="DATA_MASK_110",M[M.DATA_MASK_111=7]="DATA_MASK_111"})(et||(et={}));class Er{constructor(o,l){this.value=o,this.isMasked=l}unmaskBitMatrix(o,l){for(let c=0;c<l;c++)for(let h=0;h<l;h++)this.isMasked(c,h)&&o.flip(h,c)}}Er.values=new Map([[et.DATA_MASK_000,new Er(et.DATA_MASK_000,(M,o)=>(M+o&1)===0)],[et.DATA_MASK_001,new Er(et.DATA_MASK_001,(M,o)=>(M&1)===0)],[et.DATA_MASK_010,new Er(et.DATA_MASK_010,(M,o)=>o%3===0)],[et.DATA_MASK_011,new Er(et.DATA_MASK_011,(M,o)=>(M+o)%3===0)],[et.DATA_MASK_100,new Er(et.DATA_MASK_100,(M,o)=>(Math.floor(M/2)+Math.floor(o/3)&1)===0)],[et.DATA_MASK_101,new Er(et.DATA_MASK_101,(M,o)=>M*o%6===0)],[et.DATA_MASK_110,new Er(et.DATA_MASK_110,(M,o)=>M*o%6<3)],[et.DATA_MASK_111,new Er(et.DATA_MASK_111,(M,o)=>(M+o+M*o%3&1)===0)]]);class ml{constructor(o){const l=o.getHeight();if(l<21||(l&3)!==1)throw new D;this.bitMatrix=o}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let o=0;for(let f=0;f<6;f++)o=this.copyBit(f,8,o);o=this.copyBit(7,8,o),o=this.copyBit(8,8,o),o=this.copyBit(8,7,o);for(let f=5;f>=0;f--)o=this.copyBit(8,f,o);const l=this.bitMatrix.getHeight();let c=0;const h=l-7;for(let f=l-1;f>=h;f--)c=this.copyBit(8,f,c);for(let f=l-8;f<l;f++)c=this.copyBit(f,8,c);if(this.parsedFormatInfo=Qt.decodeFormatInformation(o,c),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new D}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const o=this.bitMatrix.getHeight(),l=Math.floor((o-17)/4);if(l<=6)return Ve.getVersionForNumber(l);let c=0;const h=o-11;for(let g=5;g>=0;g--)for(let w=o-9;w>=h;w--)c=this.copyBit(w,g,c);let f=Ve.decodeVersionInformation(c);if(f!==null&&f.getDimensionForVersion()===o)return this.parsedVersion=f,f;c=0;for(let g=5;g>=0;g--)for(let w=o-9;w>=h;w--)c=this.copyBit(g,w,c);if(f=Ve.decodeVersionInformation(c),f!==null&&f.getDimensionForVersion()===o)return this.parsedVersion=f,f;throw new D}copyBit(o,l,c){return(this.isMirror?this.bitMatrix.get(l,o):this.bitMatrix.get(o,l))?c<<1|1:c<<1}readCodewords(){const o=this.readFormatInformation(),l=this.readVersion(),c=Er.values.get(o.getDataMask()),h=this.bitMatrix.getHeight();c.unmaskBitMatrix(this.bitMatrix,h);const f=l.buildFunctionPattern();let g=!0;const w=new Uint8Array(l.getTotalCodewords());let v=0,A=0,N=0;for(let L=h-1;L>0;L-=2){L===6&&L--;for(let V=0;V<h;V++){const q=g?h-1-V:V;for(let J=0;J<2;J++)f.get(L-J,q)||(N++,A<<=1,this.bitMatrix.get(L-J,q)&&(A|=1),N===8&&(w[v++]=A,N=0,A=0))}g=!g}if(v!==l.getTotalCodewords())throw new D;return w}remask(){if(this.parsedFormatInfo===null)return;const o=Er.values[this.parsedFormatInfo.getDataMask()],l=this.bitMatrix.getHeight();o.unmaskBitMatrix(this.bitMatrix,l)}setMirror(o){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=o}mirror(){const o=this.bitMatrix;for(let l=0,c=o.getWidth();l<c;l++)for(let h=l+1,f=o.getHeight();h<f;h++)o.get(l,h)!==o.get(h,l)&&(o.flip(h,l),o.flip(l,h))}}class no{constructor(o,l){this.numDataCodewords=o,this.codewords=l}static getDataBlocks(o,l,c){if(o.length!==l.getTotalCodewords())throw new _;const h=l.getECBlocksForLevel(c);let f=0;const g=h.getECBlocks();for(const J of g)f+=J.getCount();const w=new Array(f);let v=0;for(const J of g)for(let ee=0;ee<J.getCount();ee++){const se=J.getDataCodewords(),ce=h.getECCodewordsPerBlock()+se;w[v++]=new no(se,new Uint8Array(ce))}const A=w[0].codewords.length;let N=w.length-1;for(;N>=0&&w[N].codewords.length!==A;)N--;N++;const L=A-h.getECCodewordsPerBlock();let V=0;for(let J=0;J<L;J++)for(let ee=0;ee<v;ee++)w[ee].codewords[J]=o[V++];for(let J=N;J<v;J++)w[J].codewords[L]=o[V++];const q=w[0].codewords.length;for(let J=L;J<q;J++)for(let ee=0;ee<v;ee++){const se=ee<N?J:J+1;w[ee].codewords[se]=o[V++]}return w}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var as;(function(M){M[M.TERMINATOR=0]="TERMINATOR",M[M.NUMERIC=1]="NUMERIC",M[M.ALPHANUMERIC=2]="ALPHANUMERIC",M[M.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",M[M.BYTE=4]="BYTE",M[M.ECI=5]="ECI",M[M.KANJI=6]="KANJI",M[M.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",M[M.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",M[M.HANZI=9]="HANZI"})(as||(as={}));class ze{constructor(o,l,c,h){this.value=o,this.stringValue=l,this.characterCountBitsForVersions=c,this.bits=h,ze.FOR_BITS.set(h,this),ze.FOR_VALUE.set(o,this)}static forBits(o){const l=ze.FOR_BITS.get(o);if(l===void 0)throw new _;return l}getCharacterCountBits(o){const l=o.getVersionNumber();let c;return l<=9?c=0:l<=26?c=1:c=2,this.characterCountBitsForVersions[c]}getValue(){return this.value}getBits(){return this.bits}equals(o){if(!(o instanceof ze))return!1;const l=o;return this.value===l.value}toString(){return this.stringValue}}ze.FOR_BITS=new Map,ze.FOR_VALUE=new Map,ze.TERMINATOR=new ze(as.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),ze.NUMERIC=new ze(as.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),ze.ALPHANUMERIC=new ze(as.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),ze.STRUCTURED_APPEND=new ze(as.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),ze.BYTE=new ze(as.BYTE,"BYTE",Int32Array.from([8,16,16]),4),ze.ECI=new ze(as.ECI,"ECI",Int32Array.from([0,0,0]),7),ze.KANJI=new ze(as.KANJI,"KANJI",Int32Array.from([8,10,12]),8),ze.FNC1_FIRST_POSITION=new ze(as.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),ze.FNC1_SECOND_POSITION=new ze(as.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),ze.HANZI=new ze(as.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class en{static decode(o,l,c,h){const f=new fl(o);let g=new z;const w=new Array;let v=-1,A=-1;try{let N=null,L=!1,V;do{if(f.available()<4)V=ze.TERMINATOR;else{const q=f.readBits(4);V=ze.forBits(q)}switch(V){case ze.TERMINATOR:break;case ze.FNC1_FIRST_POSITION:case ze.FNC1_SECOND_POSITION:L=!0;break;case ze.STRUCTURED_APPEND:if(f.available()<16)throw new D;v=f.readBits(8),A=f.readBits(8);break;case ze.ECI:const q=en.parseECIValue(f);if(N=F.getCharacterSetECIByValue(q),N===null)throw new D;break;case ze.HANZI:const J=f.readBits(4),ee=f.readBits(V.getCharacterCountBits(l));J===en.GB2312_SUBSET&&en.decodeHanziSegment(f,g,ee);break;default:const se=f.readBits(V.getCharacterCountBits(l));switch(V){case ze.NUMERIC:en.decodeNumericSegment(f,g,se);break;case ze.ALPHANUMERIC:en.decodeAlphanumericSegment(f,g,se,L);break;case ze.BYTE:en.decodeByteSegment(f,g,se,N,w,h);break;case ze.KANJI:en.decodeKanjiSegment(f,g,se);break;default:throw new D}break}}while(V!==ze.TERMINATOR)}catch{throw new D}return new Xs(o,g.toString(),w.length===0?null:w,c===null?null:c.toString(),v,A)}static decodeHanziSegment(o,l,c){if(c*13>o.available())throw new D;const h=new Uint8Array(2*c);let f=0;for(;c>0;){const g=o.readBits(13);let w=g/96<<8&4294967295|g%96;w<959?w+=41377:w+=42657,h[f]=w>>8&255,h[f+1]=w&255,f+=2,c--}try{l.append(X.decode(h,$.GB2312))}catch(g){throw new D(g)}}static decodeKanjiSegment(o,l,c){if(c*13>o.available())throw new D;const h=new Uint8Array(2*c);let f=0;for(;c>0;){const g=o.readBits(13);let w=g/192<<8&4294967295|g%192;w<7936?w+=33088:w+=49472,h[f]=w>>8,h[f+1]=w,f+=2,c--}try{l.append(X.decode(h,$.SHIFT_JIS))}catch(g){throw new D(g)}}static decodeByteSegment(o,l,c,h,f,g){if(8*c>o.available())throw new D;const w=new Uint8Array(c);for(let A=0;A<c;A++)w[A]=o.readBits(8);let v;h===null?v=$.guessEncoding(w,g):v=h.getName();try{l.append(X.decode(w,v))}catch(A){throw new D(A)}f.push(w)}static toAlphaNumericChar(o){if(o>=en.ALPHANUMERIC_CHARS.length)throw new D;return en.ALPHANUMERIC_CHARS[o]}static decodeAlphanumericSegment(o,l,c,h){const f=l.length();for(;c>1;){if(o.available()<11)throw new D;const g=o.readBits(11);l.append(en.toAlphaNumericChar(Math.floor(g/45))),l.append(en.toAlphaNumericChar(g%45)),c-=2}if(c===1){if(o.available()<6)throw new D;l.append(en.toAlphaNumericChar(o.readBits(6)))}if(h)for(let g=f;g<l.length();g++)l.charAt(g)==="%"&&(g<l.length()-1&&l.charAt(g+1)==="%"?l.deleteCharAt(g+1):l.setCharAt(g,String.fromCharCode(29)))}static decodeNumericSegment(o,l,c){for(;c>=3;){if(o.available()<10)throw new D;const h=o.readBits(10);if(h>=1e3)throw new D;l.append(en.toAlphaNumericChar(Math.floor(h/100))),l.append(en.toAlphaNumericChar(Math.floor(h/10)%10)),l.append(en.toAlphaNumericChar(h%10)),c-=3}if(c===2){if(o.available()<7)throw new D;const h=o.readBits(7);if(h>=100)throw new D;l.append(en.toAlphaNumericChar(Math.floor(h/10))),l.append(en.toAlphaNumericChar(h%10))}else if(c===1){if(o.available()<4)throw new D;const h=o.readBits(4);if(h>=10)throw new D;l.append(en.toAlphaNumericChar(h))}}static parseECIValue(o){const l=o.readBits(8);if(!(l&128))return l&127;if((l&192)===128){const c=o.readBits(8);return(l&63)<<8&4294967295|c}if((l&224)===192){const c=o.readBits(16);return(l&31)<<16&4294967295|c}throw new D}}en.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",en.GB2312_SUBSET=1;class d0{constructor(o){this.mirrored=o}isMirrored(){return this.mirrored}applyMirroredCorrection(o){if(!this.mirrored||o===null||o.length<3)return;const l=o[0];o[0]=o[2],o[2]=l}}class Jp{constructor(){this.rsDecoder=new xi(dt.QR_CODE_FIELD_256)}decodeBooleanArray(o,l){return this.decodeBitMatrix(Te.parseFromBooleanArray(o),l)}decodeBitMatrix(o,l){const c=new ml(o);let h=null;try{return this.decodeBitMatrixParser(c,l)}catch(f){h=f}try{c.remask(),c.setMirror(!0),c.readVersion(),c.readFormatInformation(),c.mirror();const f=this.decodeBitMatrixParser(c,l);return f.setOther(new d0(!0)),f}catch(f){throw h!==null?h:f}}decodeBitMatrixParser(o,l){const c=o.readVersion(),h=o.readFormatInformation().getErrorCorrectionLevel(),f=o.readCodewords(),g=no.getDataBlocks(f,c,h);let w=0;for(const N of g)w+=N.getNumDataCodewords();const v=new Uint8Array(w);let A=0;for(const N of g){const L=N.getCodewords(),V=N.getNumDataCodewords();this.correctErrors(L,V);for(let q=0;q<V;q++)v[A++]=L[q]}return en.decode(v,c,h,l)}correctErrors(o,l){const c=new Int32Array(o);try{this.rsDecoder.decode(c,o.length-l)}catch{throw new b}for(let h=0;h<l;h++)o[h]=c[h]}}class Nh extends Z{constructor(o,l,c){super(o,l),this.estimatedModuleSize=c}aboutEquals(o,l,c){if(Math.abs(l-this.getY())<=o&&Math.abs(c-this.getX())<=o){const h=Math.abs(o-this.estimatedModuleSize);return h<=1||h<=this.estimatedModuleSize}return!1}combineEstimate(o,l,c){const h=(this.getX()+l)/2,f=(this.getY()+o)/2,g=(this.estimatedModuleSize+c)/2;return new Nh(h,f,g)}}class bi{constructor(o,l,c,h,f,g,w){this.image=o,this.startX=l,this.startY=c,this.width=h,this.height=f,this.moduleSize=g,this.resultPointCallback=w,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const o=this.startX,l=this.height,c=this.width,h=o+c,f=this.startY+l/2,g=new Int32Array(3),w=this.image;for(let v=0;v<l;v++){const A=f+(v&1?-Math.floor((v+1)/2):Math.floor((v+1)/2));g[0]=0,g[1]=0,g[2]=0;let N=o;for(;N<h&&!w.get(N,A);)N++;let L=0;for(;N<h;){if(w.get(N,A))if(L===1)g[1]++;else if(L===2){if(this.foundPatternCross(g)){const V=this.handlePossibleCenter(g,A,N);if(V!==null)return V}g[0]=g[2],g[1]=1,g[2]=0,L=1}else g[++L]++;else L===1&&L++,g[L]++;N++}if(this.foundPatternCross(g)){const V=this.handlePossibleCenter(g,A,h);if(V!==null)return V}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new ie}static centerFromEnd(o,l){return l-o[2]-o[1]/2}foundPatternCross(o){const l=this.moduleSize,c=l/2;for(let h=0;h<3;h++)if(Math.abs(l-o[h])>=c)return!1;return!0}crossCheckVertical(o,l,c,h){const f=this.image,g=f.getHeight(),w=this.crossCheckStateCount;w[0]=0,w[1]=0,w[2]=0;let v=o;for(;v>=0&&f.get(l,v)&&w[1]<=c;)w[1]++,v--;if(v<0||w[1]>c)return NaN;for(;v>=0&&!f.get(l,v)&&w[0]<=c;)w[0]++,v--;if(w[0]>c)return NaN;for(v=o+1;v<g&&f.get(l,v)&&w[1]<=c;)w[1]++,v++;if(v===g||w[1]>c)return NaN;for(;v<g&&!f.get(l,v)&&w[2]<=c;)w[2]++,v++;if(w[2]>c)return NaN;const A=w[0]+w[1]+w[2];return 5*Math.abs(A-h)>=2*h?NaN:this.foundPatternCross(w)?bi.centerFromEnd(w,v):NaN}handlePossibleCenter(o,l,c){const h=o[0]+o[1]+o[2],f=bi.centerFromEnd(o,c),g=this.crossCheckVertical(l,f,2*o[1],h);if(!isNaN(g)){const w=(o[0]+o[1]+o[2])/3;for(const A of this.possibleCenters)if(A.aboutEquals(w,g,f))return A.combineEstimate(g,f,w);const v=new Nh(f,g,w);this.possibleCenters.push(v),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(v)}return null}}class Fs extends Z{constructor(o,l,c,h){super(o,l),this.estimatedModuleSize=c,this.count=h,h===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(o,l,c){if(Math.abs(l-this.getY())<=o&&Math.abs(c-this.getX())<=o){const h=Math.abs(o-this.estimatedModuleSize);return h<=1||h<=this.estimatedModuleSize}return!1}combineEstimate(o,l,c){const h=this.count+1,f=(this.count*this.getX()+l)/h,g=(this.count*this.getY()+o)/h,w=(this.count*this.estimatedModuleSize+c)/h;return new Fs(f,g,w,h)}}class f0{constructor(o){this.bottomLeft=o[0],this.topLeft=o[1],this.topRight=o[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class jn{constructor(o,l){this.image=o,this.resultPointCallback=l,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=l}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(o){const l=o!=null&&o.get(Q.TRY_HARDER)!==void 0,c=o!=null&&o.get(Q.PURE_BARCODE)!==void 0,h=this.image,f=h.getHeight(),g=h.getWidth();let w=Math.floor(3*f/(4*jn.MAX_MODULES));(w<jn.MIN_SKIP||l)&&(w=jn.MIN_SKIP);let v=!1;const A=new Int32Array(5);for(let L=w-1;L<f&&!v;L+=w){A[0]=0,A[1]=0,A[2]=0,A[3]=0,A[4]=0;let V=0;for(let q=0;q<g;q++)if(h.get(q,L))(V&1)===1&&V++,A[V]++;else if(V&1)A[V]++;else if(V===4)if(jn.foundPatternCross(A)){if(this.handlePossibleCenter(A,L,q,c)===!0)if(w=2,this.hasSkipped===!0)v=this.haveMultiplyConfirmedCenters();else{const ee=this.findRowSkip();ee>A[2]&&(L+=ee-A[2]-w,q=g-1)}else{A[0]=A[2],A[1]=A[3],A[2]=A[4],A[3]=1,A[4]=0,V=3;continue}V=0,A[0]=0,A[1]=0,A[2]=0,A[3]=0,A[4]=0}else A[0]=A[2],A[1]=A[3],A[2]=A[4],A[3]=1,A[4]=0,V=3;else A[++V]++;jn.foundPatternCross(A)&&this.handlePossibleCenter(A,L,g,c)===!0&&(w=A[0],this.hasSkipped&&(v=this.haveMultiplyConfirmedCenters()))}const N=this.selectBestPatterns();return Z.orderBestPatterns(N),new f0(N)}static centerFromEnd(o,l){return l-o[4]-o[3]-o[2]/2}static foundPatternCross(o){let l=0;for(let f=0;f<5;f++){const g=o[f];if(g===0)return!1;l+=g}if(l<7)return!1;const c=l/7,h=c/2;return Math.abs(c-o[0])<h&&Math.abs(c-o[1])<h&&Math.abs(3*c-o[2])<3*h&&Math.abs(c-o[3])<h&&Math.abs(c-o[4])<h}getCrossCheckStateCount(){const o=this.crossCheckStateCount;return o[0]=0,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o}crossCheckDiagonal(o,l,c,h){const f=this.getCrossCheckStateCount();let g=0;const w=this.image;for(;o>=g&&l>=g&&w.get(l-g,o-g);)f[2]++,g++;if(o<g||l<g)return!1;for(;o>=g&&l>=g&&!w.get(l-g,o-g)&&f[1]<=c;)f[1]++,g++;if(o<g||l<g||f[1]>c)return!1;for(;o>=g&&l>=g&&w.get(l-g,o-g)&&f[0]<=c;)f[0]++,g++;if(f[0]>c)return!1;const v=w.getHeight(),A=w.getWidth();for(g=1;o+g<v&&l+g<A&&w.get(l+g,o+g);)f[2]++,g++;if(o+g>=v||l+g>=A)return!1;for(;o+g<v&&l+g<A&&!w.get(l+g,o+g)&&f[3]<c;)f[3]++,g++;if(o+g>=v||l+g>=A||f[3]>=c)return!1;for(;o+g<v&&l+g<A&&w.get(l+g,o+g)&&f[4]<c;)f[4]++,g++;if(f[4]>=c)return!1;const N=f[0]+f[1]+f[2]+f[3]+f[4];return Math.abs(N-h)<2*h&&jn.foundPatternCross(f)}crossCheckVertical(o,l,c,h){const f=this.image,g=f.getHeight(),w=this.getCrossCheckStateCount();let v=o;for(;v>=0&&f.get(l,v);)w[2]++,v--;if(v<0)return NaN;for(;v>=0&&!f.get(l,v)&&w[1]<=c;)w[1]++,v--;if(v<0||w[1]>c)return NaN;for(;v>=0&&f.get(l,v)&&w[0]<=c;)w[0]++,v--;if(w[0]>c)return NaN;for(v=o+1;v<g&&f.get(l,v);)w[2]++,v++;if(v===g)return NaN;for(;v<g&&!f.get(l,v)&&w[3]<c;)w[3]++,v++;if(v===g||w[3]>=c)return NaN;for(;v<g&&f.get(l,v)&&w[4]<c;)w[4]++,v++;if(w[4]>=c)return NaN;const A=w[0]+w[1]+w[2]+w[3]+w[4];return 5*Math.abs(A-h)>=2*h?NaN:jn.foundPatternCross(w)?jn.centerFromEnd(w,v):NaN}crossCheckHorizontal(o,l,c,h){const f=this.image,g=f.getWidth(),w=this.getCrossCheckStateCount();let v=o;for(;v>=0&&f.get(v,l);)w[2]++,v--;if(v<0)return NaN;for(;v>=0&&!f.get(v,l)&&w[1]<=c;)w[1]++,v--;if(v<0||w[1]>c)return NaN;for(;v>=0&&f.get(v,l)&&w[0]<=c;)w[0]++,v--;if(w[0]>c)return NaN;for(v=o+1;v<g&&f.get(v,l);)w[2]++,v++;if(v===g)return NaN;for(;v<g&&!f.get(v,l)&&w[3]<c;)w[3]++,v++;if(v===g||w[3]>=c)return NaN;for(;v<g&&f.get(v,l)&&w[4]<c;)w[4]++,v++;if(w[4]>=c)return NaN;const A=w[0]+w[1]+w[2]+w[3]+w[4];return 5*Math.abs(A-h)>=h?NaN:jn.foundPatternCross(w)?jn.centerFromEnd(w,v):NaN}handlePossibleCenter(o,l,c,h){const f=o[0]+o[1]+o[2]+o[3]+o[4];let g=jn.centerFromEnd(o,c),w=this.crossCheckVertical(l,Math.floor(g),o[2],f);if(!isNaN(w)&&(g=this.crossCheckHorizontal(Math.floor(g),Math.floor(w),o[2],f),!isNaN(g)&&(!h||this.crossCheckDiagonal(Math.floor(w),Math.floor(g),o[2],f)))){const v=f/7;let A=!1;const N=this.possibleCenters;for(let L=0,V=N.length;L<V;L++){const q=N[L];if(q.aboutEquals(v,w,g)){N[L]=q.combineEstimate(w,g,v),A=!0;break}}if(!A){const L=new Fs(g,w,v);N.push(L),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(L)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let l=null;for(const c of this.possibleCenters)if(c.getCount()>=jn.CENTER_QUORUM)if(l==null)l=c;else return this.hasSkipped=!0,Math.floor((Math.abs(l.getX()-c.getX())-Math.abs(l.getY()-c.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let o=0,l=0;const c=this.possibleCenters.length;for(const g of this.possibleCenters)g.getCount()>=jn.CENTER_QUORUM&&(o++,l+=g.getEstimatedModuleSize());if(o<3)return!1;const h=l/c;let f=0;for(const g of this.possibleCenters)f+=Math.abs(g.getEstimatedModuleSize()-h);return f<=.05*l}selectBestPatterns(){const o=this.possibleCenters.length;if(o<3)throw new ie;const l=this.possibleCenters;let c;if(o>3){let h=0,f=0;for(const v of this.possibleCenters){const A=v.getEstimatedModuleSize();h+=A,f+=A*A}c=h/o;let g=Math.sqrt(f/o-c*c);l.sort((v,A)=>{const N=Math.abs(A.getEstimatedModuleSize()-c),L=Math.abs(v.getEstimatedModuleSize()-c);return N<L?-1:N>L?1:0});const w=Math.max(.2*c,g);for(let v=0;v<l.length&&l.length>3;v++){const A=l[v];Math.abs(A.getEstimatedModuleSize()-c)>w&&(l.splice(v,1),v--)}}if(l.length>3){let h=0;for(const f of l)h+=f.getEstimatedModuleSize();c=h/l.length,l.sort((f,g)=>{if(g.getCount()===f.getCount()){const w=Math.abs(g.getEstimatedModuleSize()-c),v=Math.abs(f.getEstimatedModuleSize()-c);return w<v?1:w>v?-1:0}else return g.getCount()-f.getCount()}),l.splice(3)}return[l[0],l[1],l[2]]}}jn.CENTER_QUORUM=2,jn.MIN_SKIP=3,jn.MAX_MODULES=57;class Ho{constructor(o){this.image=o}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(o){this.resultPointCallback=o==null?null:o.get(Q.NEED_RESULT_POINT_CALLBACK);const c=new jn(this.image,this.resultPointCallback).find(o);return this.processFinderPatternInfo(c)}processFinderPatternInfo(o){const l=o.getTopLeft(),c=o.getTopRight(),h=o.getBottomLeft(),f=this.calculateModuleSize(l,c,h);if(f<1)throw new ie("No pattern found in proccess finder.");const g=Ho.computeDimension(l,c,h,f),w=Ve.getProvisionalVersionForDimension(g),v=w.getDimensionForVersion()-7;let A=null;if(w.getAlignmentPatternCenters().length>0){const q=c.getX()-l.getX()+h.getX(),J=c.getY()-l.getY()+h.getY(),ee=1-3/v,se=Math.floor(l.getX()+ee*(q-l.getX())),ce=Math.floor(l.getY()+ee*(J-l.getY()));for(let ve=4;ve<=16;ve<<=1)try{A=this.findAlignmentInRegion(f,se,ce,ve);break}catch(Ee){if(!(Ee instanceof ie))throw Ee}}const N=Ho.createTransform(l,c,h,A,g),L=Ho.sampleGrid(this.image,N,g);let V;return A===null?V=[h,l,c]:V=[h,l,c,A],new ue(L,V)}static createTransform(o,l,c,h,f){const g=f-3.5;let w,v,A,N;return h!==null?(w=h.getX(),v=h.getY(),A=g-3,N=A):(w=l.getX()-o.getX()+c.getX(),v=l.getY()-o.getY()+c.getY(),A=g,N=g),Pe.quadrilateralToQuadrilateral(3.5,3.5,g,3.5,A,N,3.5,g,o.getX(),o.getY(),l.getX(),l.getY(),w,v,c.getX(),c.getY())}static sampleGrid(o,l,c){return He.getInstance().sampleGridWithTransform(o,c,c,l)}static computeDimension(o,l,c,h){const f=lt.round(Z.distance(o,l)/h),g=lt.round(Z.distance(o,c)/h);let w=Math.floor((f+g)/2)+7;switch(w&3){case 0:w++;break;case 2:w--;break;case 3:throw new ie("Dimensions could be not found.")}return w}calculateModuleSize(o,l,c){return(this.calculateModuleSizeOneWay(o,l)+this.calculateModuleSizeOneWay(o,c))/2}calculateModuleSizeOneWay(o,l){const c=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(o.getX()),Math.floor(o.getY()),Math.floor(l.getX()),Math.floor(l.getY())),h=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(l.getX()),Math.floor(l.getY()),Math.floor(o.getX()),Math.floor(o.getY()));return isNaN(c)?h/7:isNaN(h)?c/7:(c+h)/14}sizeOfBlackWhiteBlackRunBothWays(o,l,c,h){let f=this.sizeOfBlackWhiteBlackRun(o,l,c,h),g=1,w=o-(c-o);w<0?(g=o/(o-w),w=0):w>=this.image.getWidth()&&(g=(this.image.getWidth()-1-o)/(w-o),w=this.image.getWidth()-1);let v=Math.floor(l-(h-l)*g);return g=1,v<0?(g=l/(l-v),v=0):v>=this.image.getHeight()&&(g=(this.image.getHeight()-1-l)/(v-l),v=this.image.getHeight()-1),w=Math.floor(o+(w-o)*g),f+=this.sizeOfBlackWhiteBlackRun(o,l,w,v),f-1}sizeOfBlackWhiteBlackRun(o,l,c,h){const f=Math.abs(h-l)>Math.abs(c-o);if(f){let q=o;o=l,l=q,q=c,c=h,h=q}const g=Math.abs(c-o),w=Math.abs(h-l);let v=-g/2;const A=o<c?1:-1,N=l<h?1:-1;let L=0;const V=c+A;for(let q=o,J=l;q!==V;q+=A){const ee=f?J:q,se=f?q:J;if(L===1===this.image.get(ee,se)){if(L===2)return lt.distance(q,J,o,l);L++}if(v+=w,v>0){if(J===h)break;J+=N,v-=g}}return L===2?lt.distance(c+A,h,o,l):NaN}findAlignmentInRegion(o,l,c,h){const f=Math.floor(h*o),g=Math.max(0,l-f),w=Math.min(this.image.getWidth()-1,l+f);if(w-g<o*3)throw new ie("Alignment top exceeds estimated module size.");const v=Math.max(0,c-f),A=Math.min(this.image.getHeight()-1,c+f);if(A-v<o*3)throw new ie("Alignment bottom exceeds estimated module size.");return new bi(this.image,g,v,w-g,A-v,o,this.resultPointCallback).find()}}class $r{constructor(){this.decoder=new Jp}getDecoder(){return this.decoder}decode(o,l){let c,h;if(l!=null&&l.get(Q.PURE_BARCODE)!==void 0){const v=$r.extractPureBits(o.getBlackMatrix());c=this.decoder.decodeBitMatrix(v,l),h=$r.NO_POINTS}else{const v=new Ho(o.getBlackMatrix()).detect(l);c=this.decoder.decodeBitMatrix(v.getBits(),l),h=v.getPoints()}c.getOther()instanceof d0&&c.getOther().applyMirroredCorrection(h);const f=new zt(c.getText(),c.getRawBytes(),void 0,h,Fe.QR_CODE,void 0),g=c.getByteSegments();g!==null&&f.putMetadata(pn.BYTE_SEGMENTS,g);const w=c.getECLevel();return w!==null&&f.putMetadata(pn.ERROR_CORRECTION_LEVEL,w),c.hasStructuredAppend()&&(f.putMetadata(pn.STRUCTURED_APPEND_SEQUENCE,c.getStructuredAppendSequenceNumber()),f.putMetadata(pn.STRUCTURED_APPEND_PARITY,c.getStructuredAppendParity())),f}reset(){}static extractPureBits(o){const l=o.getTopLeftOnBit(),c=o.getBottomRightOnBit();if(l===null||c===null)throw new ie;const h=this.moduleSize(l,o);let f=l[1],g=c[1],w=l[0],v=c[0];if(w>=v||f>=g)throw new ie;if(g-f!==v-w&&(v=w+(g-f),v>=o.getWidth()))throw new ie;const A=Math.round((v-w+1)/h),N=Math.round((g-f+1)/h);if(A<=0||N<=0)throw new ie;if(N!==A)throw new ie;const L=Math.floor(h/2);f+=L,w+=L;const V=w+Math.floor((A-1)*h)-v;if(V>0){if(V>L)throw new ie;w-=V}const q=f+Math.floor((N-1)*h)-g;if(q>0){if(q>L)throw new ie;f-=q}const J=new Te(A,N);for(let ee=0;ee<N;ee++){const se=f+Math.floor(ee*h);for(let ce=0;ce<A;ce++)o.get(w+Math.floor(ce*h),se)&&J.set(ce,ee)}return J}static moduleSize(o,l){const c=l.getHeight(),h=l.getWidth();let f=o[0],g=o[1],w=!0,v=0;for(;f<h&&g<c;){if(w!==l.get(f,g)){if(++v===5)break;w=!w}f++,g++}if(f===h||g===c)throw new ie;return(f-o[0])/7}}$r.NO_POINTS=new Array;class Ke{PDF417Common(){}static getBitCountSum(o){return lt.sum(o)}static toIntArray(o){if(o==null||!o.length)return Ke.EMPTY_INT_ARRAY;const l=new Int32Array(o.length);let c=0;for(const h of o)l[c++]=h;return l}static getCodeword(o){const l=C.binarySearch(Ke.SYMBOL_TABLE,o&262143);return l<0?-1:(Ke.CODEWORD_TABLE[l]-1)%Ke.NUMBER_OF_CODEWORDS}}Ke.NUMBER_OF_CODEWORDS=929,Ke.MAX_CODEWORDS_IN_BARCODE=Ke.NUMBER_OF_CODEWORDS-1,Ke.MIN_ROWS_IN_BARCODE=3,Ke.MAX_ROWS_IN_BARCODE=90,Ke.MODULES_IN_CODEWORD=17,Ke.MODULES_IN_STOP_PATTERN=18,Ke.BARS_IN_MODULE=8,Ke.EMPTY_INT_ARRAY=new Int32Array([]),Ke.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),Ke.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class e1{constructor(o,l){this.bits=o,this.points=l}getBits(){return this.bits}getPoints(){return this.points}}class tt{static detectMultiple(o,l,c){let h=o.getBlackMatrix(),f=tt.detect(c,h);return f.length||(h=h.clone(),h.rotate180(),f=tt.detect(c,h)),new e1(h,f)}static detect(o,l){const c=new Array;let h=0,f=0,g=!1;for(;h<l.getHeight();){const w=tt.findVertices(l,h,f);if(w[0]==null&&w[3]==null){if(!g)break;g=!1,f=0;for(const v of c)v[1]!=null&&(h=Math.trunc(Math.max(h,v[1].getY()))),v[3]!=null&&(h=Math.max(h,Math.trunc(v[3].getY())));h+=tt.ROW_STEP;continue}if(g=!0,c.push(w),!o)break;w[2]!=null?(f=Math.trunc(w[2].getX()),h=Math.trunc(w[2].getY())):(f=Math.trunc(w[4].getX()),h=Math.trunc(w[4].getY()))}return c}static findVertices(o,l,c){const h=o.getHeight(),f=o.getWidth(),g=new Array(8);return tt.copyToResult(g,tt.findRowsWithPattern(o,h,f,l,c,tt.START_PATTERN),tt.INDEXES_START_PATTERN),g[4]!=null&&(c=Math.trunc(g[4].getX()),l=Math.trunc(g[4].getY())),tt.copyToResult(g,tt.findRowsWithPattern(o,h,f,l,c,tt.STOP_PATTERN),tt.INDEXES_STOP_PATTERN),g}static copyToResult(o,l,c){for(let h=0;h<c.length;h++)o[c[h]]=l[h]}static findRowsWithPattern(o,l,c,h,f,g){const w=new Array(4);let v=!1;const A=new Int32Array(g.length);for(;h<l;h+=tt.ROW_STEP){let L=tt.findGuardPattern(o,f,h,c,!1,g,A);if(L!=null){for(;h>0;){const V=tt.findGuardPattern(o,f,--h,c,!1,g,A);if(V!=null)L=V;else{h++;break}}w[0]=new Z(L[0],h),w[1]=new Z(L[1],h),v=!0;break}}let N=h+1;if(v){let L=0,V=Int32Array.from([Math.trunc(w[0].getX()),Math.trunc(w[1].getX())]);for(;N<l;N++){const q=tt.findGuardPattern(o,V[0],N,c,!1,g,A);if(q!=null&&Math.abs(V[0]-q[0])<tt.MAX_PATTERN_DRIFT&&Math.abs(V[1]-q[1])<tt.MAX_PATTERN_DRIFT)V=q,L=0;else{if(L>tt.SKIPPED_ROW_COUNT_MAX)break;L++}}N-=L+1,w[2]=new Z(V[0],N),w[3]=new Z(V[1],N)}return N-h<tt.BARCODE_MIN_HEIGHT&&C.fill(w,null),w}static findGuardPattern(o,l,c,h,f,g,w){C.fillWithin(w,0,w.length,0);let v=l,A=0;for(;o.get(v,c)&&v>0&&A++<tt.MAX_PIXEL_DRIFT;)v--;let N=v,L=0,V=g.length;for(let q=f;N<h;N++)if(o.get(N,c)!==q)w[L]++;else{if(L===V-1){if(tt.patternMatchVariance(w,g,tt.MAX_INDIVIDUAL_VARIANCE)<tt.MAX_AVG_VARIANCE)return new Int32Array([v,N]);v+=w[0]+w[1],S.arraycopy(w,2,w,0,L-1),w[L-1]=0,w[L]=0,L--}else L++;w[L]=1,q=!q}return L===V-1&&tt.patternMatchVariance(w,g,tt.MAX_INDIVIDUAL_VARIANCE)<tt.MAX_AVG_VARIANCE?new Int32Array([v,N-1]):null}static patternMatchVariance(o,l,c){let h=o.length,f=0,g=0;for(let A=0;A<h;A++)f+=o[A],g+=l[A];if(f<g)return 1/0;let w=f/g;c*=w;let v=0;for(let A=0;A<h;A++){let N=o[A],L=l[A]*w,V=N>L?N-L:L-N;if(V>c)return 1/0;v+=V}return v/f}}tt.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),tt.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),tt.MAX_AVG_VARIANCE=.42,tt.MAX_INDIVIDUAL_VARIANCE=.8,tt.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),tt.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),tt.MAX_PIXEL_DRIFT=3,tt.MAX_PATTERN_DRIFT=5,tt.SKIPPED_ROW_COUNT_MAX=25,tt.ROW_STEP=5,tt.BARCODE_MIN_HEIGHT=10;class Xt{constructor(o,l){if(l.length===0)throw new _;this.field=o;let c=l.length;if(c>1&&l[0]===0){let h=1;for(;h<c&&l[h]===0;)h++;h===c?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(c-h),S.arraycopy(l,h,this.coefficients,0,this.coefficients.length))}else this.coefficients=l}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(o){return this.coefficients[this.coefficients.length-1-o]}evaluateAt(o){if(o===0)return this.getCoefficient(0);if(o===1){let h=0;for(let f of this.coefficients)h=this.field.add(h,f);return h}let l=this.coefficients[0],c=this.coefficients.length;for(let h=1;h<c;h++)l=this.field.add(this.field.multiply(o,l),this.coefficients[h]);return l}add(o){if(!this.field.equals(o.field))throw new _("ModulusPolys do not have same ModulusGF field");if(this.isZero())return o;if(o.isZero())return this;let l=this.coefficients,c=o.coefficients;if(l.length>c.length){let g=l;l=c,c=g}let h=new Int32Array(c.length),f=c.length-l.length;S.arraycopy(c,0,h,0,f);for(let g=f;g<c.length;g++)h[g]=this.field.add(l[g-f],c[g]);return new Xt(this.field,h)}subtract(o){if(!this.field.equals(o.field))throw new _("ModulusPolys do not have same ModulusGF field");return o.isZero()?this:this.add(o.negative())}multiply(o){return o instanceof Xt?this.multiplyOther(o):this.multiplyScalar(o)}multiplyOther(o){if(!this.field.equals(o.field))throw new _("ModulusPolys do not have same ModulusGF field");if(this.isZero()||o.isZero())return new Xt(this.field,new Int32Array([0]));let l=this.coefficients,c=l.length,h=o.coefficients,f=h.length,g=new Int32Array(c+f-1);for(let w=0;w<c;w++){let v=l[w];for(let A=0;A<f;A++)g[w+A]=this.field.add(g[w+A],this.field.multiply(v,h[A]))}return new Xt(this.field,g)}negative(){let o=this.coefficients.length,l=new Int32Array(o);for(let c=0;c<o;c++)l[c]=this.field.subtract(0,this.coefficients[c]);return new Xt(this.field,l)}multiplyScalar(o){if(o===0)return new Xt(this.field,new Int32Array([0]));if(o===1)return this;let l=this.coefficients.length,c=new Int32Array(l);for(let h=0;h<l;h++)c[h]=this.field.multiply(this.coefficients[h],o);return new Xt(this.field,c)}multiplyByMonomial(o,l){if(o<0)throw new _;if(l===0)return new Xt(this.field,new Int32Array([0]));let c=this.coefficients.length,h=new Int32Array(c+o);for(let f=0;f<c;f++)h[f]=this.field.multiply(this.coefficients[f],l);return new Xt(this.field,h)}toString(){let o=new z;for(let l=this.getDegree();l>=0;l--){let c=this.getCoefficient(l);c!==0&&(c<0?(o.append(" - "),c=-c):o.length()>0&&o.append(" + "),(l===0||c!==1)&&o.append(c),l!==0&&(l===1?o.append("x"):(o.append("x^"),o.append(l))))}return o.toString()}}class t1{add(o,l){return(o+l)%this.modulus}subtract(o,l){return(this.modulus+o-l)%this.modulus}exp(o){return this.expTable[o]}log(o){if(o===0)throw new _;return this.logTable[o]}inverse(o){if(o===0)throw new Ys;return this.expTable[this.modulus-this.logTable[o]-1]}multiply(o,l){return o===0||l===0?0:this.expTable[(this.logTable[o]+this.logTable[l])%(this.modulus-1)]}getSize(){return this.modulus}equals(o){return o===this}}class Rh extends t1{constructor(o,l){super(),this.modulus=o,this.expTable=new Int32Array(o),this.logTable=new Int32Array(o);let c=1;for(let h=0;h<o;h++)this.expTable[h]=c,c=c*l%o;for(let h=0;h<o-1;h++)this.logTable[this.expTable[h]]=h;this.zero=new Xt(this,new Int32Array([0])),this.one=new Xt(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(o,l){if(o<0)throw new _;if(l===0)return this.zero;let c=new Int32Array(o+1);return c[0]=l,new Xt(this,c)}}Rh.PDF417_GF=new Rh(Ke.NUMBER_OF_CODEWORDS,3);class gl{constructor(){this.field=Rh.PDF417_GF}decode(o,l,c){let h=new Xt(this.field,o),f=new Int32Array(l),g=!1;for(let J=l;J>0;J--){let ee=h.evaluateAt(this.field.exp(J));f[l-J]=ee,ee!==0&&(g=!0)}if(!g)return 0;let w=this.field.getOne();if(c!=null)for(const J of c){let ee=this.field.exp(o.length-1-J),se=new Xt(this.field,new Int32Array([this.field.subtract(0,ee),1]));w=w.multiply(se)}let v=new Xt(this.field,f),A=this.runEuclideanAlgorithm(this.field.buildMonomial(l,1),v,l),N=A[0],L=A[1],V=this.findErrorLocations(N),q=this.findErrorMagnitudes(L,N,V);for(let J=0;J<V.length;J++){let ee=o.length-1-this.field.log(V[J]);if(ee<0)throw b.getChecksumInstance();o[ee]=this.field.subtract(o[ee],q[J])}return V.length}runEuclideanAlgorithm(o,l,c){if(o.getDegree()<l.getDegree()){let V=o;o=l,l=V}let h=o,f=l,g=this.field.getZero(),w=this.field.getOne();for(;f.getDegree()>=Math.round(c/2);){let V=h,q=g;if(h=f,g=w,h.isZero())throw b.getChecksumInstance();f=V;let J=this.field.getZero(),ee=h.getCoefficient(h.getDegree()),se=this.field.inverse(ee);for(;f.getDegree()>=h.getDegree()&&!f.isZero();){let ce=f.getDegree()-h.getDegree(),ve=this.field.multiply(f.getCoefficient(f.getDegree()),se);J=J.add(this.field.buildMonomial(ce,ve)),f=f.subtract(h.multiplyByMonomial(ce,ve))}w=J.multiply(g).subtract(q).negative()}let v=w.getCoefficient(0);if(v===0)throw b.getChecksumInstance();let A=this.field.inverse(v),N=w.multiply(A),L=f.multiply(A);return[N,L]}findErrorLocations(o){let l=o.getDegree(),c=new Int32Array(l),h=0;for(let f=1;f<this.field.getSize()&&h<l;f++)o.evaluateAt(f)===0&&(c[h]=this.field.inverse(f),h++);if(h!==l)throw b.getChecksumInstance();return c}findErrorMagnitudes(o,l,c){let h=l.getDegree(),f=new Int32Array(h);for(let A=1;A<=h;A++)f[h-A]=this.field.multiply(A,l.getCoefficient(A));let g=new Xt(this.field,f),w=c.length,v=new Int32Array(w);for(let A=0;A<w;A++){let N=this.field.inverse(c[A]),L=this.field.subtract(0,o.evaluateAt(N)),V=this.field.inverse(g.evaluateAt(N));v[A]=this.field.multiply(L,V)}return v}}class Bs{constructor(o,l,c,h,f){o instanceof Bs?this.constructor_2(o):this.constructor_1(o,l,c,h,f)}constructor_1(o,l,c,h,f){const g=l==null||c==null,w=h==null||f==null;if(g&&w)throw new ie;g?(l=new Z(0,h.getY()),c=new Z(0,f.getY())):w&&(h=new Z(o.getWidth()-1,l.getY()),f=new Z(o.getWidth()-1,c.getY())),this.image=o,this.topLeft=l,this.bottomLeft=c,this.topRight=h,this.bottomRight=f,this.minX=Math.trunc(Math.min(l.getX(),c.getX())),this.maxX=Math.trunc(Math.max(h.getX(),f.getX())),this.minY=Math.trunc(Math.min(l.getY(),h.getY())),this.maxY=Math.trunc(Math.max(c.getY(),f.getY()))}constructor_2(o){this.image=o.image,this.topLeft=o.getTopLeft(),this.bottomLeft=o.getBottomLeft(),this.topRight=o.getTopRight(),this.bottomRight=o.getBottomRight(),this.minX=o.getMinX(),this.maxX=o.getMaxX(),this.minY=o.getMinY(),this.maxY=o.getMaxY()}static merge(o,l){return o==null?l:l==null?o:new Bs(o.image,o.topLeft,o.bottomLeft,l.topRight,l.bottomRight)}addMissingRows(o,l,c){let h=this.topLeft,f=this.bottomLeft,g=this.topRight,w=this.bottomRight;if(o>0){let v=c?this.topLeft:this.topRight,A=Math.trunc(v.getY()-o);A<0&&(A=0);let N=new Z(v.getX(),A);c?h=N:g=N}if(l>0){let v=c?this.bottomLeft:this.bottomRight,A=Math.trunc(v.getY()+l);A>=this.image.getHeight()&&(A=this.image.getHeight()-1);let N=new Z(v.getX(),A);c?f=N:w=N}return new Bs(this.image,h,f,g,w)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class m0{constructor(o,l,c,h){this.columnCount=o,this.errorCorrectionLevel=h,this.rowCountUpperPart=l,this.rowCountLowerPart=c,this.rowCount=l+c}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class ei{constructor(){this.buffer=""}static form(o,l){let c=-1;function h(g,w,v,A,N,L){if(g==="%%")return"%";if(l[++c]===void 0)return;g=A?parseInt(A.substr(1)):void 0;let V=N?parseInt(N.substr(1)):void 0,q;switch(L){case"s":q=l[c];break;case"c":q=l[c][0];break;case"f":q=parseFloat(l[c]).toFixed(g);break;case"p":q=parseFloat(l[c]).toPrecision(g);break;case"e":q=parseFloat(l[c]).toExponential(g);break;case"x":q=parseInt(l[c]).toString(V||16);break;case"d":q=parseFloat(parseInt(l[c],V||10).toPrecision(g)).toFixed(0);break}q=typeof q=="object"?JSON.stringify(q):(+q).toString(V);let J=parseInt(v),ee=v&&v[0]+""=="0"?"0":" ";for(;q.length<J;)q=w!==void 0?q+ee:ee+q;return q}let f=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return o.replace(f,h)}format(o,...l){this.buffer+=ei.form(o,l)}toString(){return this.buffer}}class ti{constructor(o){this.boundingBox=new Bs(o),this.codewords=new Array(o.getMaxY()-o.getMinY()+1)}getCodewordNearby(o){let l=this.getCodeword(o);if(l!=null)return l;for(let c=1;c<ti.MAX_NEARBY_DISTANCE;c++){let h=this.imageRowToCodewordIndex(o)-c;if(h>=0&&(l=this.codewords[h],l!=null)||(h=this.imageRowToCodewordIndex(o)+c,h<this.codewords.length&&(l=this.codewords[h],l!=null)))return l}return null}imageRowToCodewordIndex(o){return o-this.boundingBox.getMinY()}setCodeword(o,l){this.codewords[this.imageRowToCodewordIndex(o)]=l}getCodeword(o){return this.codewords[this.imageRowToCodewordIndex(o)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const o=new ei;let l=0;for(const c of this.codewords){if(c==null){o.format("%3d:    |   %n",l++);continue}o.format("%3d: %3d|%3d%n",l++,c.getRowNumber(),c.getValue())}return o.toString()}}ti.MAX_NEARBY_DISTANCE=5;class Ko{constructor(){this.values=new Map}setValue(o){o=Math.trunc(o);let l=this.values.get(o);l==null&&(l=0),l++,this.values.set(o,l)}getValue(){let o=-1,l=new Array;for(const[c,h]of this.values.entries()){const f={getKey:()=>c,getValue:()=>h};f.getValue()>o?(o=f.getValue(),l=[],l.push(f.getKey())):f.getValue()===o&&l.push(f.getKey())}return Ke.toIntArray(l)}getConfidence(o){return this.values.get(o)}}class Nc extends ti{constructor(o,l){super(o),this._isLeft=l}setRowNumbers(){for(let o of this.getCodewords())o!=null&&o.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(o){let l=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(l,o);let c=this.getBoundingBox(),h=this._isLeft?c.getTopLeft():c.getTopRight(),f=this._isLeft?c.getBottomLeft():c.getBottomRight(),g=this.imageRowToCodewordIndex(Math.trunc(h.getY())),w=this.imageRowToCodewordIndex(Math.trunc(f.getY())),v=-1,A=1,N=0;for(let L=g;L<w;L++){if(l[L]==null)continue;let V=l[L],q=V.getRowNumber()-v;if(q===0)N++;else if(q===1)A=Math.max(A,N),N=1,v=V.getRowNumber();else if(q<0||V.getRowNumber()>=o.getRowCount()||q>L)l[L]=null;else{let J;A>2?J=(A-2)*q:J=q;let ee=J>=L;for(let se=1;se<=J&&!ee;se++)ee=l[L-se]!=null;ee?l[L]=null:(v=V.getRowNumber(),N=1)}}}getRowHeights(){let o=this.getBarcodeMetadata();if(o==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(o);let l=new Int32Array(o.getRowCount());for(let c of this.getCodewords())if(c!=null){let h=c.getRowNumber();if(h>=l.length)continue;l[h]++}return l}adjustIncompleteIndicatorColumnRowNumbers(o){let l=this.getBoundingBox(),c=this._isLeft?l.getTopLeft():l.getTopRight(),h=this._isLeft?l.getBottomLeft():l.getBottomRight(),f=this.imageRowToCodewordIndex(Math.trunc(c.getY())),g=this.imageRowToCodewordIndex(Math.trunc(h.getY())),w=this.getCodewords(),v=-1;for(let A=f;A<g;A++){if(w[A]==null)continue;let N=w[A];N.setRowNumberAsRowIndicatorColumn();let L=N.getRowNumber()-v;L===0||(L===1?v=N.getRowNumber():N.getRowNumber()>=o.getRowCount()?w[A]=null:v=N.getRowNumber())}}getBarcodeMetadata(){let o=this.getCodewords(),l=new Ko,c=new Ko,h=new Ko,f=new Ko;for(let w of o){if(w==null)continue;w.setRowNumberAsRowIndicatorColumn();let v=w.getValue()%30,A=w.getRowNumber();switch(this._isLeft||(A+=2),A%3){case 0:c.setValue(v*3+1);break;case 1:f.setValue(v/3),h.setValue(v%3);break;case 2:l.setValue(v+1);break}}if(l.getValue().length===0||c.getValue().length===0||h.getValue().length===0||f.getValue().length===0||l.getValue()[0]<1||c.getValue()[0]+h.getValue()[0]<Ke.MIN_ROWS_IN_BARCODE||c.getValue()[0]+h.getValue()[0]>Ke.MAX_ROWS_IN_BARCODE)return null;let g=new m0(l.getValue()[0],c.getValue()[0],h.getValue()[0],f.getValue()[0]);return this.removeIncorrectCodewords(o,g),g}removeIncorrectCodewords(o,l){for(let c=0;c<o.length;c++){let h=o[c];if(o[c]==null)continue;let f=h.getValue()%30,g=h.getRowNumber();if(g>l.getRowCount()){o[c]=null;continue}switch(this._isLeft||(g+=2),g%3){case 0:f*3+1!==l.getRowCountUpperPart()&&(o[c]=null);break;case 1:(Math.trunc(f/3)!==l.getErrorCorrectionLevel()||f%3!==l.getRowCountLowerPart())&&(o[c]=null);break;case 2:f+1!==l.getColumnCount()&&(o[c]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class Ft{constructor(o,l){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=o,this.barcodeColumnCount=o.getColumnCount(),this.boundingBox=l,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let o=Ke.MAX_CODEWORDS_IN_BARCODE,l;do l=o,o=this.adjustRowNumbersAndGetCount();while(o>0&&o<l);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(o){o!=null&&o.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let o=this.adjustRowNumbersByRow();if(o===0)return 0;for(let l=1;l<this.barcodeColumnCount+1;l++){let c=this.detectionResultColumns[l].getCodewords();for(let h=0;h<c.length;h++)c[h]!=null&&(c[h].hasValidRowNumber()||this.adjustRowNumbers(l,h,c))}return o}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let o=this.detectionResultColumns[0].getCodewords(),l=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let c=0;c<o.length;c++)if(o[c]!=null&&l[c]!=null&&o[c].getRowNumber()===l[c].getRowNumber())for(let h=1;h<=this.barcodeColumnCount;h++){let f=this.detectionResultColumns[h].getCodewords()[c];f!=null&&(f.setRowNumber(o[c].getRowNumber()),f.hasValidRowNumber()||(this.detectionResultColumns[h].getCodewords()[c]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let o=0,l=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let c=0;c<l.length;c++){if(l[c]==null)continue;let h=l[c].getRowNumber(),f=0;for(let g=this.barcodeColumnCount+1;g>0&&f<this.ADJUST_ROW_NUMBER_SKIP;g--){let w=this.detectionResultColumns[g].getCodewords()[c];w!=null&&(f=Ft.adjustRowNumberIfValid(h,f,w),w.hasValidRowNumber()||o++)}}return o}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let o=0,l=this.detectionResultColumns[0].getCodewords();for(let c=0;c<l.length;c++){if(l[c]==null)continue;let h=l[c].getRowNumber(),f=0;for(let g=1;g<this.barcodeColumnCount+1&&f<this.ADJUST_ROW_NUMBER_SKIP;g++){let w=this.detectionResultColumns[g].getCodewords()[c];w!=null&&(f=Ft.adjustRowNumberIfValid(h,f,w),w.hasValidRowNumber()||o++)}}return o}static adjustRowNumberIfValid(o,l,c){return c==null||c.hasValidRowNumber()||(c.isValidRowNumber(o)?(c.setRowNumber(o),l=0):++l),l}adjustRowNumbers(o,l,c){if(!this.detectionResultColumns[o-1])return;let h=c[l],f=this.detectionResultColumns[o-1].getCodewords(),g=f;this.detectionResultColumns[o+1]!=null&&(g=this.detectionResultColumns[o+1].getCodewords());let w=new Array(14);w[2]=f[l],w[3]=g[l],l>0&&(w[0]=c[l-1],w[4]=f[l-1],w[5]=g[l-1]),l>1&&(w[8]=c[l-2],w[10]=f[l-2],w[11]=g[l-2]),l<c.length-1&&(w[1]=c[l+1],w[6]=f[l+1],w[7]=g[l+1]),l<c.length-2&&(w[9]=c[l+2],w[12]=f[l+2],w[13]=g[l+2]);for(let v of w)if(Ft.adjustRowNumber(h,v))return}static adjustRowNumber(o,l){return l==null?!1:l.hasValidRowNumber()&&l.getBucket()===o.getBucket()?(o.setRowNumber(l.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(o){this.boundingBox=o}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(o,l){this.detectionResultColumns[o]=l}getDetectionResultColumn(o){return this.detectionResultColumns[o]}toString(){let o=this.detectionResultColumns[0];o==null&&(o=this.detectionResultColumns[this.barcodeColumnCount+1]);let l=new ei;for(let c=0;c<o.getCodewords().length;c++){l.format("CW %3d:",c);for(let h=0;h<this.barcodeColumnCount+2;h++){if(this.detectionResultColumns[h]==null){l.format("    |   ");continue}let f=this.detectionResultColumns[h].getCodewords()[c];if(f==null){l.format("    |   ");continue}l.format(" %3d|%3d",f.getRowNumber(),f.getValue())}l.format("%n")}return l.toString()}}class pl{constructor(o,l,c,h){this.rowNumber=pl.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(o),this.endX=Math.trunc(l),this.bucket=Math.trunc(c),this.value=Math.trunc(h)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(o){return o!==pl.BARCODE_ROW_UNKNOWN&&this.bucket===o%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(o){this.rowNumber=o}toString(){return this.rowNumber+"|"+this.value}}pl.BARCODE_ROW_UNKNOWN=-1;class Dr{static initialize(){for(let o=0;o<Ke.SYMBOL_TABLE.length;o++){let l=Ke.SYMBOL_TABLE[o],c=l&1;for(let h=0;h<Ke.BARS_IN_MODULE;h++){let f=0;for(;(l&1)===c;)f+=1,l>>=1;c=l&1,Dr.RATIOS_TABLE[o]||(Dr.RATIOS_TABLE[o]=new Array(Ke.BARS_IN_MODULE)),Dr.RATIOS_TABLE[o][Ke.BARS_IN_MODULE-h-1]=Math.fround(f/Ke.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(o){let l=Dr.getDecodedCodewordValue(Dr.sampleBitCounts(o));return l!==-1?l:Dr.getClosestDecodedValue(o)}static sampleBitCounts(o){let l=lt.sum(o),c=new Int32Array(Ke.BARS_IN_MODULE),h=0,f=0;for(let g=0;g<Ke.MODULES_IN_CODEWORD;g++){let w=l/(2*Ke.MODULES_IN_CODEWORD)+g*l/Ke.MODULES_IN_CODEWORD;f+o[h]<=w&&(f+=o[h],h++),c[h]++}return c}static getDecodedCodewordValue(o){let l=Dr.getBitValue(o);return Ke.getCodeword(l)===-1?-1:l}static getBitValue(o){let l=0;for(let c=0;c<o.length;c++)for(let h=0;h<o[c];h++)l=l<<1|(c%2===0?1:0);return Math.trunc(l)}static getClosestDecodedValue(o){let l=lt.sum(o),c=new Array(Ke.BARS_IN_MODULE);if(l>1)for(let g=0;g<c.length;g++)c[g]=Math.fround(o[g]/l);let h=Y.MAX_VALUE,f=-1;this.bSymbolTableReady||Dr.initialize();for(let g=0;g<Dr.RATIOS_TABLE.length;g++){let w=0,v=Dr.RATIOS_TABLE[g];for(let A=0;A<Ke.BARS_IN_MODULE;A++){let N=Math.fround(v[A]-c[A]);if(w+=Math.fround(N*N),w>=h)break}w<h&&(h=w,f=Ke.SYMBOL_TABLE[g])}return f}}Dr.bSymbolTableReady=!1,Dr.RATIOS_TABLE=new Array(Ke.SYMBOL_TABLE.length).map(M=>new Array(Ke.BARS_IN_MODULE));class Ph{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(o){this.segmentIndex=o}getFileId(){return this.fileId}setFileId(o){this.fileId=o}getOptionalData(){return this.optionalData}setOptionalData(o){this.optionalData=o}isLastSegment(){return this.lastSegment}setLastSegment(o){this.lastSegment=o}getSegmentCount(){return this.segmentCount}setSegmentCount(o){this.segmentCount=o}getSender(){return this.sender||null}setSender(o){this.sender=o}getAddressee(){return this.addressee||null}setAddressee(o){this.addressee=o}getFileName(){return this.fileName}setFileName(o){this.fileName=o}getFileSize(){return this.fileSize}setFileSize(o){this.fileSize=o}getChecksum(){return this.checksum}setChecksum(o){this.checksum=o}getTimestamp(){return this.timestamp}setTimestamp(o){this.timestamp=o}}class kh{static parseLong(o,l=void 0){return parseInt(o,l)}}class Dh extends m{}Dh.kind="NullPointerException";class Rc{writeBytes(o){this.writeBytesOffset(o,0,o.length)}writeBytesOffset(o,l,c){if(o==null)throw new Dh;if(l<0||l>o.length||c<0||l+c>o.length||l+c<0)throw new O;if(c===0)return;for(let h=0;h<c;h++)this.write(o[l+h])}flush(){}close(){}}class g0 extends m{}class ni extends Rc{constructor(o=32){if(super(),this.count=0,o<0)throw new _("Negative initial size: "+o);this.buf=new Uint8Array(o)}ensureCapacity(o){o-this.buf.length>0&&this.grow(o)}grow(o){let c=this.buf.length<<1;if(c-o<0&&(c=o),c<0){if(o<0)throw new g0;c=R.MAX_VALUE}this.buf=C.copyOfUint8Array(this.buf,c)}write(o){this.ensureCapacity(this.count+1),this.buf[this.count]=o,this.count+=1}writeBytesOffset(o,l,c){if(l<0||l>o.length||c<0||l+c-o.length>0)throw new O;this.ensureCapacity(this.count+c),S.arraycopy(o,l,this.buf,this.count,c),this.count+=c}writeTo(o){o.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return C.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(o){return o?typeof o=="string"?this.toString_string(o):this.toString_number(o):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(o){return new String(this.buf).toString()}toString_number(o){return new String(this.buf).toString()}close(){}}var Pt;(function(M){M[M.ALPHA=0]="ALPHA",M[M.LOWER=1]="LOWER",M[M.MIXED=2]="MIXED",M[M.PUNCT=3]="PUNCT",M[M.ALPHA_SHIFT=4]="ALPHA_SHIFT",M[M.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(Pt||(Pt={}));function p0(){if(typeof window<"u")return window.BigInt||null;if(typeof jh<"u")return jh.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let Ii;function ri(M){if(typeof Ii>"u"&&(Ii=p0()),Ii===null)throw new Error("BigInt is not supported!");return Ii(M)}function Oh(){let M=[];M[0]=ri(1);let o=ri(900);M[1]=o;for(let l=2;l<16;l++)M[l]=M[l-1]*o;return M}class oe{static decode(o,l){let c=new z(""),h=F.ISO8859_1;c.enableDecoding(h);let f=1,g=o[f++],w=new Ph;for(;f<o[0];){switch(g){case oe.TEXT_COMPACTION_MODE_LATCH:f=oe.textCompaction(o,f,c);break;case oe.BYTE_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH_6:f=oe.byteCompaction(g,o,h,f,c);break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:c.append(o[f++]);break;case oe.NUMERIC_COMPACTION_MODE_LATCH:f=oe.numericCompaction(o,f,c);break;case oe.ECI_CHARSET:F.getCharacterSetECIByValue(o[f++]);break;case oe.ECI_GENERAL_PURPOSE:f+=2;break;case oe.ECI_USER_DEFINED:f++;break;case oe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:f=oe.decodeMacroBlock(o,f,w);break;case oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case oe.MACRO_PDF417_TERMINATOR:throw new D;default:f--,f=oe.textCompaction(o,f,c);break}if(f<o.length)g=o[f++];else throw D.getFormatInstance()}if(c.length()===0)throw D.getFormatInstance();let v=new Xs(null,c.toString(),null,l);return v.setOther(w),v}static decodeMacroBlock(o,l,c){if(l+oe.NUMBER_OF_SEQUENCE_CODEWORDS>o[0])throw D.getFormatInstance();let h=new Int32Array(oe.NUMBER_OF_SEQUENCE_CODEWORDS);for(let w=0;w<oe.NUMBER_OF_SEQUENCE_CODEWORDS;w++,l++)h[w]=o[l];c.setSegmentIndex(R.parseInt(oe.decodeBase900toBase10(h,oe.NUMBER_OF_SEQUENCE_CODEWORDS)));let f=new z;l=oe.textCompaction(o,l,f),c.setFileId(f.toString());let g=-1;for(o[l]===oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(g=l+1);l<o[0];)switch(o[l]){case oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(l++,o[l]){case oe.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let w=new z;l=oe.textCompaction(o,l+1,w),c.setFileName(w.toString());break;case oe.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let v=new z;l=oe.textCompaction(o,l+1,v),c.setSender(v.toString());break;case oe.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let A=new z;l=oe.textCompaction(o,l+1,A),c.setAddressee(A.toString());break;case oe.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let N=new z;l=oe.numericCompaction(o,l+1,N),c.setSegmentCount(R.parseInt(N.toString()));break;case oe.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let L=new z;l=oe.numericCompaction(o,l+1,L),c.setTimestamp(kh.parseLong(L.toString()));break;case oe.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let V=new z;l=oe.numericCompaction(o,l+1,V),c.setChecksum(R.parseInt(V.toString()));break;case oe.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let q=new z;l=oe.numericCompaction(o,l+1,q),c.setFileSize(kh.parseLong(q.toString()));break;default:throw D.getFormatInstance()}break;case oe.MACRO_PDF417_TERMINATOR:l++,c.setLastSegment(!0);break;default:throw D.getFormatInstance()}if(g!==-1){let w=l-g;c.isLastSegment()&&w--,c.setOptionalData(C.copyOfRange(o,g,g+w))}return l}static textCompaction(o,l,c){let h=new Int32Array((o[0]-l)*2),f=new Int32Array((o[0]-l)*2),g=0,w=!1;for(;l<o[0]&&!w;){let v=o[l++];if(v<oe.TEXT_COMPACTION_MODE_LATCH)h[g]=v/30,h[g+1]=v%30,g+=2;else switch(v){case oe.TEXT_COMPACTION_MODE_LATCH:h[g++]=oe.TEXT_COMPACTION_MODE_LATCH;break;case oe.BYTE_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH_6:case oe.NUMERIC_COMPACTION_MODE_LATCH:case oe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case oe.MACRO_PDF417_TERMINATOR:l--,w=!0;break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h[g]=oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,v=o[l++],f[g]=v,g++;break}}return oe.decodeTextCompaction(h,f,g,c),l}static decodeTextCompaction(o,l,c,h){let f=Pt.ALPHA,g=Pt.ALPHA,w=0;for(;w<c;){let v=o[w],A="";switch(f){case Pt.ALPHA:if(v<26)A=String.fromCharCode(65+v);else switch(v){case 26:A=" ";break;case oe.LL:f=Pt.LOWER;break;case oe.ML:f=Pt.MIXED;break;case oe.PS:g=f,f=Pt.PUNCT_SHIFT;break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(l[w]);break;case oe.TEXT_COMPACTION_MODE_LATCH:f=Pt.ALPHA;break}break;case Pt.LOWER:if(v<26)A=String.fromCharCode(97+v);else switch(v){case 26:A=" ";break;case oe.AS:g=f,f=Pt.ALPHA_SHIFT;break;case oe.ML:f=Pt.MIXED;break;case oe.PS:g=f,f=Pt.PUNCT_SHIFT;break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(l[w]);break;case oe.TEXT_COMPACTION_MODE_LATCH:f=Pt.ALPHA;break}break;case Pt.MIXED:if(v<oe.PL)A=oe.MIXED_CHARS[v];else switch(v){case oe.PL:f=Pt.PUNCT;break;case 26:A=" ";break;case oe.LL:f=Pt.LOWER;break;case oe.AL:f=Pt.ALPHA;break;case oe.PS:g=f,f=Pt.PUNCT_SHIFT;break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(l[w]);break;case oe.TEXT_COMPACTION_MODE_LATCH:f=Pt.ALPHA;break}break;case Pt.PUNCT:if(v<oe.PAL)A=oe.PUNCT_CHARS[v];else switch(v){case oe.PAL:f=Pt.ALPHA;break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(l[w]);break;case oe.TEXT_COMPACTION_MODE_LATCH:f=Pt.ALPHA;break}break;case Pt.ALPHA_SHIFT:if(f=g,v<26)A=String.fromCharCode(65+v);else switch(v){case 26:A=" ";break;case oe.TEXT_COMPACTION_MODE_LATCH:f=Pt.ALPHA;break}break;case Pt.PUNCT_SHIFT:if(f=g,v<oe.PAL)A=oe.PUNCT_CHARS[v];else switch(v){case oe.PAL:f=Pt.ALPHA;break;case oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(l[w]);break;case oe.TEXT_COMPACTION_MODE_LATCH:f=Pt.ALPHA;break}break}A!==""&&h.append(A),w++}}static byteCompaction(o,l,c,h,f){let g=new ni,w=0,v=0,A=!1;switch(o){case oe.BYTE_COMPACTION_MODE_LATCH:let N=new Int32Array(6),L=l[h++];for(;h<l[0]&&!A;)switch(N[w++]=L,v=900*v+L,L=l[h++],L){case oe.TEXT_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH:case oe.NUMERIC_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH_6:case oe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case oe.MACRO_PDF417_TERMINATOR:h--,A=!0;break;default:if(w%5===0&&w>0){for(let V=0;V<6;++V)g.write(Number(ri(v)>>ri(8*(5-V))));v=0,w=0}break}h===l[0]&&L<oe.TEXT_COMPACTION_MODE_LATCH&&(N[w++]=L);for(let V=0;V<w;V++)g.write(N[V]);break;case oe.BYTE_COMPACTION_MODE_LATCH_6:for(;h<l[0]&&!A;){let V=l[h++];if(V<oe.TEXT_COMPACTION_MODE_LATCH)w++,v=900*v+V;else switch(V){case oe.TEXT_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH:case oe.NUMERIC_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH_6:case oe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case oe.MACRO_PDF417_TERMINATOR:h--,A=!0;break}if(w%5===0&&w>0){for(let q=0;q<6;++q)g.write(Number(ri(v)>>ri(8*(5-q))));v=0,w=0}}break}return f.append(X.decode(g.toByteArray(),c)),h}static numericCompaction(o,l,c){let h=0,f=!1,g=new Int32Array(oe.MAX_NUMERIC_CODEWORDS);for(;l<o[0]&&!f;){let w=o[l++];if(l===o[0]&&(f=!0),w<oe.TEXT_COMPACTION_MODE_LATCH)g[h]=w,h++;else switch(w){case oe.TEXT_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH:case oe.BYTE_COMPACTION_MODE_LATCH_6:case oe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case oe.MACRO_PDF417_TERMINATOR:l--,f=!0;break}(h%oe.MAX_NUMERIC_CODEWORDS===0||w===oe.NUMERIC_COMPACTION_MODE_LATCH||f)&&h>0&&(c.append(oe.decodeBase900toBase10(g,h)),h=0)}return l}static decodeBase900toBase10(o,l){let c=ri(0);for(let f=0;f<l;f++)c+=oe.EXP900[l-f-1]*ri(o[f]);let h=c.toString();if(h.charAt(0)!=="1")throw new D;return h.substring(1)}}oe.TEXT_COMPACTION_MODE_LATCH=900,oe.BYTE_COMPACTION_MODE_LATCH=901,oe.NUMERIC_COMPACTION_MODE_LATCH=902,oe.BYTE_COMPACTION_MODE_LATCH_6=924,oe.ECI_USER_DEFINED=925,oe.ECI_GENERAL_PURPOSE=926,oe.ECI_CHARSET=927,oe.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,oe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,oe.MACRO_PDF417_TERMINATOR=922,oe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,oe.MAX_NUMERIC_CODEWORDS=15,oe.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,oe.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,oe.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,oe.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,oe.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,oe.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,oe.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,oe.PL=25,oe.LL=27,oe.AS=27,oe.ML=28,oe.AL=28,oe.PS=29,oe.PAL=29,oe.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,oe.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",oe.EXP900=p0()?Oh():[],oe.NUMBER_OF_SEQUENCE_CODEWORDS=2;class nt{constructor(){}static decode(o,l,c,h,f,g,w){let v=new Bs(o,l,c,h,f),A=null,N=null,L;for(let J=!0;;J=!1){if(l!=null&&(A=nt.getRowIndicatorColumn(o,v,l,!0,g,w)),h!=null&&(N=nt.getRowIndicatorColumn(o,v,h,!1,g,w)),L=nt.merge(A,N),L==null)throw ie.getNotFoundInstance();let ee=L.getBoundingBox();if(J&&ee!=null&&(ee.getMinY()<v.getMinY()||ee.getMaxY()>v.getMaxY()))v=ee;else break}L.setBoundingBox(v);let V=L.getBarcodeColumnCount()+1;L.setDetectionResultColumn(0,A),L.setDetectionResultColumn(V,N);let q=A!=null;for(let J=1;J<=V;J++){let ee=q?J:V-J;if(L.getDetectionResultColumn(ee)!==void 0)continue;let se;ee===0||ee===V?se=new Nc(v,ee===0):se=new ti(v),L.setDetectionResultColumn(ee,se);let ce=-1,ve=ce;for(let Ee=v.getMinY();Ee<=v.getMaxY();Ee++){if(ce=nt.getStartColumn(L,ee,Ee,q),ce<0||ce>v.getMaxX()){if(ve===-1)continue;ce=ve}let pe=nt.detectCodeword(o,v.getMinX(),v.getMaxX(),q,ce,Ee,g,w);pe!=null&&(se.setCodeword(Ee,pe),ve=ce,g=Math.min(g,pe.getWidth()),w=Math.max(w,pe.getWidth()))}}return nt.createDecoderResult(L)}static merge(o,l){if(o==null&&l==null)return null;let c=nt.getBarcodeMetadata(o,l);if(c==null)return null;let h=Bs.merge(nt.adjustBoundingBox(o),nt.adjustBoundingBox(l));return new Ft(c,h)}static adjustBoundingBox(o){if(o==null)return null;let l=o.getRowHeights();if(l==null)return null;let c=nt.getMax(l),h=0;for(let w of l)if(h+=c-w,w>0)break;let f=o.getCodewords();for(let w=0;h>0&&f[w]==null;w++)h--;let g=0;for(let w=l.length-1;w>=0&&(g+=c-l[w],!(l[w]>0));w--);for(let w=f.length-1;g>0&&f[w]==null;w--)g--;return o.getBoundingBox().addMissingRows(h,g,o.isLeft())}static getMax(o){let l=-1;for(let c of o)l=Math.max(l,c);return l}static getBarcodeMetadata(o,l){let c;if(o==null||(c=o.getBarcodeMetadata())==null)return l==null?null:l.getBarcodeMetadata();let h;return l==null||(h=l.getBarcodeMetadata())==null?c:c.getColumnCount()!==h.getColumnCount()&&c.getErrorCorrectionLevel()!==h.getErrorCorrectionLevel()&&c.getRowCount()!==h.getRowCount()?null:c}static getRowIndicatorColumn(o,l,c,h,f,g){let w=new Nc(l,h);for(let v=0;v<2;v++){let A=v===0?1:-1,N=Math.trunc(Math.trunc(c.getX()));for(let L=Math.trunc(Math.trunc(c.getY()));L<=l.getMaxY()&&L>=l.getMinY();L+=A){let V=nt.detectCodeword(o,0,o.getWidth(),h,N,L,f,g);V!=null&&(w.setCodeword(L,V),h?N=V.getStartX():N=V.getEndX())}}return w}static adjustCodewordCount(o,l){let c=l[0][1],h=c.getValue(),f=o.getBarcodeColumnCount()*o.getBarcodeRowCount()-nt.getNumberOfECCodeWords(o.getBarcodeECLevel());if(h.length===0){if(f<1||f>Ke.MAX_CODEWORDS_IN_BARCODE)throw ie.getNotFoundInstance();c.setValue(f)}else h[0]!==f&&c.setValue(f)}static createDecoderResult(o){let l=nt.createBarcodeMatrix(o);nt.adjustCodewordCount(o,l);let c=new Array,h=new Int32Array(o.getBarcodeRowCount()*o.getBarcodeColumnCount()),f=[],g=new Array;for(let v=0;v<o.getBarcodeRowCount();v++)for(let A=0;A<o.getBarcodeColumnCount();A++){let N=l[v][A+1].getValue(),L=v*o.getBarcodeColumnCount()+A;N.length===0?c.push(L):N.length===1?h[L]=N[0]:(g.push(L),f.push(N))}let w=new Array(f.length);for(let v=0;v<w.length;v++)w[v]=f[v];return nt.createDecoderResultFromAmbiguousValues(o.getBarcodeECLevel(),h,Ke.toIntArray(c),Ke.toIntArray(g),w)}static createDecoderResultFromAmbiguousValues(o,l,c,h,f){let g=new Int32Array(h.length),w=100;for(;w-- >0;){for(let v=0;v<g.length;v++)l[h[v]]=f[v][g[v]];try{return nt.decodeCodewords(l,o,c)}catch(v){if(!(v instanceof b))throw v}if(g.length===0)throw b.getChecksumInstance();for(let v=0;v<g.length;v++)if(g[v]<f[v].length-1){g[v]++;break}else if(g[v]=0,v===g.length-1)throw b.getChecksumInstance()}throw b.getChecksumInstance()}static createBarcodeMatrix(o){let l=Array.from({length:o.getBarcodeRowCount()},()=>new Array(o.getBarcodeColumnCount()+2));for(let h=0;h<l.length;h++)for(let f=0;f<l[h].length;f++)l[h][f]=new Ko;let c=0;for(let h of o.getDetectionResultColumns()){if(h!=null){for(let f of h.getCodewords())if(f!=null){let g=f.getRowNumber();if(g>=0){if(g>=l.length)continue;l[g][c].setValue(f.getValue())}}}c++}return l}static isValidBarcodeColumn(o,l){return l>=0&&l<=o.getBarcodeColumnCount()+1}static getStartColumn(o,l,c,h){let f=h?1:-1,g=null;if(nt.isValidBarcodeColumn(o,l-f)&&(g=o.getDetectionResultColumn(l-f).getCodeword(c)),g!=null)return h?g.getEndX():g.getStartX();if(g=o.getDetectionResultColumn(l).getCodewordNearby(c),g!=null)return h?g.getStartX():g.getEndX();if(nt.isValidBarcodeColumn(o,l-f)&&(g=o.getDetectionResultColumn(l-f).getCodewordNearby(c)),g!=null)return h?g.getEndX():g.getStartX();let w=0;for(;nt.isValidBarcodeColumn(o,l-f);){l-=f;for(let v of o.getDetectionResultColumn(l).getCodewords())if(v!=null)return(h?v.getEndX():v.getStartX())+f*w*(v.getEndX()-v.getStartX());w++}return h?o.getBoundingBox().getMinX():o.getBoundingBox().getMaxX()}static detectCodeword(o,l,c,h,f,g,w,v){f=nt.adjustCodewordStartColumn(o,l,c,h,f,g);let A=nt.getModuleBitCount(o,l,c,h,f,g);if(A==null)return null;let N,L=lt.sum(A);if(h)N=f+L;else{for(let J=0;J<A.length/2;J++){let ee=A[J];A[J]=A[A.length-1-J],A[A.length-1-J]=ee}N=f,f=N-L}if(!nt.checkCodewordSkew(L,w,v))return null;let V=Dr.getDecodedValue(A),q=Ke.getCodeword(V);return q===-1?null:new pl(f,N,nt.getCodewordBucketNumber(V),q)}static getModuleBitCount(o,l,c,h,f,g){let w=f,v=new Int32Array(8),A=0,N=h?1:-1,L=h;for(;(h?w<c:w>=l)&&A<v.length;)o.get(w,g)===L?(v[A]++,w+=N):(A++,L=!L);return A===v.length||w===(h?c:l)&&A===v.length-1?v:null}static getNumberOfECCodeWords(o){return 2<<o}static adjustCodewordStartColumn(o,l,c,h,f,g){let w=f,v=h?-1:1;for(let A=0;A<2;A++){for(;(h?w>=l:w<c)&&h===o.get(w,g);){if(Math.abs(f-w)>nt.CODEWORD_SKEW_SIZE)return f;w+=v}v=-v,h=!h}return w}static checkCodewordSkew(o,l,c){return l-nt.CODEWORD_SKEW_SIZE<=o&&o<=c+nt.CODEWORD_SKEW_SIZE}static decodeCodewords(o,l,c){if(o.length===0)throw D.getFormatInstance();let h=1<<l+1,f=nt.correctErrors(o,c,h);nt.verifyCodewordCount(o,h);let g=oe.decode(o,""+l);return g.setErrorsCorrected(f),g.setErasures(c.length),g}static correctErrors(o,l,c){if(l!=null&&l.length>c/2+nt.MAX_ERRORS||c<0||c>nt.MAX_EC_CODEWORDS)throw b.getChecksumInstance();return nt.errorCorrection.decode(o,c,l)}static verifyCodewordCount(o,l){if(o.length<4)throw D.getFormatInstance();let c=o[0];if(c>o.length)throw D.getFormatInstance();if(c===0)if(l<o.length)o[0]=o.length-l;else throw D.getFormatInstance()}static getBitCountForCodeword(o){let l=new Int32Array(8),c=0,h=l.length-1;for(;!((o&1)!==c&&(c=o&1,h--,h<0));)l[h]++,o>>=1;return l}static getCodewordBucketNumber(o){return o instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(o):this.getCodewordBucketNumber_number(o)}static getCodewordBucketNumber_number(o){return nt.getCodewordBucketNumber(nt.getBitCountForCodeword(o))}static getCodewordBucketNumber_Int32Array(o){return(o[0]-o[2]+o[4]-o[6]+9)%9}static toString(o){let l=new ei;for(let c=0;c<o.length;c++){l.format("Row %2d: ",c);for(let h=0;h<o[c].length;h++){let f=o[c][h];f.getValue().length===0?l.format("        ",null):l.format("%4d(%2d)",f.getValue()[0],f.getConfidence(f.getValue()[0]))}l.format("%n")}return l.toString()}}nt.CODEWORD_SKEW_SIZE=2,nt.MAX_ERRORS=3,nt.MAX_EC_CODEWORDS=512,nt.errorCorrection=new gl;class Tn{decode(o,l=null){let c=Tn.decode(o,l,!1);if(c==null||c.length===0||c[0]==null)throw ie.getNotFoundInstance();return c[0]}decodeMultiple(o,l=null){try{return Tn.decode(o,l,!0)}catch(c){throw c instanceof D||c instanceof b?ie.getNotFoundInstance():c}}static decode(o,l,c){const h=new Array,f=tt.detectMultiple(o,l,c);for(const g of f.getPoints()){const w=nt.decode(f.getBits(),g[4],g[5],g[6],g[7],Tn.getMinCodewordWidth(g),Tn.getMaxCodewordWidth(g)),v=new zt(w.getText(),w.getRawBytes(),void 0,g,Fe.PDF_417);v.putMetadata(pn.ERROR_CORRECTION_LEVEL,w.getECLevel());const A=w.getOther();A!=null&&v.putMetadata(pn.PDF417_EXTRA_METADATA,A),h.push(v)}return h.map(g=>g)}static getMaxWidth(o,l){return o==null||l==null?0:Math.trunc(Math.abs(o.getX()-l.getX()))}static getMinWidth(o,l){return o==null||l==null?R.MAX_VALUE:Math.trunc(Math.abs(o.getX()-l.getX()))}static getMaxCodewordWidth(o){return Math.floor(Math.max(Math.max(Tn.getMaxWidth(o[0],o[4]),Tn.getMaxWidth(o[6],o[2])*Ke.MODULES_IN_CODEWORD/Ke.MODULES_IN_STOP_PATTERN),Math.max(Tn.getMaxWidth(o[1],o[5]),Tn.getMaxWidth(o[7],o[3])*Ke.MODULES_IN_CODEWORD/Ke.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(o){return Math.floor(Math.min(Math.min(Tn.getMinWidth(o[0],o[4]),Tn.getMinWidth(o[6],o[2])*Ke.MODULES_IN_CODEWORD/Ke.MODULES_IN_STOP_PATTERN),Math.min(Tn.getMinWidth(o[1],o[5]),Tn.getMinWidth(o[7],o[3])*Ke.MODULES_IN_CODEWORD/Ke.MODULES_IN_STOP_PATTERN)))}reset(){}}class Pc extends m{}Pc.kind="ReaderException";class Mh{constructor(o,l){this.verbose=o===!0,l&&this.setHints(l)}decode(o,l){return l&&this.setHints(l),this.decodeInternal(o)}decodeWithState(o){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(o)}setHints(o){this.hints=o;const l=!r(o)&&o.get(Q.TRY_HARDER)===!0,c=r(o)?null:o.get(Q.POSSIBLE_FORMATS),h=new Array;if(!r(c)){const f=c.some(g=>g===Fe.UPC_A||g===Fe.UPC_E||g===Fe.EAN_13||g===Fe.EAN_8||g===Fe.CODABAR||g===Fe.CODE_39||g===Fe.CODE_93||g===Fe.CODE_128||g===Fe.ITF||g===Fe.RSS_14||g===Fe.RSS_EXPANDED);f&&!l&&h.push(new os(o,this.verbose)),c.includes(Fe.QR_CODE)&&h.push(new $r),c.includes(Fe.DATA_MATRIX)&&h.push(new Js),c.includes(Fe.AZTEC)&&h.push(new kr),c.includes(Fe.PDF_417)&&h.push(new Tn),f&&l&&h.push(new os(o,this.verbose))}h.length===0&&(l||h.push(new os(o,this.verbose)),h.push(new $r),h.push(new Js),h.push(new kr),h.push(new Tn),l&&h.push(new os(o,this.verbose))),this.readers=h}reset(){if(this.readers!==null)for(const o of this.readers)o.reset()}decodeInternal(o){if(this.readers===null)throw new Pc("No readers where selected, nothing can be read.");for(const l of this.readers)try{return l.decode(o,this.hints)}catch(c){if(c instanceof Pc)continue}throw new ie("No MultiFormat Readers were able to detect the code.")}}class yl extends _t{constructor(o=null,l=500){const c=new Mh;c.setHints(o),super(c,l)}decodeBitmap(o){return this.reader.decodeWithState(o)}}class y0 extends _t{constructor(o=500){super(new Tn,o)}}class x0 extends _t{constructor(o=500){super(new $r,o)}}var xl;(function(M){M[M.ERROR_CORRECTION=0]="ERROR_CORRECTION",M[M.CHARACTER_SET=1]="CHARACTER_SET",M[M.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",M[M.MIN_SIZE=3]="MIN_SIZE",M[M.MAX_SIZE=4]="MAX_SIZE",M[M.MARGIN=5]="MARGIN",M[M.PDF417_COMPACT=6]="PDF417_COMPACT",M[M.PDF417_COMPACTION=7]="PDF417_COMPACTION",M[M.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",M[M.AZTEC_LAYERS=9]="AZTEC_LAYERS",M[M.QR_VERSION=10]="QR_VERSION"})(xl||(xl={}));var xn=xl;class kc{constructor(o){this.field=o,this.cachedGenerators=[],this.cachedGenerators.push(new Mn(o,Int32Array.from([1])))}buildGenerator(o){const l=this.cachedGenerators;if(o>=l.length){let c=l[l.length-1];const h=this.field;for(let f=l.length;f<=o;f++){const g=c.multiply(new Mn(h,Int32Array.from([1,h.exp(f-1+h.getGeneratorBase())])));l.push(g),c=g}}return l[o]}encode(o,l){if(l===0)throw new _("No error correction bytes");const c=o.length-l;if(c<=0)throw new _("No data bytes provided");const h=this.buildGenerator(l),f=new Int32Array(c);S.arraycopy(o,0,f,0,c);let g=new Mn(this.field,f);g=g.multiplyByMonomial(l,1);const v=g.divide(h)[1].getCoefficients(),A=l-v.length;for(let N=0;N<A;N++)o[c+N]=0;S.arraycopy(v,0,o,c+A,v.length)}}class qt{constructor(){}static applyMaskPenaltyRule1(o){return qt.applyMaskPenaltyRule1Internal(o,!0)+qt.applyMaskPenaltyRule1Internal(o,!1)}static applyMaskPenaltyRule2(o){let l=0;const c=o.getArray(),h=o.getWidth(),f=o.getHeight();for(let g=0;g<f-1;g++){const w=c[g];for(let v=0;v<h-1;v++){const A=w[v];A===w[v+1]&&A===c[g+1][v]&&A===c[g+1][v+1]&&l++}}return qt.N2*l}static applyMaskPenaltyRule3(o){let l=0;const c=o.getArray(),h=o.getWidth(),f=o.getHeight();for(let g=0;g<f;g++)for(let w=0;w<h;w++){const v=c[g];w+6<h&&v[w]===1&&v[w+1]===0&&v[w+2]===1&&v[w+3]===1&&v[w+4]===1&&v[w+5]===0&&v[w+6]===1&&(qt.isWhiteHorizontal(v,w-4,w)||qt.isWhiteHorizontal(v,w+7,w+11))&&l++,g+6<f&&c[g][w]===1&&c[g+1][w]===0&&c[g+2][w]===1&&c[g+3][w]===1&&c[g+4][w]===1&&c[g+5][w]===0&&c[g+6][w]===1&&(qt.isWhiteVertical(c,w,g-4,g)||qt.isWhiteVertical(c,w,g+7,g+11))&&l++}return l*qt.N3}static isWhiteHorizontal(o,l,c){l=Math.max(l,0),c=Math.min(c,o.length);for(let h=l;h<c;h++)if(o[h]===1)return!1;return!0}static isWhiteVertical(o,l,c,h){c=Math.max(c,0),h=Math.min(h,o.length);for(let f=c;f<h;f++)if(o[f][l]===1)return!1;return!0}static applyMaskPenaltyRule4(o){let l=0;const c=o.getArray(),h=o.getWidth(),f=o.getHeight();for(let v=0;v<f;v++){const A=c[v];for(let N=0;N<h;N++)A[N]===1&&l++}const g=o.getHeight()*o.getWidth();return Math.floor(Math.abs(l*2-g)*10/g)*qt.N4}static getDataMaskBit(o,l,c){let h,f;switch(o){case 0:h=c+l&1;break;case 1:h=c&1;break;case 2:h=l%3;break;case 3:h=(c+l)%3;break;case 4:h=Math.floor(c/2)+Math.floor(l/3)&1;break;case 5:f=c*l,h=(f&1)+f%3;break;case 6:f=c*l,h=(f&1)+f%3&1;break;case 7:f=c*l,h=f%3+(c+l&1)&1;break;default:throw new _("Invalid mask pattern: "+o)}return h===0}static applyMaskPenaltyRule1Internal(o,l){let c=0;const h=l?o.getHeight():o.getWidth(),f=l?o.getWidth():o.getHeight(),g=o.getArray();for(let w=0;w<h;w++){let v=0,A=-1;for(let N=0;N<f;N++){const L=l?g[w][N]:g[N][w];L===A?v++:(v>=5&&(c+=qt.N1+(v-5)),v=1,A=L)}v>=5&&(c+=qt.N1+(v-5))}return c}}qt.N1=3,qt.N2=3,qt.N3=40,qt.N4=10;class wl{constructor(o,l){this.width=o,this.height=l;const c=new Array(l);for(let h=0;h!==l;h++)c[h]=new Uint8Array(o);this.bytes=c}getHeight(){return this.height}getWidth(){return this.width}get(o,l){return this.bytes[l][o]}getArray(){return this.bytes}setNumber(o,l,c){this.bytes[l][o]=c}setBoolean(o,l,c){this.bytes[l][o]=c?1:0}clear(o){for(const l of this.bytes)C.fill(l,o)}equals(o){if(!(o instanceof wl))return!1;const l=o;if(this.width!==l.width||this.height!==l.height)return!1;for(let c=0,h=this.height;c<h;++c){const f=this.bytes[c],g=l.bytes[c];for(let w=0,v=this.width;w<v;++w)if(f[w]!==g[w])return!1}return!0}toString(){const o=new z;for(let l=0,c=this.height;l<c;++l){const h=this.bytes[l];for(let f=0,g=this.width;f<g;++f)switch(h[f]){case 0:o.append(" 0");break;case 1:o.append(" 1");break;default:o.append("  ");break}o.append(`
`)}return o.toString()}}class Ci{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const o=new z;return o.append(`<<
`),o.append(" mode: "),o.append(this.mode?this.mode.toString():"null"),o.append(`
 ecLevel: `),o.append(this.ecLevel?this.ecLevel.toString():"null"),o.append(`
 version: `),o.append(this.version?this.version.toString():"null"),o.append(`
 maskPattern: `),o.append(this.maskPattern.toString()),this.matrix?(o.append(`
 matrix:
`),o.append(this.matrix.toString())):o.append(`
 matrix: null
`),o.append(`>>
`),o.toString()}setMode(o){this.mode=o}setECLevel(o){this.ecLevel=o}setVersion(o){this.version=o}setMaskPattern(o){this.maskPattern=o}setMatrix(o){this.matrix=o}static isValidMaskPattern(o){return o>=0&&o<Ci.NUM_MASK_PATTERNS}}Ci.NUM_MASK_PATTERNS=8;class wt extends m{}wt.kind="WriterException";class qe{constructor(){}static clearMatrix(o){o.clear(255)}static buildMatrix(o,l,c,h,f){qe.clearMatrix(f),qe.embedBasicPatterns(c,f),qe.embedTypeInfo(l,h,f),qe.maybeEmbedVersionInfo(c,f),qe.embedDataBits(o,h,f)}static embedBasicPatterns(o,l){qe.embedPositionDetectionPatternsAndSeparators(l),qe.embedDarkDotAtLeftBottomCorner(l),qe.maybeEmbedPositionAdjustmentPatterns(o,l),qe.embedTimingPatterns(l)}static embedTypeInfo(o,l,c){const h=new j;qe.makeTypeInfoBits(o,l,h);for(let f=0,g=h.getSize();f<g;++f){const w=h.get(h.getSize()-1-f),v=qe.TYPE_INFO_COORDINATES[f],A=v[0],N=v[1];if(c.setBoolean(A,N,w),f<8){const L=c.getWidth()-f-1,V=8;c.setBoolean(L,V,w)}else{const V=c.getHeight()-7+(f-8);c.setBoolean(8,V,w)}}}static maybeEmbedVersionInfo(o,l){if(o.getVersionNumber()<7)return;const c=new j;qe.makeVersionInfoBits(o,c);let h=6*3-1;for(let f=0;f<6;++f)for(let g=0;g<3;++g){const w=c.get(h);h--,l.setBoolean(f,l.getHeight()-11+g,w),l.setBoolean(l.getHeight()-11+g,f,w)}}static embedDataBits(o,l,c){let h=0,f=-1,g=c.getWidth()-1,w=c.getHeight()-1;for(;g>0;){for(g===6&&(g-=1);w>=0&&w<c.getHeight();){for(let v=0;v<2;++v){const A=g-v;if(!qe.isEmpty(c.get(A,w)))continue;let N;h<o.getSize()?(N=o.get(h),++h):N=!1,l!==255&&qt.getDataMaskBit(l,A,w)&&(N=!N),c.setBoolean(A,w,N)}w+=f}f=-f,w+=f,g-=2}if(h!==o.getSize())throw new wt("Not all bits consumed: "+h+"/"+o.getSize())}static findMSBSet(o){return 32-R.numberOfLeadingZeros(o)}static calculateBCHCode(o,l){if(l===0)throw new _("0 polynomial");const c=qe.findMSBSet(l);for(o<<=c-1;qe.findMSBSet(o)>=c;)o^=l<<qe.findMSBSet(o)-c;return o}static makeTypeInfoBits(o,l,c){if(!Ci.isValidMaskPattern(l))throw new wt("Invalid mask pattern");const h=o.getBits()<<3|l;c.appendBits(h,5);const f=qe.calculateBCHCode(h,qe.TYPE_INFO_POLY);c.appendBits(f,10);const g=new j;if(g.appendBits(qe.TYPE_INFO_MASK_PATTERN,15),c.xor(g),c.getSize()!==15)throw new wt("should not happen but we got: "+c.getSize())}static makeVersionInfoBits(o,l){l.appendBits(o.getVersionNumber(),6);const c=qe.calculateBCHCode(o.getVersionNumber(),qe.VERSION_INFO_POLY);if(l.appendBits(c,12),l.getSize()!==18)throw new wt("should not happen but we got: "+l.getSize())}static isEmpty(o){return o===255}static embedTimingPatterns(o){for(let l=8;l<o.getWidth()-8;++l){const c=(l+1)%2;qe.isEmpty(o.get(l,6))&&o.setNumber(l,6,c),qe.isEmpty(o.get(6,l))&&o.setNumber(6,l,c)}}static embedDarkDotAtLeftBottomCorner(o){if(o.get(8,o.getHeight()-8)===0)throw new wt;o.setNumber(8,o.getHeight()-8,1)}static embedHorizontalSeparationPattern(o,l,c){for(let h=0;h<8;++h){if(!qe.isEmpty(c.get(o+h,l)))throw new wt;c.setNumber(o+h,l,0)}}static embedVerticalSeparationPattern(o,l,c){for(let h=0;h<7;++h){if(!qe.isEmpty(c.get(o,l+h)))throw new wt;c.setNumber(o,l+h,0)}}static embedPositionAdjustmentPattern(o,l,c){for(let h=0;h<5;++h){const f=qe.POSITION_ADJUSTMENT_PATTERN[h];for(let g=0;g<5;++g)c.setNumber(o+g,l+h,f[g])}}static embedPositionDetectionPattern(o,l,c){for(let h=0;h<7;++h){const f=qe.POSITION_DETECTION_PATTERN[h];for(let g=0;g<7;++g)c.setNumber(o+g,l+h,f[g])}}static embedPositionDetectionPatternsAndSeparators(o){const l=qe.POSITION_DETECTION_PATTERN[0].length;qe.embedPositionDetectionPattern(0,0,o),qe.embedPositionDetectionPattern(o.getWidth()-l,0,o),qe.embedPositionDetectionPattern(0,o.getWidth()-l,o);const c=8;qe.embedHorizontalSeparationPattern(0,c-1,o),qe.embedHorizontalSeparationPattern(o.getWidth()-c,c-1,o),qe.embedHorizontalSeparationPattern(0,o.getWidth()-c,o);const h=7;qe.embedVerticalSeparationPattern(h,0,o),qe.embedVerticalSeparationPattern(o.getHeight()-h-1,0,o),qe.embedVerticalSeparationPattern(h,o.getHeight()-h,o)}static maybeEmbedPositionAdjustmentPatterns(o,l){if(o.getVersionNumber()<2)return;const c=o.getVersionNumber()-1,h=qe.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[c];for(let f=0,g=h.length;f!==g;f++){const w=h[f];if(w>=0)for(let v=0;v!==g;v++){const A=h[v];A>=0&&qe.isEmpty(l.get(A,w))&&qe.embedPositionAdjustmentPattern(A-2,w-2,l)}}}}qe.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),qe.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),qe.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),qe.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),qe.VERSION_INFO_POLY=7973,qe.TYPE_INFO_POLY=1335,qe.TYPE_INFO_MASK_PATTERN=21522;class w0{constructor(o,l){this.dataBytes=o,this.errorCorrectionBytes=l}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class Bt{constructor(){}static calculateMaskPenalty(o){return qt.applyMaskPenaltyRule1(o)+qt.applyMaskPenaltyRule2(o)+qt.applyMaskPenaltyRule3(o)+qt.applyMaskPenaltyRule4(o)}static encode(o,l,c=null){let h=Bt.DEFAULT_BYTE_MODE_ENCODING;const f=c!==null&&c.get(xn.CHARACTER_SET)!==void 0;f&&(h=c.get(xn.CHARACTER_SET).toString());const g=this.chooseMode(o,h),w=new j;if(g===ze.BYTE&&(f||Bt.DEFAULT_BYTE_MODE_ENCODING!==h)){const Ee=F.getCharacterSetECIByName(h);Ee!==void 0&&this.appendECI(Ee,w)}this.appendModeInfo(g,w);const v=new j;this.appendBytes(o,g,v,h);let A;if(c!==null&&c.get(xn.QR_VERSION)!==void 0){const Ee=Number.parseInt(c.get(xn.QR_VERSION).toString(),10);A=Ve.getVersionForNumber(Ee);const pe=this.calculateBitsNeeded(g,w,v,A);if(!this.willFit(pe,A,l))throw new wt("Data too big for requested version")}else A=this.recommendVersion(l,g,w,v);const N=new j;N.appendBitArray(w);const L=g===ze.BYTE?v.getSizeInBytes():o.length;this.appendLengthInfo(L,A,g,N),N.appendBitArray(v);const V=A.getECBlocksForLevel(l),q=A.getTotalCodewords()-V.getTotalECCodewords();this.terminateBits(q,N);const J=this.interleaveWithECBytes(N,A.getTotalCodewords(),q,V.getNumBlocks()),ee=new Ci;ee.setECLevel(l),ee.setMode(g),ee.setVersion(A);const se=A.getDimensionForVersion(),ce=new wl(se,se),ve=this.chooseMaskPattern(J,l,A,ce);return ee.setMaskPattern(ve),qe.buildMatrix(J,l,A,ve,ce),ee.setMatrix(ce),ee}static recommendVersion(o,l,c,h){const f=this.calculateBitsNeeded(l,c,h,Ve.getVersionForNumber(1)),g=this.chooseVersion(f,o),w=this.calculateBitsNeeded(l,c,h,g);return this.chooseVersion(w,o)}static calculateBitsNeeded(o,l,c,h){return l.getSize()+o.getCharacterCountBits(h)+c.getSize()}static getAlphanumericCode(o){return o<Bt.ALPHANUMERIC_TABLE.length?Bt.ALPHANUMERIC_TABLE[o]:-1}static chooseMode(o,l=null){if(F.SJIS.getName()===l&&this.isOnlyDoubleByteKanji(o))return ze.KANJI;let c=!1,h=!1;for(let f=0,g=o.length;f<g;++f){const w=o.charAt(f);if(Bt.isDigit(w))c=!0;else if(this.getAlphanumericCode(w.charCodeAt(0))!==-1)h=!0;else return ze.BYTE}return h?ze.ALPHANUMERIC:c?ze.NUMERIC:ze.BYTE}static isOnlyDoubleByteKanji(o){let l;try{l=X.encode(o,F.SJIS)}catch{return!1}const c=l.length;if(c%2!==0)return!1;for(let h=0;h<c;h+=2){const f=l[h]&255;if((f<129||f>159)&&(f<224||f>235))return!1}return!0}static chooseMaskPattern(o,l,c,h){let f=Number.MAX_SAFE_INTEGER,g=-1;for(let w=0;w<Ci.NUM_MASK_PATTERNS;w++){qe.buildMatrix(o,l,c,w,h);let v=this.calculateMaskPenalty(h);v<f&&(f=v,g=w)}return g}static chooseVersion(o,l){for(let c=1;c<=40;c++){const h=Ve.getVersionForNumber(c);if(Bt.willFit(o,h,l))return h}throw new wt("Data too big")}static willFit(o,l,c){const h=l.getTotalCodewords(),g=l.getECBlocksForLevel(c).getTotalECCodewords(),w=h-g,v=(o+7)/8;return w>=v}static terminateBits(o,l){const c=o*8;if(l.getSize()>c)throw new wt("data bits cannot fit in the QR Code"+l.getSize()+" > "+c);for(let g=0;g<4&&l.getSize()<c;++g)l.appendBit(!1);const h=l.getSize()&7;if(h>0)for(let g=h;g<8;g++)l.appendBit(!1);const f=o-l.getSizeInBytes();for(let g=0;g<f;++g)l.appendBits(g&1?17:236,8);if(l.getSize()!==c)throw new wt("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(o,l,c,h,f,g){if(h>=c)throw new wt("Block ID too large");const w=o%c,v=c-w,A=Math.floor(o/c),N=A+1,L=Math.floor(l/c),V=L+1,q=A-L,J=N-V;if(q!==J)throw new wt("EC bytes mismatch");if(c!==v+w)throw new wt("RS blocks mismatch");if(o!==(L+q)*v+(V+J)*w)throw new wt("Total bytes mismatch");h<v?(f[0]=L,g[0]=q):(f[0]=V,g[0]=J)}static interleaveWithECBytes(o,l,c,h){if(o.getSizeInBytes()!==c)throw new wt("Number of bits and data bytes does not match");let f=0,g=0,w=0;const v=new Array;for(let N=0;N<h;++N){const L=new Int32Array(1),V=new Int32Array(1);Bt.getNumDataBytesAndNumECBytesForBlockID(l,c,h,N,L,V);const q=L[0],J=new Uint8Array(q);o.toBytes(8*f,J,0,q);const ee=Bt.generateECBytes(J,V[0]);v.push(new w0(J,ee)),g=Math.max(g,q),w=Math.max(w,ee.length),f+=L[0]}if(c!==f)throw new wt("Data bytes does not match offset");const A=new j;for(let N=0;N<g;++N)for(const L of v){const V=L.getDataBytes();N<V.length&&A.appendBits(V[N],8)}for(let N=0;N<w;++N)for(const L of v){const V=L.getErrorCorrectionBytes();N<V.length&&A.appendBits(V[N],8)}if(l!==A.getSizeInBytes())throw new wt("Interleaving error: "+l+" and "+A.getSizeInBytes()+" differ.");return A}static generateECBytes(o,l){const c=o.length,h=new Int32Array(c+l);for(let g=0;g<c;g++)h[g]=o[g]&255;new kc(dt.QR_CODE_FIELD_256).encode(h,l);const f=new Uint8Array(l);for(let g=0;g<l;g++)f[g]=h[c+g];return f}static appendModeInfo(o,l){l.appendBits(o.getBits(),4)}static appendLengthInfo(o,l,c,h){const f=c.getCharacterCountBits(l);if(o>=1<<f)throw new wt(o+" is bigger than "+((1<<f)-1));h.appendBits(o,f)}static appendBytes(o,l,c,h){switch(l){case ze.NUMERIC:Bt.appendNumericBytes(o,c);break;case ze.ALPHANUMERIC:Bt.appendAlphanumericBytes(o,c);break;case ze.BYTE:Bt.append8BitBytes(o,c,h);break;case ze.KANJI:Bt.appendKanjiBytes(o,c);break;default:throw new wt("Invalid mode: "+l)}}static getDigit(o){return o.charCodeAt(0)-48}static isDigit(o){const l=Bt.getDigit(o);return l>=0&&l<=9}static appendNumericBytes(o,l){const c=o.length;let h=0;for(;h<c;){const f=Bt.getDigit(o.charAt(h));if(h+2<c){const g=Bt.getDigit(o.charAt(h+1)),w=Bt.getDigit(o.charAt(h+2));l.appendBits(f*100+g*10+w,10),h+=3}else if(h+1<c){const g=Bt.getDigit(o.charAt(h+1));l.appendBits(f*10+g,7),h+=2}else l.appendBits(f,4),h++}}static appendAlphanumericBytes(o,l){const c=o.length;let h=0;for(;h<c;){const f=Bt.getAlphanumericCode(o.charCodeAt(h));if(f===-1)throw new wt;if(h+1<c){const g=Bt.getAlphanumericCode(o.charCodeAt(h+1));if(g===-1)throw new wt;l.appendBits(f*45+g,11),h+=2}else l.appendBits(f,6),h++}}static append8BitBytes(o,l,c){let h;try{h=X.encode(o,c)}catch(f){throw new wt(f)}for(let f=0,g=h.length;f!==g;f++){const w=h[f];l.appendBits(w,8)}}static appendKanjiBytes(o,l){let c;try{c=X.encode(o,F.SJIS)}catch(f){throw new wt(f)}const h=c.length;for(let f=0;f<h;f+=2){const g=c[f]&255,w=c[f+1]&255,v=g<<8&4294967295|w;let A=-1;if(v>=33088&&v<=40956?A=v-33088:v>=57408&&v<=60351&&(A=v-49472),A===-1)throw new wt("Invalid byte sequence");const N=(A>>8)*192+(A&255);l.appendBits(N,13)}}static appendECI(o,l){l.appendBits(ze.ECI.getBits(),4),l.appendBits(o.getValue(),8)}}Bt.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),Bt.DEFAULT_BYTE_MODE_ENCODING=F.UTF8.getName();class Ti{write(o,l,c,h=null){if(o.length===0)throw new _("Found empty contents");if(l<0||c<0)throw new _("Requested dimensions are too small: "+l+"x"+c);let f=bt.L,g=Ti.QUIET_ZONE_SIZE;h!==null&&(h.get(xn.ERROR_CORRECTION)!==void 0&&(f=bt.fromString(h.get(xn.ERROR_CORRECTION).toString())),h.get(xn.MARGIN)!==void 0&&(g=Number.parseInt(h.get(xn.MARGIN).toString(),10)));const w=Bt.encode(o,f,h);return this.renderResult(w,l,c,g)}writeToDom(o,l,c,h,f=null){typeof o=="string"&&(o=document.querySelector(o));const g=this.write(l,c,h,f);o&&o.appendChild(g)}renderResult(o,l,c,h){const f=o.getMatrix();if(f===null)throw new _r;const g=f.getWidth(),w=f.getHeight(),v=g+h*2,A=w+h*2,N=Math.max(l,v),L=Math.max(c,A),V=Math.min(Math.floor(N/v),Math.floor(L/A)),q=Math.floor((N-g*V)/2),J=Math.floor((L-w*V)/2),ee=this.createSVGElement(N,L);for(let se=0,ce=J;se<w;se++,ce+=V)for(let ve=0,Ee=q;ve<g;ve++,Ee+=V)if(f.get(ve,se)===1){const pe=this.createSvgRectElement(Ee,ce,V,V);ee.appendChild(pe)}return ee}createSVGElement(o,l){const c=document.createElementNS(Ti.SVG_NS,"svg");return c.setAttributeNS(null,"height",o.toString()),c.setAttributeNS(null,"width",l.toString()),c}createSvgRectElement(o,l,c,h){const f=document.createElementNS(Ti.SVG_NS,"rect");return f.setAttributeNS(null,"x",o.toString()),f.setAttributeNS(null,"y",l.toString()),f.setAttributeNS(null,"height",c.toString()),f.setAttributeNS(null,"width",h.toString()),f.setAttributeNS(null,"fill","#000000"),f}}Ti.QUIET_ZONE_SIZE=4,Ti.SVG_NS="http://www.w3.org/2000/svg";class si{encode(o,l,c,h,f){if(o.length===0)throw new _("Found empty contents");if(l!==Fe.QR_CODE)throw new _("Can only encode QR_CODE, but got "+l);if(c<0||h<0)throw new _(`Requested dimensions are too small: ${c}x${h}`);let g=bt.L,w=si.QUIET_ZONE_SIZE;f!==null&&(f.get(xn.ERROR_CORRECTION)!==void 0&&(g=bt.fromString(f.get(xn.ERROR_CORRECTION).toString())),f.get(xn.MARGIN)!==void 0&&(w=Number.parseInt(f.get(xn.MARGIN).toString(),10)));const v=Bt.encode(o,g,f);return si.renderResult(v,c,h,w)}static renderResult(o,l,c,h){const f=o.getMatrix();if(f===null)throw new _r;const g=f.getWidth(),w=f.getHeight(),v=g+h*2,A=w+h*2,N=Math.max(l,v),L=Math.max(c,A),V=Math.min(Math.floor(N/v),Math.floor(L/A)),q=Math.floor((N-g*V)/2),J=Math.floor((L-w*V)/2),ee=new Te(N,L);for(let se=0,ce=J;se<w;se++,ce+=V)for(let ve=0,Ee=q;ve<g;ve++,Ee+=V)f.get(ve,se)===1&&ee.setRegion(Ee,ce,V,V);return ee}}si.QUIET_ZONE_SIZE=4;class Hr{encode(o,l,c,h,f){let g;switch(l){case Fe.QR_CODE:g=new si;break;default:throw new _("No encoder available for format "+l)}return g.encode(o,l,c,h,f)}}class Es extends he{constructor(o,l,c,h,f,g,w,v){if(super(g,w),this.yuvData=o,this.dataWidth=l,this.dataHeight=c,this.left=h,this.top=f,h+g>l||f+w>c)throw new _("Crop rectangle does not fit within image data.");v&&this.reverseHorizontal(g,w)}getRow(o,l){if(o<0||o>=this.getHeight())throw new _("Requested row is outside the image: "+o);const c=this.getWidth();(l==null||l.length<c)&&(l=new Uint8ClampedArray(c));const h=(o+this.top)*this.dataWidth+this.left;return S.arraycopy(this.yuvData,h,l,0,c),l}getMatrix(){const o=this.getWidth(),l=this.getHeight();if(o===this.dataWidth&&l===this.dataHeight)return this.yuvData;const c=o*l,h=new Uint8ClampedArray(c);let f=this.top*this.dataWidth+this.left;if(o===this.dataWidth)return S.arraycopy(this.yuvData,f,h,0,c),h;for(let g=0;g<l;g++){const w=g*o;S.arraycopy(this.yuvData,f,h,w,o),f+=this.dataWidth}return h}isCropSupported(){return!0}crop(o,l,c,h){return new Es(this.yuvData,this.dataWidth,this.dataHeight,this.left+o,this.top+l,c,h,!1)}renderThumbnail(){const o=this.getWidth()/Es.THUMBNAIL_SCALE_FACTOR,l=this.getHeight()/Es.THUMBNAIL_SCALE_FACTOR,c=new Int32Array(o*l),h=this.yuvData;let f=this.top*this.dataWidth+this.left;for(let g=0;g<l;g++){const w=g*o;for(let v=0;v<o;v++){const A=h[f+v*Es.THUMBNAIL_SCALE_FACTOR]&255;c[w+v]=4278190080|A*65793}f+=this.dataWidth*Es.THUMBNAIL_SCALE_FACTOR}return c}getThumbnailWidth(){return this.getWidth()/Es.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/Es.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(o,l){const c=this.yuvData;for(let h=0,f=this.top*this.dataWidth+this.left;h<l;h++,f+=this.dataWidth){const g=f+o/2;for(let w=f,v=f+o-1;w<g;w++,v--){const A=c[w];c[w]=c[v],c[v]=A}}}invert(){return new Ce(this)}}Es.THUMBNAIL_SCALE_FACTOR=2;class Dc extends he{constructor(o,l,c,h,f,g,w){if(super(l,c),this.dataWidth=h,this.dataHeight=f,this.left=g,this.top=w,o.BYTES_PER_ELEMENT===4){const v=l*c,A=new Uint8ClampedArray(v);for(let N=0;N<v;N++){const L=o[N],V=L>>16&255,q=L>>7&510,J=L&255;A[N]=(V+q+J)/4&255}this.luminances=A}else this.luminances=o;if(h===void 0&&(this.dataWidth=l),f===void 0&&(this.dataHeight=c),g===void 0&&(this.left=0),w===void 0&&(this.top=0),this.left+l>this.dataWidth||this.top+c>this.dataHeight)throw new _("Crop rectangle does not fit within image data.")}getRow(o,l){if(o<0||o>=this.getHeight())throw new _("Requested row is outside the image: "+o);const c=this.getWidth();(l==null||l.length<c)&&(l=new Uint8ClampedArray(c));const h=(o+this.top)*this.dataWidth+this.left;return S.arraycopy(this.luminances,h,l,0,c),l}getMatrix(){const o=this.getWidth(),l=this.getHeight();if(o===this.dataWidth&&l===this.dataHeight)return this.luminances;const c=o*l,h=new Uint8ClampedArray(c);let f=this.top*this.dataWidth+this.left;if(o===this.dataWidth)return S.arraycopy(this.luminances,f,h,0,c),h;for(let g=0;g<l;g++){const w=g*o;S.arraycopy(this.luminances,f,h,w,o),f+=this.dataWidth}return h}isCropSupported(){return!0}crop(o,l,c,h){return new Dc(this.luminances,c,h,this.dataWidth,this.dataHeight,this.left+o,this.top+l)}invert(){return new Ce(this)}}class ro extends F{static forName(o){return this.getCharacterSetECIByName(o)}}class x{}x.ISO_8859_1=F.ISO8859_1;class I{isCompact(){return this.compact}setCompact(o){this.compact=o}getSize(){return this.size}setSize(o){this.size=o}getLayers(){return this.layers}setLayers(o){this.layers=o}getCodeWords(){return this.codeWords}setCodeWords(o){this.codeWords=o}getMatrix(){return this.matrix}setMatrix(o){this.matrix=o}}class P{static singletonList(o){return[o]}static min(o,l){return o.sort(l)[0]}}class U{constructor(o){this.previous=o}getPrevious(){return this.previous}}class te extends U{constructor(o,l,c){super(o),this.value=l,this.bitCount=c}appendTo(o,l){o.appendBits(this.value,this.bitCount)}add(o,l){return new te(this,o,l)}addBinaryShift(o,l){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new te(this,o,l)}toString(){let o=this.value&(1<<this.bitCount)-1;return o|=1<<this.bitCount,"<"+R.toBinaryString(o|1<<this.bitCount).substring(1)+">"}}class le extends te{constructor(o,l,c){super(o,0,0),this.binaryShiftStart=l,this.binaryShiftByteCount=c}appendTo(o,l){for(let c=0;c<this.binaryShiftByteCount;c++)(c===0||c===31&&this.binaryShiftByteCount<=62)&&(o.appendBits(31,5),this.binaryShiftByteCount>62?o.appendBits(this.binaryShiftByteCount-31,16):c===0?o.appendBits(Math.min(this.binaryShiftByteCount,31),5):o.appendBits(this.binaryShiftByteCount-31,5)),o.appendBits(l[this.binaryShiftStart+c],8)}addBinaryShift(o,l){return new le(this,o,l)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function be(M,o,l){return new le(M,o,l)}function Tt(M,o,l){return new te(M,o,l)}const sr=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],it=0,Fn=1,Ot=2,so=3,Sn=4,Oc=new te(null,0,0),_l=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,655360+928+30]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,655360+928+30]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,917504+14336+928+30]),Int32Array.from([(5<<16)+29,(5<<16)+28,655360+928+30,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,655360+992+28,655360+992+30,655360+992+29,0])];function eP(M){for(let o of M)C.fill(o,-1);return M[it][Sn]=0,M[Fn][Sn]=0,M[Fn][it]=28,M[so][Sn]=0,M[Ot][Sn]=0,M[Ot][it]=15,M}const f2=eP(C.createInt32Array(6,6));class Si{constructor(o,l,c,h){this.token=o,this.mode=l,this.binaryShiftByteCount=c,this.bitCount=h}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(o,l){let c=this.bitCount,h=this.token;if(o!==this.mode){let g=_l[this.mode][o];h=Tt(h,g&65535,g>>16),c+=g>>16}let f=o===Ot?4:5;return h=Tt(h,l,f),new Si(h,o,0,c+f)}shiftAndAppend(o,l){let c=this.token,h=this.mode===Ot?4:5;return c=Tt(c,f2[this.mode][o],h),c=Tt(c,l,5),new Si(c,this.mode,0,this.bitCount+h+5)}addBinaryShiftChar(o){let l=this.token,c=this.mode,h=this.bitCount;if(this.mode===Sn||this.mode===Ot){let w=_l[c][it];l=Tt(l,w&65535,w>>16),h+=w>>16,c=it}let f=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,g=new Si(l,c,this.binaryShiftByteCount+1,h+f);return g.binaryShiftByteCount===2047+31&&(g=g.endBinaryShift(o+1)),g}endBinaryShift(o){if(this.binaryShiftByteCount===0)return this;let l=this.token;return l=be(l,o-this.binaryShiftByteCount,this.binaryShiftByteCount),new Si(l,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(o){let l=this.bitCount+(_l[this.mode][o.mode]>>16);return this.binaryShiftByteCount<o.binaryShiftByteCount?l+=Si.calculateBinaryShiftCost(o)-Si.calculateBinaryShiftCost(this):this.binaryShiftByteCount>o.binaryShiftByteCount&&o.binaryShiftByteCount>0&&(l+=10),l<=o.bitCount}toBitArray(o){let l=[];for(let h=this.endBinaryShift(o.length).token;h!==null;h=h.getPrevious())l.unshift(h);let c=new j;for(const h of l)h.appendTo(c,o);return c}toString(){return $.format("%s bits=%d bytes=%d",sr[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(o){return o.binaryShiftByteCount>62?21:o.binaryShiftByteCount>31?20:o.binaryShiftByteCount>0?10:0}}Si.INITIAL_STATE=new Si(Oc,it,0,0);function tP(M){const o=$.getCharCode(" "),l=$.getCharCode("."),c=$.getCharCode(",");M[it][o]=1;const h=$.getCharCode("Z"),f=$.getCharCode("A");for(let V=f;V<=h;V++)M[it][V]=V-f+2;M[Fn][o]=1;const g=$.getCharCode("z"),w=$.getCharCode("a");for(let V=w;V<=g;V++)M[Fn][V]=V-w+2;M[Ot][o]=1;const v=$.getCharCode("9"),A=$.getCharCode("0");for(let V=A;V<=v;V++)M[Ot][V]=V-A+2;M[Ot][c]=12,M[Ot][l]=13;const N=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let V=0;V<N.length;V++)M[so][$.getCharCode(N[V])]=V;const L=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let V=0;V<L.length;V++)$.getCharCode(L[V])>0&&(M[Sn][$.getCharCode(L[V])]=V);return M}const n1=tP(C.createInt32Array(5,256));class Lh{constructor(o){this.text=o}encode(){const o=$.getCharCode(" "),l=$.getCharCode(`
`);let c=P.singletonList(Si.INITIAL_STATE);for(let f=0;f<this.text.length;f++){let g,w=f+1<this.text.length?this.text[f+1]:0;switch(this.text[f]){case $.getCharCode("\r"):g=w===l?2:0;break;case $.getCharCode("."):g=w===o?3:0;break;case $.getCharCode(","):g=w===o?4:0;break;case $.getCharCode(":"):g=w===o?5:0;break;default:g=0}g>0?(c=Lh.updateStateListForPair(c,f,g),f++):c=this.updateStateListForChar(c,f)}return P.min(c,(f,g)=>f.getBitCount()-g.getBitCount()).toBitArray(this.text)}updateStateListForChar(o,l){const c=[];for(let h of o)this.updateStateForChar(h,l,c);return Lh.simplifyStates(c)}updateStateForChar(o,l,c){let h=this.text[l]&255,f=n1[o.getMode()][h]>0,g=null;for(let w=0;w<=Sn;w++){let v=n1[w][h];if(v>0){if(g==null&&(g=o.endBinaryShift(l)),!f||w===o.getMode()||w===Ot){const A=g.latchAndAppend(w,v);c.push(A)}if(!f&&f2[o.getMode()][w]>=0){const A=g.shiftAndAppend(w,v);c.push(A)}}}if(o.getBinaryShiftByteCount()>0||n1[o.getMode()][h]===0){let w=o.addBinaryShiftChar(l);c.push(w)}}static updateStateListForPair(o,l,c){const h=[];for(let f of o)this.updateStateForPair(f,l,c,h);return this.simplifyStates(h)}static updateStateForPair(o,l,c,h){let f=o.endBinaryShift(l);if(h.push(f.latchAndAppend(Sn,c)),o.getMode()!==Sn&&h.push(f.shiftAndAppend(Sn,c)),c===3||c===4){let g=f.latchAndAppend(Ot,16-c).latchAndAppend(Ot,1);h.push(g)}if(o.getBinaryShiftByteCount()>0){let g=o.addBinaryShiftChar(l).addBinaryShiftChar(l+1);h.push(g)}}static simplifyStates(o){let l=[];for(const c of o){let h=!0;for(const f of l){if(f.isBetterThanOrEqualTo(c)){h=!1;break}c.isBetterThanOrEqualTo(f)&&(l=l.filter(g=>g!==f))}h&&l.push(c)}return l}}class St{constructor(){}static encodeBytes(o){return St.encode(o,St.DEFAULT_EC_PERCENT,St.DEFAULT_AZTEC_LAYERS)}static encode(o,l,c){let h=new Lh(o).encode(),f=R.truncDivision(h.getSize()*l,100)+11,g=h.getSize()+f,w,v,A,N,L;if(c!==St.DEFAULT_AZTEC_LAYERS){if(w=c<0,v=Math.abs(c),v>(w?St.MAX_NB_BITS_COMPACT:St.MAX_NB_BITS))throw new _($.format("Illegal value %s for layers",c));A=St.totalBitsInLayer(v,w),N=St.WORD_SIZE[v];let pe=A-A%N;if(L=St.stuffBits(h,N),L.getSize()+f>pe)throw new _("Data to large for user specified layer");if(w&&L.getSize()>N*64)throw new _("Data to large for user specified layer")}else{N=0,L=null;for(let pe=0;;pe++){if(pe>St.MAX_NB_BITS)throw new _("Data too large for an Aztec code");if(w=pe<=3,v=w?pe+1:pe,A=St.totalBitsInLayer(v,w),g>A)continue;(L==null||N!==St.WORD_SIZE[v])&&(N=St.WORD_SIZE[v],L=St.stuffBits(h,N));let gt=A-A%N;if(!(w&&L.getSize()>N*64)&&L.getSize()+f<=gt)break}}let V=St.generateCheckWords(L,A,N),q=L.getSize()/N,J=St.generateModeMessage(w,v,q),ee=(w?11:14)+v*4,se=new Int32Array(ee),ce;if(w){ce=ee;for(let pe=0;pe<se.length;pe++)se[pe]=pe}else{ce=ee+1+2*R.truncDivision(R.truncDivision(ee,2)-1,15);let pe=R.truncDivision(ee,2),gt=R.truncDivision(ce,2);for(let rt=0;rt<pe;rt++){let ls=rt+R.truncDivision(rt,15);se[pe-rt-1]=gt-ls-1,se[pe+rt]=gt+ls+1}}let ve=new Te(ce);for(let pe=0,gt=0;pe<v;pe++){let rt=(v-pe)*4+(w?9:12);for(let ls=0;ls<rt;ls++){let ii=ls*2;for(let cs=0;cs<2;cs++)V.get(gt+ii+cs)&&ve.set(se[pe*2+cs],se[pe*2+ls]),V.get(gt+rt*2+ii+cs)&&ve.set(se[pe*2+ls],se[ee-1-pe*2-cs]),V.get(gt+rt*4+ii+cs)&&ve.set(se[ee-1-pe*2-cs],se[ee-1-pe*2-ls]),V.get(gt+rt*6+ii+cs)&&ve.set(se[ee-1-pe*2-ls],se[pe*2+cs])}gt+=rt*8}if(St.drawModeMessage(ve,w,ce,J),w)St.drawBullsEye(ve,R.truncDivision(ce,2),5);else{St.drawBullsEye(ve,R.truncDivision(ce,2),7);for(let pe=0,gt=0;pe<R.truncDivision(ee,2)-1;pe+=15,gt+=16)for(let rt=R.truncDivision(ce,2)&1;rt<ce;rt+=2)ve.set(R.truncDivision(ce,2)-gt,rt),ve.set(R.truncDivision(ce,2)+gt,rt),ve.set(rt,R.truncDivision(ce,2)-gt),ve.set(rt,R.truncDivision(ce,2)+gt)}let Ee=new I;return Ee.setCompact(w),Ee.setSize(ce),Ee.setLayers(v),Ee.setCodeWords(q),Ee.setMatrix(ve),Ee}static drawBullsEye(o,l,c){for(let h=0;h<c;h+=2)for(let f=l-h;f<=l+h;f++)o.set(f,l-h),o.set(f,l+h),o.set(l-h,f),o.set(l+h,f);o.set(l-c,l-c),o.set(l-c+1,l-c),o.set(l-c,l-c+1),o.set(l+c,l-c),o.set(l+c,l-c+1),o.set(l+c,l+c-1)}static generateModeMessage(o,l,c){let h=new j;return o?(h.appendBits(l-1,2),h.appendBits(c-1,6),h=St.generateCheckWords(h,28,4)):(h.appendBits(l-1,5),h.appendBits(c-1,11),h=St.generateCheckWords(h,40,4)),h}static drawModeMessage(o,l,c,h){let f=R.truncDivision(c,2);if(l)for(let g=0;g<7;g++){let w=f-3+g;h.get(g)&&o.set(w,f-5),h.get(g+7)&&o.set(f+5,w),h.get(20-g)&&o.set(w,f+5),h.get(27-g)&&o.set(f-5,w)}else for(let g=0;g<10;g++){let w=f-5+g+R.truncDivision(g,5);h.get(g)&&o.set(w,f-7),h.get(g+10)&&o.set(f+7,w),h.get(29-g)&&o.set(w,f+7),h.get(39-g)&&o.set(f-7,w)}}static generateCheckWords(o,l,c){let h=o.getSize()/c,f=new kc(St.getGF(c)),g=R.truncDivision(l,c),w=St.bitsToWords(o,c,g);f.encode(w,g-h);let v=l%c,A=new j;A.appendBits(0,v);for(const N of Array.from(w))A.appendBits(N,c);return A}static bitsToWords(o,l,c){let h=new Int32Array(c),f,g;for(f=0,g=o.getSize()/l;f<g;f++){let w=0;for(let v=0;v<l;v++)w|=o.get(f*l+v)?1<<l-v-1:0;h[f]=w}return h}static getGF(o){switch(o){case 4:return dt.AZTEC_PARAM;case 6:return dt.AZTEC_DATA_6;case 8:return dt.AZTEC_DATA_8;case 10:return dt.AZTEC_DATA_10;case 12:return dt.AZTEC_DATA_12;default:throw new _("Unsupported word size "+o)}}static stuffBits(o,l){let c=new j,h=o.getSize(),f=(1<<l)-2;for(let g=0;g<h;g+=l){let w=0;for(let v=0;v<l;v++)(g+v>=h||o.get(g+v))&&(w|=1<<l-1-v);(w&f)===f?(c.appendBits(w&f,l),g--):w&f?c.appendBits(w,l):(c.appendBits(w|1,l),g--)}return c}static totalBitsInLayer(o,l){return((l?88:112)+16*o)*o}}St.DEFAULT_EC_PERCENT=33,St.DEFAULT_AZTEC_LAYERS=0,St.MAX_NB_BITS=32,St.MAX_NB_BITS_COMPACT=4,St.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class _0{encode(o,l,c,h){return this.encodeWithHints(o,l,c,h,null)}encodeWithHints(o,l,c,h,f){let g=x.ISO_8859_1,w=St.DEFAULT_EC_PERCENT,v=St.DEFAULT_AZTEC_LAYERS;return f!=null&&(f.has(xn.CHARACTER_SET)&&(g=ro.forName(f.get(xn.CHARACTER_SET).toString())),f.has(xn.ERROR_CORRECTION)&&(w=R.parseInt(f.get(xn.ERROR_CORRECTION).toString())),f.has(xn.AZTEC_LAYERS)&&(v=R.parseInt(f.get(xn.AZTEC_LAYERS).toString()))),_0.encodeLayers(o,l,c,h,g,w,v)}static encodeLayers(o,l,c,h,f,g,w){if(l!==Fe.AZTEC)throw new _("Can only encode AZTEC, but got "+l);let v=St.encode($.getBytes(o,f),g,w);return _0.renderResult(v,c,h)}static renderResult(o,l,c){let h=o.getMatrix();if(h==null)throw new _r;let f=h.getWidth(),g=h.getHeight(),w=Math.max(l,f),v=Math.max(c,g),A=Math.min(w/f,v/g),N=(w-f*A)/2,L=(v-g*A)/2,V=new Te(w,v);for(let q=0,J=L;q<g;q++,J+=A)for(let ee=0,se=N;ee<f;ee++,se+=A)h.get(ee,q)&&V.setRegion(se,J,A,A);return V}}n.AbstractExpandedDecoder=Ih,n.ArgumentException=y,n.ArithmeticException=Ys,n.AztecCode=I,n.AztecCodeReader=kr,n.AztecCodeWriter=_0,n.AztecDecoder=Dt,n.AztecDetector=wi,n.AztecDetectorResult=Ne,n.AztecEncoder=St,n.AztecHighLevelEncoder=Lh,n.AztecPoint=Ct,n.BarcodeFormat=Fe,n.Binarizer=k,n.BinaryBitmap=E,n.BitArray=j,n.BitMatrix=Te,n.BitSource=fl,n.BrowserAztecCodeReader=Ah,n.BrowserBarcodeReader=Sh,n.BrowserCodeReader=_t,n.BrowserDatamatrixCodeReader=h0,n.BrowserMultiFormatReader=yl,n.BrowserPDF417Reader=y0,n.BrowserQRCodeReader=x0,n.BrowserQRCodeSvgWriter=Ti,n.CharacterSetECI=F,n.ChecksumException=b,n.Code128Reader=Ae,n.Code39Reader=ln,n.DataMatrixDecodedBitStreamParser=Zs,n.DataMatrixReader=Js,n.DecodeHintType=Q,n.DecoderResult=Xs,n.DefaultGridSampler=Qe,n.DetectorResult=ue,n.EAN13Reader=_s,n.EncodeHintType=xn,n.Exception=m,n.FormatException=D,n.GenericGF=dt,n.GenericGFPoly=Mn,n.GlobalHistogramBinarizer=Xe,n.GridSampler=xe,n.GridSamplerInstance=He,n.HTMLCanvasElementLuminanceSource=Me,n.HybridBinarizer=de,n.ITFReader=vt,n.IllegalArgumentException=_,n.IllegalStateException=_r,n.InvertedLuminanceSource=Ce,n.LuminanceSource=he,n.MathUtils=lt,n.MultiFormatOneDReader=os,n.MultiFormatReader=Mh,n.MultiFormatWriter=Hr,n.NotFoundException=ie,n.OneDReader=kt,n.PDF417DecodedBitStreamParser=oe,n.PDF417DecoderErrorCorrection=gl,n.PDF417Reader=Tn,n.PDF417ResultMetadata=Ph,n.PerspectiveTransform=Pe,n.PlanarYUVLuminanceSource=Es,n.QRCodeByteMatrix=wl,n.QRCodeDataMask=Er,n.QRCodeDecodedBitStreamParser=en,n.QRCodeDecoderErrorCorrectionLevel=bt,n.QRCodeDecoderFormatInformation=Qt,n.QRCodeEncoder=Bt,n.QRCodeEncoderQRCode=Ci,n.QRCodeMaskUtil=qt,n.QRCodeMatrixUtil=qe,n.QRCodeMode=ze,n.QRCodeReader=$r,n.QRCodeVersion=Ve,n.QRCodeWriter=si,n.RGBLuminanceSource=Dc,n.RSS14Reader=jt,n.RSSExpandedReader=fe,n.ReaderException=Pc,n.ReedSolomonDecoder=xi,n.ReedSolomonEncoder=kc,n.ReedSolomonException=ws,n.Result=zt,n.ResultMetadataType=pn,n.ResultPoint=Z,n.StringUtils=$,n.UnsupportedOperationException=W,n.VideoInputDevice=ht,n.WhiteRectangleDetector=_e,n.WriterException=wt,n.ZXingArrays=C,n.ZXingCharset=ro,n.ZXingInteger=R,n.ZXingStandardCharsets=x,n.ZXingStringBuilder=z,n.ZXingStringEncoding=X,n.ZXingSystem=S,n.createAbstractExpandedDecoder=Ch,Object.defineProperty(n,"__esModule",{value:!0})})})(yw,yw.exports);var nn=yw.exports;const Mz=wI(nn),Lz=xI({__proto__:null,default:Mz},[nn]);var cI=function(){function t(e,n,r){if(this.formatMap=new Map([[Oe.QR_CODE,nn.BarcodeFormat.QR_CODE],[Oe.AZTEC,nn.BarcodeFormat.AZTEC],[Oe.CODABAR,nn.BarcodeFormat.CODABAR],[Oe.CODE_39,nn.BarcodeFormat.CODE_39],[Oe.CODE_93,nn.BarcodeFormat.CODE_93],[Oe.CODE_128,nn.BarcodeFormat.CODE_128],[Oe.DATA_MATRIX,nn.BarcodeFormat.DATA_MATRIX],[Oe.MAXICODE,nn.BarcodeFormat.MAXICODE],[Oe.ITF,nn.BarcodeFormat.ITF],[Oe.EAN_13,nn.BarcodeFormat.EAN_13],[Oe.EAN_8,nn.BarcodeFormat.EAN_8],[Oe.PDF_417,nn.BarcodeFormat.PDF_417],[Oe.RSS_14,nn.BarcodeFormat.RSS_14],[Oe.RSS_EXPANDED,nn.BarcodeFormat.RSS_EXPANDED],[Oe.UPC_A,nn.BarcodeFormat.UPC_A],[Oe.UPC_E,nn.BarcodeFormat.UPC_E],[Oe.UPC_EAN_EXTENSION,nn.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!Lz)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=n,this.logger=r;var s=this.createZXingFormats(e),i=new Map;i.set(nn.DecodeHintType.POSSIBLE_FORMATS,s),i.set(nn.DecodeHintType.TRY_HARDER,!1),this.hints=i}return t.prototype.decodeAsync=function(e){var n=this;return new Promise(function(r,s){try{r(n.decode(e))}catch(i){s(i)}})},t.prototype.decode=function(e){var n=new nn.MultiFormatReader(this.verbose,this.hints),r=new nn.HTMLCanvasElementLuminanceSource(e),s=new nn.BinaryBitmap(new nn.HybridBinarizer(r)),i=n.decode(s);return{text:i.text,format:Q4.create(this.toHtml5QrcodeSupportedFormats(i.format)),debugData:this.createDebugData()}},t.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(n,r,s){e.set(n,r)}),e},t.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},t.prototype.createZXingFormats=function(e){for(var n=[],r=0,s=e;r<s.length;r++){var i=s[r];this.formatMap.has(i)?n.push(this.formatMap.get(i)):this.logger.logError("".concat(i," is not supported by")+"ZXingHtml5QrcodeShim")}return n},t.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},t}(),jz=globalThis&&globalThis.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(a){a(i)})}return new(n||(n=Promise))(function(i,a){function u(y){try{m(r.next(y))}catch(_){a(_)}}function d(y){try{m(r.throw(y))}catch(_){a(_)}}function m(y){y.done?i(y.value):s(y.value).then(u,d)}m((r=r.apply(t,e||[])).next())})},Fz=globalThis&&globalThis.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(m){return function(y){return d([m,y])}}function d(m){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,m[0]&&(n=0)),n;)try{if(r=1,s&&(i=m[0]&2?s.return:m[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,m[1])).done)return i;switch(s=0,i&&(m=[m[0]&2,i.value]),m[0]){case 0:case 1:i=m;break;case 4:return n.label++,{value:m[1],done:!1};case 5:n.label++,s=m[1],m=[0];continue;case 7:m=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(m[0]===6||m[0]===2)){n=0;continue}if(m[0]===3&&(!i||m[1]>i[0]&&m[1]<i[3])){n.label=m[1];break}if(m[0]===6&&n.label<i[1]){n.label=i[1],i=m;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(m);break}i[2]&&n.ops.pop(),n.trys.pop();continue}m=e.call(t,n)}catch(y){m=[6,y],s=0}finally{r=i=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},uI=function(){function t(e,n,r){if(this.formatMap=new Map([[Oe.QR_CODE,"qr_code"],[Oe.AZTEC,"aztec"],[Oe.CODABAR,"codabar"],[Oe.CODE_39,"code_39"],[Oe.CODE_93,"code_93"],[Oe.CODE_128,"code_128"],[Oe.DATA_MATRIX,"data_matrix"],[Oe.ITF,"itf"],[Oe.EAN_13,"ean_13"],[Oe.EAN_8,"ean_8"],[Oe.PDF_417,"pdf417"],[Oe.UPC_A,"upc_a"],[Oe.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!t.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=n,this.logger=r;var s=this.createBarcodeDetectorFormats(e);if(this.detector=new BarcodeDetector(s),!this.detector)throw"BarcodeDetector detector not supported"}return t.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var e=new BarcodeDetector({formats:["qr_code"]});return typeof e<"u"},t.prototype.decodeAsync=function(e){return jz(this,void 0,void 0,function(){var n,r;return Fz(this,function(s){switch(s.label){case 0:return[4,this.detector.detect(e)];case 1:if(n=s.sent(),!n||n.length===0)throw"No barcode or QR code detected.";return r=this.selectLargestBarcode(n),[2,{text:r.rawValue,format:Q4.create(this.toHtml5QrcodeSupportedFormats(r.format)),debugData:this.createDebugData()}]}})})},t.prototype.selectLargestBarcode=function(e){for(var n=null,r=0,s=0,i=e;s<i.length;s++){var a=i[s],u=a.boundingBox.width*a.boundingBox.height;u>r&&(r=u,n=a)}if(!n)throw"No largest barcode found";return n},t.prototype.createBarcodeDetectorFormats=function(e){for(var n=[],r=0,s=e;r<s.length;r++){var i=s[r];this.formatMap.has(i)?n.push(this.formatMap.get(i)):this.logger.warn("".concat(i," is not supported by")+"BarcodeDetectorDelegate")}return{formats:n}},t.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},t.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(n,r,s){e.set(n,r)}),e},t.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},t}(),hI=globalThis&&globalThis.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(a){a(i)})}return new(n||(n=Promise))(function(i,a){function u(y){try{m(r.next(y))}catch(_){a(_)}}function d(y){try{m(r.throw(y))}catch(_){a(_)}}function m(y){y.done?i(y.value):s(y.value).then(u,d)}m((r=r.apply(t,e||[])).next())})},dI=globalThis&&globalThis.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(m){return function(y){return d([m,y])}}function d(m){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,m[0]&&(n=0)),n;)try{if(r=1,s&&(i=m[0]&2?s.return:m[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,m[1])).done)return i;switch(s=0,i&&(m=[m[0]&2,i.value]),m[0]){case 0:case 1:i=m;break;case 4:return n.label++,{value:m[1],done:!1};case 5:n.label++,s=m[1],m=[0];continue;case 7:m=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(m[0]===6||m[0]===2)){n=0;continue}if(m[0]===3&&(!i||m[1]>i[0]&&m[1]<i[3])){n.label=m[1];break}if(m[0]===6&&n.label<i[1]){n.label=i[1],i=m;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(m);break}i[2]&&n.ops.pop(),n.trys.pop();continue}m=e.call(t,n)}catch(y){m=[6,y],s=0}finally{r=i=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Bz=function(){function t(e,n,r,s){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=r,n&&uI.isSupported()?(this.primaryDecoder=new uI(e,r,s),this.secondaryDecoder=new cI(e,r,s)):this.primaryDecoder=new cI(e,r,s)}return t.prototype.decodeAsync=function(e){return hI(this,void 0,void 0,function(){var n;return dI(this,function(r){switch(r.label){case 0:n=performance.now(),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(e)];case 2:return[2,r.sent()];case 3:return this.possiblyLogPerformance(n),[7];case 4:return[2]}})})},t.prototype.decodeRobustlyAsync=function(e){return hI(this,void 0,void 0,function(){var n,r;return dI(this,function(s){switch(s.label){case 0:n=performance.now(),s.label=1;case 1:return s.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(e)];case 2:return[2,s.sent()];case 3:if(r=s.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(e)];throw r;case 4:return this.possiblyLogPerformance(n),[7];case 5:return[2]}})})},t.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},t.prototype.possiblyLogPerformance=function(e){if(this.verbose){var n=performance.now()-e;this.executionResults.push(n),this.executions++,this.possiblyFlushPerformanceReport()}},t.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var e=0,n=0,r=this.executionResults;n<r.length;n++){var s=r[n];e+=s}var i=e/this.executionResults.length;console.log("".concat(i," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},t}(),d2=globalThis&&globalThis.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Kg=globalThis&&globalThis.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(a){a(i)})}return new(n||(n=Promise))(function(i,a){function u(y){try{m(r.next(y))}catch(_){a(_)}}function d(y){try{m(r.throw(y))}catch(_){a(_)}}function m(y){y.done?i(y.value):s(y.value).then(u,d)}m((r=r.apply(t,e||[])).next())})},Qg=globalThis&&globalThis.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(m){return function(y){return d([m,y])}}function d(m){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,m[0]&&(n=0)),n;)try{if(r=1,s&&(i=m[0]&2?s.return:m[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,m[1])).done)return i;switch(s=0,i&&(m=[m[0]&2,i.value]),m[0]){case 0:case 1:i=m;break;case 4:return n.label++,{value:m[1],done:!1};case 5:n.label++,s=m[1],m=[0];continue;case 7:m=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(m[0]===6||m[0]===2)){n=0;continue}if(m[0]===3&&(!i||m[1]>i[0]&&m[1]<i[3])){n.label=m[1];break}if(m[0]===6&&n.label<i[1]){n.label=i[1],i=m;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(m);break}i[2]&&n.ops.pop(),n.trys.pop();continue}m=e.call(t,n)}catch(y){m=[6,y],s=0}finally{r=i=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Y4=function(){function t(e,n){this.name=e,this.track=n}return t.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},t.prototype.apply=function(e){var n={};n[this.name]=e;var r={advanced:[n]};return this.track.applyConstraints(r)},t.prototype.value=function(){var e=this.track.getSettings();if(this.name in e){var n=e[this.name];return n}return null},t}(),Vz=function(t){d2(e,t);function e(n,r){return t.call(this,n,r)||this}return e.prototype.min=function(){return this.getCapabilities().min},e.prototype.max=function(){return this.getCapabilities().max},e.prototype.step=function(){return this.getCapabilities().step},e.prototype.apply=function(n){var r={};r[this.name]=n;var s={advanced:[r]};return this.track.applyConstraints(s)},e.prototype.getCapabilities=function(){this.failIfNotSupported();var n=this.track.getCapabilities(),r=n[this.name];return{min:r.min,max:r.max,step:r.step}},e.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},e}(Y4),Uz=function(t){d2(e,t);function e(n){return t.call(this,"zoom",n)||this}return e}(Vz),zz=function(t){d2(e,t);function e(n){return t.call(this,"torch",n)||this}return e}(Y4),Gz=function(){function t(e){this.track=e}return t.prototype.zoomFeature=function(){return new Uz(this.track)},t.prototype.torchFeature=function(){return new zz(this.track)},t}(),qz=function(){function t(e,n,r){this.isClosed=!1,this.parentElement=e,this.mediaStream=n,this.callbacks=r,this.surface=this.createVideoElement(this.parentElement.clientWidth),e.append(this.surface)}return t.prototype.createVideoElement=function(e){var n=document.createElement("video");return n.style.width="".concat(e,"px"),n.style.display="block",n.muted=!0,n.setAttribute("muted","true"),n.playsInline=!0,n},t.prototype.setupSurface=function(){var e=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var n=function(){var r=e.surface.clientWidth,s=e.surface.clientHeight;e.callbacks.onRenderSurfaceReady(r,s),e.surface.removeEventListener("playing",n)};this.surface.addEventListener("playing",n),this.surface.srcObject=this.mediaStream,this.surface.play()},t.create=function(e,n,r,s){return Kg(this,void 0,void 0,function(){var i,a;return Qg(this,function(u){switch(u.label){case 0:return i=new t(e,n,s),r.aspectRatio?(a={aspectRatio:r.aspectRatio},[4,i.getFirstTrackOrFail().applyConstraints(a)]):[3,2];case 1:u.sent(),u.label=2;case 2:return i.setupSurface(),[2,i]}})})},t.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},t.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},t.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},t.prototype.resume=function(e){this.failIfClosed();var n=this,r=function(){setTimeout(e,200),n.surface.removeEventListener("playing",r)};this.surface.addEventListener("playing",r),this.surface.play()},t.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},t.prototype.getSurface=function(){return this.failIfClosed(),this.surface},t.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},t.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},t.prototype.applyVideoConstraints=function(e){return Kg(this,void 0,void 0,function(){return Qg(this,function(n){if("aspectRatio"in e)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(e)]})})},t.prototype.close=function(){if(this.isClosed)return Promise.resolve();var e=this;return new Promise(function(n,r){var s=e.mediaStream.getVideoTracks(),i=s.length,a=0;e.mediaStream.getVideoTracks().forEach(function(u){e.mediaStream.removeTrack(u),u.stop(),++a,a>=i&&(e.isClosed=!0,e.parentElement.removeChild(e.surface),n())})})},t.prototype.getCapabilities=function(){return new Gz(this.getFirstTrackOrFail())},t}(),Wz=function(){function t(e){this.mediaStream=e}return t.prototype.render=function(e,n,r){return Kg(this,void 0,void 0,function(){return Qg(this,function(s){return[2,qz.create(e,this.mediaStream,n,r)]})})},t.create=function(e){return Kg(this,void 0,void 0,function(){var n,r;return Qg(this,function(s){switch(s.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return n={audio:!1,video:e},[4,navigator.mediaDevices.getUserMedia(n)];case 1:return r=s.sent(),[2,new t(r)]}})})},t}(),fI=globalThis&&globalThis.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(a){a(i)})}return new(n||(n=Promise))(function(i,a){function u(y){try{m(r.next(y))}catch(_){a(_)}}function d(y){try{m(r.throw(y))}catch(_){a(_)}}function m(y){y.done?i(y.value):s(y.value).then(u,d)}m((r=r.apply(t,e||[])).next())})},mI=globalThis&&globalThis.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(m){return function(y){return d([m,y])}}function d(m){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,m[0]&&(n=0)),n;)try{if(r=1,s&&(i=m[0]&2?s.return:m[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,m[1])).done)return i;switch(s=0,i&&(m=[m[0]&2,i.value]),m[0]){case 0:case 1:i=m;break;case 4:return n.label++,{value:m[1],done:!1};case 5:n.label++,s=m[1],m=[0];continue;case 7:m=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(m[0]===6||m[0]===2)){n=0;continue}if(m[0]===3&&(!i||m[1]>i[0]&&m[1]<i[3])){n.label=m[1];break}if(m[0]===6&&n.label<i[1]){n.label=i[1],i=m;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(m);break}i[2]&&n.ops.pop(),n.trys.pop();continue}m=e.call(t,n)}catch(y){m=[6,y],s=0}finally{r=i=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},$z=function(){function t(){}return t.failIfNotSupported=function(){return fI(this,void 0,void 0,function(){return mI(this,function(e){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new t]})})},t.prototype.create=function(e){return fI(this,void 0,void 0,function(){return mI(this,function(n){return[2,Wz.create(e)]})})},t}(),Hz=globalThis&&globalThis.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(a){a(i)})}return new(n||(n=Promise))(function(i,a){function u(y){try{m(r.next(y))}catch(_){a(_)}}function d(y){try{m(r.throw(y))}catch(_){a(_)}}function m(y){y.done?i(y.value):s(y.value).then(u,d)}m((r=r.apply(t,e||[])).next())})},Kz=globalThis&&globalThis.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(m){return function(y){return d([m,y])}}function d(m){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,m[0]&&(n=0)),n;)try{if(r=1,s&&(i=m[0]&2?s.return:m[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,m[1])).done)return i;switch(s=0,i&&(m=[m[0]&2,i.value]),m[0]){case 0:case 1:i=m;break;case 4:return n.label++,{value:m[1],done:!1};case 5:n.label++,s=m[1],m=[0];continue;case 7:m=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(m[0]===6||m[0]===2)){n=0;continue}if(m[0]===3&&(!i||m[1]>i[0]&&m[1]<i[3])){n.label=m[1];break}if(m[0]===6&&n.label<i[1]){n.label=i[1],i=m;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(m);break}i[2]&&n.ops.pop(),n.trys.pop();continue}m=e.call(t,n)}catch(y){m=[6,y],s=0}finally{r=i=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Qz=function(){function t(){}return t.retrieve=function(){if(navigator.mediaDevices)return t.getCamerasFromMediaDevices();var e=MediaStreamTrack;return MediaStreamTrack&&e.getSources?t.getCamerasFromMediaStreamTrack():t.rejectWithError()},t.rejectWithError=function(){var e=uu.unableToQuerySupportedDevices();return t.isHttpsOrLocalhost()||(e=uu.insecureContextCameraQueryError()),Promise.reject(e)},t.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var e=location.host.split(":")[0];return e==="127.0.0.1"||e==="localhost"},t.getCamerasFromMediaDevices=function(){return Hz(this,void 0,void 0,function(){var e,n,r,s,i,a,u;return Kz(this,function(d){switch(d.label){case 0:return e=function(m){for(var y=m.getVideoTracks(),_=0,E=y;_<E.length;_++){var b=E[_];b.enabled=!1,b.stop(),m.removeTrack(b)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return n=d.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(r=d.sent(),s=[],i=0,a=r;i<a.length;i++)u=a[i],u.kind==="videoinput"&&s.push({id:u.deviceId,label:u.label});return e(n),[2,s]}})})},t.getCamerasFromMediaStreamTrack=function(){return new Promise(function(e,n){var r=function(i){for(var a=[],u=0,d=i;u<d.length;u++){var m=d[u];m.kind==="video"&&a.push({id:m.id,label:m.label})}e(a)},s=MediaStreamTrack;s.getSources(r)})},t}(),Nn;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.NOT_STARTED=1]="NOT_STARTED",t[t.SCANNING=2]="SCANNING",t[t.PAUSED=3]="PAUSED"})(Nn||(Nn={}));var Xz=function(){function t(){this.state=Nn.NOT_STARTED,this.onGoingTransactionNewState=Nn.UNKNOWN}return t.prototype.directTransition=function(e){this.failIfTransitionOngoing(),this.validateTransition(e),this.state=e},t.prototype.startTransition=function(e){return this.failIfTransitionOngoing(),this.validateTransition(e),this.onGoingTransactionNewState=e,this},t.prototype.execute=function(){if(this.onGoingTransactionNewState===Nn.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var e=this.onGoingTransactionNewState;this.onGoingTransactionNewState=Nn.UNKNOWN,this.directTransition(e)},t.prototype.cancel=function(){if(this.onGoingTransactionNewState===Nn.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=Nn.UNKNOWN},t.prototype.getState=function(){return this.state},t.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==Nn.UNKNOWN)throw"Cannot transition to a new state, already under transition"},t.prototype.validateTransition=function(e){switch(this.state){case Nn.UNKNOWN:throw"Transition from unknown is not allowed";case Nn.NOT_STARTED:this.failIfNewStateIs(e,[Nn.PAUSED]);break;case Nn.SCANNING:break;case Nn.PAUSED:break}},t.prototype.failIfNewStateIs=function(e,n){for(var r=0,s=n;r<s.length;r++){var i=s[r];if(e===i)throw"Cannot transition from ".concat(this.state," to ").concat(e)}},t}(),Yz=function(){function t(e){this.stateManager=e}return t.prototype.startTransition=function(e){return this.stateManager.startTransition(e)},t.prototype.directTransition=function(e){this.stateManager.directTransition(e)},t.prototype.getState=function(){return this.stateManager.getState()},t.prototype.canScanFile=function(){return this.stateManager.getState()===Nn.NOT_STARTED},t.prototype.isScanning=function(){return this.stateManager.getState()!==Nn.NOT_STARTED},t.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===Nn.SCANNING},t.prototype.isPaused=function(){return this.stateManager.getState()===Nn.PAUSED},t}(),Zz=function(){function t(){}return t.create=function(){return new Yz(new Xz)},t}(),Jz=globalThis&&globalThis.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Is=function(t){Jz(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.DEFAULT_WIDTH=300,e.DEFAULT_WIDTH_OFFSET=2,e.FILE_SCAN_MIN_HEIGHT=300,e.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,e.MIN_QR_BOX_SIZE=50,e.SHADED_LEFT=1,e.SHADED_RIGHT=2,e.SHADED_TOP=3,e.SHADED_BOTTOM=4,e.SHADED_REGION_ELEMENT_ID="qr-shaded-region",e.VERBOSE=!1,e.BORDER_SHADER_DEFAULT_COLOR="#ffffff",e.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",e}(kz),eG=function(){function t(e,n){this.logger=n,this.fps=Is.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=e.disableFlip===!0,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=Is.DEFAULT_DISABLE_FLIP}return t.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?X4.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},t.prototype.isShadedBoxEnabled=function(){return!lo(this.qrbox)},t.create=function(e,n){return new t(e,n)},t}(),tG=function(){function t(e,n){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw"HTML Element with id=".concat(e," not found");this.elementId=e,this.verbose=!1;var r;typeof n=="boolean"?this.verbose=n===!0:n&&(r=n,this.verbose=r.verbose===!0,r.experimentalFeatures),this.logger=new Oz(this.verbose),this.qrcode=new Bz(this.getSupportedFormats(n),this.getUseBarCodeDetectorIfSupported(r),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=Zz.create()}return t.prototype.start=function(e,n,r,s){var i=this;if(!e)throw"cameraIdOrConfig is required";if(!r||typeof r!="function")throw"qrCodeSuccessCallback is required and should be a function.";var a;s?a=s:a=this.verbose?this.logger.log:function(){};var u=eG.create(n,this.logger);this.clearElement();var d=!1;u.videoConstraints&&(u.isMediaStreamConstraintsValid()?d=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var m=d,y=document.getElementById(this.elementId);y.clientWidth?y.clientWidth:Is.DEFAULT_WIDTH,y.style.position="relative",this.shouldScan=!0,this.element=y;var _=this,E=this.stateManagerProxy.startTransition(Nn.SCANNING);return new Promise(function(b,k){var S=m?u.videoConstraints:_.createVideoConstraints(e);if(!S){E.cancel(),k("videoConstraints should be defined");return}var O={};(!m||u.aspectRatio)&&(O.aspectRatio=u.aspectRatio);var T={onRenderSurfaceReady:function(C,R){_.setupUi(C,R,u),_.isScanning=!0,_.foreverScan(u,r,a)}};$z.failIfNotSupported().then(function(C){C.create(S).then(function(R){return R.render(i.element,O,T).then(function(j){_.renderedCamera=j,E.execute(),b(null)}).catch(function(j){E.cancel(),k(j)})}).catch(function(R){E.cancel(),k(uu.errorGettingUserMedia(R))})}).catch(function(C){E.cancel(),k(uu.cameraStreamingNotSupported())})})},t.prototype.pause=function(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(Nn.PAUSED),this.showPausedState(),(lo(e)||e!==!0)&&(e=!1),e&&this.renderedCamera&&this.renderedCamera.pause()},t.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var e=this,n=function(){e.stateManagerProxy.directTransition(Nn.SCANNING),e.hidePausedState()};if(!this.renderedCamera.isPaused()){n();return}this.renderedCamera.resume(function(){n()})},t.prototype.getState=function(){return this.stateManagerProxy.getState()},t.prototype.stop=function(){var e=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var n=this.stateManagerProxy.startTransition(Nn.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var r=function(){if(e.element){var i=document.getElementById(Is.SHADED_REGION_ELEMENT_ID);i&&e.element.removeChild(i)}},s=this;return this.renderedCamera.close().then(function(){return s.renderedCamera=null,s.element&&(s.element.removeChild(s.canvasElement),s.canvasElement=null),r(),s.qrRegion&&(s.qrRegion=null),s.context&&(s.context=null),n.execute(),s.hidePausedState(),s.isScanning=!1,Promise.resolve()})},t.prototype.scanFile=function(e,n){return this.scanFileV2(e,n).then(function(r){return r.decodedText})},t.prototype.scanFileV2=function(e,n){var r=this;if(!e||!(e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(lo(n)&&(n=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(s,i){r.possiblyCloseLastScanImageFile(),r.clearElement(),r.lastScanImageFile=URL.createObjectURL(e);var a=new Image;a.onload=function(){var u=a.width,d=a.height,m=document.getElementById(r.elementId),y=m.clientWidth?m.clientWidth:Is.DEFAULT_WIDTH,_=Math.max(m.clientHeight?m.clientHeight:d,Is.FILE_SCAN_MIN_HEIGHT),E=r.computeCanvasDrawConfig(u,d,y,_);if(n){var b=r.createCanvasElement(y,_,"qr-canvas-visible");b.style.display="inline-block",m.appendChild(b);var k=b.getContext("2d");if(!k)throw"Unable to get 2d context from canvas";k.canvas.width=y,k.canvas.height=_,k.drawImage(a,0,0,u,d,E.x,E.y,E.width,E.height)}var S=Is.FILE_SCAN_HIDDEN_CANVAS_PADDING,O=Math.max(a.width,E.width),T=Math.max(a.height,E.height),C=O+2*S,R=T+2*S,j=r.createCanvasElement(C,R);m.appendChild(j);var K=j.getContext("2d");if(!K)throw"Unable to get 2d context from canvas";K.canvas.width=C,K.canvas.height=R,K.drawImage(a,0,0,u,d,S,S,O,T);try{r.qrcode.decodeRobustlyAsync(j).then(function(Q){s(lI.createFromQrcodeResult(Q))}).catch(i)}catch(Q){i("QR code parse error, error = ".concat(Q))}},a.onerror=i,a.onabort=i,a.onstalled=i,a.onsuspend=i,a.src=URL.createObjectURL(e)})},t.prototype.clear=function(){this.clearElement()},t.getCameras=function(){return Qz.retrieve()},t.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},t.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},t.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},t.prototype.applyVideoConstraints=function(e){if(e){if(!X4.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(e)},t.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},t.prototype.getSupportedFormats=function(e){var n=[Oe.QR_CODE,Oe.AZTEC,Oe.CODABAR,Oe.CODE_39,Oe.CODE_93,Oe.CODE_128,Oe.DATA_MATRIX,Oe.MAXICODE,Oe.ITF,Oe.EAN_13,Oe.EAN_8,Oe.PDF_417,Oe.RSS_14,Oe.RSS_EXPANDED,Oe.UPC_A,Oe.UPC_E,Oe.UPC_EAN_EXTENSION];if(!e||typeof e=="boolean"||!e.formatsToSupport)return n;if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(e.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var r=[],s=0,i=e.formatsToSupport;s<i.length;s++){var a=i[s];Pz(a)?r.push(a):this.logger.warn("Invalid format: ".concat(a," passed in config, ignoring."))}if(r.length===0)throw"None of formatsToSupport match supported values.";return r},t.prototype.getUseBarCodeDetectorIfSupported=function(e){if(lo(e))return!0;if(!lo(e.useBarCodeDetectorIfSupported))return e.useBarCodeDetectorIfSupported!==!1;if(lo(e.experimentalFeatures))return!0;var n=e.experimentalFeatures;return lo(n.useBarCodeDetectorIfSupported)?!0:n.useBarCodeDetectorIfSupported!==!1},t.prototype.validateQrboxSize=function(e,n,r){var s=this,i=r.qrbox;this.validateQrboxConfig(i);var a=this.toQrdimensions(e,n,i),u=function(m){if(m<Is.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(Is.MIN_QR_BOX_SIZE,"px.")},d=function(m){return m>e&&(s.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),m=e),m};u(a.width),u(a.height),a.width=d(a.width)},t.prototype.validateQrboxConfig=function(e){if(typeof e!="number"&&typeof e!="function"&&(e.width===void 0||e.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},t.prototype.toQrdimensions=function(e,n,r){if(typeof r=="number")return{width:r,height:r};if(typeof r=="function")try{return r(e,n)}catch(s){throw new Error("qrbox config was passed as a function but it failed with unknown error"+s)}return r},t.prototype.setupUi=function(e,n,r){r.isShadedBoxEnabled()&&this.validateQrboxSize(e,n,r);var s=lo(r.qrbox)?{width:e,height:n}:r.qrbox;this.validateQrboxConfig(s);var i=this.toQrdimensions(e,n,s);i.height>n&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var a=r.isShadedBoxEnabled()&&i.height<=n,u={x:0,y:0,width:e,height:n},d=a?this.getShadedRegionBounds(e,n,i):u,m=this.createCanvasElement(d.width,d.height),y={willReadFrequently:!0},_=m.getContext("2d",y);_.canvas.width=d.width,_.canvas.height=d.height,this.element.append(m),a&&this.possiblyInsertShadingElement(this.element,e,n,i),this.createScannerPausedUiElement(this.element),this.qrRegion=d,this.context=_,this.canvasElement=m},t.prototype.createScannerPausedUiElement=function(e){var n=document.createElement("div");n.innerText=uu.scannerPaused(),n.style.display="none",n.style.position="absolute",n.style.top="0px",n.style.zIndex="1",n.style.background="rgba(9, 9, 9, 0.46)",n.style.color="#FFECEC",n.style.textAlign="center",n.style.width="100%",e.appendChild(n),this.scannerPausedUiElement=n},t.prototype.scanContext=function(e,n){var r=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(s){return e(s.text,lI.createFromQrcodeResult(s)),r.possiblyUpdateShaders(!0),!0}).catch(function(s){r.possiblyUpdateShaders(!1);var i=uu.codeParseError(s);return n(i,Dz.createFrom(i)),!1})},t.prototype.foreverScan=function(e,n,r){var s=this;if(this.shouldScan&&this.renderedCamera){var i=this.renderedCamera.getSurface(),a=i.videoWidth/i.clientWidth,u=i.videoHeight/i.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var d=this.qrRegion.width*a,m=this.qrRegion.height*u,y=this.qrRegion.x*a,_=this.qrRegion.y*u;this.context.drawImage(i,y,_,d,m,0,0,this.qrRegion.width,this.qrRegion.height);var E=function(){s.foreverScanTimeout=setTimeout(function(){s.foreverScan(e,n,r)},s.getTimeoutFps(e.fps))};this.scanContext(n,r).then(function(b){!b&&e.disableFlip!==!0?(s.context.translate(s.context.canvas.width,0),s.context.scale(-1,1),s.scanContext(n,r).finally(function(){E()})):E()}).catch(function(b){s.logger.logError("Error happend while scanning context",b),E()})}},t.prototype.createVideoConstraints=function(e){if(typeof e=="string")return{deviceId:{exact:e}};if(typeof e=="object"){var n="facingMode",r="deviceId",s={user:!0,environment:!0},i="exact",a=function(k){if(k in s)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(k,"'")},u=Object.keys(e);if(u.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(u.length," keys");var d=Object.keys(e)[0];if(d!==n&&d!==r)throw"Only '".concat(n,"' and '").concat(r,"' ")+" are supported for 'cameraIdOrConfig'";if(d===n){var m=e.facingMode;if(typeof m=="string"){if(a(m))return{facingMode:m}}else if(typeof m=="object")if(i in m){if(a(m["".concat(i)]))return{facingMode:{exact:m["".concat(i)]}}}else throw"'facingMode' should be string or object with"+" ".concat(i," as key.");else{var y=typeof m;throw"Invalid type of 'facingMode' = ".concat(y)}}else{var _=e.deviceId;if(typeof _=="string")return{deviceId:_};if(typeof _=="object"){if(i in _)return{deviceId:{exact:_["".concat(i)]}};throw"'deviceId' should be string or object with"+" ".concat(i," as key.")}else{var E=typeof _;throw"Invalid type of 'deviceId' = ".concat(E)}}}var b=typeof e;throw"Invalid type of 'cameraIdOrConfig' = ".concat(b)},t.prototype.computeCanvasDrawConfig=function(e,n,r,s){if(e<=r&&n<=s){var i=(r-e)/2,a=(s-n)/2;return{x:i,y:a,width:e,height:n}}else{var u=e,d=n;return e>r&&(n=r/e*n,e=r),n>s&&(e=s/n*e,n=s),this.logger.log("Image downsampled from "+"".concat(u,"X").concat(d)+" to ".concat(e,"X").concat(n,".")),this.computeCanvasDrawConfig(e,n,r,s)}},t.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var e=document.getElementById(this.elementId);e&&(e.innerHTML="")},t.prototype.possiblyUpdateShaders=function(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(n){n.style.backgroundColor=e?Is.BORDER_SHADER_MATCH_COLOR:Is.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=e)},t.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},t.prototype.createCanvasElement=function(e,n,r){var s=e,i=n,a=document.createElement("canvas");return a.style.width="".concat(s,"px"),a.style.height="".concat(i,"px"),a.style.display="none",a.id=lo(r)?"qr-canvas":r,a},t.prototype.getShadedRegionBounds=function(e,n,r){if(r.width>e||r.height>n)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-r.width)/2,y:(n-r.height)/2,width:r.width,height:r.height}},t.prototype.possiblyInsertShadingElement=function(e,n,r,s){if(!(n-s.width<1||r-s.height<1)){var i=document.createElement("div");i.style.position="absolute";var a=(n-s.width)/2,u=(r-s.height)/2;if(i.style.borderLeft="".concat(a,"px solid rgba(0, 0, 0, 0.48)"),i.style.borderRight="".concat(a,"px solid rgba(0, 0, 0, 0.48)"),i.style.borderTop="".concat(u,"px solid rgba(0, 0, 0, 0.48)"),i.style.borderBottom="".concat(u,"px solid rgba(0, 0, 0, 0.48)"),i.style.boxSizing="border-box",i.style.top="0px",i.style.bottom="0px",i.style.left="0px",i.style.right="0px",i.id="".concat(Is.SHADED_REGION_ELEMENT_ID),n-s.width<11||r-s.height<11)this.hasBorderShaders=!1;else{var d=5,m=40;this.insertShaderBorders(i,m,d,-d,null,0,!0),this.insertShaderBorders(i,m,d,-d,null,0,!1),this.insertShaderBorders(i,m,d,null,-d,0,!0),this.insertShaderBorders(i,m,d,null,-d,0,!1),this.insertShaderBorders(i,d,m+d,-d,null,-d,!0),this.insertShaderBorders(i,d,m+d,null,-d,-d,!0),this.insertShaderBorders(i,d,m+d,-d,null,-d,!1),this.insertShaderBorders(i,d,m+d,null,-d,-d,!1),this.hasBorderShaders=!0}e.append(i)}},t.prototype.insertShaderBorders=function(e,n,r,s,i,a,u){var d=document.createElement("div");d.style.position="absolute",d.style.backgroundColor=Is.BORDER_SHADER_DEFAULT_COLOR,d.style.width="".concat(n,"px"),d.style.height="".concat(r,"px"),s!==null&&(d.style.top="".concat(s,"px")),i!==null&&(d.style.bottom="".concat(i,"px")),u?d.style.left="".concat(a,"px"):d.style.right="".concat(a,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(d),e.appendChild(d)},t.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},t.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},t.prototype.getTimeoutFps=function(e){return 1e3/e},t}();globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;var gI;(function(t){t[t.STATUS_DEFAULT=0]="STATUS_DEFAULT",t[t.STATUS_SUCCESS=1]="STATUS_SUCCESS",t[t.STATUS_WARNING=2]="STATUS_WARNING",t[t.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(gI||(gI={}));const nG=()=>{const t=gn(),e=H.useRef(null),n=H.useRef(!1),[r,s]=H.useState(!1),[i,a]=H.useState(null),[u,d]=H.useState(""),[m,y]=H.useState(null);H.useEffect(()=>()=>{e.current&&r&&e.current.stop().catch(console.error)},[r]);const _=async()=>{try{if(e.current)try{await e.current.stop(),e.current.clear()}catch{console.log("No scanner to stop")}n.current=!1,s(!0),await new Promise(O=>setTimeout(O,100));const S=new tG("qr-reader");e.current=S,await S.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},O=>{b(O)},O=>{}),a(!0),ye.success("Scanner ready! Point camera at QR code")}catch(S){console.error("Error starting scanner:",S),s(!1),a(!1),S.name==="NotAllowedError"?ye.error("Camera permission denied. Please enable camera access."):S.name==="NotFoundError"?ye.error("No camera found on this device."):ye.error("Failed to start scanner. Try manual entry.")}},E=async()=>{if(e.current&&r)try{await e.current.stop(),s(!1),ye.success("Scanner stopped")}catch(S){console.error("Error stopping scanner:",S)}},b=S=>{if(n.current){console.log("Already processing, ignoring duplicate scan");return}n.current=!0,console.log("Processing QR code:",S),e.current&&e.current.pause(!0),y(S);const O=S.match(/\/artifacts\/([a-zA-Z0-9-_]+)/);if(O&&O[1]){const T=O[1];E(),ye.success("QR Code scanned successfully!",{duration:2e3,icon:""}),setTimeout(()=>{t(`/artifacts/${T}`)},500)}else E(),ye.error("Invalid QR code. Expected artifact URL."),setTimeout(()=>{n.current=!1,_()},2e3)},k=S=>{if(S.preventDefault(),!u.trim()){ye.error("Please enter an artifact ID");return}ye.success("Opening artifact..."),t(`/artifacts/${u.trim()}`)};return p.jsx("div",{className:"min-h-screen",children:p.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("div",{className:"mb-8",children:[p.jsx("h1",{className:"text-3xl font-bold text-archaeological-charcoal",children:"QR Code Scanner"}),p.jsx("p",{className:"mt-2 text-archaeological-charcoal",children:"Scan QR codes to quickly access artifact information"})]}),p.jsx("div",{className:"card mb-6",children:p.jsxs("div",{className:"card-content",children:[i===!1&&p.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4 flex items-start gap-3",children:[p.jsx(a2,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-red-800 font-medium",children:"Camera Access Required"}),p.jsx("p",{className:"text-red-700 text-sm mt-1",children:"Please enable camera permissions in your browser settings to use the scanner."})]})]}),!r&&p.jsxs("div",{className:"text-center py-12",children:[p.jsx(If,{className:"w-16 h-16 text-archaeological-sage mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-semibold text-archaeological-charcoal mb-2",children:"Ready to Scan"}),p.jsx("p",{className:"text-archaeological-charcoal mb-6",children:"Click the button below to activate your camera"}),p.jsxs("button",{onClick:_,className:"btn btn-primary btn-lg flex items-center gap-2 mx-auto",children:[p.jsx(If,{className:"w-5 h-5"}),"Start Scanner"]})]}),r&&p.jsx("div",{className:"relative bg-black rounded-lg overflow-hidden",style:{minHeight:"400px"},children:p.jsx("div",{id:"qr-reader",style:{width:"100%"}})}),r&&p.jsxs("div",{className:"mt-4 text-center",children:[p.jsxs("button",{onClick:E,className:"btn btn-danger btn-sm flex items-center gap-2 mx-auto",children:[p.jsx(fc,{className:"w-4 h-4"}),"Stop Scanner"]}),p.jsx("p",{className:"text-sm text-archaeological-olive mt-2",children:"Point your camera at a QR code"})]}),m&&p.jsxs("div",{className:"mt-4 bg-green-50 border border-green-200 rounded-lg p-3 flex items-start gap-2",children:[p.jsx(Cf,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("p",{className:"text-green-800 font-medium text-sm",children:"Last Scanned:"}),p.jsx("p",{className:"text-green-700 text-xs truncate",children:m})]})]})]})}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsxs("h3",{className:"text-lg font-semibold text-archaeological-charcoal mb-4 flex items-center gap-2",children:[p.jsx(dc,{className:"w-5 h-5"}),"Manual Entry"]}),p.jsx("p",{className:"text-archaeological-charcoal text-sm mb-4",children:"Already know the artifact ID? Enter it directly below."}),p.jsxs("form",{onSubmit:k,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"artifactId",className:"block text-sm font-medium text-archaeological-charcoal mb-1",children:"Artifact ID"}),p.jsx("input",{type:"text",id:"artifactId",value:u,onChange:S=>d(S.target.value),className:"input",placeholder:"e.g., xHDc4cQXBh13pTnzJSCN"})]}),p.jsxs("button",{type:"submit",className:"btn btn-outline w-full flex items-center justify-center gap-2",children:[p.jsx(dc,{className:"w-4 h-4"}),"Go to Artifact"]})]})]})}),p.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[p.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:" Scanning Tips:"}),p.jsxs("ul",{className:"text-blue-800 text-sm space-y-1 list-disc list-inside",children:[p.jsx("li",{children:"Hold your phone steady"}),p.jsx("li",{children:"Ensure good lighting"}),p.jsx("li",{children:"Center the QR code in the frame"}),p.jsx("li",{children:"Keep camera 4-6 inches from QR code"}),p.jsx("li",{children:"Use manual entry if scanning doesn't work"})]})]})]})})},rG=()=>{var n,r,s,i;const{user:t}=bn(),e=gn();return t?(console.log("UserProfilePage: user.role =",t.role),console.log("UserProfilePage: showing admin button?",t.role==="admin"),p.jsx("div",{className:"min-h-screen bg-gray-50",children:p.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("button",{onClick:()=>e("/dashboard"),className:"btn btn-ghost mb-6 flex items-center gap-2",children:[p.jsx(Qs,{className:"w-4 h-4"}),"Back to Dashboard"]}),p.jsxs("div",{className:"mb-8",children:[p.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Profile"}),p.jsx("p",{className:"mt-2 text-gray-600",children:"View and manage your account information"})]}),p.jsxs("div",{className:"grid gap-6",children:[p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsxs("div",{className:"flex items-center gap-6 mb-6",children:[p.jsx("div",{className:"w-20 h-20 rounded-full bg-primary-600 text-white flex items-center justify-center text-3xl font-bold",children:((r=(n=t.displayName)==null?void 0:n[0])==null?void 0:r.toUpperCase())||((i=(s=t.email)==null?void 0:s[0])==null?void 0:i.toUpperCase())||"U"}),p.jsxs("div",{children:[p.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t.displayName||t.username||"User"}),t.role&&p.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-primary-100 text-primary-800 mt-2",children:t.role})]})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[p.jsx(c2,{className:"w-5 h-5 text-gray-400"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Email"}),p.jsx("p",{className:"text-gray-900",children:t.email})]})]}),t.username&&p.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[p.jsx(th,{className:"w-5 h-5 text-gray-400"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Username"}),p.jsx("p",{className:"text-gray-900",children:t.username})]})]}),t.role&&p.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[p.jsx(Ma,{className:"w-5 h-5 text-gray-400"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Role"}),p.jsx("p",{className:"text-gray-900 capitalize",children:t.role})]})]}),t.createdAt&&p.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[p.jsx(z4,{className:"w-5 h-5 text-gray-400"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Member Since"}),p.jsx("p",{className:"text-gray-900",children:new Date(t.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]})]})]})}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Account Actions"}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("button",{onClick:()=>e("/profile/edit"),className:"btn btn-outline w-full justify-start",children:"Edit Profile Information"}),p.jsx("button",{onClick:()=>e("/profile/change-password"),className:"btn btn-outline w-full justify-start",children:"Change Password"}),t.role!=="admin"&&p.jsxs("button",{onClick:()=>e("/profile/request-role"),className:"btn btn-primary w-full justify-start",children:[p.jsx(Ma,{className:"w-4 h-4 mr-2"}),"Request Role Upgrade"]}),t.role==="admin"&&p.jsxs("button",{onClick:()=>e("/admin"),className:"btn btn-primary w-full justify-start",children:[p.jsx(Ma,{className:"w-4 h-4 mr-2"}),"Admin Panel"]}),p.jsx("button",{onClick:()=>e("/profile/delete"),className:"btn btn-danger w-full justify-start",children:"Delete Account"})]})]})})]})]})})):null},sG=()=>{const{user:t}=bn(),e=gn(),[n,r]=H.useState(!1),[s,i]=H.useState(!1),{register:a,handleSubmit:u,formState:{errors:d}}=a0({defaultValues:{displayName:(t==null?void 0:t.displayName)||"",username:(t==null?void 0:t.username)||"",email:(t==null?void 0:t.email)||"",role:(t==null?void 0:t.role)||""}}),m=async y=>{if(!t||!ot.currentUser){ye.error("User not authenticated");return}r(!0);try{if(await OS(ot.currentUser,{displayName:y.displayName}),y.email!==t.email)try{await X5(ot.currentUser,y.email)}catch(b){if(b.code==="auth/requires-recent-login"){ye.error("Please log out and log back in before changing your email",{duration:5e3}),r(!1);return}throw b}const _=Vt($e,"users",t.id),E={displayName:y.displayName,username:y.username,email:y.email};y.role!==t.role&&t.role==="archaeologist"&&y.role==="researcher"&&(E.role=y.role,ye.success("Role changed to Researcher. You now have read-only access.",{duration:5e3,icon:""})),await Wr(_,E),ye.success("Profile updated successfully!",{duration:3e3,icon:""}),window.location.href="/profile"}catch(_){console.error("Error updating profile:",_),ye.error(_.message||"Failed to update profile")}finally{r(!1)}};return t?p.jsx("div",{className:"min-h-screen bg-gray-50",children:p.jsxs("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("button",{onClick:()=>e("/profile"),className:"btn btn-ghost mb-6 flex items-center gap-2",children:[p.jsx(Qs,{className:"w-4 h-4"}),"Back to Profile"]}),p.jsxs("div",{className:"mb-8",children:[p.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Edit Profile"}),p.jsx("p",{className:"mt-2 text-gray-600",children:"Update your personal information"})]}),p.jsx("div",{className:"card",children:p.jsxs("form",{onSubmit:u(m),className:"card-content space-y-6",children:[p.jsxs("div",{children:[p.jsxs("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 mb-1",children:[p.jsx(th,{className:"w-4 h-4 inline mr-1"}),"Display Name"]}),p.jsx("input",{...a("displayName",{required:"Display name is required",minLength:{value:2,message:"Display name must be at least 2 characters"},maxLength:{value:50,message:"Display name must be less than 50 characters"}}),type:"text",id:"displayName",className:"input",placeholder:"Enter your display name"}),d.displayName&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.displayName.message})]}),p.jsxs("div",{children:[p.jsxs("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:[p.jsx(th,{className:"w-4 h-4 inline mr-1"}),"Username"]}),p.jsx("input",{...a("username",{required:"Username is required",minLength:{value:3,message:"Username must be at least 3 characters"},maxLength:{value:30,message:"Username must be less than 30 characters"},pattern:{value:/^[a-zA-Z0-9_-]+$/,message:"Username can only contain letters, numbers, hyphens, and underscores"}}),type:"text",id:"username",className:"input",placeholder:"Enter your username"}),d.username&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.username.message})]}),p.jsxs("div",{children:[p.jsxs("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:[p.jsx(c2,{className:"w-4 h-4 inline mr-1"}),"Email Address"]}),p.jsx("input",{...a("email",{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email format"}}),type:"email",id:"email",className:"input",placeholder:"Enter your email"}),d.email&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:d.email.message}),p.jsx("p",{className:"text-sm text-gray-500 mt-1",children:" Changing your email may require you to log in again"})]}),p.jsxs("div",{children:[p.jsxs("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:[p.jsx(Ma,{className:"w-4 h-4 inline mr-1"}),"Role"]}),t.role==="archaeologist"?p.jsxs(p.Fragment,{children:[p.jsxs("select",{...a("role"),id:"role",className:"input",onChange:y=>i(y.target.value!==t.role),children:[p.jsx("option",{value:"archaeologist",children:"Archaeologist (Full Access)"}),p.jsx("option",{value:"researcher",children:"Researcher (Read-Only)"})]}),s&&p.jsx("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:p.jsxs("p",{className:"text-yellow-800 text-sm",children:[p.jsx("strong",{children:" Downgrading to Researcher:"})," You will lose the ability to create and edit artifacts. You'll need to contact an administrator to upgrade back to Archaeologist."]})}),p.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"As an Archaeologist, you can create, edit, delete, and manage your own artifacts. You can downgrade to Researcher for read-only access. Contact an administrator to upgrade to Admin."})]}):p.jsxs(p.Fragment,{children:[p.jsx("input",{type:"text",id:"role",value:t.role==="researcher"?"Researcher (Read-Only)":t.role==="admin"?"Administrator":t.role==="guest"?"Guest":t.role,className:"input bg-gray-100 cursor-not-allowed",disabled:!0,readOnly:!0}),p.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t.role==="researcher"?"Contact an administrator to upgrade to Archaeologist or Admin roles.":t.role==="guest"?"Guest accounts have read-only access. Create a full account for more features.":"Contact an administrator if you need a different role."})]})]}),p.jsxs("div",{className:"flex gap-3 pt-4",children:[p.jsx("button",{type:"button",onClick:()=>e("/profile"),className:"btn btn-outline flex-1",disabled:n,children:"Cancel"}),p.jsx("button",{type:"submit",disabled:n,className:"btn btn-primary flex-1",children:n?"Saving...":"Save Changes"})]})]})})]})}):null},iG=()=>{const t=gn(),[e,n]=H.useState(!1),{register:r,handleSubmit:s,formState:{errors:i},watch:a,reset:u}=a0(),d=a("newPassword"),m=async y=>{if(!ot.currentUser||!ot.currentUser.email){ye.error("User not authenticated");return}n(!0);try{const _=xc.credential(ot.currentUser.email,y.currentPassword);await $5(ot.currentUser,_),await Y5(ot.currentUser,y.newPassword),ye.success("Password changed successfully!",{duration:3e3,icon:""}),u(),t("/profile")}catch(_){console.error("Error changing password:",_),_.code==="auth/wrong-password"?ye.error("Current password is incorrect"):_.code==="auth/weak-password"?ye.error("New password is too weak. Use at least 6 characters"):ye.error(_.message||"Failed to change password")}finally{n(!1)}};return p.jsx("div",{className:"min-h-screen bg-gray-50",children:p.jsxs("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("button",{onClick:()=>t("/profile"),className:"btn btn-ghost mb-6 flex items-center gap-2",children:[p.jsx(Qs,{className:"w-4 h-4"}),"Back to Profile"]}),p.jsxs("div",{className:"mb-8",children:[p.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Change Password"}),p.jsx("p",{className:"mt-2 text-gray-600",children:"Update your account password"})]}),p.jsx("div",{className:"card",children:p.jsxs("form",{onSubmit:s(m),className:"card-content space-y-6",children:[p.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex gap-3",children:[p.jsx(a2,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),p.jsxs("div",{className:"text-sm text-blue-800",children:[p.jsx("p",{className:"font-medium mb-1",children:"Password Requirements:"}),p.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[p.jsx("li",{children:"At least 6 characters long"}),p.jsx("li",{children:"Use a mix of letters, numbers, and symbols"}),p.jsx("li",{children:"Avoid common passwords"})]})]})]}),p.jsxs("div",{children:[p.jsxs("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:[p.jsx(jd,{className:"w-4 h-4 inline mr-1"}),"Current Password"]}),p.jsx("input",{...r("currentPassword",{required:"Current password is required"}),type:"password",id:"currentPassword",className:"input",placeholder:"Enter your current password"}),i.currentPassword&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:i.currentPassword.message})]}),p.jsxs("div",{children:[p.jsxs("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:[p.jsx(jd,{className:"w-4 h-4 inline mr-1"}),"New Password"]}),p.jsx("input",{...r("newPassword",{required:"New password is required",minLength:{value:6,message:"Password must be at least 6 characters"}}),type:"password",id:"newPassword",className:"input",placeholder:"Enter your new password"}),i.newPassword&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:i.newPassword.message})]}),p.jsxs("div",{children:[p.jsxs("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:[p.jsx(jd,{className:"w-4 h-4 inline mr-1"}),"Confirm New Password"]}),p.jsx("input",{...r("confirmPassword",{required:"Please confirm your new password",validate:y=>y===d||"Passwords do not match"}),type:"password",id:"confirmPassword",className:"input",placeholder:"Confirm your new password"}),i.confirmPassword&&p.jsx("p",{className:"text-red-600 text-sm mt-1",children:i.confirmPassword.message})]}),p.jsxs("div",{className:"flex gap-3 pt-4",children:[p.jsx("button",{type:"button",onClick:()=>t("/profile"),className:"btn btn-outline flex-1",disabled:e,children:"Cancel"}),p.jsx("button",{type:"submit",disabled:e,className:"btn btn-primary flex-1",children:e?"Changing Password...":"Change Password"})]})]})})]})})},oG="modulepreload",aG=function(t){return"/"+t},pI={},yI=function(e,n,r){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=aG(i),i in pI)return;pI[i]=!0;const a=i.endsWith(".css"),u=a?'[rel="stylesheet"]':"";if(!!r)for(let y=s.length-1;y>=0;y--){const _=s[y];if(_.href===i&&(!a||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${u}`))return;const m=document.createElement("link");if(m.rel=a?"stylesheet":oG,a||(m.as="script",m.crossOrigin=""),m.href=i,document.head.appendChild(m),a)return new Promise((y,_)=>{m.addEventListener("load",y),m.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i})},lG=()=>{const{user:t}=bn(),e=gn(),[n,r]=H.useState(""),[s,i]=H.useState(!1),a=async()=>{if(n!=="DELETE"){ye.error("Please type DELETE to confirm");return}if(!ot.currentUser||!t){ye.error("No user logged in");return}i(!0);try{const u=ot.currentUser.uid,{doc:d,updateDoc:m,serverTimestamp:y}=await yI(()=>import("./index.esm-7776397f.js"),[]),{db:_}=await yI(()=>Promise.resolve().then(()=>_B),void 0);await m(d(_,"users",u),{isActive:!1,deletedAt:y(),deletedBy:u}),await tM(ot.currentUser),ye.success("Account deleted successfully"),e("/login")}catch(u){console.error("Error deleting account:",u),u.code==="auth/requires-recent-login"?ye.error("Please log out and log back in before deleting your account",{duration:5e3}):ye.error("Failed to delete account. Please try again.")}finally{i(!1)}};return t?p.jsx("div",{className:"min-h-screen bg-gray-50",children:p.jsxs("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("button",{onClick:()=>e("/profile"),className:"btn btn-ghost mb-6 flex items-center gap-2",children:[p.jsx(Qs,{className:"w-4 h-4"}),"Back to Profile"]}),p.jsx("div",{className:"card border-2 border-red-200",children:p.jsxs("div",{className:"card-content",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[p.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:p.jsx(XU,{className:"w-6 h-6 text-red-600"})}),p.jsxs("div",{children:[p.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Delete Account"}),p.jsx("p",{className:"text-sm text-red-600",children:"This action cannot be undone"})]})]}),p.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[p.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:" Warning"}),p.jsxs("ul",{className:"text-sm text-red-800 space-y-1 list-disc list-inside",children:[p.jsx("li",{children:"Your account will be permanently deleted"}),p.jsx("li",{children:"All your artifacts will remain in the system"}),p.jsx("li",{children:"You will lose access to all your data"}),p.jsx("li",{children:"This action cannot be reversed"})]})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Type ",p.jsx("span",{className:"font-bold text-red-600",children:"DELETE"})," to confirm"]}),p.jsx("input",{type:"text",value:n,onChange:u=>r(u.target.value),className:"input",placeholder:"Type DELETE here",disabled:s})]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:()=>e("/profile"),className:"btn btn-outline flex-1",disabled:s,children:"Cancel"}),p.jsx("button",{onClick:a,disabled:n!=="DELETE"||s,className:"btn btn-danger flex-1",children:s?"Deleting...":"Delete My Account"})]})]})]})})]})}):null},Eh="roleRequests",cG=async t=>{try{const e=ot.currentUser;if(!e)throw new Error("User must be authenticated");const n=await uo.getUserProfile(e.uid);if(await Z4(e.uid))throw new Error("You already have a pending role request");if(t.requestedRole==="researcher")throw new Error("Cannot request researcher role");const s={userId:e.uid,userEmail:n.email,username:n.username,currentRole:n.role,requestedRole:t.requestedRole,reason:t.reason,status:"pending",createdAt:Pn(),updatedAt:Pn()},i=await Ku(an($e,Eh),s);return console.log(" Role request created:",i.id),i.id}catch(e){throw console.error(" Error creating role request:",e),e}},Z4=async t=>{var e,n,r,s,i,a;try{const u=ur(an($e,Eh),Zt("userId","==",t),Zt("status","==","pending")),d=await hr(u);if(d.empty)return null;const m=d.docs[0],y=m.data();return{id:m.id,...y,createdAt:((n=(e=y.createdAt)==null?void 0:e.toDate)==null?void 0:n.call(e))||new Date,updatedAt:((s=(r=y.updatedAt)==null?void 0:r.toDate)==null?void 0:s.call(r))||new Date,reviewedAt:((a=(i=y.reviewedAt)==null?void 0:i.toDate)==null?void 0:a.call(i))||void 0}}catch(u){throw console.error(" Error getting pending request:",u),u}},uG=async t=>{try{const e=ur(an($e,Eh),Zt("userId","==",t),Jf("createdAt","desc")),n=await hr(e),r=[];return n.forEach(s=>{var a,u,d,m,y,_;const i=s.data();r.push({id:s.id,...i,createdAt:((u=(a=i.createdAt)==null?void 0:a.toDate)==null?void 0:u.call(a))||new Date,updatedAt:((m=(d=i.updatedAt)==null?void 0:d.toDate)==null?void 0:m.call(d))||new Date,reviewedAt:((_=(y=i.reviewedAt)==null?void 0:y.toDate)==null?void 0:_.call(y))||void 0})}),r}catch(e){throw console.error(" Error getting role requests:",e),e}},hG=async()=>{try{const t=ur(an($e,Eh),Zt("status","==","pending"),Jf("createdAt","asc")),e=await hr(t),n=[];return e.forEach(r=>{var i,a,u,d,m,y;const s=r.data();n.push({id:r.id,...s,createdAt:((a=(i=s.createdAt)==null?void 0:i.toDate)==null?void 0:a.call(i))||new Date,updatedAt:((d=(u=s.updatedAt)==null?void 0:u.toDate)==null?void 0:d.call(u))||new Date,reviewedAt:((y=(m=s.reviewedAt)==null?void 0:m.toDate)==null?void 0:y.call(m))||void 0})}),n}catch(t){throw console.error(" Error getting pending requests:",t),t}},dG=async(t,e)=>{try{const n=ot.currentUser;if(!n)throw new Error("User must be authenticated");const r=Vt($e,Eh,t),s=await ll(r);if(!s.exists())throw new Error("Role request not found");const i=s.data();if(await Wr(r,{status:e.status,reviewedBy:n.uid,reviewedAt:Pn(),reviewNotes:e.reviewNotes||"",updatedAt:Pn()}),e.status==="approved"){const a=Vt($e,"users",i.userId);await Wr(a,{role:i.requestedRole}),console.log(" User role updated to:",i.requestedRole)}console.log(" Role request reviewed:",t,e.status)}catch(n){throw console.error(" Error reviewing role request:",n),n}},fG=async()=>{try{const t=ur(an($e,Eh),Jf("createdAt","desc")),e=await hr(t),n=[];return e.forEach(r=>{var i,a,u,d,m,y;const s=r.data();n.push({id:r.id,...s,createdAt:((a=(i=s.createdAt)==null?void 0:i.toDate)==null?void 0:a.call(i))||new Date,updatedAt:((d=(u=s.updatedAt)==null?void 0:u.toDate)==null?void 0:d.call(u))||new Date,reviewedAt:((y=(m=s.reviewedAt)==null?void 0:m.toDate)==null?void 0:y.call(m))||void 0})}),n}catch(t){throw console.error(" Error getting all role requests:",t),t}},mG=()=>{const{user:t}=bn(),e=gn(),[n,r]=H.useState("archaeologist"),[s,i]=H.useState(""),[a,u]=H.useState(!1),[d,m]=H.useState(null),[y,_]=H.useState([]),[E,b]=H.useState(!0);H.useEffect(()=>{k()},[t]);const k=async()=>{var T,C;if(t)try{b(!0);const R=await Z4(t.id);m(R);const j=await uG(t.id);_(j)}catch(R){console.error("Error loading requests:",R),!((T=R.message)!=null&&T.includes("permission"))&&!((C=R.message)!=null&&C.includes("denied"))&&ye.error("Failed to load role requests")}finally{b(!1)}},S=async T=>{if(T.preventDefault(),!s.trim()){ye.error("Please provide a reason for your request");return}if(s.trim().length<20){ye.error("Please provide a more detailed reason (at least 20 characters)");return}try{u(!0),await cG({requestedRole:n,reason:s.trim()}),ye.success("Role request submitted successfully!"),i(""),k()}catch(C){console.error("Error submitting request:",C),ye.error(C.message||"Failed to submit request")}finally{u(!1)}};if(!t)return null;const O=T=>{switch(T){case"pending":return p.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[p.jsx(eh,{className:"w-3 h-3"}),"Pending"]});case"approved":return p.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[p.jsx(Cf,{className:"w-3 h-3"}),"Approved"]});case"denied":return p.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[p.jsx(gw,{className:"w-3 h-3"}),"Denied"]})}};return p.jsx("div",{className:"min-h-screen bg-gray-50",children:p.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("button",{onClick:()=>e("/profile"),className:"btn btn-ghost mb-6 flex items-center gap-2",children:[p.jsx(Qs,{className:"w-4 h-4"}),"Back to Profile"]}),p.jsxs("div",{className:"mb-8",children:[p.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[p.jsx(Ma,{className:"w-8 h-8 text-primary-600"}),"Request Role Upgrade"]}),p.jsxs("p",{className:"mt-2 text-gray-600",children:["Current Role: ",p.jsx("strong",{className:"text-gray-900 capitalize",children:t.role})]})]}),d&&p.jsx("div",{className:"card mb-6 border-yellow-300 bg-yellow-50",children:p.jsx("div",{className:"card-content",children:p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx(eh,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"font-semibold text-yellow-900",children:"Pending Request"}),p.jsxs("p",{className:"text-yellow-800 text-sm mt-1",children:["You have a pending request for ",p.jsx("strong",{className:"capitalize",children:d.requestedRole})," role. Please wait for an administrator to review your request."]}),p.jsxs("p",{className:"text-yellow-700 text-xs mt-2",children:["Submitted: ",d.createdAt.toLocaleDateString()]})]})]})})}),!d&&t.role!=="admin"&&p.jsxs("div",{className:"card mb-6",children:[p.jsx("div",{className:"card-header",children:p.jsx("h2",{className:"text-xl font-semibold",children:"Submit New Request"})}),p.jsxs("form",{onSubmit:S,className:"card-content space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:"Requested Role"}),p.jsxs("select",{id:"role",value:n,onChange:T=>r(T.target.value),className:"input",disabled:a,children:[p.jsx("option",{value:"archaeologist",children:"Archaeologist - Create and edit artifacts"}),t.role==="archaeologist"&&p.jsx("option",{value:"admin",children:"Administrator - Full system access"})]})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason for Request"}),p.jsx("textarea",{id:"reason",value:s,onChange:T=>i(T.target.value),className:"input min-h-[120px]",placeholder:"Please explain why you need this role upgrade. Include your qualifications, experience, or institutional affiliation...",disabled:a,required:!0}),p.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[s.length,"/500 characters (minimum 20)"]})]}),p.jsx("button",{type:"submit",disabled:a||s.length<20,className:"btn btn-primary w-full",children:a?"Submitting...":"Submit Request"})]})]}),t.role==="admin"&&p.jsx("div",{className:"card border-green-300 bg-green-50",children:p.jsx("div",{className:"card-content",children:p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx(Cf,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),p.jsxs("div",{children:[p.jsx("h3",{className:"font-semibold text-green-900",children:"Administrator Account"}),p.jsx("p",{className:"text-green-800 text-sm mt-1",children:"You have the highest level of access. You can manage role requests from other users in the Admin Panel."})]})]})})}),y.length>0&&p.jsxs("div",{className:"card",children:[p.jsx("div",{className:"card-header",children:p.jsx("h2",{className:"text-xl font-semibold",children:"Request History"})}),p.jsx("div",{className:"card-content",children:p.jsx("div",{className:"space-y-4",children:y.map(T=>p.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[p.jsxs("div",{className:"flex items-start justify-between mb-2",children:[p.jsxs("div",{children:[p.jsxs("p",{className:"font-medium text-gray-900",children:[p.jsx("span",{className:"capitalize",children:T.currentRole}),"  ",p.jsx("span",{className:"capitalize",children:T.requestedRole})]}),p.jsxs("p",{className:"text-sm text-gray-500",children:[T.createdAt.toLocaleDateString()," at"," ",T.createdAt.toLocaleTimeString()]})]}),O(T.status)]}),p.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[p.jsx("strong",{children:"Reason:"})," ",T.reason]}),T.reviewNotes&&p.jsxs("p",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded",children:[p.jsx("strong",{children:"Admin Response:"})," ",T.reviewNotes]})]},T.id))})})]})]})})},gG=()=>{const{user:t}=bn(),e=gn(),[n,r]=H.useState([]),[s,i]=H.useState([]),[a,u]=H.useState(!0),[d,m]=H.useState("pending"),[y,_]=H.useState(null),[E,b]=H.useState("");H.useEffect(()=>{if(console.log("AdminPanelPage: user =",t),console.log("AdminPanelPage: user.role =",t==null?void 0:t.role),!t){console.log(" Waiting for user to load...");return}if(t.role!=="admin"){console.log(" Access denied. User role:",t.role,"(expected: admin)"),e("/dashboard",{replace:!0});return}console.log(" Admin access granted. Loading requests..."),k()},[t,e]);const k=async()=>{try{u(!0);const[C,R]=await Promise.all([hG(),fG()]);r(C),i(R)}catch(C){console.error("Error loading requests:",C),ye.error("Failed to load role requests")}finally{u(!1)}},S=async(C,R)=>{try{await dG(C,{status:R,reviewNotes:E.trim()||void 0}),ye.success(`Request ${R}!`),_(null),b(""),k()}catch(j){console.error("Error reviewing request:",j),ye.error(j.message||"Failed to review request")}},O=C=>{switch(C){case"pending":return p.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[p.jsx(eh,{className:"w-3 h-3"}),"Pending"]});case"approved":return p.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[p.jsx(Cf,{className:"w-3 h-3"}),"Approved"]});case"denied":return p.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[p.jsx(gw,{className:"w-3 h-3"}),"Denied"]})}};if(!t||t.role!=="admin")return null;const T=d==="pending"?n:s;return p.jsx("div",{className:"min-h-screen bg-gray-50",children:p.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("button",{onClick:()=>e("/dashboard"),className:"btn btn-ghost mb-6 flex items-center gap-2",children:[p.jsx(Qs,{className:"w-4 h-4"}),"Back to Dashboard"]}),p.jsx("div",{className:"mb-8",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[p.jsx(Ma,{className:"w-8 h-8 text-primary-600"}),"Admin Panel"]}),p.jsx("p",{className:"mt-2 text-gray-600",children:"Manage role requests from users"})]}),p.jsxs("button",{onClick:()=>e("/admin/users"),className:"btn btn-primary flex items-center gap-2",children:[p.jsx(Jr,{className:"w-5 h-5"}),"Manage Users"]})]})}),p.jsxs("div",{className:"flex gap-2 mb-6",children:[p.jsxs("button",{onClick:()=>m("pending"),className:`btn ${d==="pending"?"btn-primary":"btn-outline"}`,children:[p.jsx(eh,{className:"w-4 h-4 mr-2"}),"Pending (",n.length,")"]}),p.jsxs("button",{onClick:()=>m("all"),className:`btn ${d==="all"?"btn-primary":"btn-outline"}`,children:[p.jsx(Jr,{className:"w-4 h-4 mr-2"}),"All Requests (",s.length,")"]})]}),a?p.jsx("div",{className:"card",children:p.jsx("div",{className:"card-content text-center py-12",children:p.jsx("p",{className:"text-gray-500",children:"Loading requests..."})})}):T.length===0?p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content text-center py-12",children:[p.jsx(Jr,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),p.jsx("p",{className:"text-gray-500",children:d==="pending"?"No pending requests":"No role requests yet"})]})}):p.jsx("div",{className:"space-y-4",children:T.map(C=>{var R;return p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsxs("div",{className:"flex items-start justify-between mb-4",children:[p.jsxs("div",{children:[p.jsxs("h3",{className:"font-semibold text-gray-900",children:[C.username," (",C.userEmail,")"]}),p.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[p.jsx("span",{className:"capitalize",children:C.currentRole}),"  ",p.jsx("span",{className:"capitalize font-medium",children:C.requestedRole})]}),p.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Submitted: ",C.createdAt.toLocaleDateString()," at"," ",C.createdAt.toLocaleTimeString()]})]}),O(C.status)]}),p.jsxs("div",{className:"mb-4",children:[p.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Reason:"}),p.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded",children:C.reason})]}),C.status==="pending"&&p.jsx("div",{className:"border-t pt-4",children:y===C.id?p.jsxs("div",{className:"space-y-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Review Notes (Optional)"}),p.jsx("textarea",{value:E,onChange:j=>b(j.target.value),className:"input min-h-[80px]",placeholder:"Add any notes or feedback..."})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsxs("button",{onClick:()=>S(C.id,"approved"),className:"btn btn-primary flex-1",children:[p.jsx(Cf,{className:"w-4 h-4 mr-2"}),"Approve"]}),p.jsxs("button",{onClick:()=>S(C.id,"denied"),className:"btn btn-danger flex-1",children:[p.jsx(gw,{className:"w-4 h-4 mr-2"}),"Deny"]}),p.jsx("button",{onClick:()=>{_(null),b("")},className:"btn btn-ghost",children:"Cancel"})]})]}):p.jsx("button",{onClick:()=>_(C.id),className:"btn btn-primary w-full",children:"Review Request"})}),C.status!=="pending"&&p.jsxs("div",{className:"border-t pt-4",children:[p.jsxs("p",{className:"text-sm text-gray-600",children:[p.jsx("strong",{children:"Reviewed:"})," ",(R=C.reviewedAt)==null?void 0:R.toLocaleDateString()]}),C.reviewNotes&&p.jsxs("p",{className:"text-sm text-gray-600 mt-2 bg-gray-50 p-2 rounded",children:[p.jsx("strong",{children:"Notes:"})," ",C.reviewNotes]})]})]})},C.id)})})]})})},pG=async()=>{try{const t=ur(an($e,"users"),Jf("createdAt","desc")),e=await hr(t),n=[];return e.forEach(r=>{const s=r.data();n.push({id:r.id,email:s.email,username:s.username,role:s.role,displayName:s.displayName,createdAt:s.createdAt,lastLoginAt:s.lastLoginAt,isActive:s.isActive})}),n}catch(t){throw console.error(" Error getting all users:",t),t}},yG=async t=>{try{const e=ot.currentUser;if(!e)throw new Error("Must be authenticated");const n=Vt($e,"users",t);await Wr(n,{isActive:!1,deletedAt:Pn(),deletedBy:e.uid}),console.log(" User deactivated:",t)}catch(e){throw console.error(" Error deactivating user:",e),e}},xG=async t=>{try{const e=ot.currentUser;if(!e)throw new Error("Must be authenticated");const n=Vt($e,"users",t);await Wr(n,{isActive:!0,reactivatedAt:Pn(),reactivatedBy:e.uid,deletedAt:null,deletedBy:null}),console.log(" User reactivated:",t)}catch(e){throw console.error(" Error reactivating user:",e),e}},wG=async(t,e)=>{try{const n=ot.currentUser;if(!n)throw new Error("Must be authenticated");const r=Vt($e,"users",t);await Wr(r,{role:e,roleUpdatedAt:Pn(),roleUpdatedBy:n.uid}),console.log(" User role updated:",t,"to",e)}catch(n){throw console.error(" Error updating user role:",n),n}},_G=()=>{const{user:t}=bn(),e=gn(),[n,r]=H.useState([]),[s,i]=H.useState(!0),[a,u]=H.useState(""),[d,m]=H.useState("all"),[y,_]=H.useState(null),[E,b]=H.useState("researcher");H.useEffect(()=>{if(t){if(t.role!=="admin"){e("/dashboard",{replace:!0});return}k()}},[t,e]);const k=async()=>{try{i(!0);const j=await pG();r(j)}catch(j){console.error("Error loading users:",j),ye.error("Failed to load users")}finally{i(!1)}},S=async(j,K)=>{if(window.confirm(`Are you sure you want to deactivate ${K}? They will not be able to log in.`))try{await yG(j),ye.success("User deactivated successfully"),k()}catch(D){console.error("Error deactivating user:",D),ye.error(D.message||"Failed to deactivate user")}},O=async(j,K)=>{try{await xG(j),ye.success(`${K} has been reactivated`),k()}catch(Q){console.error("Error reactivating user:",Q),ye.error(Q.message||"Failed to reactivate user")}},T=async j=>{try{await wG(j,E),ye.success("User role updated successfully"),_(null),k()}catch(K){console.error("Error updating role:",K),ye.error(K.message||"Failed to update role")}},C=j=>{switch(j){case"admin":return"bg-red-100 text-red-800";case"archaeologist":return"bg-blue-100 text-blue-800";case"researcher":return"bg-green-100 text-green-800";case"guest":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};if(!t||t.role!=="admin")return null;const R=n.filter(j=>{var D;const K=j.email.toLowerCase().includes(a.toLowerCase())||j.username.toLowerCase().includes(a.toLowerCase())||((D=j.displayName)==null?void 0:D.toLowerCase().includes(a.toLowerCase())),Q=d==="all"||j.role===d;return K&&Q});return p.jsx("div",{className:"min-h-screen bg-gray-50",children:p.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("button",{onClick:()=>e("/dashboard"),className:"btn btn-ghost mb-6 flex items-center gap-2",children:[p.jsx(Qs,{className:"w-4 h-4"}),"Back to Dashboard"]}),p.jsxs("div",{className:"mb-8",children:[p.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[p.jsx(Jr,{className:"w-8 h-8 text-primary-600"}),"User Management"]}),p.jsx("p",{className:"mt-2 text-gray-600",children:"Manage user accounts and permissions"})]}),p.jsx("div",{className:"card mb-6",children:p.jsx("div",{className:"card-content",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search Users"}),p.jsxs("div",{className:"relative",children:[p.jsx(dc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),p.jsx("input",{type:"text",value:a,onChange:j=>u(j.target.value),className:"input pl-10",placeholder:"Search by email, username, or name..."})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter by Role"}),p.jsxs("select",{value:d,onChange:j=>m(j.target.value),className:"input",children:[p.jsx("option",{value:"all",children:"All Roles"}),p.jsx("option",{value:"admin",children:"Admin"}),p.jsx("option",{value:"archaeologist",children:"Archaeologist"}),p.jsx("option",{value:"researcher",children:"Researcher"}),p.jsx("option",{value:"guest",children:"Guest"})]})]})]})})}),s?p.jsx("div",{className:"card",children:p.jsx("div",{className:"card-content text-center py-12",children:p.jsx("p",{className:"text-gray-500",children:"Loading users..."})})}):R.length===0?p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content text-center py-12",children:[p.jsx(Jr,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),p.jsx("p",{className:"text-gray-500",children:"No users found"})]})}):p.jsx("div",{className:"card",children:p.jsx("div",{className:"card-content p-0",children:p.jsx("div",{className:"overflow-x-auto",children:p.jsxs("table",{className:"w-full",children:[p.jsx("thead",{className:"bg-gray-50 border-b",children:p.jsxs("tr",{children:[p.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),p.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),p.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),p.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),p.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),p.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:R.map(j=>p.jsxs("tr",{className:j.isActive?"":"bg-gray-50 opacity-60",children:[p.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:p.jsxs("div",{children:[p.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[j.displayName||j.username,j.id===t.id&&p.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(You)"})]}),p.jsx("div",{className:"text-sm text-gray-500",children:j.email})]})}),p.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:y===j.id&&j.role!=="admin"?p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs("select",{value:E,onChange:K=>b(K.target.value),className:"input input-sm",children:[p.jsx("option",{value:"researcher",children:"Researcher"}),p.jsx("option",{value:"archaeologist",children:"Archaeologist"})]}),p.jsx("button",{onClick:()=>T(j.id),className:"btn btn-primary btn-sm",children:"Save"}),p.jsx("button",{onClick:()=>_(null),className:"btn btn-ghost btn-sm",children:"Cancel"})]}):p.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${C(j.role)}`,children:j.role})}),p.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:p.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${j.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:j.isActive?"Active":"Inactive"})}),p.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(j.createdAt).toLocaleDateString()}),p.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:p.jsxs("div",{className:"flex items-center justify-end gap-2",children:[j.role!=="admin"&&j.id!==t.id&&p.jsx(p.Fragment,{children:j.isActive?p.jsxs(p.Fragment,{children:[p.jsx("button",{onClick:()=>{_(j.id),b(j.role)},className:"btn btn-ghost btn-sm",title:"Change role",children:p.jsx(sz,{className:"w-4 h-4"})}),p.jsx("button",{onClick:()=>S(j.id,j.email),className:"btn btn-danger btn-sm",title:"Deactivate user",children:p.jsx(l0,{className:"w-4 h-4"})})]}):p.jsx("button",{onClick:()=>O(j.id,j.email),className:"btn btn-primary btn-sm",title:"Reactivate user",children:p.jsx(mw,{className:"w-4 h-4"})})}),j.role==="admin"&&j.id!==t.id&&p.jsx("span",{className:"text-xs text-gray-400",children:"Protected"}),j.id===t.id&&p.jsx("span",{className:"text-xs text-gray-400",children:""})]})})]},j.id))})]})})})}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6",children:[p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsx("p",{className:"text-sm text-gray-600",children:"Total Users"}),p.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.length})]})}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsx("p",{className:"text-sm text-gray-600",children:"Admins"}),p.jsx("p",{className:"text-2xl font-bold text-red-600",children:n.filter(j=>j.role==="admin").length})]})}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsx("p",{className:"text-sm text-gray-600",children:"Archaeologists"}),p.jsx("p",{className:"text-2xl font-bold text-blue-600",children:n.filter(j=>j.role==="archaeologist").length})]})}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsx("p",{className:"text-sm text-gray-600",children:"Researchers"}),p.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.filter(j=>j.role==="researcher").length})]})})]})]})})},vG=({group:t})=>{const e=gn();return p.jsx("div",{onClick:()=>e(`/groups/${t.id}`),className:"card hover:shadow-lg transition-shadow cursor-pointer",children:p.jsxs("div",{className:"card-content",children:[p.jsxs("div",{className:"flex items-start justify-between mb-3",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900 line-clamp-1",children:t.name}),t.settings.privacy==="private"&&p.jsx(Ma,{className:"w-4 h-4 text-gray-400"})]}),t.description&&p.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:t.description}),p.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(Jr,{className:"w-4 h-4"}),p.jsxs("span",{children:[t.memberCount||0," members"]})]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(Ea,{className:"w-4 h-4"}),p.jsxs("span",{children:[t.artifactCount||0," artifacts"]})]})]}),p.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 text-xs text-gray-400",children:["Created ",new Date(t.createdAt).toLocaleDateString()]})]})})},EG=()=>{const t=gn(),{user:e}=bn(),[n,r]=H.useState([]),[s,i]=H.useState(!0),[a,u]=H.useState("");H.useEffect(()=>{d()},[e]);const d=async()=>{if(e)try{i(!0);const y=await t2(e.id),_=await Promise.all(y.map(async E=>{try{const[b,k]=await Promise.all([u2(E.id),P4(E.id)]);return{...E,memberCount:b.length,artifactCount:k.length}}catch(b){return console.error(`Error fetching counts for group ${E.id}:`,b),{...E,memberCount:0,artifactCount:0}}}));r(_)}catch(y){console.error("Error loading groups:",y),ye.error("Failed to load groups")}finally{i(!1)}},m=n.filter(y=>{var _;return y.name.toLowerCase().includes(a.toLowerCase())||((_=y.description)==null?void 0:_.toLowerCase().includes(a.toLowerCase()))});return s?p.jsx("div",{className:"min-h-screen  flex items-center justify-center",children:p.jsx(Rr,{text:"Loading groups..."})}):p.jsx("div",{className:"min-h-screen ",children:p.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("div",{className:"mb-8 flex justify-between items-start",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-3xl font-bold text-archaeological-charcoal",children:"Groups"}),p.jsx("p",{className:"mt-2 text-archaeological-charcoal",children:"Collaborate with your team on artifacts"})]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsxs("button",{onClick:()=>t("/groups/browse/public"),className:"btn btn-secondary flex items-center gap-2",children:[p.jsx(dc,{className:"w-4 h-4"}),"Browse Public Groups"]}),p.jsxs("button",{onClick:()=>t("/groups/new"),className:"btn btn-primary flex items-center gap-2",children:[p.jsx(Wg,{className:"w-4 h-4"}),"Create Group"]})]})]}),p.jsx("div",{className:"mb-6",children:p.jsxs("div",{className:"relative",children:[p.jsx(dc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-archaeological-sage w-5 h-5"}),p.jsx("input",{type:"text",placeholder:"Search groups...",value:a,onChange:y=>u(y.target.value),className:"input pl-10 w-full"})]})}),m.length===0?p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content text-center py-12",children:[p.jsx(Jr,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-semibold text-archaeological-charcoal mb-2",children:a?"No groups found":"No groups yet"}),p.jsx("p",{className:"text-archaeological-charcoal mb-6",children:a?"Try adjusting your search criteria":"Create your first group to start collaborating with your team"}),!a&&p.jsxs("button",{onClick:()=>t("/groups/new"),className:"btn btn-primary",children:[p.jsx(Wg,{className:"w-4 h-4 mr-2"}),"Create Group"]})]})}):p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(y=>p.jsx(vG,{group:y},y.id))}),m.length>0&&p.jsxs("div",{className:"mt-6 text-center text-sm text-archaeological-olive",children:["Showing ",m.length," of ",n.length," group",n.length!==1?"s":""]})]})})},AG=()=>{var a,u,d,m,y;const t=gn(),[e,n]=H.useState(!1),[r,s]=H.useState({name:"",description:"",settings:{privacy:"private",defaultMemberPermissions:{canCreateArtifacts:!0,canEditArtifacts:!0,canDeleteArtifacts:!1,canViewArtifacts:!0,canManageMembers:!1},allowMemberInvites:!1}}),i=async _=>{if(_.preventDefault(),!r.name.trim()){ye.error("Group name is required");return}try{n(!0);const E=await pU(r);ye.success("Group created successfully!"),t(`/groups/${E}`)}catch(E){console.error("Error creating group:",E),ye.error(E.message||"Failed to create group")}finally{n(!1)}};return p.jsx("div",{className:"min-h-screen ",children:p.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("button",{onClick:()=>t("/groups"),className:"btn btn-ghost mb-6",children:[p.jsx(Qs,{className:"w-4 h-4"}),"Back to Groups"]}),p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"card-header",children:[p.jsx("h2",{className:"text-2xl font-bold",children:"Create New Group"}),p.jsx("p",{className:"text-archaeological-charcoal mt-1",children:"Set up a new group to collaborate with your team"})]}),p.jsxs("form",{onSubmit:i,className:"card-content space-y-6",children:[p.jsxs("div",{className:"form-group",children:[p.jsxs("label",{className:"label",children:[p.jsx(Jr,{className:"w-4 h-4"}),"Group Name",p.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),p.jsx("input",{type:"text",value:r.name,onChange:_=>s({...r,name:_.target.value}),placeholder:"e.g., Egypt Excavation Team",className:"input",required:!0,maxLength:100,disabled:e})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{className:"label",children:"Description"}),p.jsx("textarea",{value:r.description,onChange:_=>s({...r,description:_.target.value}),placeholder:"Describe the purpose of this group...",className:"input",rows:3,maxLength:500,disabled:e})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{className:"label",children:"Privacy"}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"flex items-center gap-3 p-3 border border-archaeological-lightBrown rounded-lg cursor-pointer hover:bg-archaeological-warmGray",children:[p.jsx("input",{type:"radio",name:"privacy",value:"private",checked:((a=r.settings)==null?void 0:a.privacy)==="private",onChange:_=>s({...r,settings:{...r.settings,privacy:"private"}}),disabled:e}),p.jsx(jd,{className:"w-5 h-5 text-archaeological-olive"}),p.jsxs("div",{children:[p.jsx("div",{className:"font-medium",children:"Private"}),p.jsx("div",{className:"text-sm text-archaeological-olive",children:"Only invited members can see this group"})]})]}),p.jsxs("label",{className:"flex items-center gap-3 p-3 border border-archaeological-lightBrown rounded-lg cursor-pointer hover:bg-archaeological-warmGray",children:[p.jsx("input",{type:"radio",name:"privacy",value:"public",checked:((u=r.settings)==null?void 0:u.privacy)==="public",onChange:_=>s({...r,settings:{...r.settings,privacy:"public"}}),disabled:e}),p.jsx(qg,{className:"w-5 h-5 text-archaeological-olive"}),p.jsxs("div",{children:[p.jsx("div",{className:"font-medium",children:"Public"}),p.jsx("div",{className:"text-sm text-archaeological-olive",children:"Anyone can see this group"})]})]})]})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{className:"label",children:"Default Member Permissions"}),p.jsx("p",{className:"text-sm text-archaeological-olive mb-3",children:"These permissions will be applied to new members by default"}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:(d=r.settings)==null?void 0:d.defaultMemberPermissions.canCreateArtifacts,onChange:_=>s({...r,settings:{...r.settings,defaultMemberPermissions:{...r.settings.defaultMemberPermissions,canCreateArtifacts:_.target.checked}}}),disabled:e}),p.jsx("span",{className:"text-sm",children:"Can create artifacts"})]}),p.jsxs("label",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:(m=r.settings)==null?void 0:m.defaultMemberPermissions.canEditArtifacts,onChange:_=>s({...r,settings:{...r.settings,defaultMemberPermissions:{...r.settings.defaultMemberPermissions,canEditArtifacts:_.target.checked}}}),disabled:e}),p.jsx("span",{className:"text-sm",children:"Can edit artifacts"})]}),p.jsxs("label",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:(y=r.settings)==null?void 0:y.defaultMemberPermissions.canDeleteArtifacts,onChange:_=>s({...r,settings:{...r.settings,defaultMemberPermissions:{...r.settings.defaultMemberPermissions,canDeleteArtifacts:_.target.checked}}}),disabled:e}),p.jsx("span",{className:"text-sm",children:"Can delete artifacts"})]})]})]}),p.jsxs("div",{className:"flex gap-3 pt-4",children:[p.jsx("button",{type:"button",onClick:()=>t("/groups"),className:"btn btn-secondary flex-1",disabled:e,children:"Cancel"}),p.jsx("button",{type:"submit",className:"btn btn-primary flex-1",disabled:e,children:e?p.jsxs(p.Fragment,{children:[p.jsx(Rr,{size:"sm"}),"Creating..."]}):p.jsxs(p.Fragment,{children:[p.jsx(Jr,{className:"w-4 h-4"}),"Create Group"]})})]})]})]})]})})},bG=({member:t,memberUser:e,groupId:n,onClose:r,onSuccess:s})=>{const[i,a]=H.useState(t.role),[u,d]=H.useState(t.permissions),[m,y]=H.useState(!1),_=(b,k)=>{d(S=>({...S,[b]:k}))},E=async()=>{try{y(!0),i!==t.role&&await Cz(n,t.userId,i),await Iz(n,t.userId,u),ye.success("Member permissions updated successfully"),s(),r()}catch(b){console.error("Error updating member permissions:",b),ye.error(b.message||"Failed to update permissions")}finally{y(!1)}};return p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:p.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:[p.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[p.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Member Permissions"}),p.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-500",children:p.jsx(fc,{className:"w-5 h-5"})})]}),p.jsxs("div",{className:"p-6 space-y-6",children:[p.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[p.jsx("p",{className:"font-medium text-gray-900",children:(e==null?void 0:e.displayName)||(e==null?void 0:e.username)||"Unknown User"}),p.jsx("p",{className:"text-sm text-gray-600",children:e==null?void 0:e.email})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),p.jsxs("select",{value:i,onChange:b=>a(b.target.value),className:"input",children:[p.jsx("option",{value:"member",children:"Member"}),p.jsx("option",{value:"group_admin",children:"Group Admin"})]}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i==="group_admin"?"Group admins can manage members and group settings":"Regular members have limited permissions"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Permissions"}),p.jsxs("div",{className:"space-y-3",children:[p.jsxs("label",{className:"flex items-center gap-3",children:[p.jsx("input",{type:"checkbox",checked:u.canViewArtifacts,onChange:b=>_("canViewArtifacts",b.target.checked),className:"rounded border-gray-300"}),p.jsxs("div",{children:[p.jsx("span",{className:"text-sm font-medium text-gray-700",children:"View Artifacts"}),p.jsx("p",{className:"text-xs text-gray-500",children:"Can view group artifacts"})]})]}),p.jsxs("label",{className:"flex items-center gap-3",children:[p.jsx("input",{type:"checkbox",checked:u.canCreateArtifacts,onChange:b=>_("canCreateArtifacts",b.target.checked),className:"rounded border-gray-300"}),p.jsxs("div",{children:[p.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Create Artifacts"}),p.jsx("p",{className:"text-xs text-gray-500",children:"Can add new artifacts to the group"})]})]}),p.jsxs("label",{className:"flex items-center gap-3",children:[p.jsx("input",{type:"checkbox",checked:u.canEditArtifacts,onChange:b=>_("canEditArtifacts",b.target.checked),className:"rounded border-gray-300"}),p.jsxs("div",{children:[p.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Edit Artifacts"}),p.jsx("p",{className:"text-xs text-gray-500",children:"Can modify existing artifacts"})]})]}),p.jsxs("label",{className:"flex items-center gap-3",children:[p.jsx("input",{type:"checkbox",checked:u.canDeleteArtifacts,onChange:b=>_("canDeleteArtifacts",b.target.checked),className:"rounded border-gray-300"}),p.jsxs("div",{children:[p.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Delete Artifacts"}),p.jsx("p",{className:"text-xs text-gray-500",children:"Can remove artifacts from the group"})]})]}),p.jsxs("label",{className:"flex items-center gap-3",children:[p.jsx("input",{type:"checkbox",checked:u.canManageMembers,onChange:b=>_("canManageMembers",b.target.checked),className:"rounded border-gray-300"}),p.jsxs("div",{children:[p.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Manage Members"}),p.jsx("p",{className:"text-xs text-gray-500",children:"Can add/remove group members"})]})]})]})]})]}),p.jsxs("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 flex gap-3 justify-end border-t border-gray-200",children:[p.jsx("button",{onClick:r,className:"btn btn-secondary",disabled:m,children:"Cancel"}),p.jsx("button",{onClick:E,className:"btn btn-primary",disabled:m,children:m?p.jsx(p.Fragment,{children:"Saving..."}):p.jsxs(p.Fragment,{children:[p.jsx(G4,{className:"w-4 h-4"}),"Save Changes"]})})]})]})})},IG=({groupId:t,canManage:e,currentUserId:n,onAddMember:r})=>{const[s,i]=H.useState([]),[a,u]=H.useState(new Map),[d,m]=H.useState(!0),[y,_]=H.useState(null),[E,b]=H.useState(null),k=async()=>{try{m(!0);const O=await u2(t);i(O);const T=new Map;for(const C of O)try{const R=await ll(Vt($e,"users",C.userId));R.exists()&&T.set(C.userId,R.data())}catch(R){console.error("Error loading user details:",R)}u(T)}catch(O){console.error("Error loading members:",O),ye.error("Failed to load group members")}finally{m(!1)}};H.useEffect(()=>{k()},[t]);const S=async O=>{if(window.confirm("Are you sure you want to remove this member from the group?"))try{_(O),await bz(t,O),ye.success("Member removed successfully"),await k()}catch(T){console.error("Error removing member:",T),ye.error(T.message||"Failed to remove member")}finally{_(null)}};return d?p.jsx("div",{className:"flex justify-center py-8",children:p.jsx(Rr,{text:"Loading members..."})}):p.jsxs("div",{children:[p.jsxs("div",{className:"flex justify-between items-center mb-4",children:[p.jsxs("h3",{className:"text-lg font-semibold",children:["Members (",s.length,")"]}),e&&r&&p.jsxs("button",{onClick:r,className:"btn btn-primary btn-sm",children:[p.jsx($g,{className:"w-4 h-4"}),"Add Member"]})]}),s.length===0?p.jsxs("div",{className:"text-center py-8 text-gray-500",children:[p.jsx(Jr,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),p.jsx("p",{children:"No members yet"})]}):p.jsx("div",{className:"space-y-2",children:s.map(O=>{const T=a.get(O.userId),C=O.userId===n;return p.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center",children:p.jsx(th,{className:"w-5 h-5 text-primary-600"})}),p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"font-medium text-gray-900",children:(T==null?void 0:T.displayName)||(T==null?void 0:T.username)||"Unknown User"}),C&&p.jsx("span",{className:"text-xs text-gray-500",children:"(You)"})]}),p.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[p.jsx("span",{children:T==null?void 0:T.email}),O.role==="group_admin"&&p.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:[p.jsx(Ma,{className:"w-3 h-3"}),"Group Admin"]})]})]})]}),e&&!C&&p.jsxs("div",{className:"flex gap-2",children:[p.jsxs("button",{onClick:()=>b(O),className:"btn btn-ghost btn-sm text-gray-600 hover:text-gray-700 hover:bg-gray-100",children:[p.jsx(Yp,{className:"w-4 h-4"}),"Edit"]}),p.jsx("button",{onClick:()=>S(O.userId),disabled:y===O.userId,className:"btn btn-ghost btn-sm text-red-600 hover:text-red-700 hover:bg-red-50",children:y===O.userId?p.jsx(Rr,{size:"sm"}):p.jsxs(p.Fragment,{children:[p.jsx(l0,{className:"w-4 h-4"}),"Remove"]})})]})]},O.id)})}),E&&p.jsx(bG,{member:E,memberUser:a.get(E.userId),groupId:t,onClose:()=>b(null),onSuccess:k})]})},CG=({groupId:t,onClose:e,onMemberAdded:n})=>{const[r,s]=H.useState(""),[i,a]=H.useState("member"),[u,d]=H.useState(!1),m=async y=>{if(y.preventDefault(),!r.trim()){ye.error("Please enter an email address");return}try{d(!0),await H4(t,{email:r.trim(),role:i,permissions:hc(i)}),ye.success("Member added successfully"),n(),e()}catch(_){console.error("Error adding member:",_),ye.error(_.message||"Failed to add member")}finally{d(!1)}};return p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:p.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[p.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Member"}),p.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600",disabled:u,children:p.jsx(fc,{className:"w-5 h-5"})})]}),p.jsxs("form",{onSubmit:m,className:"p-6 space-y-4",children:[p.jsxs("div",{className:"form-group",children:[p.jsxs("label",{className:"label",children:[p.jsx(c2,{className:"w-4 h-4"}),"Email Address",p.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),p.jsx("input",{type:"email",value:r,onChange:y=>s(y.target.value),placeholder:"user@example.com",className:"input",required:!0,disabled:u}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the email address of the user you want to add"})]}),p.jsxs("div",{className:"form-group",children:[p.jsxs("label",{className:"label",children:[p.jsx($g,{className:"w-4 h-4"}),"Role"]}),p.jsxs("select",{value:i,onChange:y=>a(y.target.value),className:"input",disabled:u,children:[p.jsx("option",{value:"member",children:"Member"}),p.jsx("option",{value:"group_admin",children:"Group Admin"})]}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i==="group_admin"?"Group admins can manage members and group settings":"Members can view and edit artifacts based on their permissions"})]}),p.jsxs("div",{className:"flex gap-3 pt-4",children:[p.jsx("button",{type:"button",onClick:e,className:"btn btn-secondary flex-1",disabled:u,children:"Cancel"}),p.jsx("button",{type:"submit",className:"btn btn-primary flex-1",disabled:u,children:u?p.jsxs(p.Fragment,{children:[p.jsx(Rr,{size:"sm"}),"Adding..."]}):p.jsxs(p.Fragment,{children:[p.jsx($g,{className:"w-4 h-4"}),"Add Member"]})})]})]})]})})},TG=({group:t,onUpdate:e})=>{var u,d,m,y,_,E,b,k;const[n,r]=H.useState(!1),[s,i]=H.useState({name:t.name,description:t.description||"",settings:{privacy:t.settings.privacy,defaultMemberPermissions:{...t.settings.defaultMemberPermissions},allowMemberInvites:t.settings.allowMemberInvites}});H.useEffect(()=>{i({name:t.name,description:t.description||"",settings:{privacy:t.settings.privacy,defaultMemberPermissions:{...t.settings.defaultMemberPermissions},allowMemberInvites:t.settings.allowMemberInvites}})},[t]);const a=async S=>{var O;if(S.preventDefault(),!((O=s.name)!=null&&O.trim())){ye.error("Group name is required");return}try{r(!0),await wU(t.id,s),ye.success("Group settings updated successfully!"),e()}catch(T){console.error("Error updating group settings:",T),ye.error(T.message||"Failed to update group settings")}finally{r(!1)}};return p.jsxs("form",{onSubmit:a,className:"space-y-6",children:[p.jsxs("div",{className:"card",children:[p.jsx("div",{className:"card-header",children:p.jsx("h3",{className:"text-lg font-semibold",children:"Basic Information"})}),p.jsxs("div",{className:"card-content space-y-4",children:[p.jsxs("div",{className:"form-group",children:[p.jsxs("label",{className:"label",children:[p.jsx(Yp,{className:"w-4 h-4"}),"Group Name",p.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),p.jsx("input",{type:"text",value:s.name,onChange:S=>i({...s,name:S.target.value}),placeholder:"e.g., Egypt Excavation Team",className:"input",required:!0,maxLength:100,disabled:n})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{className:"label",children:"Description"}),p.jsx("textarea",{value:s.description,onChange:S=>i({...s,description:S.target.value}),placeholder:"Describe the purpose of this group...",className:"input",rows:3,maxLength:500,disabled:n})]})]})]}),p.jsxs("div",{className:"card",children:[p.jsx("div",{className:"card-header",children:p.jsx("h3",{className:"text-lg font-semibold",children:"Privacy Settings"})}),p.jsxs("div",{className:"card-content space-y-4",children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{className:"label",children:"Group Privacy"}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[p.jsx("input",{type:"radio",name:"privacy",value:"private",checked:((u=s.settings)==null?void 0:u.privacy)==="private",onChange:S=>i({...s,settings:{...s.settings,privacy:"private"}}),disabled:n}),p.jsx(jd,{className:"w-5 h-5 text-gray-500"}),p.jsxs("div",{children:[p.jsx("div",{className:"font-medium",children:"Private"}),p.jsx("div",{className:"text-sm text-gray-500",children:"Only invited members can see this group"})]})]}),p.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[p.jsx("input",{type:"radio",name:"privacy",value:"public",checked:((d=s.settings)==null?void 0:d.privacy)==="public",onChange:S=>i({...s,settings:{...s.settings,privacy:"public"}}),disabled:n}),p.jsx(qg,{className:"w-5 h-5 text-gray-500"}),p.jsxs("div",{children:[p.jsx("div",{className:"font-medium",children:"Public"}),p.jsx("div",{className:"text-sm text-gray-500",children:"Anyone can see this group"})]})]})]})]}),p.jsxs("div",{className:"form-group",children:[p.jsxs("label",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:(m=s.settings)==null?void 0:m.allowMemberInvites,onChange:S=>i({...s,settings:{...s.settings,allowMemberInvites:S.target.checked}}),disabled:n}),p.jsx("span",{className:"text-sm font-medium",children:"Allow members to invite others"})]}),p.jsx("p",{className:"text-xs text-gray-500 ml-6 mt-1",children:"If enabled, regular members can add new people to the group (not just admins)"})]})]})]}),p.jsxs("div",{className:"card",children:[p.jsxs("div",{className:"card-header",children:[p.jsx("h3",{className:"text-lg font-semibold",children:"Default Member Permissions"}),p.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"These permissions will be applied to new members when they join"})]}),p.jsxs("div",{className:"card-content space-y-3",children:[p.jsxs("label",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:(y=s.settings)==null?void 0:y.defaultMemberPermissions.canViewArtifacts,onChange:S=>i({...s,settings:{...s.settings,defaultMemberPermissions:{...s.settings.defaultMemberPermissions,canViewArtifacts:S.target.checked}}}),disabled:n}),p.jsxs("div",{children:[p.jsx("span",{className:"text-sm font-medium",children:"View artifacts"}),p.jsx("p",{className:"text-xs text-gray-500",children:"Members can view all artifacts in this group"})]})]}),p.jsxs("label",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:(_=s.settings)==null?void 0:_.defaultMemberPermissions.canCreateArtifacts,onChange:S=>i({...s,settings:{...s.settings,defaultMemberPermissions:{...s.settings.defaultMemberPermissions,canCreateArtifacts:S.target.checked}}}),disabled:n}),p.jsxs("div",{children:[p.jsx("span",{className:"text-sm font-medium",children:"Create artifacts"}),p.jsx("p",{className:"text-xs text-gray-500",children:"Members can add new artifacts to this group"})]})]}),p.jsxs("label",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:(E=s.settings)==null?void 0:E.defaultMemberPermissions.canEditArtifacts,onChange:S=>i({...s,settings:{...s.settings,defaultMemberPermissions:{...s.settings.defaultMemberPermissions,canEditArtifacts:S.target.checked}}}),disabled:n}),p.jsxs("div",{children:[p.jsx("span",{className:"text-sm font-medium",children:"Edit artifacts"}),p.jsx("p",{className:"text-xs text-gray-500",children:"Members can modify existing artifacts in this group"})]})]}),p.jsxs("label",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:(b=s.settings)==null?void 0:b.defaultMemberPermissions.canDeleteArtifacts,onChange:S=>i({...s,settings:{...s.settings,defaultMemberPermissions:{...s.settings.defaultMemberPermissions,canDeleteArtifacts:S.target.checked}}}),disabled:n}),p.jsxs("div",{children:[p.jsx("span",{className:"text-sm font-medium",children:"Delete artifacts"}),p.jsx("p",{className:"text-xs text-gray-500",children:"Members can remove artifacts from this group"})]})]}),p.jsxs("label",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:(k=s.settings)==null?void 0:k.defaultMemberPermissions.canManageMembers,onChange:S=>i({...s,settings:{...s.settings,defaultMemberPermissions:{...s.settings.defaultMemberPermissions,canManageMembers:S.target.checked}}}),disabled:n}),p.jsxs("div",{children:[p.jsx("span",{className:"text-sm font-medium",children:"Manage members"}),p.jsx("p",{className:"text-xs text-gray-500",children:"Members can add/remove other members"})]})]})]})]}),p.jsx("div",{className:"flex justify-end gap-3",children:p.jsx("button",{type:"submit",className:"btn btn-primary",disabled:n,children:n?p.jsxs(p.Fragment,{children:[p.jsx(Rr,{size:"sm"}),"Saving..."]}):p.jsxs(p.Fragment,{children:[p.jsx(G4,{className:"w-4 h-4"}),"Save Changes"]})})})]})},nh="groupRequests",SG=async t=>{try{const e=ot.currentUser;if(!e)throw new Error("User must be authenticated to request to join groups");if(await J4(t.groupId,e.uid))throw new Error("You already have a pending request for this group");const r={groupId:t.groupId,userId:e.uid,status:"pending",message:t.message||"",createdAt:Pn()},s=await Ku(an($e,nh),r);return console.log(" Join request created successfully:",s.id),s.id}catch(e){throw console.error(" Error creating join request:",e),e}},J4=async(t,e)=>{var n,r,s,i,a,u;try{const d=ur(an($e,nh),Zt("groupId","==",t),Zt("userId","==",e),Zt("status","==","pending")),m=await hr(d);if(m.empty)return null;const y=m.docs[0],_=y.data();return{id:y.id,..._,createdAt:((s=(r=(n=_.createdAt)==null?void 0:n.toDate)==null?void 0:r.call(n))==null?void 0:s.toISOString())||new Date().toISOString(),reviewedAt:(u=(a=(i=_.reviewedAt)==null?void 0:i.toDate)==null?void 0:a.call(i))==null?void 0:u.toISOString()}}catch(d){throw console.error(" Error getting user pending request:",d),d}},NG=async t=>{try{const e=ur(an($e,nh),Zt("groupId","==",t),Zt("status","==","pending"),Jf("createdAt","desc")),n=await hr(e),r=[];return n.forEach(s=>{var a,u,d,m,y,_;const i=s.data();r.push({id:s.id,...i,createdAt:((d=(u=(a=i.createdAt)==null?void 0:a.toDate)==null?void 0:u.call(a))==null?void 0:d.toISOString())||new Date().toISOString(),reviewedAt:(_=(y=(m=i.reviewedAt)==null?void 0:m.toDate)==null?void 0:y.call(m))==null?void 0:_.toISOString()})}),r}catch(e){throw console.error(" Error getting group pending requests:",e),e}},RG=async t=>{try{const e=ot.currentUser;if(!e)throw new Error("User must be authenticated to approve requests");const n=await ll(Vt($e,nh,t));if(!n.exists())throw new Error("Request not found");const r=n.data();await H4(r.groupId,{userId:r.userId,role:"member",permissions:hc("member")}),await Wr(Vt($e,nh,t),{status:"approved",reviewedAt:Pn(),reviewedBy:e.uid}),console.log(" Join request approved:",t)}catch(e){throw console.error(" Error approving join request:",e),e}},PG=async t=>{try{const e=ot.currentUser;if(!e)throw new Error("User must be authenticated to reject requests");await Wr(Vt($e,nh,t),{status:"rejected",reviewedAt:Pn(),reviewedBy:e.uid}),console.log(" Join request rejected:",t)}catch(e){throw console.error(" Error rejecting join request:",e),e}},kG=({groupId:t,onRequestReviewed:e})=>{const[n,r]=H.useState([]),[s,i]=H.useState(new Map),[a,u]=H.useState(!0),[d,m]=H.useState(null),y=async()=>{try{u(!0);const b=await NG(t);r(b);const k=new Map;for(const S of b)try{const O=await ll(Vt($e,"users",S.userId));O.exists()&&k.set(S.userId,O.data())}catch(O){console.error("Error loading user details:",O)}i(k)}catch(b){console.error("Error loading requests:",b),ye.error("Failed to load join requests")}finally{u(!1)}};H.useEffect(()=>{y()},[t]);const _=async b=>{try{m(b),await RG(b),ye.success("Request approved! User added to group."),await y(),e()}catch(k){console.error("Error approving request:",k),ye.error(k.message||"Failed to approve request")}finally{m(null)}},E=async b=>{try{m(b),await PG(b),ye.success("Request rejected"),await y()}catch(k){console.error("Error rejecting request:",k),ye.error(k.message||"Failed to reject request")}finally{m(null)}};return a?p.jsx("div",{className:"flex justify-center py-8",children:p.jsx(Rr,{text:"Loading requests..."})}):n.length===0?p.jsxs("div",{className:"text-center py-8 text-gray-500",children:[p.jsx(eh,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),p.jsx("p",{children:"No pending join requests"})]}):p.jsx("div",{className:"space-y-3",children:n.map(b=>{const k=s.get(b.userId),S=d===b.id;return p.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[p.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center",children:p.jsx(th,{className:"w-5 h-5 text-primary-600"})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("div",{className:"font-medium text-gray-900",children:(k==null?void 0:k.displayName)||(k==null?void 0:k.username)||"Unknown User"}),p.jsx("div",{className:"text-sm text-gray-500",children:k==null?void 0:k.email}),b.message&&p.jsxs("div",{className:"text-sm text-gray-600 mt-1 italic",children:['"',b.message,'"']}),p.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Requested ",new Date(b.createdAt).toLocaleDateString()]})]})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx("button",{onClick:()=>_(b.id),disabled:S,className:"btn btn-sm bg-green-600 hover:bg-green-700 text-white",title:"Approve request",children:S?p.jsx(Rr,{size:"sm"}):p.jsxs(p.Fragment,{children:[p.jsx(l2,{className:"w-4 h-4"}),"Approve"]})}),p.jsxs("button",{onClick:()=>E(b.id),disabled:S,className:"btn btn-sm btn-ghost text-red-600 hover:text-red-700 hover:bg-red-50",title:"Reject request",children:[p.jsx(fc,{className:"w-4 h-4"}),"Reject"]})]})]},b.id)})})},DG=()=>{const{id:t}=p_(),e=gn(),{user:n}=bn(),{isGroupAdmin:r,canManageGroup:s,loading:i}=K4(t),[a,u]=H.useState(null),[d,m]=H.useState([]),[y,_]=H.useState("overview"),[E,b]=H.useState(!0),[k,S]=H.useState(!1),[O,T]=H.useState(!1);H.useEffect(()=>{t&&C()},[t]);const C=async()=>{if(t)try{b(!0);const[j,K,Q]=await Promise.all([yU(t),P4(t),u2(t)]);if(!j){ye.error("Group not found"),e("/groups");return}j.memberCount=Q.length,j.artifactCount=K.length,u(j),m(K)}catch(j){console.error("Error loading group:",j),ye.error("Failed to load group")}finally{b(!1)}},R=async()=>{if(!(!t||!a||!window.confirm(`Are you sure you want to delete "${a.name}"? This action cannot be undone.`)))try{T(!0),await _U(t),ye.success("Group deleted successfully"),e("/groups")}catch(K){console.error("Error deleting group:",K),ye.error(K.message||"Failed to delete group")}finally{T(!1)}};return E||i?p.jsx("div",{className:"min-h-screen flex items-center justify-center",children:p.jsx(Rr,{text:"Loading group..."})}):a?p.jsxs("div",{className:"min-h-screen",children:[p.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("button",{onClick:()=>e("/groups"),className:"btn btn-ghost mb-6",children:[p.jsx(Qs,{className:"w-4 h-4"}),"Back to Groups"]}),p.jsx("div",{className:"card mb-6",children:p.jsx("div",{className:"card-content",children:p.jsxs("div",{className:"flex justify-between items-start",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-3xl font-bold text-archaeological-charcoal mb-2",children:a.name}),a.description&&p.jsx("p",{className:"text-archaeological-charcoal mb-4",children:a.description}),p.jsxs("div",{className:"flex items-center gap-4 text-sm text-archaeological-olive",children:[p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(Jr,{className:"w-4 h-4"}),p.jsxs("span",{children:[a.memberCount||0," members"]})]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(Ea,{className:"w-4 h-4"}),p.jsxs("span",{children:[d.length," artifacts"]})]})]})]}),s&&p.jsx("button",{onClick:R,className:"btn btn-ghost text-red-600 hover:bg-red-50",disabled:O,children:O?p.jsx(Rr,{size:"sm"}):p.jsxs(p.Fragment,{children:[p.jsx(l0,{className:"w-4 h-4"}),"Delete Group"]})})]})})}),p.jsx("div",{className:"border-b border-archaeological-lightBrown mb-6",children:p.jsxs("nav",{className:"-mb-px flex space-x-8",children:[p.jsx("button",{onClick:()=>_("overview"),className:`py-4 px-1 border-b-2 font-medium text-sm ${y==="overview"?"border-primary-500 text-primary-600":"border-transparent text-archaeological-olive hover:text-archaeological-charcoal hover:border-archaeological-lightBrown"}`,children:"Overview"}),p.jsxs("button",{onClick:()=>_("artifacts"),className:`py-4 px-1 border-b-2 font-medium text-sm ${y==="artifacts"?"border-primary-500 text-primary-600":"border-transparent text-archaeological-olive hover:text-archaeological-charcoal hover:border-archaeological-lightBrown"}`,children:[p.jsx(Ea,{className:"w-4 h-4 inline mr-1"}),"Artifacts (",d.length,")"]}),p.jsxs("button",{onClick:()=>_("members"),className:`py-4 px-1 border-b-2 font-medium text-sm ${y==="members"?"border-primary-500 text-primary-600":"border-transparent text-archaeological-olive hover:text-archaeological-charcoal hover:border-archaeological-lightBrown"}`,children:[p.jsx(Jr,{className:"w-4 h-4 inline mr-1"}),"Members"]}),s&&p.jsx("button",{onClick:()=>_("requests"),className:`py-4 px-1 border-b-2 font-medium text-sm ${y==="requests"?"border-primary-500 text-primary-600":"border-transparent text-archaeological-olive hover:text-archaeological-charcoal hover:border-archaeological-lightBrown"}`,children:"Join Requests"}),s&&p.jsxs("button",{onClick:()=>_("settings"),className:`py-4 px-1 border-b-2 font-medium text-sm ${y==="settings"?"border-primary-500 text-primary-600":"border-transparent text-archaeological-olive hover:text-archaeological-charcoal hover:border-archaeological-lightBrown"}`,children:[p.jsx(Yp,{className:"w-4 h-4 inline mr-1"}),"Settings"]})]})}),p.jsxs("div",{children:[y==="overview"&&p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Group Information"}),p.jsxs("dl",{className:"space-y-2",children:[p.jsxs("div",{children:[p.jsx("dt",{className:"text-sm font-medium text-archaeological-olive",children:"Privacy"}),p.jsx("dd",{className:"text-sm text-archaeological-charcoal capitalize",children:a.settings.privacy})]}),p.jsxs("div",{children:[p.jsx("dt",{className:"text-sm font-medium text-archaeological-olive",children:"Created"}),p.jsx("dd",{className:"text-sm text-archaeological-charcoal",children:new Date(a.createdAt).toLocaleDateString()})]})]})]})}),p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Stats"}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm text-archaeological-charcoal",children:"Total Artifacts"}),p.jsx("span",{className:"text-2xl font-bold text-primary-600",children:d.length})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm text-archaeological-charcoal",children:"Total Members"}),p.jsx("span",{className:"text-2xl font-bold text-primary-600",children:a.memberCount||0})]})]})]})})]}),y==="artifacts"&&p.jsx("div",{className:"card",children:p.jsx("div",{className:"card-content",children:d.length===0?p.jsxs("div",{className:"text-center py-12",children:[p.jsx(Ea,{className:"w-12 h-12 text-archaeological-sage mx-auto mb-4"}),p.jsx("p",{className:"text-archaeological-charcoal",children:"No artifacts in this group yet"}),p.jsx("button",{onClick:()=>e("/artifacts/new"),className:"btn btn-primary mt-4",children:"Create First Artifact"})]}):p.jsx("div",{className:"space-y-3",children:d.map(j=>p.jsxs("div",{onClick:()=>e(`/artifacts/${j.id}`),className:"flex items-center gap-4 p-4 bg-archaeological-warmGray rounded-lg hover:bg-archaeological-lightBrown cursor-pointer",children:[j.photos&&j.photos.length>0?p.jsx("img",{src:j.photos[0].url,alt:j.name,className:"w-16 h-16 object-cover rounded"}):p.jsx("div",{className:"w-16 h-16 bg-archaeological-lightBrown rounded flex items-center justify-center",children:p.jsx(Ea,{className:"w-6 h-6 text-archaeological-sage"})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h4",{className:"font-medium text-archaeological-charcoal",children:j.name}),p.jsx("p",{className:"text-sm text-archaeological-olive",children:j.artifactType})]})]},j.id))})})}),y==="members"&&t&&n&&p.jsx("div",{className:"card",children:p.jsx("div",{className:"card-content",children:p.jsx(IG,{groupId:t,canManage:s,currentUserId:n.id,onAddMember:()=>S(!0)})})}),y==="requests"&&s&&t&&p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content",children:[p.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Pending Join Requests"}),p.jsx(kG,{groupId:t,onRequestReviewed:C})]})}),y==="settings"&&s&&p.jsx(TG,{group:a,onUpdate:C})]})]}),k&&t&&p.jsx(CG,{groupId:t,onClose:()=>S(!1),onMemberAdded:()=>{C(),S(!1)}})]}):p.jsx("div",{className:"min-h-screen flex items-center justify-center",children:p.jsxs("div",{className:"text-center",children:[p.jsx("h2",{className:"text-2xl font-bold text-archaeological-charcoal mb-2",children:"Group Not Found"}),p.jsx("button",{onClick:()=>e("/groups"),className:"btn btn-primary mt-4",children:"Back to Groups"})]})})},OG=()=>{const t=gn(),{user:e}=bn(),[n,r]=H.useState([]),[s,i]=H.useState(new Set),[a,u]=H.useState(new Map),[d,m]=H.useState(!0),[y,_]=H.useState(""),[E,b]=H.useState(null);H.useEffect(()=>{k()},[e]);const k=async()=>{if(e)try{m(!0);const C=(await xU()).filter(Q=>Q.settings.privacy==="public");r(C);const R=await Tz(e.id),j=new Set(R.map(Q=>Q.groupId));i(j);const K=new Map;for(const Q of C)if(!j.has(Q.id)){const D=await J4(Q.id,e.id);D&&K.set(Q.id,D)}u(K)}catch(T){console.error("Error loading groups:",T),ye.error("Failed to load groups")}finally{m(!1)}},S=async T=>{try{b(T),await SG({groupId:T}),ye.success("Join request sent! Group admins will review your request."),await k()}catch(C){console.error("Error requesting to join:",C),ye.error(C.message||"Failed to send join request")}finally{b(null)}},O=n.filter(T=>{var C;return T.name.toLowerCase().includes(y.toLowerCase())||((C=T.description)==null?void 0:C.toLowerCase().includes(y.toLowerCase()))});return d?p.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:p.jsx(Rr,{text:"Loading groups..."})}):p.jsx("div",{className:"min-h-screen bg-gray-50",children:p.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("div",{className:"mb-8",children:[p.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Browse Public Groups"}),p.jsx("p",{className:"mt-2 text-gray-600",children:"Discover and join groups to collaborate with teams"})]}),p.jsx("div",{className:"mb-6",children:p.jsxs("div",{className:"relative",children:[p.jsx(dc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),p.jsx("input",{type:"text",placeholder:"Search public groups...",value:y,onChange:T=>_(T.target.value),className:"input pl-10 w-full"})]})}),O.length===0?p.jsx("div",{className:"card",children:p.jsxs("div",{className:"card-content text-center py-12",children:[p.jsx(qg,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:y?"No groups found":"No public groups available"}),p.jsx("p",{className:"text-gray-600 mb-6",children:y?"Try adjusting your search criteria":"Public groups will appear here when they are created"})]})}):p.jsx("div",{className:"space-y-4",children:O.map(T=>{const C=s.has(T.id),R=a.get(T.id),j=E===T.id;return p.jsx("div",{className:"card hover:shadow-lg transition-shadow",children:p.jsx("div",{className:"card-content",children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:T.name}),p.jsx(qg,{className:"w-4 h-4 text-green-500",title:"Public Group"})]}),T.description&&p.jsx("p",{className:"text-sm text-gray-600 mb-3",children:T.description}),p.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(Jr,{className:"w-4 h-4"}),p.jsxs("span",{children:[T.memberCount||0," members"]})]})})]}),p.jsx("div",{className:"ml-4",children:C?p.jsxs("button",{onClick:()=>t(`/groups/${T.id}`),className:"btn btn-primary flex items-center gap-2",children:[p.jsx(l2,{className:"w-4 h-4"}),"Member"]}):R?p.jsxs("button",{disabled:!0,className:"btn btn-secondary flex items-center gap-2",children:[p.jsx(eh,{className:"w-4 h-4"}),"Pending"]}):p.jsx("button",{onClick:()=>S(T.id),disabled:j,className:"btn btn-primary flex items-center gap-2",children:j?p.jsxs(p.Fragment,{children:[p.jsx(Rr,{size:"sm"}),"Requesting..."]}):p.jsxs(p.Fragment,{children:[p.jsx($g,{className:"w-4 h-4"}),"Request to Join"]})})})]})})},T.id)})}),O.length>0&&p.jsxs("div",{className:"mt-6 text-center text-sm text-gray-500",children:["Showing ",O.length," public group",O.length!==1?"s":""]})]})})};class MG extends H.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){this.setState({error:e,errorInfo:n})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:p.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:p.jsx("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:p.jsxs("div",{className:"flex items-center",children:[p.jsx("div",{className:"flex-shrink-0",children:p.jsx("svg",{className:"h-8 w-8 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),p.jsxs("div",{className:"ml-3",children:[p.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Something went wrong"}),p.jsx("div",{className:"mt-2 text-sm text-gray-500",children:p.jsx("p",{children:"We're sorry, but something unexpected happened. Please try refreshing the page."})}),!1,p.jsx("div",{className:"mt-4",children:p.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-primary btn-sm",children:"Refresh Page"})})]})]})})}):this.props.children}}const LG=()=>{const{user:t}=bn(),e=gn(),[n,r]=H.useState(!1),s=H.useRef(null);H.useEffect(()=>{const m=y=>{s.current&&!s.current.contains(y.target)&&r(!1)};return n&&document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}},[n]);const i=async()=>{try{await hx(ot),ye.success("Logged out successfully"),e("/login")}catch(m){console.error("Error logging out:",m),ye.error("Failed to log out")}},a=()=>{r(!1),e("/profile")},u=()=>{r(!1),e("/profile/delete")};if(!t)return null;const d=()=>{var m,y;return t.displayName?t.displayName.split(" ").map(_=>_[0]).join("").toUpperCase().slice(0,2):((y=(m=t.email)==null?void 0:m[0])==null?void 0:y.toUpperCase())||"U"};return p.jsxs("div",{className:"relative",ref:s,children:[p.jsxs("button",{onClick:()=>r(!n),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-archaeological-warmGray transition-colors","aria-label":"User menu",children:[p.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-600 text-white flex items-center justify-center font-semibold text-sm",children:d()}),p.jsxs("div",{className:"hidden md:block text-left",children:[p.jsx("p",{className:"text-sm font-medium text-archaeological-charcoal",children:t.displayName||t.username||"User"}),p.jsx("p",{className:"text-xs text-archaeological-olive",children:t.email})]}),p.jsx(YU,{className:`w-4 h-4 text-archaeological-olive transition-transform ${n?"rotate-180":""}`})]}),n&&p.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-archaeological border border-archaeological-lightBrown py-2 z-50",children:[p.jsxs("div",{className:"px-4 py-3 border-b border-archaeological-lightBrown",children:[p.jsx("p",{className:"text-sm font-semibold text-archaeological-charcoal",children:t.displayName||t.username||"User"}),p.jsx("p",{className:"text-xs text-archaeological-olive truncate",children:t.email}),t.role&&p.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-archaeological-lightBrown text-primary-800 mt-1",children:t.role})]}),t.role!=="guest"&&p.jsxs("div",{className:"py-1",children:[p.jsxs("button",{onClick:a,className:"w-full flex items-center gap-3 px-4 py-2 text-sm text-archaeological-charcoal hover:bg-archaeological-warmGray transition-colors",children:[p.jsx(th,{className:"w-4 h-4"}),p.jsx("span",{children:"View Profile"})]}),p.jsxs("button",{onClick:a,className:"w-full flex items-center gap-3 px-4 py-2 text-sm text-archaeological-charcoal hover:bg-archaeological-warmGray transition-colors",children:[p.jsx(Yp,{className:"w-4 h-4"}),p.jsx("span",{children:"Account Settings"})]})]}),t.role==="guest"&&p.jsxs("div",{className:"py-1 px-4 text-xs text-archaeological-olive",children:[p.jsx("p",{className:"italic",children:"You're browsing as a guest."}),p.jsx("p",{className:"mt-1",children:"Create an account to save data and access more features."})]}),p.jsxs("div",{className:"border-t border-archaeological-lightBrown py-1",children:[t.role!=="guest"&&p.jsxs("button",{onClick:u,className:"w-full flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors",children:[p.jsx(l0,{className:"w-4 h-4"}),p.jsx("span",{children:"Delete Account"})]}),p.jsxs("button",{onClick:i,className:"w-full flex items-center gap-3 px-4 py-2 text-sm text-archaeological-charcoal hover:bg-archaeological-warmGray transition-colors",children:[p.jsx(nz,{className:"w-4 h-4"}),p.jsx("span",{children:t.role==="guest"?"Exit Guest Mode":"Log Out"})]})]})]})]})},jG=()=>{const{user:t}=bn();return p.jsx("header",{className:"bg-archaeological-cream border-b border-archaeological-lightBrown sticky top-0 z-40",children:p.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:p.jsxs("div",{className:"flex justify-between items-center h-16",children:[p.jsxs($h,{to:"/dashboard",className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:[p.jsx(Ea,{className:"w-8 h-8 text-primary-600"}),p.jsxs("div",{children:[p.jsx("h1",{className:"text-lg font-bold text-archaeological-charcoal",children:"Artifacts Scanner"}),p.jsx("p",{className:"text-xs text-archaeological-olive",children:"Archaeological Management"})]})]}),t&&p.jsxs("nav",{className:"hidden md:flex items-center gap-6",children:[p.jsx($h,{to:"/dashboard",className:"text-sm font-medium text-archaeological-charcoal hover:text-primary-600 transition-colors",children:"Dashboard"}),p.jsx($h,{to:"/artifacts",className:"text-sm font-medium text-archaeological-charcoal hover:text-primary-600 transition-colors",children:"Artifacts"}),p.jsxs($h,{to:"/groups",className:"text-sm font-medium text-archaeological-charcoal hover:text-primary-600 transition-colors flex items-center gap-1",children:[p.jsx(Jr,{className:"w-4 h-4"}),"Groups"]}),p.jsx($h,{to:"/scanner",className:"text-sm font-medium text-archaeological-charcoal hover:text-primary-600 transition-colors",children:"Scanner"})]}),t&&p.jsx(LG,{})]})})})};function FG({showOnlineState:t=!0,isSyncing:e=!1,lastSyncAt:n,pendingChanges:r}){const s=xh(),{retryFailedChanges:i}=D4(),[a,u]=H.useState(0),[d,m]=H.useState(0);H.useEffect(()=>{const E=async()=>{const k=await aw();u(k)};E();const b=setInterval(E,5e3);return()=>clearInterval(b)},[]),H.useEffect(()=>{const E=async()=>{try{const S=(await Yn.pendingChanges.toArray()).filter(O=>O.retries>=3);m(S.length)}catch(k){console.error("Error checking failed changes:",k)}};E();const b=setInterval(E,5e3);return()=>clearInterval(b)},[]);const y=r??a;if(s&&!t&&y===0&&!e)return null;const _=E=>{if(!E)return"Never";const b=new Date(E),S=new Date().getTime()-b.getTime(),O=Math.floor(S/6e4);if(O<1)return"Just now";if(O<60)return`${O}m ago`;const T=Math.floor(O/60);return T<24?`${T}h ago`:b.toLocaleDateString()};return p.jsxs("div",{className:"fixed bottom-4 right-4 z-50",children:[p.jsxs("div",{className:`
          flex items-center gap-2 px-4 py-2 rounded-lg shadow-lg
          transition-all duration-300 backdrop-blur-sm
          ${s?"bg-white/90 border border-gray-200 text-gray-700":"bg-orange-500/90 text-white"}
        `,children:[p.jsxs("div",{className:"flex items-center gap-2",children:[s?p.jsx(p.Fragment,{children:e?p.jsx(mw,{className:"w-4 h-4 animate-spin"}):p.jsx(hz,{className:"w-4 h-4"})}):p.jsx(uz,{className:"w-4 h-4"}),p.jsx("span",{className:"text-sm font-medium",children:s?e?"Syncing...":"Online":"Offline"})]}),y>0&&p.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-blue-500 text-white rounded-full text-xs font-semibold",children:[p.jsx(ZU,{className:"w-3 h-3"}),y]}),s&&n&&!e&&p.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 border-l pl-2 ml-1 border-gray-300",children:[p.jsx(JU,{className:"w-3 h-3"}),p.jsx("span",{children:_(n)})]})]}),!s&&p.jsx("div",{className:"mt-2 px-4 py-2 bg-white/90 border border-orange-200 rounded-lg shadow-lg text-xs text-gray-600 backdrop-blur-sm",children:p.jsx("p",{children:"Working offline. Changes will sync when connection is restored."})}),s&&d>0&&p.jsx("div",{className:"mt-2 px-4 py-2 bg-red-50/90 border border-red-200 rounded-lg shadow-lg backdrop-blur-sm",children:p.jsxs("div",{className:"flex items-center justify-between gap-3",children:[p.jsxs("div",{className:"flex items-center gap-2 text-xs text-red-700",children:[p.jsx(a2,{className:"w-4 h-4"}),p.jsxs("span",{children:[d," change",d>1?"s":""," failed to sync"]})]}),p.jsxs("button",{onClick:i,className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-xs font-medium rounded transition-colors flex items-center gap-1",children:[p.jsx(mw,{className:"w-3 h-3"}),"Retry"]})]})})]})}function BG(){const{user:t,loading:e}=bn(),{syncStatus:n}=D4();return e?p.jsx(Rr,{}):p.jsx(MG,{children:p.jsx(EU,{children:p.jsxs("div",{className:"min-h-screen",children:[t&&p.jsx(jG,{}),t&&p.jsx(FG,{showOnlineState:!0,isSyncing:n.isSyncing,lastSyncAt:n.lastSyncAt,pendingChanges:n.pendingChanges}),p.jsxs(E8,{children:[p.jsx($n,{path:"/login",element:t?p.jsx(Wn,{to:"/dashboard",replace:!0}):p.jsx(dz,{})}),p.jsx($n,{path:"/dashboard",element:t?p.jsx(fz,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/artifacts",element:t?p.jsx(xz,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/artifacts/new",element:t?p.jsx(Ez,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/artifacts/:id/edit",element:t?p.jsx(Sz,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/artifacts/:id",element:t?p.jsx(Rz,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/scanner",element:t?p.jsx(nG,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/profile",element:t?p.jsx(rG,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/profile/edit",element:t?p.jsx(sG,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/profile/change-password",element:t?p.jsx(iG,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/profile/delete",element:t?p.jsx(lG,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/profile/request-role",element:t?p.jsx(mG,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/admin",element:t?p.jsx(gG,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/admin/users",element:t?p.jsx(_G,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/groups",element:t?p.jsx(EG,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/groups/new",element:t?p.jsx(AG,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/groups/:id",element:t?p.jsx(DG,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/groups/browse/public",element:t?p.jsx(OG,{}):p.jsx(Wn,{to:"/login",replace:!0})}),p.jsx($n,{path:"/",element:p.jsx(Wn,{to:t?"/dashboard":"/login",replace:!0})})]})]})})})}oy.createRoot(document.getElementById("root")).render(p.jsx(jr.StrictMode,{children:p.jsx(N8,{children:p.jsx(EB,{children:p.jsxs(fU,{children:[p.jsx(BG,{}),p.jsx(_6,{position:"top-center",toastOptions:{duration:3e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,iconTheme:{primary:"#10b981",secondary:"#fff"}},error:{duration:4e3,iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]})})})}));export{an as $,u3 as A,oc as B,qi as C,Gn as D,Kq as E,wc as F,yv as G,Hq as H,$G as I,Ks as J,vj as K,Aj as L,Ku as M,wq as N,_q as O,$j as P,Nr as Q,uq as R,YG as S,vn as T,Fq as U,Mp as V,qj as W,jq as X,xq as Y,tq as Z,eN as _,mf as a,QG as a0,Ej as a1,kj as a2,$q as a3,Oj as a4,Lq as a5,sq as a6,Wq as a7,Vt as a8,lq as a9,aq as aA,Cq as aB,Tq as aC,cq as aD,Jf as aE,kq as aF,Dq as aG,zj as aH,ur as aI,XR as aJ,XG as aK,Mq as aL,Pn as aM,$0 as aN,zq as aO,zG as aP,vq as aQ,mq as aR,fq as aS,yq as aT,iq as aU,Wr as aV,Vq as aW,nq as aX,Zt as aY,Uq as aZ,JG as aa,eq as ab,rq as ac,qq as ad,pq as ae,gq as af,An as ag,e0 as ah,Mj as ai,Sq as aj,ll as ak,Eq as al,Aq as am,hr as an,bq as ao,Iq as ap,bj as aq,Gq as ar,Bq as as,ZG as at,hq as au,dq as av,oq as aw,Nq as ax,Pq as ay,Rq as az,Ij as b,$u as c,_c as d,Ht as e,ge as f,yh as g,Yf as h,Rm as i,zp as j,Zf as k,Vp as l,Cv as m,Hu as n,Up as o,Ol as p,Wj as q,kn as r,Zl as s,Se as t,qG as u,mL as v,fn as w,Qq as x,ft as y,GG as z};
//# sourceMappingURL=index-2bbea03d.js.map
